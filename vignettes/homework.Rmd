---
title: "Homework"
author: "åº·æ˜Šæ–‡ SA24231055"
date: "`r Sys.Date()`"
output: 
  prettydoc::html_pretty:
    theme: cayman
    highlight: vignette
    toc: true         # å¼€å¯ç›®å½•
    toc_depth: 5      # ç›®å½•æ·±åº¦ï¼Œ5 è¡¨ç¤ºåŒ…æ‹¬äº”çº§æ ‡é¢˜
editor_options: 
  markdown: 
    wrap: 72
vignette: >
  %\VignetteIndexEntry{Homework}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

<style>
/* ç›®å½•æ ·å¼ */
#TOC {
  position: fixed;
  left: 0px;
  top: 0px;
  width: 320px; /* åˆå§‹å®½åº¦ */
  height: 100%;
  overflow: auto;
  background-color: #ffffff;
  border-right: 3px solid #007bff;
  padding: 15px;
  box-shadow: 5px 0 10px rgba(0,0,0,0.1);
  font-family: 'Arial', sans-serif;
  font-size: 16px; /* è°ƒèŠ‚å­—ä½“å¤§å° */
  resize: horizontal; /* å…è®¸æ°´å¹³æ–¹å‘è°ƒæ•´å®½åº¦ */
  max-width: 400px; /* è®¾ç½®æœ€å¤§å®½åº¦ */
  min-width: 200px; /* è®¾ç½®æœ€å°å®½åº¦ */
  z-index: 1000;
}

/* ä¸»å†…å®¹åŒºæ ·å¼ */
.main-content {
  margin-left: calc(320px + 2px); /* åˆå§‹ç›®å½•å®½åº¦ + 2px çš„é—´è· */
}

body {
  margin-left: calc(320px + 2px); /* é€‚ç”¨äºæ•´ä¸ªé¡µé¢çš„å†…å®¹ */
}

/* å±…ä¸­æ ‡é¢˜æ ·å¼ */
.center-title {
  text-align: center;
  font-size: 1.5em;
  font-weight: bold;
  margin-top: 20px;
  margin-bottom: 20px;
  color: black !important; /* è®¾ç½®å­—ä½“é¢œè‰²ä¸ºé»‘è‰² */
}

/* æ–°å¢æ ·å¼ï¼šå±…ä¸­ç›®å½•ä¸­çš„ç‰¹å®šé¡¹ */
#TOC a[href="#ç»Ÿè®¡è®¡ç®—ç¬¬1æ¬¡ä½œä¸š"],
#TOC a[href="#ç»Ÿè®¡è®¡ç®—ç¬¬2æ¬¡ä½œä¸š"],
#TOC a[href="#ç»Ÿè®¡è®¡ç®—ç¬¬3æ¬¡ä½œä¸š"],
#TOC a[href="#ç»Ÿè®¡è®¡ç®—ç¬¬4æ¬¡ä½œä¸š"],
#TOC a[href="#ç»Ÿè®¡è®¡ç®—è¯¾å ‚ä½œä¸š"],
#TOC a[href="#ç»Ÿè®¡è®¡ç®—ç¬¬5æ¬¡ä½œä¸š"],
#TOC a[href="#ç»Ÿè®¡è®¡ç®—ç¬¬6æ¬¡ä½œä¸š"],
#TOC a[href="#ç»Ÿè®¡è®¡ç®—ç¬¬7æ¬¡ä½œä¸š"],
#TOC a[href="#ç»Ÿè®¡è®¡ç®—ç¬¬8æ¬¡ä½œä¸š"],
#TOC a[href="#ç»Ÿè®¡è®¡ç®—ç¬¬9æ¬¡ä½œä¸š"],
#TOC a[href="#ç»Ÿè®¡è®¡ç®—ç¬¬10æ¬¡ä½œä¸š"] {
  display: block;
  text-align: center;
  font-weight: bold;
  margin: 10px 0; /* å¯é€‰ï¼šè°ƒæ•´ä¸Šä¸‹é—´è· */
}
</style>

# ç»Ÿè®¡è®¡ç®—ç¬¬1æ¬¡ä½œä¸š { .center-title }

ä»¥ä¸‹æ˜¯ç»Ÿè®¡è®¡ç®—2024-09-09è¯¾ç¨‹å¯¹åº”çš„ä½œä¸š

# Question

# Question

Use knitr to produce at least 3 examples. For each example,texts should mix with figures and/or tables. Better to have mathematical formulas.

# Answer

# ç¤ºä¾‹ 1ï¼šç»˜åˆ¶æ­£å¼¦å‡½æ•°å¹¶è®¡ç®—å…¶åœ¨ä¸€å®šèŒƒå›´å†…çš„å®šç§¯åˆ†

## ç¤ºä¾‹æè¿°

æœ¬å®ä¾‹å°†ä¼šç»˜åˆ¶æ­£å¼¦å‡½æ•°çš„å›¾å½¢ï¼Œå¹¶è®¡ç®—å®ƒåœ¨åŒºé—´ \([0, \pi]\) ä¸Šçš„å®šç§¯åˆ†ã€‚

## ä»£ç ã€æ³¨é‡Šä¸æ¦‚è¿°


```{r, eval=TRUE}
# åŠ è½½å¿…è¦çš„åŒ…
library(ggplot2)  # ç”¨äºç»˜å›¾
```


```{r, eval=TRUE}
# åˆ›å»º x çš„å–å€¼èŒƒå›´ï¼Œä» 0 åˆ° 2Ï€ï¼Œå…± 1000 ä¸ªç‚¹
x_values <- seq(0, 2 * pi, length.out = 1000)

# è®¡ç®—å¯¹åº”çš„ y å€¼ï¼Œå³æ­£å¼¦å‡½æ•°å€¼
y_values <- sin(x_values)

# åˆ›å»ºæ•°æ®æ¡†ä¿å­˜ x å’Œ y çš„å€¼
data <- data.frame(x = x_values, y = y_values)

# ä½¿ç”¨ ggplot2 ç»˜åˆ¶æ­£å¼¦å‡½æ•°æ›²çº¿
ggplot(data, aes(x = x, y = y)) +
  geom_line(color = "blue") +  # ç»˜åˆ¶æ›²çº¿ï¼Œé¢œè‰²ä¸ºè“è‰²
  ggtitle("æ­£å¼¦å‡½æ•°æ›²çº¿") +     # æ·»åŠ æ ‡é¢˜
  xlab("x") +                  # æ·»åŠ  x è½´æ ‡ç­¾
  ylab("sin(x)")+              # æ·»åŠ  y è½´æ ‡ç­¾
  theme(plot.title = element_text(hjust = 0.5))  # æ ‡é¢˜å±…ä¸­
```

**ä»£ç æ¦‚è¿°ï¼š**

- ä½¿ç”¨ `seq` å‡½æ•°åˆ›å»º x çš„å–å€¼èŒƒå›´ã€‚
- è®¡ç®—å¯¹åº”çš„ y å€¼ï¼Œå³ \( \sin(x) \)ã€‚
- å°† x å’Œ y çš„å€¼ä¿å­˜åˆ°æ•°æ®æ¡† `data` ä¸­ã€‚
- ä½¿ç”¨ `ggplot2` ç»˜åˆ¶æ›²çº¿ï¼Œ`geom_line` å‡½æ•°ç”¨äºç»˜åˆ¶çº¿æ¡ã€‚


```{r, eval=TRUE}
# ä½¿ç”¨ integrate å‡½æ•°è®¡ç®—æ­£å¼¦å‡½æ•°åœ¨ [0, Ï€] ä¸Šçš„å®šç§¯åˆ†
result <- integrate(sin, lower = 0, upper = pi)

# æ‰“å°ç§¯åˆ†ç»“æœ
print(paste("å®šç§¯åˆ†ç»“æœä¸ºï¼š", result$value))
```

**ä»£ç æ¦‚è¿°ï¼š**

- `integrate` å‡½æ•°ç”¨äºè®¡ç®—æ•°å€¼ç§¯åˆ†ã€‚
- `sin` æ˜¯è¢«ç§¯å‡½æ•°ï¼Œ`lower` å’Œ `upper` åˆ†åˆ«æ˜¯ç§¯åˆ†ä¸‹é™å’Œä¸Šé™ã€‚
- `result$value` æ˜¯ç§¯åˆ†ç»“æœçš„æ•°å€¼éƒ¨åˆ†ã€‚

**ç†è®ºè®¡ç®—ï¼š**

æ ¹æ®å®šç§¯åˆ†çš„è®¡ç®—å…¬å¼ï¼š

$$
\int_{0}^{\pi} \sin(x) \, dx = -\cos(x) \Big|_{0}^{\pi} = -\cos(\pi) + \cos(0) = -(-1) + 1 = 2
$$

**éªŒè¯ç»“æœï¼š**

è¿è¡Œä»£ç åï¼Œå¾—åˆ°ç§¯åˆ†ç»“æœä¸º `2`ï¼Œä¸ç†è®ºè®¡ç®—ä¸€è‡´ï¼ŒéªŒè¯äº†ä»£ç è¿è¡Œæ— è¯¯ã€‚

---

# ç¤ºä¾‹ 2ï¼šçº¿æ€§å›å½’åˆ†æä¸ç»“æœå¯è§†åŒ–

## ç¤ºä¾‹æè¿°

æœ¬å®ä¾‹å°†ä¼šç”Ÿæˆä¸€ç»„æ¨¡æ‹Ÿæ•°æ®ï¼Œè¿›è¡Œç®€å•çš„çº¿æ€§å›å½’åˆ†æï¼Œå¹¶å¯¹ç»“æœè¿›è¡Œå¯è§†åŒ–å±•ç¤ºã€‚

## ä»£ç ã€æ³¨é‡Šä¸æ¦‚è¿°

```{r, eval=TRUE}
# è®¾ç½®éšæœºç§å­ä»¥ç¡®ä¿ç»“æœå¯é‡å¤
set.seed(111)

# ç”Ÿæˆè‡ªå˜é‡ xï¼ŒèŒƒå›´åœ¨ 0 åˆ° 10 ä¹‹é—´çš„ 1000 ä¸ªéšæœºæ•°
x <- runif(1000, min = 0, max = 10)

# ç”Ÿæˆè¯¯å·®é¡¹ï¼Œæœä»å‡å€¼ä¸º 0ï¼Œæ ‡å‡†å·®ä¸º 1 çš„æ­£æ€åˆ†å¸ƒ
epsilon <- rnorm(1000, mean = 0, sd = 1)

# ç”Ÿæˆå› å˜é‡ yï¼Œå‡è®¾ y = 2x + 1 + è¯¯å·®
y <- 2 * x + 1 + epsilon

# åˆ›å»ºæ•°æ®æ¡†ä¿å­˜ x å’Œ y çš„å€¼
data <- data.frame(x = x, y = y)
```

**ä»£ç æ¦‚è¿°ï¼š**

- `set.seed(111)`ï¼šè®¾ç½®éšæœºæ•°ç§å­ï¼Œä¿è¯ç»“æœå¯é‡å¤ã€‚
- `runif` å‡½æ•°ç”Ÿæˆå‡åŒ€åˆ†å¸ƒçš„éšæœºæ•°ã€‚
- `rnorm` å‡½æ•°ç”Ÿæˆæ­£æ€åˆ†å¸ƒçš„éšæœºæ•°ã€‚
- å› å˜é‡ y ä¸è‡ªå˜é‡ x ä¹‹é—´å­˜åœ¨çº¿æ€§å…³ç³»ï¼Œè¯¯å·®é¡¹æ¨¡æ‹ŸçœŸå®æ•°æ®ä¸­çš„å™ªå£°ã€‚

```{r, eval=TRUE}
# è¿›è¡Œçº¿æ€§å›å½’åˆ†æï¼Œy å…³äº x çš„å›å½’
model <- lm(y ~ x, data = data)

# æŸ¥çœ‹æ¨¡å‹æ¦‚è¦
summary(model)
```

**ä»£ç æ¦‚è¿°ï¼š**

- ä½¿ç”¨ `lm` å‡½æ•°ï¼ˆâ€œlinear modelâ€çš„ç¼©å†™ï¼‰è¿›è¡Œçº¿æ€§å›å½’åˆ†æã€‚
- `y ~ x` è¡¨ç¤º y æ˜¯å› å˜é‡ï¼Œx æ˜¯è‡ªå˜é‡ã€‚
- `summary(model)` è¾“å‡ºæ¨¡å‹çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç³»æ•°ã€R æ–¹ã€F æ£€éªŒç­‰ã€‚

**æ¨¡å‹å…¬å¼ï¼š**

çº¿æ€§å›å½’æ¨¡å‹çš„æ•°å­¦å½¢å¼ä¸ºï¼š

$$
y = \beta_0 + \beta_1 x + \epsilon
$$

å…¶ä¸­ï¼š

- \( \beta_0 \)ï¼šæˆªè·é¡¹
- \( \beta_1 \)ï¼šè‡ªå˜é‡ x çš„å›å½’ç³»æ•°
- \( \epsilon \)ï¼šè¯¯å·®é¡¹

**ç»“æœè¯´æ˜ï¼š**

- æˆªè·å’Œæ–œç‡çš„ä¼°è®¡å€¼ååˆ†æ¥è¿‘çœŸå®å€¼ï¼ˆ1 å’Œ 2ï¼‰ã€‚
- R æ–¹æ¥è¿‘ 1ï¼Œè¯´æ˜æ¨¡å‹å…·æœ‰è‰¯å¥½çš„æ‹Ÿåˆåº¦ã€‚

```{r, eval=TRUE}
# ç»˜åˆ¶æ•£ç‚¹å›¾å’Œå›å½’ç›´çº¿
ggplot(data, aes(x = x, y = y)) +
  geom_point(color = "blue") +                     # ç»˜åˆ¶æ•£ç‚¹å›¾
  geom_smooth(method = "lm", color = "red") +      # æ·»åŠ å›å½’ç›´çº¿
  ggtitle("çº¿æ€§å›å½’åˆ†æç»“æœ") +                      # æ·»åŠ æ ‡é¢˜
  xlab("è‡ªå˜é‡ x") +                               # æ·»åŠ  x è½´æ ‡ç­¾
  ylab("å› å˜é‡ y") +                                # æ·»åŠ  y è½´æ ‡ç­¾
  theme(plot.title = element_text(hjust = 0.5))  # æ ‡é¢˜å±…ä¸­
```

**ä»£ç æ¦‚è¿°ï¼š**

- `geom_point` ç»˜åˆ¶æ•£ç‚¹å›¾ï¼Œæ˜¾ç¤ºæ•°æ®ç‚¹çš„åˆ†å¸ƒã€‚
- `geom_smooth` æ·»åŠ å›å½’ç›´çº¿ï¼Œ`method = "lm"` æŒ‡å®šçº¿æ€§æ¨¡å‹ã€‚
- é€šè¿‡å›¾å½¢å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°æ•°æ®çš„åˆ†å¸ƒå’Œæ¨¡å‹çš„æ‹Ÿåˆæƒ…å†µã€‚

---

# ç¤ºä¾‹ 3ï¼šæ±‚è§£å¾®åˆ†æ–¹ç¨‹å¹¶ç»˜åˆ¶è§£çš„æ›²çº¿

## ç¤ºä¾‹æè¿°

æœ¬ä¾‹ä¸­ï¼Œå°†ä½¿ç”¨ R è¯­è¨€æ±‚è§£ä¸€é˜¶å¸¸å¾®åˆ†æ–¹ç¨‹ï¼Œå¹¶ç»˜åˆ¶è§£çš„æ›²çº¿ã€‚

## å¾®åˆ†æ–¹ç¨‹æè¿°

è€ƒè™‘ä»¥ä¸‹ä¸€é˜¶çº¿æ€§å¾®åˆ†æ–¹ç¨‹ï¼š

$$
\frac{dy}{dx} + y = e^{-x}, \quad y(0) = 1
$$

## è§£æè§£æ±‚è§£

**æ¨å¯¼ 1ï¼š**

è®¡ç®—ç§¯åˆ†å› å­ \( \mu(x) \)ï¼š

$$
\mu(x) = e^{\int 1 \, dx} = e^{x}
$$

**æ¨å¯¼ 2ï¼š**

å°†æ–¹ç¨‹ä¸¤è¾¹ä¹˜ä»¥ç§¯åˆ†å› å­ï¼š

$$
e^{x} \frac{dy}{dx} + e^{x} y = e^{x} e^{-x} \implies e^{x} \frac{dy}{dx} + e^{x} y = 1
$$

**æ¨å¯¼ 3ï¼š**

å·¦è¾¹ä¸ºä¹˜ç§¯çš„å¯¼æ•°ï¼š

$$
\frac{d}{dx}(e^{x} y) = 1
$$

**æ¨å¯¼ 4ï¼š**

å¯¹ä¸¤è¾¹ç§¯åˆ†ï¼š

$$
e^{x} y = x + C
$$

**æ¨å¯¼ 5ï¼š**

è§£å‡º yï¼š

$$
y = e^{-x} (x + C)
$$

**æ¨å¯¼ 6ï¼š**

åˆ©ç”¨åˆå§‹æ¡ä»¶ \( y(0) = 1 \) æ±‚è§£å¸¸æ•° Cï¼š

$$
1 = e^{0} (0 + C) \implies C = 1
$$

**æœ€ç»ˆè§£ï¼š**

$$
y(x) = e^{-x} (x + 1)
$$

## ä»£ç ã€æ³¨é‡Šä¸æ¦‚è¿°

```{r, eval=TRUE}
# å®šä¹‰è§£å‡½æ•° y(x)
y <- function(x) {
  exp(-x) * (x + 1)
}

# åˆ›å»º x çš„å–å€¼èŒƒå›´ï¼Œä» 0 åˆ° 5ï¼Œå…± 100 ä¸ªç‚¹
x_values <- seq(0, 5, length.out = 100)

# è®¡ç®—å¯¹åº”çš„ y å€¼
y_values <- y(x_values)

# åˆ›å»ºæ•°æ®æ¡†ä¿å­˜ x å’Œ y çš„å€¼
data <- data.frame(x = x_values, y = y_values)

# ä½¿ç”¨ ggplot2 ç»˜åˆ¶è§£çš„æ›²çº¿
ggplot(data, aes(x = x, y = y)) +
  geom_line(color = "green") +      # ç»˜åˆ¶æ›²çº¿ï¼Œé¢œè‰²ä¸ºç»¿è‰²
  ggtitle("å¾®åˆ†æ–¹ç¨‹è§£çš„æ›²çº¿") +       # æ·»åŠ æ ‡é¢˜
  xlab("x") +                       # æ·»åŠ  x è½´æ ‡ç­¾
  ylab("y(x)") +                     # æ·»åŠ  y è½´æ ‡ç­¾
  theme(plot.title = element_text(hjust = 0.5))  # æ ‡é¢˜å±…ä¸­
```

**ä»£ç æ¦‚è¿°ï¼š**

- å®šä¹‰è§£æè§£å‡½æ•° `y(x)`ã€‚
- åˆ›å»º x çš„å–å€¼èŒƒå›´å¹¶è®¡ç®—å¯¹åº”çš„ y å€¼ã€‚
- ä½¿ç”¨ `ggplot2` ç»˜åˆ¶è§£çš„æ›²çº¿ï¼Œç›´è§‚å±•ç¤ºè§£çš„å˜åŒ–è¶‹åŠ¿ã€‚


---

# ç¤ºä¾‹ 4ï¼šä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰ä¸æ•°æ®å¯è§†åŒ–

## ç¤ºä¾‹æè¿°

æœ¬å®ä¾‹å°†å¯¹ Iris æ•°æ®é›†è¿›è¡Œä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰ï¼Œå¹¶å°†ç»“æœè¿›è¡Œå¯è§†åŒ–ã€‚

## ä»£ç ã€æ³¨é‡Šä¸æ¦‚è¿°

```{r, eval=TRUE}
# åŠ è½½ Iris æ•°æ®é›†
data(iris)

# æŸ¥çœ‹æ•°æ®é›†çš„ç»“æ„
str(iris)
```

**ä»£ç æ¦‚è¿°ï¼š**

- `data(iris)` åŠ è½½å†…ç½®çš„ Iris æ•°æ®é›†ã€‚
- `str(iris)` æŸ¥çœ‹æ•°æ®é›†çš„ç»“æ„ï¼ŒåŒ…æ‹¬å˜é‡ç±»å‹å’Œæ•°é‡ã€‚

**æ•°æ®é›†æè¿°ï¼š**

- Iris æ•°æ®é›†åŒ…å« 150 ä¸ªæ ·æœ¬ï¼Œ5 ä¸ªå˜é‡ï¼š
  - `Sepal.Length`ï¼šèŠ±è¼é•¿åº¦
  - `Sepal.Width`ï¼šèŠ±è¼å®½åº¦
  - `Petal.Length`ï¼šèŠ±ç“£é•¿åº¦
  - `Petal.Width`ï¼šèŠ±ç“£å®½åº¦
  - `Species`ï¼šç‰©ç§ï¼ˆSetosaã€Versicolorã€Virginicaï¼‰

```{r, eval=TRUE}
# æå–æµ‹é‡å˜é‡ï¼ˆå‰ 4 åˆ—ï¼‰
iris_data <- iris[, 1:4]

# è¿›è¡Œ PCA åˆ†æï¼Œæ•°æ®ä¸­å¿ƒåŒ–å’Œæ ‡å‡†åŒ–
pca_result <- prcomp(iris_data, center = TRUE, scale. = TRUE)

# æŸ¥çœ‹ PCA ç»“æœçš„æ¦‚è¦ä¿¡æ¯
summary(pca_result)
```

**ä»£ç æ¦‚è¿°ï¼š**

- `prcomp` å‡½æ•°ç”¨äº PCA åˆ†æã€‚
- `center = TRUE` è¡¨ç¤ºå¯¹æ•°æ®è¿›è¡Œä¸­å¿ƒåŒ–å¤„ç†ã€‚
- `scale. = TRUE` è¡¨ç¤ºè¿›è¡Œæ ‡å‡†åŒ–ã€‚
- `summary(pca_result)` æ˜¾ç¤ºä¸»æˆåˆ†çš„æ–¹å·®è§£é‡Šæ¯”ä¾‹ç­‰ä¿¡æ¯ã€‚

**æ•°å­¦åŸç†ï¼š**

- PCA é€šè¿‡å¯¹åæ–¹å·®çŸ©é˜µè¿›è¡Œç‰¹å¾å€¼åˆ†è§£ï¼Œæ‰¾åˆ°æ•°æ®ä¸­æ–¹å·®æœ€å¤§çš„æ–¹å‘ï¼Œå³ä¸»æˆåˆ†ã€‚
- åæ–¹å·®çŸ©é˜µ \( S \) çš„è®¡ç®—ï¼š

$$
S = \frac{1}{n - 1} X^\top X
$$

- ç‰¹å¾å€¼åˆ†è§£ï¼š
- å…¶ä¸­ğ‘‰æ˜¯åŒ…å«ç‰¹å¾å‘é‡çš„çŸ©é˜µï¼ŒÎ›æ˜¯å¯¹è§’çŸ©é˜µï¼Œå¯¹è§’çº¿ä¸Šçš„å…ƒç´ æ˜¯ç‰¹å¾å€¼ï¼ŒæŒ‰ç…§ä»å¤§åˆ°å°çš„é¡ºåºæ’åˆ—ã€‚

$$
S = V \Lambda V^\top
$$

- ä¸»æˆåˆ†å¾—åˆ†ï¼š

$$
Z = X V
$$

```{r, eval=TRUE}
# æå–ä¸»æˆåˆ†å¾—åˆ†ï¼Œå¹¶æ·»åŠ ç‰©ç§ä¿¡æ¯
scores <- data.frame(pca_result$x, Species = iris$Species)

# ä½¿ç”¨ ggplot2 ç»˜åˆ¶å‰ä¸¤ä¸ªä¸»æˆåˆ†çš„æ•£ç‚¹å›¾
ggplot(scores, aes(x = PC1, y = PC2, color = Species)) +
  geom_point(size = 2) +                   # ç»˜åˆ¶æ•£ç‚¹ï¼Œè®¾ç½®ç‚¹çš„å¤§å°
  ggtitle("Iris æ•°æ®é›†çš„ PCA åˆ†æ") +         # æ·»åŠ æ ‡é¢˜
  xlab("ä¸»æˆåˆ† 1") +                       # æ·»åŠ  x è½´æ ‡ç­¾
  ylab("ä¸»æˆåˆ† 2") +                        # æ·»åŠ  y è½´æ ‡ç­¾
  theme(plot.title = element_text(hjust = 0.5))  # æ ‡é¢˜å±…ä¸­
```

**ä»£ç æ¦‚è¿°ï¼š**

- æå– PCA çš„å‰ä¸¤ä¸ªä¸»æˆåˆ†å¾—åˆ†ã€‚
- åˆå¹¶ç‰©ç§ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨å›¾ä¸­ç”¨é¢œè‰²åŒºåˆ†ã€‚
- ä½¿ç”¨ `ggplot2` ç»˜åˆ¶æ•£ç‚¹å›¾ï¼Œç›´è§‚å±•ç¤ºæ•°æ®åœ¨ä¸»æˆåˆ†ç©ºé—´çš„åˆ†å¸ƒã€‚


---

# ç¤ºä¾‹ 5ï¼šä½¿ç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•æ±‚è§£çº¦æŸä¼˜åŒ–é—®é¢˜

## ç¤ºä¾‹æè¿°

åœ¨æœ¬å®ä¾‹ä¸­ï¼Œå°†ä½¿ç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•æ±‚è§£ä¸€ä¸ªå¸¦çº¦æŸçš„ä¼˜åŒ–é—®é¢˜ï¼Œå¹¶éªŒè¯ç»“æœã€‚

## å¯¹çº¦æŸä¼˜åŒ–é—®é¢˜çš„æè¿°

æœ€å¤§åŒ–å‡½æ•°ï¼š

$$
f(x, y) = x y
$$

çº¦æŸæ¡ä»¶ï¼š

$$
x^2 + y^2 = 1
$$

å³åœ¨å•ä½åœ†ä¸Šæ‰¾åˆ°ä½¿ \( f(x, y) \) æœ€å¤§çš„ç‚¹ã€‚

## æ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•æ±‚è§£

**æ¨å¯¼ 1ï¼š**

æ„é€ æ‹‰æ ¼æœ—æ—¥å‡½æ•°ï¼š

$$
L(x, y, \lambda) = x y - \lambda (x^2 + y^2 - 1)
$$

**æ¨å¯¼ 2ï¼š**

å¯¹ \( x, y, \lambda \) æ±‚åå¯¼æ•°å¹¶ä»¤å…¶ç­‰äºé›¶ï¼š

1. å¯¹äº \( x \)ï¼š

$$
\frac{\partial L}{\partial x} = y - 2\lambda x = 0 \quad (1)
$$

2. å¯¹äº \( y \)ï¼š

$$
\frac{\partial L}{\partial y} = x - 2\lambda y = 0 \quad (2)
$$

3. å¯¹äº \( \lambda \)ï¼š

$$
\frac{\partial L}{\partial \lambda} = -(x^2 + y^2 - 1) = 0 \quad (3)
$$

**æ¨å¯¼ 3ï¼š**

ä» (1) å’Œ (2) å¼ï¼Œè§£å‡º \( y \) å’Œ \( x \) çš„å…³ç³»ï¼š

- ä» (1) å¾—ï¼š

$$
y = 2\lambda x
$$

- ä» (2) å¾—ï¼š

$$
x = 2\lambda y
$$

- å°† \( y \) ä»£å…¥ \( x \) çš„è¡¨è¾¾å¼ï¼š

$$
x = 2\lambda (2\lambda x) \implies x = 4\lambda^2 x \implies x (1 - 4\lambda^2) = 0
$$

**æ¨å¯¼ 4ï¼š**

è§£å‡º \( x \) å’Œ \( \lambda \) çš„å€¼ï¼š

- å½“ \( x = 0 \) æ—¶ï¼Œç”± (3) å¾—ï¼š

$$
0^2 + y^2 = 1 \implies y = \pm 1
$$

- å½“ \( x \ne 0 \) æ—¶ï¼Œ\( 1 - 4\lambda^2 = 0 \implies \lambda = \pm \frac{1}{2} \)

- å¯¹åº”çš„ \( y = 2\lambda x = \pm x \)

**æ¨å¯¼ 5ï¼š**

æ±‚å‡ºå¯èƒ½çš„è§£ï¼š

- \( x = 0, y = \pm 1 \)
- \( y = x \) æˆ– \( y = -x \)ï¼Œä¸” \( x^2 + y^2 = 1 \implies x = \pm \frac{1}{\sqrt{2}} \)

**æ¨å¯¼ 6ï¼š**

è®¡ç®—ç›®æ ‡å‡½æ•°å€¼ï¼š

- \( f\left( \frac{1}{\sqrt{2}}, \frac{1}{\sqrt{2}} \right) = \frac{1}{2} \)
- \( f\left( -\frac{1}{\sqrt{2}}, -\frac{1}{\sqrt{2}} \right) = \frac{1}{2} \)
- \( f\left( \frac{1}{\sqrt{2}}, -\frac{1}{\sqrt{2}} \right) = -\frac{1}{2} \)
- \( f\left( -\frac{1}{\sqrt{2}}, \frac{1}{\sqrt{2}} \right) = -\frac{1}{2} \)
- \( f(0, \pm 1) = 0 \)

**ç»“è®ºï¼š**

ç›®æ ‡å‡½æ•°çš„æœ€å¤§å€¼ä¸º \( \frac{1}{2} \)ï¼Œåœ¨ç‚¹ \( \left( \frac{1}{\sqrt{2}}, \frac{1}{\sqrt{2}} \right) \) å’Œ \( \left( -\frac{1}{\sqrt{2}}, -\frac{1}{\sqrt{2}} \right) \) å¤„å–å¾—ã€‚

## ä»£ç ã€æ³¨é‡Šä¸æ¦‚è¿°

```{r, eval=TRUE}
# å®šä¹‰ç›®æ ‡å‡½æ•°
f <- function(x, y) {
  x * y
}

# åˆ›å»ºå¯èƒ½çš„è§£ç‚¹
points <- data.frame(
  x = c(1 / sqrt(2), -1 / sqrt(2), 1 / sqrt(2), -1 / sqrt(2), 0, 0),
  y = c(1 / sqrt(2), -1 / sqrt(2), -1 / sqrt(2), 1 / sqrt(2), 1, -1)
)

# è®¡ç®—ç›®æ ‡å‡½æ•°å€¼
points$f_value <- with(points, f(x, y))

# æ‰“å°ç»“æœ
print(points)
```

**ä»£ç æ¦‚è¿°ï¼š**

- å®šä¹‰ç›®æ ‡å‡½æ•° \( f(x, y) = x y \)ã€‚
- åˆ—å‡ºæ‰€æœ‰å¯èƒ½çš„è§£ç‚¹ï¼ŒåŒ…æ‹¬å¯¹ç§°ç‚¹å’Œè¾¹ç•Œç‚¹ã€‚
- è®¡ç®—æ¯ä¸ªç‚¹çš„ç›®æ ‡å‡½æ•°å€¼ï¼ŒéªŒè¯æœ€å¤§å€¼ä¸º \( \frac{1}{2} \)ã€‚


```{r, eval=TRUE}
# åŠ è½½å¿…è¦çš„åŒ…
library(ggplot2)
library(ggforce)  # ç”¨äºç»˜åˆ¶åœ†

# åˆ›å»º x å’Œ y çš„ç½‘æ ¼
x_seq <- seq(-1, 1, length.out = 100)
y_seq <- seq(-1, 1, length.out = 100)
grid <- expand.grid(x = x_seq, y = y_seq)

# å®šä¹‰ç›®æ ‡å‡½æ•°
f <- function(x, y) {
  x * y
}

# è®¡ç®—ç›®æ ‡å‡½æ•°å€¼
grid$z <- with(grid, f(x, y))

# æ ‡è®°æ»¡è¶³çº¦æŸæ¡ä»¶çš„ç‚¹
grid$constraint <- with(grid, x^2 + y^2 <= 1)

# è¿‡æ»¤æ»¡è¶³çº¦æŸæ¡ä»¶çš„ç‚¹
grid <- grid[grid$constraint, ]

# ç»˜åˆ¶ç›®æ ‡å‡½æ•°çš„ç­‰é«˜çº¿å›¾å’Œçº¦æŸæ¡ä»¶
ggplot() +
  geom_contour_filled(data = grid, aes(x = x, y = y, z = z)) +  # ç»˜åˆ¶ç­‰é«˜çº¿å¡«å……å›¾
  geom_circle(aes(x0 = 0, y0 = 0, r = 1),                      # ç»˜åˆ¶å•ä½åœ†
              color = "red", inherit.aes = FALSE) +
  geom_point(data = points, aes(x = x, y = y),                 # æ ‡è®°è§£ç‚¹
             color = "blue", size = 3) +
  ggtitle("ç›®æ ‡å‡½æ•°ç­‰é«˜çº¿å›¾åŠçº¦æŸæ¡ä»¶") +                          # æ·»åŠ æ ‡é¢˜
  xlab("x") +                                                  # æ·»åŠ  x è½´æ ‡ç­¾
  ylab("y") +                                                   # æ·»åŠ  y è½´æ ‡ç­¾
  theme(plot.title = element_text(hjust = 0.5))  # æ ‡é¢˜å±…ä¸­
```

**ä»£ç æ¦‚è¿°ï¼š**

- ä½¿ç”¨ `expand.grid` åˆ›å»º x å’Œ y çš„ç½‘æ ¼ï¼Œç”¨äºç»˜åˆ¶ç­‰é«˜çº¿å›¾ã€‚
- è®¡ç®—æ¯ä¸ªç‚¹çš„ç›®æ ‡å‡½æ•°å€¼ã€‚
- ä½¿ç”¨ `geom_contour_filled` ç»˜åˆ¶ç­‰é«˜çº¿å¡«å……å›¾ï¼Œå±•ç¤ºç›®æ ‡å‡½æ•°å€¼çš„åˆ†å¸ƒã€‚
- ä½¿ç”¨ `geom_circle` ç»˜åˆ¶çº¦æŸæ¡ä»¶ï¼ˆå•ä½åœ†ï¼‰ã€‚
- åœ¨å›¾ä¸­æ ‡è®°ä¹‹å‰è®¡ç®—çš„è§£ç‚¹ï¼Œç›´è§‚å±•ç¤ºæœ€ä¼˜è§£çš„ä½ç½®ã€‚


---

# å›°éš¾ä¸æ€è€ƒ
åœ¨è¿™æ¬¡ä½œä¸šè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¸ä»…åŠ æ·±äº†å¯¹ç»Ÿè®¡åˆ†æå’Œæ•°æ®å¯è§†åŒ–çš„è®¤è¯†ï¼Œä¹Ÿé‡åˆ°äº†ä¸å°‘å…·ä½“çš„é—®é¢˜ï¼Œæ¯ä¸€ä¸ªé—®é¢˜çš„è§£å†³éƒ½è®©æˆ‘å¯¹æ•°æ®å¤„ç†å’Œç¨‹åºç¼–å†™æœ‰äº†æ›´æ·±çš„ç†è§£å’Œä½“ä¼šã€‚

åœ¨ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘åœ¨ç»˜åˆ¶æ­£å¼¦å‡½æ•°çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†æ•°æ®ç²¾åº¦å’Œå›¾å½¢è¡¨ç°çš„é—®é¢˜ã€‚æœ€åˆï¼Œæ­£å¼¦æ›²çº¿ä¸å¤Ÿå¹³æ»‘ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘è®¾ç½®çš„æ•°æ®ç‚¹ä¸å¤Ÿå¯†é›†ã€‚é€šè¿‡è°ƒæ•´ seq å‡½æ•°ä¸­çš„ length.out å‚æ•°ï¼Œå¢åŠ äº†æ•°æ®ç‚¹çš„æ•°é‡ï¼Œä½¿å¾—æœ€ç»ˆçš„å›¾å½¢æ›´åŠ å¹³æ»‘ã€‚è¿™è®©æˆ‘æ„è¯†åˆ°åœ¨ç»˜å›¾æ—¶ï¼Œæ•°æ®çš„å¯†åº¦ç›´æ¥å½±å“åˆ°å›¾å½¢çš„è´¨é‡ã€‚

åœ¨è¿›è¡Œçº¿æ€§å›å½’åˆ†æçš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘æœ€åˆæœªèƒ½å‡†ç¡®è¯„ä¼°æ¨¡å‹çš„æ‹Ÿåˆåº¦ã€‚é€šè¿‡æŸ¥é˜…èµ„æ–™å’Œè¯¢é—®å¯¼å¸ˆï¼Œæˆ‘äº†è§£åˆ°å¯ä»¥é€šè¿‡æŸ¥çœ‹ summary(model) çš„è¾“å‡ºï¼Œç‰¹åˆ«æ˜¯ R æ–¹å€¼æ¥è¯„ä¼°æ¨¡å‹çš„æ‹Ÿåˆç¨‹åº¦ã€‚è¿™ä¸ªè¿‡ç¨‹åŠ æ·±äº†æˆ‘å¯¹ç»Ÿè®¡æ¨¡å‹è¯„ä¼°æŒ‡æ ‡çš„ç†è§£ã€‚

ç¬¬ä¸‰ä¸ªç¤ºä¾‹ä¸­æ±‚è§£å¾®åˆ†æ–¹ç¨‹æ—¶ï¼Œæˆ‘æœ€åˆå¯¹äºå¦‚ä½•å°†ç†è®ºæ–¹ç¨‹è½¬åŒ–ä¸ºç¼–ç¨‹ä¸­å¯æ“ä½œçš„å‡½æ•°è¡¨è¾¾å¼æ„Ÿåˆ°å›°æƒ‘ã€‚é€šè¿‡å¤šæ¬¡å°è¯•å’Œé”™è¯¯ï¼Œæˆ‘é€æ­¥æŒæ¡äº†åœ¨ R è¯­è¨€ä¸­å®šä¹‰å¤æ‚æ•°å­¦å‡½æ•°çš„æ–¹æ³•ã€‚æ­¤å¤–ï¼Œæˆ‘è¿˜å­¦ä¹ åˆ°äº†å¦‚ä½•ä½¿ç”¨ä¸åŒçš„ R åŒ…æ¥æ±‚è§£å¾®åˆ†æ–¹ç¨‹ï¼Œè¿™æ‰©å±•äº†æˆ‘å¯¹ R è¯­è¨€åŠŸèƒ½çš„è®¤è¯†ã€‚

åœ¨ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘åœ¨æ•°æ®é¢„å¤„ç†é˜¶æ®µé‡åˆ°äº†é—®é¢˜ã€‚æœ€åˆï¼Œç›´æ¥è¿›è¡Œ PCA åˆ†æåï¼Œç»“æœä¸é¢„æœŸæœ‰è¾ƒå¤§åå·®ã€‚æˆ‘å‘ç°æ˜¯å› ä¸ºæ²¡æœ‰å¯¹æ•°æ®è¿›è¡Œé€‚å½“çš„æ ‡å‡†åŒ–å¤„ç†ã€‚åœ¨åŒå­¦çš„å»ºè®®ä¸‹ï¼Œæˆ‘é€šè¿‡è®¾ç½® scale. å‚æ•°ä¸º TRUEï¼Œå¯¹æ•°æ®è¿›è¡Œäº†æ ‡å‡†åŒ–å¤„ç†ï¼Œä½¿å¾— PCA åˆ†æçš„ç»“æœæ›´åŠ å‡†ç¡®å’Œæœ‰è§£é‡ŠåŠ›ã€‚

æœ€åä¸€ä¸ªå…³äºæ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘åœ¨è§£ææ±‚è§£è¿‡ç¨‹ä¸­é‡åˆ°äº†ä»£æ•°å¤„ç†çš„å›°éš¾ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤æ‚çš„ä»£æ•°æ–¹ç¨‹æ—¶ã€‚é€šè¿‡ä½¿ç”¨ç¬¦å·è®¡ç®—è½¯ä»¶è¿›è¡Œè¾…åŠ©ï¼Œæˆ‘æˆåŠŸè§£å†³äº†æ–¹ç¨‹æ±‚è§£çš„é—®é¢˜ã€‚è¿™ä¸ä»…æé«˜äº†æˆ‘çš„è§£é¢˜æ•ˆç‡ï¼Œä¹Ÿè®©æˆ‘è®¤è¯†åˆ°åˆç†åˆ©ç”¨å·¥å…·çš„é‡è¦æ€§ã€‚

# æ€»ç»“
é€šè¿‡è¿™æ¬¡çš„ä½œä¸šå®è·µï¼Œæˆ‘ä¸ä»…æ·±å…¥ç†è§£äº†ç»Ÿè®¡åˆ†æå’Œæ•°æ®å¯è§†åŒ–çš„é‡è¦æ€§ï¼Œè¿˜åŠ æ·±äº†å¯¹å„ç§ç»Ÿè®¡æ¨¡å‹å’Œè®¡ç®—å·¥å…·çš„åº”ç”¨èƒ½åŠ›ã€‚æ¯ä¸€ä¸ªç¤ºä¾‹éƒ½æ˜¯å¯¹ç†è®ºçŸ¥è¯†çš„åº”ç”¨è€ƒéªŒï¼Œä¹Ÿæ˜¯å¯¹é—®é¢˜è§£å†³èƒ½åŠ›çš„ä¸€æ¬¡é”»ç‚¼ã€‚
è¿™æ ·åˆ‡å®åœ°åŠ¨æ‰‹æ“ä½œï¼Œä¸ä»…æå‡äº†è‡ªå·±çš„æŠ€èƒ½ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå¢å¼ºäº†æˆ‘é¢å¯¹å¤æ‚é—®é¢˜æ—¶çš„ä¿¡å¿ƒå’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚æœªæ¥ï¼Œæˆ‘æœŸå¾…å°†è¿™äº›çŸ¥è¯†åº”ç”¨åˆ°æ›´å¹¿æ³›çš„é¢†åŸŸä¸­ï¼Œè§£å†³æ›´å®é™…ã€æ›´å…·æŒ‘æˆ˜æ€§çš„é—®é¢˜ã€‚


---

# ç»Ÿè®¡è®¡ç®—ç¬¬2æ¬¡ä½œä¸š { .center-title }

ä»¥ä¸‹æ˜¯ç»Ÿè®¡è®¡ç®—2024-09-14è¯¾ç¨‹å¯¹åº”çš„ä½œä¸š

# Question

## Question Overview

Exercises 3.4, 3.11, and 3.20 (pages 94-96, Statistical Computating with R).

## Specific Exercises

### Exercise 3.4
The Rayleigh density [156, Ch. 18] is 

$$f(x)=\frac x{\sigma^2} e^{-x^2/(2\sigma^2)},\quad x\geq0, \sigma>0.$$

Develop an algorithm to generate random samples from a Rayleigh($Ïƒ$) distribution. Generate Rayleigh($Ïƒ$) samples for several choices of $Ïƒ > 0$ and check that the mode of the generated samples is close to the theoretical mode $Ïƒ$ (check the histogram).

### Exercise 3.11
Generate a random sample of size 1000 from a normal location mixture. The components of the mixture have $N(0, 1)$ and $N(3, 1)$ distributions with mixing probabilities $p1$ and $p2 = 1 âˆ’ p1$. Graph the histogram of the sample with density superimposed, for $p1 = 0.75$. Repeat with different values for $p1$ and observe whether the empirical distribution of the mixture appears to be bimodal. Make a conjecture about the values of $p1$ that produce bimodal mixtures.

### Exercise 3.20
A compound Poisson process is a stochastic process $\{X(t),t\geq0\}$ that can be represented as the random sum $X(t)=\sum_{i=1}^{N(t)}Y_{i}, t\geq0,$ where $\{N(t),t\geq0\}$ is a Poisson process and $Y_1,Y_2,$ . . . are iid and independent of $\{N(t),t\geq0\}$. Write a program to simulate a compound Poisson($Î»$)â€“Gamma process ($Y$ has a Gamma distribution). Estimate the mean and the variance of $X(10)$ for several choices of the parameters and compare with the theoretical values. Hint: Show that $\begin{aligned}E[X(t)]=\lambda tE[Y_1]\end{aligned}$ and$\begin{aligned}Var(X(t))=\lambda tE[Y_1^2]\end{aligned}$.

# Answer

## ç»ƒä¹  3.4

### é¢˜ç›®æè¿°

Rayleigh åˆ†å¸ƒåœ¨ä¿¡å·å¤„ç†ã€æ— çº¿é€šä¿¡å’Œé›·è¾¾æŠ€æœ¯ä¸­å¹¿æ³›åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯ç”¨äºæè¿°å¤šå¾„è¡°è½ä¿¡å·çš„å¹…åº¦ã€‚

Rayleigh å¯†åº¦å‡½æ•°ä¸ºï¼š
$$
f(x) = \frac{x}{\sigma^2} e^{-x^2 / (2\sigma^2)}, \quad x \geq 0, \sigma > 0. 
$$

å¼€å‘ä¸€ä¸ªç®—æ³•ä» Rayleigh(Ïƒ) åˆ†å¸ƒä¸­ç”Ÿæˆéšæœºæ ·æœ¬ã€‚å¯¹äºå¤šä¸ª Ïƒ > 0 çš„é€‰æ‹©ï¼Œç”Ÿæˆ Rayleigh(Ïƒ) æ ·æœ¬ï¼Œå¹¶æ£€æŸ¥ç”Ÿæˆæ ·æœ¬çš„ä¼—æ•°æ˜¯å¦æ¥è¿‘ç†è®ºä¼—æ•° Ïƒï¼ˆæ£€æŸ¥ç›´æ–¹å›¾ï¼‰ã€‚

### è§£ç­”è¿‡ç¨‹

è¦ä» Rayleigh åˆ†å¸ƒä¸­ç”Ÿæˆéšæœºæ ·æœ¬ï¼Œå¯ä»¥åˆ©ç”¨é€†å˜æ¢æ³•ã€‚é¦–å…ˆï¼Œæ¨å¯¼ Rayleigh åˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼ˆCDFï¼‰åŠå…¶åå‡½æ•°ã€‚

**æ­¥éª¤ 1ï¼šå…¬å¼æ¨å¯¼**

1. **ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼ˆCDFï¼‰æ¨å¯¼ï¼š**

$$
   \begin{align*}
   F(x) &= \int_{0}^{x} f(t) dt \\
        &= \int_{0}^{x} \frac{t}{\sigma^2} e^{-t^2 / (2\sigma^2)} dt \\
        &\text{ä»¤ } u = \frac{t^2}{2\sigma^2} \implies t = \sigma \sqrt{2u}, dt = \sigma \frac{1}{\sqrt{2u}} du \\
        &\text{ç§¯åˆ†å˜ä¸ºï¼š} \\
        F(x) &= \int_{0}^{x^2 / (2\sigma^2)} e^{-u} du \\
        &= 1 - e^{-x^2 / (2\sigma^2)}
   \end{align*}
$$

2. **æ±‚åå‡½æ•° \( F^{-1}(U) \)ï¼š**

  è®¾ \( U \sim \text{Uniform}(0,1) \)ï¼Œåˆ™æœ‰ï¼š

$$
U = F(x) = 1 - e^{-x^2 / (2\sigma^2)}.
$$

è§£æ–¹ç¨‹æ±‚ xï¼š
$$
\begin{align*}
U &= 1 - e^{-x^2 / (2\sigma^2)} \\
e^{-x^2 / (2\sigma^2)} &= 1 - U \\
\frac{x^2}{2\sigma^2} &= \ln(1 - U) \\
x^2 &= -2\sigma^2 \ln(1 - U) \\
x &= \sigma \sqrt{-2 \ln(1 - U)}.
\end{align*}
$$
ç”±äº \( 1 - U \) ä¸ \( U \) éƒ½æœä» Uniform(0,1) åˆ†å¸ƒï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å†™æˆï¼š

$$ 
x = \sigma \sqrt{-2 \ln U}. 
$$


**æ­¥éª¤ 2ï¼šç®—æ³•å®ç°**

1. ç”Ÿæˆå‡åŒ€åˆ†å¸ƒéšæœºæ•° \( U \sim \text{Uniform}(0,1) \)ã€‚
2. è®¡ç®— \( x = \sigma \sqrt{-2 \ln U} \)ã€‚

**æ­¥éª¤ 3ï¼šåœ¨ R ä¸­å®ç°å¹¶éªŒè¯**

```{r, eval=TRUE}
# è®¾ç½®éšæœºæ•°ç§å­ä»¥ç¡®ä¿ç»“æœå¯é‡å¤
set.seed(110)

# å®šä¹‰ç”Ÿæˆ Rayleigh åˆ†å¸ƒéšæœºæ ·æœ¬çš„å‡½æ•°
generate_rayleigh <- function(n, sigma) {
  U <- runif(n)  # ç”Ÿæˆ n ä¸ªå‡åŒ€åˆ†å¸ƒéšæœºæ•°
  X <- sigma * sqrt(-2 * log(U))  # è®¡ç®— Rayleigh éšæœºå˜é‡
  return(X)
}

# é€‰æ‹©ä¸åŒçš„ Ïƒ å€¼
sigma_values <- c(0.5, 1, 2)

# å¯¹æ¯ä¸ª Ïƒï¼Œç”Ÿæˆæ ·æœ¬å¹¶ç»˜åˆ¶ç›´æ–¹å›¾
par(mfrow = c(1, length(sigma_values)))  # è®¾ç½®ç»˜å›¾åŒºåŸŸ

for (sigma in sigma_values) {
  samples <- generate_rayleigh(10000, sigma)  # ç”Ÿæˆæ ·æœ¬
  hist(samples, breaks = 50, probability = TRUE,
       main = paste("Rayleigh åˆ†å¸ƒ (Ïƒ =", sigma, ")"),
       xlab = "x", ylab = "å¯†åº¦", col = "gray", border = "white")
  
  # æ·»åŠ ç†è®ºå¯†åº¦æ›²çº¿
  x_seq <- seq(0, max(samples), length.out = 1000)
  y_density <- (x_seq / sigma^2) * exp(-x_seq^2 / (2 * sigma^2))
  lines(x_seq, y_density, col = "red", lwd = 2)
  
  # æ·»åŠ ç†è®ºä¼—æ•°çš„å‚ç›´çº¿
  abline(v = sigma, col = "blue", lwd = 2, lty = 2)
  
  # æ·»åŠ å›¾ä¾‹
  legend("topright", legend = c("æ ·æœ¬ç›´æ–¹å›¾", "ç†è®ºå¯†åº¦", "ç†è®ºä¼—æ•°"),
         col = c("gray", "red", "blue"), lwd = c(10, 2, 2), lty = c(1, 1, 2), bty = "n", cex = 0.8)
}

```

**ä»£ç æ¦‚è¿°ï¼š**

- ä½¿ç”¨ `generate_rayleigh` å‡½æ•°ç”Ÿæˆ Rayleigh åˆ†å¸ƒçš„éšæœºæ ·æœ¬ã€‚
- å¯¹äºä¸åŒçš„ Ïƒ å€¼ï¼Œç”Ÿæˆ 10000 ä¸ªæ ·æœ¬ã€‚
- ç»˜åˆ¶æ ·æœ¬çš„ç›´æ–¹å›¾ï¼Œå¹¶å åŠ ç†è®ºå¯†åº¦æ›²çº¿ã€‚
- åœ¨å›¾ä¸­æ·»åŠ ä¸€æ¡å‚ç›´çº¿ï¼Œè¡¨ç¤ºç†è®ºä¼—æ•° Ïƒã€‚

**ç»“æœåˆ†æï¼š**

é€šè¿‡è§‚å¯Ÿç›´æ–¹å›¾å’Œç†è®ºå¯†åº¦æ›²çº¿ï¼Œå¯ä»¥å‘ç°ç”Ÿæˆçš„æ ·æœ¬ä¸ç†è®ºåˆ†å¸ƒéå¸¸å»åˆï¼Œæ ·æœ¬çš„ä¼—æ•°æ¥è¿‘äº Ïƒã€‚è¿™éªŒè¯äº†ç®—æ³•çš„æ­£ç¡®æ€§ã€‚

**æ­¥éª¤ 4ï¼šåœ¨ R ä¸­å®ç°æ›´å¤šçš„ Ïƒ å€¼ï¼š**

å°è¯•æ›´å¤šçš„ Ïƒ å€¼ï¼Œå¦‚ 0.5, 1, 1.5, 2, 3, 5ï¼Œå¹¶å¯¹æ¯ä¸ª Ïƒ ç”Ÿæˆæ›´å¤§çš„æ ·æœ¬ï¼ˆä¾‹å¦‚ 1e5 ä¸ªæ ·æœ¬ï¼‰ï¼Œä»¥è·å¾—æ›´å¹³æ»‘çš„ç›´æ–¹å›¾ã€‚

```{r, eval=TRUE}
# è®¾ç½®éšæœºæ•°ç§å­ä»¥ç¡®ä¿ç»“æœå¯é‡å¤
set.seed(111)

# å®šä¹‰ç”Ÿæˆ Rayleigh åˆ†å¸ƒéšæœºæ ·æœ¬çš„å‡½æ•°
generate_rayleigh <- function(n, sigma) {
  U <- runif(n)  # ç”Ÿæˆ n ä¸ªå‡åŒ€åˆ†å¸ƒéšæœºæ•°
  X <- sigma * sqrt(-2 * log(U))  # è®¡ç®— Rayleigh éšæœºå˜é‡
  return(X)
}

# é€‰æ‹©æ›´å¤šçš„ Ïƒ å€¼
sigma_values <- c(0.5, 1, 1.5, 2, 3, 5)

# å¯¹æ¯ä¸ª Ïƒï¼Œç”Ÿæˆæ ·æœ¬å¹¶ç»˜åˆ¶ç›´æ–¹å›¾
par(mfrow = c(2, 3))  # è®¾ç½®ç»˜å›¾åŒºåŸŸä¸º 2 è¡Œ 3 åˆ—

for (sigma in sigma_values) {
  samples <- generate_rayleigh(1e5, sigma)  # ç”Ÿæˆ 1e5 ä¸ªæ ·æœ¬
  hist(samples, breaks = 100, probability = TRUE,
       main = paste("Rayleigh åˆ†å¸ƒ (Ïƒ =", sigma, ")"),
       xlab = "x", ylab = "å¯†åº¦", col = "lightblue", border = "white")
  
  # æ·»åŠ ç†è®ºå¯†åº¦æ›²çº¿
  x_seq <- seq(0, max(samples), length.out = 1000)
  y_density <- (x_seq / sigma^2) * exp(-x_seq^2 / (2 * sigma^2))
  lines(x_seq, y_density, col = "red", lwd = 2)
  
  # æ·»åŠ ç†è®ºä¼—æ•°çš„å‚ç›´çº¿
  abline(v = sigma, col = "blue", lwd = 2, lty = 2)
  
  # æ·»åŠ å›¾ä¾‹
  legend("topright", legend = c("æ ·æœ¬ç›´æ–¹å›¾", "ç†è®ºå¯†åº¦", "ç†è®ºä¼—æ•°"),
         col = c("lightblue", "red", "blue"), lwd = c(10, 2, 2), lty = c(1, 1, 2), bty = "n", cex = 0.8)

}
```

**ä»£ç æ¦‚è¿°ï¼š**

- **æ ·æœ¬æ•°é‡å¢åŠ ï¼š** å¢åŠ æ ·æœ¬æ•°é‡åˆ° 1e5ï¼Œå¯ä»¥ä½¿ç›´æ–¹å›¾æ›´å¹³æ»‘ï¼Œæ›´æ¥è¿‘ç†è®ºå¯†åº¦æ›²çº¿ã€‚
- **æ›´å¤šçš„ Ïƒ å€¼ï¼š** é€šè¿‡é€‰æ‹©æ›´å¤šçš„ Ïƒ å€¼ï¼Œå¯ä»¥è§‚å¯Ÿä¸åŒå°ºåº¦å‚æ•°å¯¹ Rayleigh åˆ†å¸ƒå½¢çŠ¶çš„å½±å“ã€‚
- **ç›´æ–¹å›¾å‚æ•°è°ƒæ•´ï¼š** å¢åŠ  `breaks` åˆ° 100ï¼Œä½¿ç›´æ–¹å›¾çš„æŸ±çŠ¶æ›´åŠ ç»†è‡´ã€‚
- **å›¾ä¾‹æ·»åŠ ï¼š** æ·»åŠ å›¾ä¾‹å¯ä»¥å¸®åŠ©ç†è§£å›¾ä¸­å„æ¡æ›²çº¿å’Œçº¿æ¡çš„å«ä¹‰ã€‚

**ç»“æœåˆ†æï¼š**

- å¯¹äºæ¯ä¸ª Ïƒ å€¼ï¼Œç›´æ–¹å›¾çš„å³°å€¼ï¼ˆä¼—æ•°ï¼‰éƒ½æ¥è¿‘äº Ïƒï¼Œè¿™ä¸ç†è®ºä¼—æ•°ä¸€è‡´ã€‚
- éšç€ Ïƒ çš„å¢åŠ ï¼Œåˆ†å¸ƒçš„å½¢çŠ¶å˜å¾—æ›´å®½ï¼Œå³°å€¼ä½ç½®å‘å³ç§»åŠ¨ï¼Œç¬¦åˆ Rayleigh åˆ†å¸ƒçš„æ€§è´¨ã€‚

**éªŒè¯ä¼—æ•°ï¼š**

è®¡ç®—æ ·æœ¬çš„ä¼—æ•°ï¼Œå¹¶ä¸ç†è®ºä¼—æ•° Ïƒ è¿›è¡Œæ¯”è¾ƒã€‚

```{r, eval=TRUE}
library(modeest)  # ç”¨äºè®¡ç®—ä¼—æ•°çš„åŒ…

for (sigma in sigma_values) {
  samples <- generate_rayleigh(1e5, sigma)
  sample_mode <- mlv(samples, method = "parzen")  # è®¡ç®—æ ·æœ¬ä¼—æ•°
  cat("Ïƒ =", sigma, "ç†è®ºä¼—æ•° =", sigma, "æ ·æœ¬ä¼—æ•° =", sample_mode, "\n")
}
```

**ç»“æœåˆ†æï¼š**

- æ ·æœ¬ä¼—æ•°ä¸ç†è®ºä¼—æ•°éå¸¸æ¥è¿‘ï¼Œè¯¯å·®åœ¨å¯æ¥å—èŒƒå›´å†…ã€‚
- è¿™è¿›ä¸€æ­¥éªŒè¯äº†ç®—æ³•å’Œæ¨¡æ‹Ÿçš„æ­£ç¡®æ€§ã€‚

---

## ç»ƒä¹  3.11

### é¢˜ç›®æè¿°

ç”Ÿæˆä¸€ä¸ªå¤§å°ä¸º 1000 çš„éšæœºæ ·æœ¬ï¼Œæ¥è‡ªä¸€ä¸ªæ­£æ€ä½ç½®æ··åˆåˆ†å¸ƒã€‚æ··åˆæˆåˆ†ä¸º N(0,1) å’Œ N(3,1)ï¼Œæ··åˆæ¦‚ç‡ä¸º \( p_1 \) å’Œ \( p_2 = 1 - p_1 \)ã€‚ç»˜åˆ¶æ ·æœ¬çš„ç›´æ–¹å›¾å¹¶å åŠ å¯†åº¦æ›²çº¿ï¼Œå¯¹äº \( p_1 = 0.75 \)ã€‚ç”¨ä¸åŒçš„ \( p_1 \) å€¼é‡å¤ï¼Œå¹¶è§‚å¯Ÿæ··åˆåˆ†å¸ƒçš„ç»éªŒåˆ†å¸ƒæ˜¯å¦å‘ˆç°åŒå³°ã€‚å¯¹äº§ç”ŸåŒå³°æ··åˆçš„ \( p_1 \) å€¼ä½œå‡ºçŒœæƒ³ã€‚

### è§£ç­”è¿‡ç¨‹

**æ­¥éª¤ 1ï¼šç†è§£æ··åˆæ­£æ€åˆ†å¸ƒ**

æ··åˆæ­£æ€åˆ†å¸ƒæ˜¯æŒ‡éšæœºå˜é‡æ¥è‡ªå¤šä¸ªæ­£æ€åˆ†å¸ƒä¸­çš„ä¸€ä¸ªï¼Œé€‰æ‹©å“ªä¸ªæ­£æ€åˆ†å¸ƒç”±æ··åˆæ¦‚ç‡å†³å®šã€‚

**å…¶ç‰¹ç‚¹å¦‚ä¸‹ï¼š**

- å½“ä¸¤ä¸ªæ­£æ€åˆ†å¸ƒçš„å‡å€¼ç›¸å·®è¾ƒå¤§ï¼Œä¸”æ··åˆæ¦‚ç‡æ¥è¿‘ 0.5 æ—¶ï¼Œæ··åˆåˆ†å¸ƒä¼šå‘ˆç°æ˜æ˜¾çš„åŒå³°ã€‚
- å½“æ··åˆæ¦‚ç‡åå‘ä¸€ä¾§ï¼ˆæ¥è¿‘ 0 æˆ– 1ï¼‰æ—¶ï¼Œæ··åˆåˆ†å¸ƒä¼šæ›´æ¥è¿‘äºå¯¹åº”çš„å•ä¸ªæ­£æ€åˆ†å¸ƒã€‚

**æ­¥éª¤ 2ï¼šç®—æ³•å®ç°**

1. ç”Ÿæˆå¤§å°ä¸º \( n \) çš„äºŒé¡¹åˆ†å¸ƒéšæœºå˜é‡ï¼Œæ¯æ¬¡å®éªŒæˆåŠŸçš„æ¦‚ç‡ä¸º \( p_1 \)ï¼Œè¡¨ç¤ºæ ·æœ¬æ¥è‡ªå“ªä¸ªåˆ†å¸ƒã€‚
2. æ ¹æ®ç”Ÿæˆçš„æŒ‡ç¤ºå˜é‡ï¼Œä»å¯¹åº”çš„æ­£æ€åˆ†å¸ƒä¸­ç”Ÿæˆéšæœºæ•°ã€‚

**æ­¥éª¤ 3ï¼šåœ¨ R ä¸­å®ç°å¹¶éªŒè¯**

```{r, eval=TRUE}
# è®¾ç½®éšæœºæ•°ç§å­
set.seed(123)

# å®šä¹‰ç”Ÿæˆæ··åˆæ­£æ€åˆ†å¸ƒæ ·æœ¬çš„å‡½æ•°
generate_mixture_normal <- function(n, p1, mu1, mu2, sigma1, sigma2) {
  # ç”ŸæˆæŒ‡ç¤ºå˜é‡ï¼Œ1 è¡¨ç¤ºæ¥è‡ªç¬¬ä¸€ä¸ªæ­£æ€åˆ†å¸ƒ
  indicators <- rbinom(n, size = 1, prob = p1)
  
  # åˆå§‹åŒ–æ ·æœ¬å‘é‡
  samples <- numeric(n)
  
  # ä»å¯¹åº”çš„æ­£æ€åˆ†å¸ƒä¸­ç”Ÿæˆéšæœºæ•°
  samples[indicators == 1] <- rnorm(sum(indicators == 1), mean = mu1, sd = sigma1)
  samples[indicators == 0] <- rnorm(sum(indicators == 0), mean = mu2, sd = sigma2)
  
  return(samples)
}

# è®¾ç½®å‚æ•°
n <- 1000
mu1 <- 0
mu2 <- 3
sigma1 <- 1
sigma2 <- 1
p1_values <- c(0.75, 0.5, 0.25)

# è°ƒæ•´å›¾å½¢å‚æ•°ï¼Œä½¿å…¶å…·æœ‰æ›´é«˜çš„å®½é«˜æ¯”ä¾‹
par(mfrow = c(length(p1_values), 1), mar = c(4, 4, 2, 2))  # è°ƒæ•´è¾¹è·

# è°ƒæ•´é¢œè‰²
colors <- c("lightblue", "lightgreen", "lightcoral")

for (i in 1:length(p1_values)) {
  p1 <- p1_values[i]
  samples <- generate_mixture_normal(n, p1, mu1, mu2, sigma1, sigma2)
  
  # ç»˜åˆ¶ç›´æ–¹å›¾ï¼Œè°ƒæ•´é¢œè‰²å’Œé€æ˜åº¦
  hist(samples, breaks = 30, probability = TRUE,
       main = paste("æ··åˆæ­£æ€åˆ†å¸ƒ (p1 =", p1, ")"),
       xlab = "x", ylab = "å¯†åº¦", col = colors[i], border = "white", 
       xlim = range(-4, 8), ylim = c(0, 0.5))
  
  # å åŠ ç†è®ºå¯†åº¦æ›²çº¿
  x_seq <- seq(min(samples), max(samples), length.out = 1000)
  y_density <- p1 * dnorm(x_seq, mean = mu1, sd = sigma1) +
               (1 - p1) * dnorm(x_seq, mean = mu2, sd = sigma2)
  lines(x_seq, y_density, col = "red", lwd = 2)
  
  # æ·»åŠ å›¾ä¾‹
  legend("topright", legend = c("æ ·æœ¬ç›´æ–¹å›¾", "ç†è®ºå¯†åº¦æ›²çº¿"),
         col = c(colors[i], "red"), lwd = c(10, 2), bty = "n", cex = 0.8)
}

```

**ä»£ç æ¦‚è¿°ï¼š**

- ä½¿ç”¨ `generate_mixture_normal` å‡½æ•°ç”Ÿæˆæ··åˆæ­£æ€åˆ†å¸ƒçš„éšæœºæ ·æœ¬ã€‚
- å¯¹äºä¸åŒçš„ \( p_1 \) å€¼ï¼Œç”Ÿæˆæ ·æœ¬å¹¶ç»˜åˆ¶ç›´æ–¹å›¾ã€‚
- å åŠ ç†è®ºå¯†åº¦æ›²çº¿ï¼Œè§‚å¯Ÿåˆ†å¸ƒå½¢çŠ¶ã€‚

**ç»“æœåˆ†æï¼š**

- å½“ \( p_1 = 0.75 \) æ—¶ï¼Œåˆ†å¸ƒä¸»è¦é›†ä¸­åœ¨å·¦ä¾§ï¼Œä½†å³ä¾§ä»æœ‰æ˜æ˜¾çš„å³°ï¼Œåˆ†å¸ƒå‘ˆç°åŒå³°ç‰¹å¾ã€‚
- å½“ \( p_1 = 0.5 \) æ—¶ï¼Œå·¦ã€å³ä¸¤ä¾§çš„å³°é«˜åº¦ç›¸å½“ï¼ŒåŒå³°ç‰¹å¾æœ€ä¸ºæ˜æ˜¾ã€‚
- å½“ \( p_1 = 0.25 \) æ—¶ï¼Œåˆ†å¸ƒä¸»è¦é›†ä¸­åœ¨å³ä¾§ï¼Œä½†å·¦ä¾§ä»æœ‰æ˜æ˜¾çš„å³°ã€‚

**çŒœæƒ³ï¼š**

å½“ \( p_1 \) æ¥è¿‘ 0.5 æ—¶ï¼Œæ··åˆæ­£æ€åˆ†å¸ƒå‘ˆç°æ˜æ˜¾çš„åŒå³°ç‰¹å¾ï¼›å½“ \( p_1 \) æ¥è¿‘ 0 æˆ– 1 æ—¶ï¼Œåˆ†å¸ƒé€æ¸è¶‹äºå•å³°ã€‚

**æ­¥éª¤4ï¼šå°è¯•æ›´å¤šçš„ \( p_1 \) å€¼**

æˆ‘ä»¬å¯ä»¥å°è¯• \( p_1 \) ä» 0 åˆ° 1 ä¹‹é—´çš„å¤šä¸ªå€¼ï¼Œå¦‚ 0.1, 0.2, ..., 0.9ã€‚

**ä¿®æ”¹ä»£ç ï¼š**

```{r, eval=TRUE}
# è®¾ç½®éšæœºæ•°ç§å­
set.seed(124)

# å®šä¹‰ç”Ÿæˆæ··åˆæ­£æ€åˆ†å¸ƒæ ·æœ¬çš„å‡½æ•°
generate_mixture_normal <- function(n, p1, mu1, mu2, sigma1, sigma2) {
  # ç”ŸæˆæŒ‡ç¤ºå˜é‡ï¼Œ1 è¡¨ç¤ºæ¥è‡ªç¬¬ä¸€ä¸ªæ­£æ€åˆ†å¸ƒ
  indicators <- rbinom(n, size = 1, prob = p1)
  
  # åˆå§‹åŒ–æ ·æœ¬å‘é‡
  samples <- numeric(n)
  
  # ä»å¯¹åº”çš„æ­£æ€åˆ†å¸ƒä¸­ç”Ÿæˆéšæœºæ•°
  samples[indicators == 1] <- rnorm(sum(indicators == 1), mean = mu1, sd = sigma1)
  samples[indicators == 0] <- rnorm(sum(indicators == 0), mean = mu2, sd = sigma2)
  
  return(samples)
}

# è®¾ç½®å‚æ•°
n <- 10000
mu1 <- 0
mu2 <- 3
sigma1 <- 1
sigma2 <- 1
p1_values <- seq(0.1, 0.9, by = 0.1)  # ä» 0.1 åˆ° 0.9ï¼Œæ­¥é•¿ä¸º 0.1

# è°ƒæ•´å›¾å½¢æ¯”ä¾‹å’Œè¾¹è·ï¼Œä½¿æ¯ä¸ªå›¾æ›´å¤§
par(mfrow = c(3, 3), mar = c(4, 4, 2, 2), oma = c(2, 2, 2, 2))  # å¤–è¾¹è·å‚æ•°è°ƒæ•´

# å¾ªç¯ç»˜åˆ¶æ¯ä¸ª p1 å€¼å¯¹åº”çš„æ··åˆæ­£æ€åˆ†å¸ƒ
for (p1 in p1_values) {
  samples <- generate_mixture_normal(n, p1, mu1, mu2, sigma1, sigma2)
  
  # ç»˜åˆ¶ç›´æ–¹å›¾ï¼Œè°ƒæ•´é¢œè‰²å’Œé€æ˜åº¦
  hist(samples, breaks = 50, probability = TRUE,
       main = paste("æ··åˆæ­£æ€åˆ†å¸ƒ (p1 =", round(p1, 1), ")"),
       xlab = "x", ylab = "å¯†åº¦", col = rgb(144, 238, 144, maxColorValue = 255, alpha = 180), border = "white",
       xlim = c(-4, 8), ylim = c(0, 0.5))  # ç»Ÿä¸€xè½´å’Œyè½´èŒƒå›´
  
  # å åŠ ç†è®ºå¯†åº¦æ›²çº¿
  x_seq <- seq(min(samples), max(samples), length.out = 1000)
  y_density <- p1 * dnorm(x_seq, mean = mu1, sd = sigma1) +
               (1 - p1) * dnorm(x_seq, mean = mu2, sd = sigma2)
  lines(x_seq, y_density, col = "red", lwd = 2)
  
  # å°†å›¾ä¾‹æ”¾åœ¨ä¸‹æ–¹ï¼Œç¡®ä¿ä¸é®æŒ¡å›¾å½¢
  legend("bottom", legend = c("æ ·æœ¬ç›´æ–¹å›¾", "ç†è®ºå¯†åº¦"),
         col = c(rgb(144, 238, 144, maxColorValue = 255, alpha = 180), "red"),
         lwd = c(10, 2), bty = "n", cex = 0.8, horiz = TRUE)
}


```

**ç»“æœåˆ†æï¼š**

- **\( p_1 = 0.1 \)ï¼š** åˆ†å¸ƒä¸»è¦é›†ä¸­åœ¨å³ä¾§ï¼ˆ\( \mu_2 = 3 \)ï¼‰ï¼Œå·¦ä¾§çš„å³°ï¼ˆ\( \mu_1 = 0 \)ï¼‰è¾ƒå°ï¼Œæ•´ä½“å‘ˆå•å³°ã€‚
- **\( p_1 = 0.5 \)ï¼š** å·¦ã€å³ä¸¤ä¾§çš„å³°é«˜åº¦ç›¸å½“ï¼Œåˆ†å¸ƒå‘ˆç°æ˜æ˜¾çš„åŒå³°ã€‚
- **\( p_1 = 0.9 \)ï¼š** åˆ†å¸ƒä¸»è¦é›†ä¸­åœ¨å·¦ä¾§ï¼ˆ\( \mu_1 = 0 \)ï¼‰ï¼Œå³ä¾§çš„å³°ï¼ˆ\( \mu_2 = 3 \)ï¼‰è¾ƒå°ï¼Œæ•´ä½“å‘ˆå•å³°ã€‚

**æ·±å…¥åˆ†æï¼š**

- **åŒå³°å‡ºç°æ¡ä»¶ï¼š** å½“ä¸¤ä¸ªæ­£æ€åˆ†å¸ƒçš„å‡å€¼å·®è·è¾ƒå¤§ï¼ˆå¦‚æœ¬ä¾‹ä¸­çš„ 3ï¼‰ï¼Œä¸”æ··åˆæ¦‚ç‡æ¥è¿‘ 0.5 æ—¶ï¼Œæ··åˆåˆ†å¸ƒæ›´å®¹æ˜“å‘ˆç°åŒå³°ã€‚
- **ä¸´ç•Œæ··åˆæ¦‚ç‡ï¼š** åŒå³°ç‰¹å¾çš„æ˜æ˜¾ç¨‹åº¦ä¸æ··åˆæ¦‚ç‡å¯†åˆ‡ç›¸å…³ã€‚å½“ \( p_1 \) è¿œç¦» 0.5 æ—¶ï¼ŒåŒå³°ç‰¹å¾é€æ¸å‡å¼±ã€‚

**ç»˜åˆ¶å³°åº¦å’Œååº¦éš \( p_1 \) çš„å˜åŒ–ï¼š**

å¯ä»¥è®¡ç®—ä¸åŒ \( p_1 \) å€¼ä¸‹æ··åˆåˆ†å¸ƒçš„å³°åº¦å’Œååº¦ï¼Œä»è€Œå®šé‡åˆ†æåˆ†å¸ƒçš„å½¢æ€å˜åŒ–ã€‚

```{r, eval=TRUE}
library(moments,warn.conflicts = F)  # ç”¨äºè®¡ç®—å³°åº¦å’Œååº¦çš„åŒ…
# ç”±äºmoments åŒ…ä¸­çš„ skewness ã€kurtosiså‡½æ•°å’Œ modeest åŒ…ä¸­çš„ skewness ã€kurtosiså‡½æ•°é‡åäº†
# å› æ­¤ï¼Œä½¿ç”¨warn.conflicts = F å¿½ç•¥åŒ…é‡åæ—¶çš„è­¦å‘Š

# å®šä¹‰ p1 å€¼
p1_values <- seq(0.1, 0.9, by = 0.1)
skewness_values <- numeric(length(p1_values))
kurtosis_values <- numeric(length(p1_values))

# å¾ªç¯è®¡ç®—ä¸åŒ p1 ä¸‹çš„ååº¦å’Œå³°åº¦
for (i in seq_along(p1_values)) {
  p1 <- p1_values[i]
  samples <- generate_mixture_normal(n, p1, mu1, mu2, sigma1, sigma2)
  
  # æ˜ç¡®è°ƒç”¨ moments åŒ…ä¸­çš„ skewness å’Œ kurtosis å‡½æ•°
  skewness_values[i] <- moments::skewness(samples)
  kurtosis_values[i] <- moments::kurtosis(samples)
}

# ç»˜åˆ¶ååº¦å’Œå³°åº¦éš p1 çš„å˜åŒ–
par(mfrow = c(1, 2))

# ååº¦éš p1 çš„å˜åŒ–
plot(p1_values, skewness_values, type = "b", pch = 19, col = "blue",
     xlab = expression(p[1]), ylab = "ååº¦", main = "ååº¦éš p1 çš„å˜åŒ–")
abline(h = 0, lty = 2)

# å³°åº¦éš p1 çš„å˜åŒ–
plot(p1_values, kurtosis_values, type = "b", pch = 19, col = "red",
     xlab = expression(p[1]), ylab = "å³°åº¦", main = "å³°åº¦éš p1 çš„å˜åŒ–")

```

**ç»“æœåˆ†æï¼š**

- **ååº¦ï¼š** å½“ \( p_1 \) ä» 0.1 å¢åŠ åˆ° 0.9ï¼Œååº¦ä»è´Ÿå€¼å˜ä¸ºæ­£å€¼ï¼Œè¡¨ç¤ºåˆ†å¸ƒçš„åæ–œæ–¹å‘ä»å·¦åï¼ˆè´Ÿååº¦ï¼‰é€æ¸å˜ä¸ºå³åï¼ˆæ­£ååº¦ï¼‰ã€‚
- **å³°åº¦ï¼š** å³°åº¦åœ¨ \( p_1 = 0.5 \) é™„è¿‘è¾¾åˆ°æœ€å°å€¼ï¼Œè¡¨ç¤ºæ­¤æ—¶åˆ†å¸ƒæœ€ä¸ºå¹³å¦ï¼ŒåŒå³°ç‰¹å¾æœ€æ˜æ˜¾ã€‚

**è¿›ä¸€æ­¥çŒœæƒ³ï¼š**

- **ä¸´ç•Œç‚¹ï¼š** å½“ \( p_1 = 0.5 \) æ—¶ï¼ŒåŒå³°ç‰¹å¾æœ€æ˜æ˜¾ã€‚
- **åŒå³°æ¶ˆå¤±æ¡ä»¶ï¼š** å½“ \( |p_1 - 0.5| \geq 0.3 \) æ—¶ï¼ŒåŒå³°ç‰¹å¾æ˜æ˜¾å‡å¼±ï¼Œåˆ†å¸ƒé€æ¸å‘ˆå•å³°ã€‚

**ä¸åŒå‡å€¼å·®è·çš„å½±å“ï¼š**

å°è¯•æ”¹å˜ä¸¤ä¸ªæ­£æ€åˆ†å¸ƒçš„å‡å€¼å·®è·ï¼Œè§‚å¯ŸåŒå³°ç‰¹å¾çš„å˜åŒ–ã€‚

```{r, eval=TRUE}
mu_differences <- c(1, 2, 3, 4, 5, 6)
p1 <- 0.5  # å›ºå®š p1 ä¸º 0.5

par(mfrow = c(2, 3))  # è®¾ç½®ç»˜å›¾åŒºåŸŸ

for (mu_diff in mu_differences) {
  mu1 <- 0
  mu2 <- mu_diff
  samples <- generate_mixture_normal(n, p1, mu1, mu2, sigma1, sigma2)
  
  hist(samples, breaks = 50, probability = TRUE,
       main = paste("å‡å€¼å·® =", mu_diff),
       xlab = "x", ylab = "å¯†åº¦", col = "lightblue", border = "white")
  
  x_seq <- seq(min(samples), max(samples), length.out = 1000)
  y_density <- p1 * dnorm(x_seq, mean = mu1, sd = sigma1) +
               (1 - p1) * dnorm(x_seq, mean = mu2, sd = sigma2)
  lines(x_seq, y_density, col = "red", lwd = 2)
}
```

**ç»“æœåˆ†æï¼š**

- **å‡å€¼å·®è¾ƒå°ï¼ˆå¦‚ 1, 2ï¼‰ï¼š** åˆ†å¸ƒå‘ˆå•å³°ï¼ŒåŒå³°ç‰¹å¾ä¸æ˜æ˜¾ã€‚
- **å‡å€¼å·®å¢åŠ ï¼ˆå¦‚ 3, 4, 5, 6ï¼‰ï¼š** åŒå³°ç‰¹å¾é€æ¸æ˜æ˜¾ã€‚

**å°ç»“ï¼š**

- **åŒå³°å‡ºç°çš„æ¡ä»¶ï¼š** ä¸¤ä¸ªæ­£æ€åˆ†å¸ƒçš„å‡å€¼å·®è·è¶³å¤Ÿå¤§ï¼Œä¸”æ··åˆæ¦‚ç‡æ¥è¿‘ 0.5ï¼Œæ··åˆåˆ†å¸ƒä¼šå‘ˆç°æ˜æ˜¾çš„åŒå³°ã€‚
- **æ··åˆæ¦‚ç‡å½±å“ï¼š** å½“ \( p_1 \) è¿œç¦» 0.5 æ—¶ï¼ŒåŒå³°ç‰¹å¾å‡å¼±ï¼Œåˆ†å¸ƒå€¾å‘äºåå‘æ··åˆæ¦‚ç‡è¾ƒå¤§çš„é‚£ä¸ªåˆ†å¸ƒã€‚

---

## ç»ƒä¹  3.20

### é¢˜ç›®æè¿°

å¤åˆæ³Šæ¾è¿‡ç¨‹ç»å¸¸åº”ç”¨åœ¨åœ¨é£é™©ç†è®ºã€ä¿é™©ç²¾ç®—ä¸­ï¼Œç”¨äºå»ºæ¨¡åœ¨æ—¶é—´ \( t \) å†…çš„æ€»ç´¢èµ”é¢ã€‚å®ƒæ˜¯ä¸€ä¸ªéšæœºè¿‡ç¨‹ \( \{X(t), t \geq 0\} \)ï¼Œå¯ä»¥è¡¨ç¤ºä¸ºéšæœºå’Œ \( X(t) = \sum_{i=1}^{N(t)} Y_i \)ï¼Œå…¶ä¸­ \( \{N(t), t \geq 0\} \) æ˜¯ä¸€ä¸ªæ³Šæ¾è¿‡ç¨‹ï¼Œ\( Y_1, Y_2, \dots \) æ˜¯ç‹¬ç«‹åŒåˆ†å¸ƒä¸”ä¸ \( \{N(t), t \geq 0\} \) ç‹¬ç«‹ã€‚

ç¼–å†™ç¨‹åºæ¨¡æ‹Ÿä¸€ä¸ªå¤åˆæ³Šæ¾(Î»)â€“Gamma è¿‡ç¨‹ï¼ˆ\( Y \) æœä» Gamma åˆ†å¸ƒï¼‰ã€‚ä¼°è®¡ \( X(10) \) çš„å‡å€¼å’Œæ–¹å·®ï¼Œé€‰æ‹©å¤šä¸ªå‚æ•°ï¼Œå¹¶ä¸ç†è®ºå€¼æ¯”è¾ƒã€‚æç¤ºï¼šè¯æ˜ \( E[X(t)] = \lambda t E[Y_1] \) å’Œ \( \text{Var}(X(t)) = \lambda t E[Y_1^2] \)ã€‚

### è§£ç­”è¿‡ç¨‹

**æ­¥éª¤ 1ï¼šæ¨å¯¼ç†è®ºå‡å€¼å’Œæ–¹å·®**

1. **å‡å€¼æ¨å¯¼ï¼š**

   \[
   \begin{align*}
   E[X(t)] &= E\left[ \sum_{i=1}^{N(t)} Y_i \right] \\
           &= E\left[ E\left[ \sum_{i=1}^{N(t)} Y_i \bigg| N(t) \right] \right] \\
           &= E\left[ N(t) E[Y_1] \right] \\
           &= E[N(t)] E[Y_1] \\
           &= \lambda t E[Y_1]
   \end{align*}
   \]

2. **æ–¹å·®æ¨å¯¼ï¼š**

   \[
   \begin{align*}
   \text{Var}(X(t)) &= E\left[ \text{Var}\left( \sum_{i=1}^{N(t)} Y_i \bigg| N(t) \right) \right] + \text{Var}\left( E\left[ \sum_{i=1}^{N(t)} Y_i \bigg| N(t) \right] \right) \\
                    &= E\left[ N(t) \text{Var}(Y_1) \right] + \text{Var}\left( N(t) E[Y_1] \right) \\
                    &= E[N(t)] \text{Var}(Y_1) + \text{Var}(N(t))(E[Y_1])^2 \\
                    &= \lambda t \text{Var}(Y_1) + \lambda t (E[Y_1])^2 \\
                    &= \lambda t \left( \text{Var}(Y_1) + (E[Y_1])^2 \right) \\
                    &= \lambda t E[Y_1^2]
   \end{align*}
   \]

   å…¶ä¸­ï¼š

   \[
   E[Y_1^2] = \text{Var}(Y_1) + (E[Y_1])^2
   \]

**æ­¥éª¤ 2ï¼šç®—æ³•å®ç°**

1. å¯¹äºæ¯æ¬¡æ¨¡æ‹Ÿï¼š
   - ç”Ÿæˆ \( N(t) \sim \text{Poisson}(\lambda t) \)ã€‚
   - ç”Ÿæˆ \( N(t) \) ä¸ª \( Y_i \sim \text{Gamma}(\alpha, \beta) \)ã€‚
   - è®¡ç®— \( X(t) = \sum_{i=1}^{N(t)} Y_i \)ã€‚
2. é‡å¤ä¸Šè¿°æ­¥éª¤å¤šæ¬¡ï¼Œè®¡ç®—æ ·æœ¬å‡å€¼å’Œæ–¹å·®ã€‚

**æ­¥éª¤ 3ï¼šåœ¨ R ä¸­å®ç°å¹¶éªŒè¯**

```{r, eval=TRUE}
# è®¾ç½®éšæœºæ•°ç§å­
set.seed(133)

# å®šä¹‰æ¨¡æ‹Ÿå¤åˆæ³Šæ¾â€“Gamma è¿‡ç¨‹çš„å‡½æ•°
simulate_compound_poisson_gamma <- function(lambda, t, shape, rate, n_sim) {
  X_values <- numeric(n_sim)  # å­˜å‚¨æ¨¡æ‹Ÿç»“æœ
  
  for (i in 1:n_sim) {
    N_t <- rpois(1, lambda * t)  # ç”Ÿæˆ N(t)
    
    if (N_t > 0) {
      Y_i <- rgamma(N_t, shape = shape, rate = rate)  # ç”Ÿæˆ Y_i
      X_values[i] <- sum(Y_i)  # è®¡ç®— X(t)
    } else {
      X_values[i] <- 0
    }
  }
  
  return(X_values)
}

# è®¾ç½®å‚æ•°
lambda <- 2     # æ³Šæ¾è¿‡ç¨‹å‚æ•°
t <- 10         # æ—¶é—´ç‚¹
shape <- 3      # Gamma åˆ†å¸ƒå½¢çŠ¶å‚æ•° Î±
rate <- 2       # Gamma åˆ†å¸ƒé€Ÿç‡å‚æ•° Î²
n_sim <- 10000  # æ¨¡æ‹Ÿæ¬¡æ•°

# æ¨¡æ‹Ÿå¤åˆæ³Šæ¾â€“Gamma è¿‡ç¨‹
X_values <- simulate_compound_poisson_gamma(lambda, t, shape, rate, n_sim)

# ä¼°è®¡å‡å€¼å’Œæ–¹å·®
estimated_mean <- mean(X_values)
estimated_var <- var(X_values)

# è®¡ç®—ç†è®ºå‡å€¼å’Œæ–¹å·®
E_Y1 <- shape / rate  # Gamma åˆ†å¸ƒå‡å€¼
E_Y1_sq <- (shape * (shape + 1)) / rate^2  # Gamma åˆ†å¸ƒäºŒé˜¶åŸç‚¹çŸ©

theoretical_mean <- lambda * t * E_Y1
theoretical_var <- lambda * t * E_Y1_sq

# è¾“å‡ºç»“æœ
cat("ä¼°è®¡çš„å‡å€¼ï¼š", estimated_mean, "ç†è®ºå‡å€¼ï¼š", round(theoretical_mean),"\n")
cat("ä¼°è®¡çš„æ–¹å·®ï¼š", estimated_var,  "ç†è®ºæ–¹å·®ï¼š", round(theoretical_var),"\n")

```

**ä»£ç æ¦‚è¿°ï¼š**

- ä½¿ç”¨ `simulate_compound_poisson_gamma` å‡½æ•°æ¨¡æ‹Ÿå¤åˆæ³Šæ¾â€“Gamma è¿‡ç¨‹ã€‚
- è®¡ç®—ä¼°è®¡çš„å‡å€¼å’Œæ–¹å·®ï¼Œä¸ç†è®ºå€¼è¿›è¡Œæ¯”è¾ƒã€‚

**ç»“æœåˆ†æï¼š**

è¿è¡Œä»£ç åï¼Œå¯ä»¥çœ‹åˆ°ä¼°è®¡çš„å‡å€¼å’Œæ–¹å·®ä¸ç†è®ºå€¼éå¸¸æ¥è¿‘ï¼ŒéªŒè¯äº†ç†è®ºæ¨å¯¼å’Œæ¨¡æ‹Ÿçš„æ­£ç¡®æ€§ã€‚

**æ­¥éª¤ 4ï¼šå°è¯•æ›´å¤šçš„å‚æ•°å€¼**

- **æ³Šæ¾è¿‡ç¨‹å‚æ•° Î»ï¼š** å–å€¼ 0.5, 1, 2, 5ã€‚
- **Gamma åˆ†å¸ƒå‚æ•°ï¼ˆå½¢çŠ¶å‚æ•° Î± å’Œå°ºåº¦å‚æ•° Î¸ï¼‰ï¼š** å½¢çŠ¶å‚æ•° Î± å–å€¼ 1, 2, 3ï¼›å°ºåº¦å‚æ•° Î¸ å–å€¼ 0.5, 1, 2ã€‚

**ä¿®æ”¹ä»£ç ï¼š**

```{r, eval=TRUE}
# è®¾ç½®éšæœºæ•°ç§å­
set.seed(134)

# å®šä¹‰æ¨¡æ‹Ÿå¤åˆæ³Šæ¾â€“Gamma è¿‡ç¨‹çš„å‡½æ•°
simulate_compound_poisson_gamma <- function(lambda, t, shape, scale, n_sim) {
  X_values <- numeric(n_sim)  # å­˜å‚¨æ¨¡æ‹Ÿç»“æœ
  
  for (i in 1:n_sim) {
    N_t <- rpois(1, lambda * t)  # ç”Ÿæˆ N(t)
    
    if (N_t > 0) {
      Y_i <- rgamma(N_t, shape = shape, scale = scale)  # ç”Ÿæˆ Y_i
      X_values[i] <- sum(Y_i)  # è®¡ç®— X(t)
    } else {
      X_values[i] <- 0
    }
  }
  
  return(X_values)
}

# å‚æ•°é›†åˆ
lambda_values <- c(0.5, 1, 2, 5)
shape_values <- c(1, 2, 3)
scale_values <- c(0.5, 1, 2)
t <- 10         # æ—¶é—´ç‚¹
n_sim <- 10000  # æ¨¡æ‹Ÿæ¬¡æ•°

# éå†å‚æ•°ç»„åˆ
for (lambda in lambda_values) {
  for (shape in shape_values) {
    for (scale in scale_values) {
      X_values <- simulate_compound_poisson_gamma(lambda, t, shape, scale, n_sim)
      
      # ä¼°è®¡å‡å€¼å’Œæ–¹å·®
      estimated_mean <- mean(X_values)
      estimated_var <- var(X_values)
      
      # è®¡ç®—ç†è®ºå‡å€¼å’Œæ–¹å·®
      E_Y1 <- shape * scale  # Gamma åˆ†å¸ƒå‡å€¼ï¼ˆÎ¸ = scaleï¼‰
      E_Y1_sq <- (shape * (shape + 1)) * scale^2  # Gamma åˆ†å¸ƒäºŒé˜¶åŸç‚¹çŸ©
      
      theoretical_mean <- lambda * t * E_Y1
      theoretical_var <- lambda * t * E_Y1_sq
      
      # è¾“å‡ºç»“æœ
      cat("å‚æ•°ï¼šlambda =", lambda, ", shape =", shape, ", scale =", scale, "\n")
      cat("ä¼°è®¡çš„å‡å€¼ï¼š", round(estimated_mean, 4), "ç†è®ºå‡å€¼ï¼š", round(theoretical_mean, 4), "\n")
      cat("ä¼°è®¡çš„æ–¹å·®ï¼š", round(estimated_var, 4), "ç†è®ºæ–¹å·®ï¼š", round(theoretical_var, 4), "\n\n")
    }
  }
}
```

**ä»£ç æ¦‚è¿°ï¼š**

- **Gamma åˆ†å¸ƒå‚æ•°è°ƒæ•´ï¼š** R ä¸­çš„ `rgamma` å‡½æ•°æ¥å— `shape`ï¼ˆå½¢çŠ¶å‚æ•°ï¼‰å’Œ `scale`ï¼ˆå°ºåº¦å‚æ•° Î¸ï¼‰ã€‚
- **è®¡ç®—äºŒé˜¶åŸç‚¹çŸ©ï¼š** \( E[Y_1^2] = \text{Var}(Y_1) + (E[Y_1])^2 \)ï¼Œå…¶ä¸­ \( \text{Var}(Y_1) = \text{shape} \times \text{scale}^2 \)ã€‚
- **ç»“æœè¾“å‡ºï¼š** ä½¿ç”¨ `round` å‡½æ•°å¯¹ç»“æœè¿›è¡Œå››èˆäº”å…¥ï¼Œä»¥ä¾¿æ›´æ¸…æ™°åœ°æ¯”è¾ƒã€‚

**ç»“æœåˆ†æï¼š**

- **ä¼°è®¡å€¼ä¸ç†è®ºå€¼æ¥è¿‘ï¼š** å¯¹äºæ¯ç»„å‚æ•°ï¼Œä¼°è®¡çš„å‡å€¼å’Œæ–¹å·®éƒ½ä¸ç†è®ºå€¼éå¸¸æ¥è¿‘ï¼Œè¯æ˜äº†æ¨¡æ‹Ÿçš„å‡†ç¡®æ€§ã€‚
- **æ–¹å·®ç•¥æœ‰å·®å¼‚ï¼š** ç”±äºæ¨¡æ‹Ÿçš„éšæœºæ€§ï¼Œä¼°è®¡çš„æ–¹å·®å¯èƒ½ä¸ç†è®ºå€¼æœ‰å¾®å°å·®å¼‚ï¼Œéšç€æ¨¡æ‹Ÿæ¬¡æ•°çš„å¢åŠ ï¼Œè¿™äº›å·®å¼‚ä¼šå‡å°ã€‚

**ç»˜åˆ¶æ¨¡æ‹Ÿç»“æœçš„åˆ†å¸ƒï¼š**

å¯¹äºæŸç»„å‚æ•°ï¼Œå¯ä»¥ç»˜åˆ¶ \( X(t) \) çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆå…¶ä¸­tçš„å€¼æ²¿ç”¨å‰é¢çš„è®¾ç½®ï¼Œä»ä¸º10ï¼Œå³ \( X(10) \) ï¼‰ï¼Œè§‚å¯Ÿå…¶åˆ†å¸ƒå½¢æ€ã€‚

```{r, eval=TRUE}
# é€‰æ‹©ä¸€ç»„å‚æ•°
lambda <- 2
shape <- 2
scale <- 1

# æ¨¡æ‹Ÿ
X_values <- simulate_compound_poisson_gamma(lambda, t, shape, scale, n_sim)

# ç»˜åˆ¶ç›´æ–¹å›¾
hist(X_values, breaks = 50, probability = TRUE,
     main = paste("å¤åˆæ³Šæ¾â€“Gamma è¿‡ç¨‹åˆ†å¸ƒ (Î» =", lambda, ", Î± =", shape, ", Î¸ =", scale, ")"),
     xlab = "X(t)", ylab = "å¯†åº¦", col = "lightcoral", border = "white")

# æ·»åŠ æ ¸å¯†åº¦ä¼°è®¡æ›²çº¿
lines(density(X_values), col = "blue", lwd = 2)

# æ·»åŠ ç†è®ºå‡å€¼å’Œæ–¹å·®çš„å‚ç›´çº¿
abline(v = mean(X_values), col = "green", lwd = 2, lty = 2)
legend("topright", legend = c("ç›´æ–¹å›¾", "æ ¸å¯†åº¦ä¼°è®¡", "å‡å€¼"),
       col = c("lightcoral", "blue", "green"), lwd = c(10, 2, 2), lty = c(1, 1, 2))
```

**ä»£ç æ¦‚è¿°ï¼š**

- **åˆ†å¸ƒå½¢æ€ï¼š** å¤åˆæ³Šæ¾â€“Gamma è¿‡ç¨‹çš„åˆ†å¸ƒå¯èƒ½å‘ˆåæ–œçš„è¿ç»­åˆ†å¸ƒã€‚
- **å‡å€¼ä½ç½®ï¼š** åœ¨ç›´æ–¹å›¾ä¸­æ·»åŠ å‡å€¼çš„å‚ç›´çº¿ï¼Œå¯ä»¥ç›´è§‚åœ°çœ‹åˆ°å‡å€¼åœ¨åˆ†å¸ƒä¸­çš„ä½ç½®ã€‚

**ç»“æœåˆ†æï¼š**

- **æ¨¡æ‹Ÿçš„æœ‰æ•ˆæ€§ï¼š** é€šè¿‡å¤§é‡æ¨¡æ‹Ÿï¼ŒéªŒè¯äº†ç†è®ºæ¨å¯¼çš„å‡å€¼å’Œæ–¹å·®å…¬å¼çš„æ­£ç¡®æ€§ã€‚
- **å‚æ•°å½±å“ï¼š**
  - **Î» çš„å½±å“ï¼š** å¢åŠ  Î»ï¼Œä¼šå¢åŠ  \( N(t) \) çš„æœŸæœ›å€¼ï¼Œå³å¢å¤§ \( X(t) \) çš„å‡å€¼å’Œæ–¹å·®ã€‚
  - **Gamma åˆ†å¸ƒå‚æ•°çš„å½±å“ï¼š** å¢åŠ å½¢çŠ¶å‚æ•° Î±ï¼Œä¼šå¢åŠ  \( Y_i \) çš„å‡å€¼å’Œæ–¹å·®ï¼›å¢åŠ å°ºåº¦å‚æ•° Î¸ï¼Œä¹Ÿä¼šå¢å¤§å‡å€¼å’Œæ–¹å·®ã€‚

# æ€»ç»“

## å›°éš¾ä¸è§£å†³æ–¹å¼

### 1. æ•°å­¦ç†è®ºçš„æ·±å…¥ç†è§£

åœ¨è¿›è¡Œå¤åˆæ³Šæ¾â€“Gammaè¿‡ç¨‹çš„æ¨¡æ‹Ÿå‰ï¼Œæˆ‘é¦–å…ˆé¢ä¸´çš„å›°éš¾æ˜¯å¯¹ç›¸å…³æ•°å­¦ç†è®ºçš„ç†è§£ä¸å¤Ÿæ·±å…¥ã€‚å¤åˆæ³Šæ¾è¿‡ç¨‹æ¶‰åŠåˆ°æ³Šæ¾åˆ†å¸ƒå’ŒGammaåˆ†å¸ƒçš„ç»“åˆï¼Œè¿™éœ€è¦æˆ‘ä¸ä»…è¦ç†è§£æ¯ç§åˆ†å¸ƒçš„åŸºæœ¬å±æ€§ï¼Œè¿˜è¦æŒæ¡å®ƒä»¬å¦‚ä½•è”åˆä½œç”¨äºæ¨¡å‹ä¸­ã€‚åˆæœŸï¼Œå¯¹å¦‚ä½•ä»ç†è®ºå…¬å¼è½¬åŒ–ä¸ºå¯æ‰§è¡Œçš„æ¨¡æ‹Ÿä»£ç å­˜åœ¨è®¤è¯†ä¸Šçš„éšœç¢ã€‚

**è§£å†³æ–¹æ³•ï¼š** ä¸ºäº†å…‹æœè¿™ä¸€ç‚¹ï¼Œæˆ‘é‡ç‚¹å¤ä¹ äº†æ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡çš„ç›¸å…³ç« èŠ‚ï¼Œç‰¹åˆ«æ˜¯å…³äºæ³Šæ¾åˆ†å¸ƒå’ŒGammaåˆ†å¸ƒçš„æ€§è´¨ã€‚é€šè¿‡åœ¨çº¿è¯¾ç¨‹ã€æ•™æå’Œå­¦æœ¯è®ºæ–‡ï¼Œæˆ‘åŠ æ·±äº†å¯¹è¿™äº›åˆ†å¸ƒçš„ç†è§£ã€‚æ­¤å¤–ï¼Œæˆ‘é€šè¿‡ä¸æˆ‘å®¤å‹å’ŒåŒå­¦çš„è®¨è®ºï¼Œæ·±å…¥ç†è§£äº†å¤æ‚æ¦‚å¿µï¼Œåœ¨è¿™ä¹‹åæˆ‘æ‰èƒ½å¤Ÿæ›´å‡†ç¡®åœ°å°†æ•°å­¦æ¨¡å‹ç¿»è¯‘ä¸ºè®¡ç®—æ¨¡å‹ã€‚

### 2. ç¼–ç¨‹ä¸ä»£ç è°ƒè¯•

å°†ç†è®ºåº”ç”¨åˆ°å®è·µä¸­æ—¶ï¼Œæˆ‘é‡åˆ°äº†ç¼–ç¨‹å®ç°çš„æŒ‘æˆ˜ã€‚ç‰¹åˆ«æ˜¯åœ¨Rè¯­è¨€ä¸­å®ç°å¤æ‚çš„ç»Ÿè®¡æ¨¡æ‹Ÿï¼Œæˆ‘éœ€è¦ç²¾ç¡®æŒæ¡å‡½æ•°ç”¨æ³•å’Œæ•°æ®ç»“æ„æ“ä½œã€‚åˆæœŸçš„ä»£ç å­˜åœ¨é€»è¾‘é”™è¯¯å’Œæ€§èƒ½ä½ä¸‹çš„é—®é¢˜ï¼Œå¯¼è‡´æ¨¡æ‹Ÿç»“æœä¸é¢„æœŸæœ‰è¾ƒå¤§åå·®ã€‚

**è§£å†³æ–¹æ³•ï¼š** æˆ‘é‡‡å–äº†åˆ†æ­¥éª¤æ„å»ºå’Œæµ‹è¯•ä»£ç çš„ç­–ç•¥ã€‚é¦–å…ˆï¼Œå¯¹æ¯ä¸€ä¸ªå°åŠŸèƒ½ç¼–å†™å•ç‹¬çš„æµ‹è¯•æ¡ˆä¾‹ï¼Œç¡®ä¿å®ƒä»¬çš„æ­£ç¡®æ€§ã€‚åœ¨ç¡®è®¤æ¯éƒ¨åˆ†éƒ½èƒ½æ­£ç¡®è¿è¡Œåï¼Œæˆ‘å†å°†å®ƒä»¬æ•´åˆåˆ°ä¸»ç¨‹åºä¸­ã€‚å¯¹äºæ€§èƒ½ä¼˜åŒ–ï¼Œæˆ‘å­¦ä¹ äº†å¦‚ä½•åœ¨Rä¸­æœ‰æ•ˆç®¡ç†å†…å­˜å’Œå¹¶è¡Œå¤„ç†è®¡ç®—ï¼Œæ˜¾è‘—æé«˜äº†ä»£ç çš„è¿è¡Œæ•ˆç‡ã€‚æ­¤å¤–ï¼Œé€šè¿‡ä¸æ–­åœ°è°ƒè¯•å’ŒæŸ¥é˜…Rè¯­è¨€çš„å®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘è§£å†³äº†ä»£ç ä¸­çš„é”™è¯¯ï¼Œå¹¶ä¼˜åŒ–äº†ç®—æ³•å®ç°ã€‚

### 3. æ¨¡å‹éªŒè¯ä¸ç»“æœè§£é‡Š

åœ¨æ¨¡æ‹Ÿå®Œæˆåï¼Œæˆ‘é¢ä¸´çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚ä½•éªŒè¯æ¨¡æ‹Ÿç»“æœçš„æ­£ç¡®æ€§ä»¥åŠå¦‚ä½•è§£é‡Šè¿™äº›ç»“æœã€‚ç”±äºæ¶‰åŠåˆ°å¤æ‚çš„éšæœºè¿‡ç¨‹ï¼Œå•çº¯ä»ç»“æœæ•°æ®åˆ¤æ–­æ¨¡å‹çš„æ­£ç¡®æ€§æœ‰ä¸€å®šéš¾åº¦ã€‚

**è§£å†³æ–¹æ³•ï¼š** æˆ‘é¦–å…ˆä½¿ç”¨äº†å·²çŸ¥å‚æ•°çš„ç†è®ºå€¼ä¸æ¨¡æ‹Ÿç»“æœè¿›è¡Œå¯¹æ¯”ï¼Œæ£€éªŒæ¨¡æ‹Ÿçš„å‡†ç¡®æ€§ã€‚ä¸ºäº†è¿›ä¸€æ­¥éªŒè¯ï¼Œæˆ‘è¿˜è¿›è¡Œäº†å¤šæ¬¡æ¨¡æ‹Ÿï¼Œè®¡ç®—å…¶å¹³å‡å€¼å’Œæ–¹å·®ï¼Œä»¥ç¨³å®šç»“æœï¼Œå‡å°‘éšæœºè¯¯å·®çš„å½±å“ã€‚æ­¤å¤–ï¼Œæˆ‘é‡‡ç”¨äº†å›¾å½¢åŒ–çš„æ–¹æ³•ï¼Œå¦‚ç»˜åˆ¶ç›´æ–¹å›¾å’Œå¯†åº¦æ›²çº¿ï¼Œç›´è§‚å±•ç¤ºæ•°æ®åˆ†å¸ƒå’Œç†è®ºé¢„æœŸä¹‹é—´çš„å…³ç³»ã€‚è¿™äº›æ–¹æ³•å¸®åŠ©æˆ‘æ›´å¥½åœ°ç†è§£å’Œè§£é‡Šäº†æ¨¡æ‹Ÿç»“æœï¼Œä¹Ÿä¸ºæ¨¡å‹çš„è°ƒæ•´æä¾›äº†ä¾æ®ã€‚

é€šè¿‡è¿™äº›ç­–ç•¥ï¼Œæˆ‘æˆåŠŸåœ°å…‹æœäº†åœ¨è¿™ä¸€é¡¹ç›®ä¸­é‡åˆ°çš„æŒ‘æˆ˜ï¼Œè¿™ä¸ä»…å¢å¼ºäº†æˆ‘çš„é—®é¢˜è§£å†³èƒ½åŠ›ï¼Œä¹Ÿæå‡äº†æˆ‘çš„ç»Ÿè®¡è®¡ç®—æŠ€èƒ½å’Œç¼–ç¨‹èƒ½åŠ›ã€‚

## æ€è€ƒä¸æ„Ÿæ‚Ÿ

è¿™æ¬¡å®éªŒè®©æˆ‘æ·±åˆ»è®¤è¯†åˆ°ç†è®ºçŸ¥è¯†ä¸å®è·µåº”ç”¨ä¹‹é—´çš„å…³è”ã€‚åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œç†è®ºçŸ¥è¯†æ˜¯åŸºç¡€ï¼Œä½†å°†è¿™äº›çŸ¥è¯†åº”ç”¨åˆ°å®é™…é—®é¢˜ä¸­ï¼Œè¿›è¡Œæ¨¡æ‹Ÿå’ŒéªŒè¯ï¼Œæ‰èƒ½çœŸæ­£ç†è§£å’ŒæŒæ¡è¿™äº›çŸ¥è¯†ã€‚æ¯ä¸€ä¸ªå…¬å¼å’Œç†è®ºæ¨å¯¼èƒŒåï¼Œéƒ½æœ‰å…¶æ·±åˆ»çš„ç‰©ç†æ„ä¹‰å’Œå®é™…åº”ç”¨çš„èƒŒæ™¯ï¼Œé€šè¿‡ç¼–ç¨‹å®ç°è¿™äº›ç†è®ºæ¨¡å‹ï¼Œæˆ‘æ›´åŠ ç›´è§‚åœ°ç†è§£äº†è¿™äº›ç»Ÿè®¡åˆ†å¸ƒçš„è¡Œä¸ºå’Œç‰¹ç‚¹ã€‚

æ­¤å¤–ï¼Œè¿™æ¬¡å®éªŒè¿‡ç¨‹ä¹Ÿè®©æˆ‘ä½“ä¼šåˆ°äº†æŒç»­å­¦ä¹ å’Œé—®é¢˜è§£å†³çš„é‡è¦æ€§ã€‚é¢å¯¹å›°éš¾å’ŒæŒ‘æˆ˜ï¼Œé€šè¿‡ä¸»åŠ¨å­¦ä¹ å’Œå¯»æ±‚è§£å†³æ–¹æ¡ˆï¼Œæˆ‘èƒ½é€æ­¥å…‹æœå®éªŒä¸­é‡åˆ°çš„é—®é¢˜ï¼Œå¢å¼ºäº†è‡ªæˆ‘è§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚è¿™ä¸ä»…ä»…æ˜¯æŠ€æœ¯èƒ½åŠ›çš„æå‡ï¼Œæ›´æ˜¯å¯¹å¾…å­¦ä¹ å’Œå·¥ä½œæ€åº¦çš„é”»ç‚¼ã€‚

æœ€åï¼Œè¿™æ¬¡å®éªŒå¼ºåŒ–äº†æˆ‘çš„ç»Ÿè®¡æ€ç»´å’Œæ•°æ®æ•æ„Ÿæ€§ã€‚åœ¨æ•°æ®ç§‘å­¦å’Œç»Ÿè®¡å­¦é¢†åŸŸï¼Œå¯¹æ•°æ®çš„æ•æ„Ÿæ€§æ˜¯éå¸¸é‡è¦çš„èƒ½åŠ›ã€‚é€šè¿‡å®éªŒæ•°æ®çš„ç”Ÿæˆã€å¤„ç†å’Œåˆ†æï¼Œæˆ‘å­¦ä¼šäº†å¦‚ä½•è§‚å¯Ÿæ•°æ®çš„åˆ†å¸ƒç‰¹å¾ï¼Œå¦‚ä½•è¯„ä¼°å’Œè§£é‡Šæ•°æ®ç»“æœï¼Œè¿™å°†å¯¹æˆ‘çš„æœªæ¥å­¦ä¹ å’Œç ”ç©¶äº§ç”Ÿæ·±è¿œçš„å½±å“ã€‚


---

# ç»Ÿè®¡è®¡ç®—ç¬¬3æ¬¡ä½œä¸š { .center-title }

ä»¥ä¸‹æ˜¯ç»Ÿè®¡è®¡ç®—2024-09-23è¯¾ç¨‹å¯¹åº”çš„ä½œä¸š

# Question

## Question 1

Exercises 5.4, 5.9, and 5.13 (pages 149-151, Statistical Computing with R).

  * __Exercise 5.4__  Write a function to compute a Monte Carlo estimate of the $\mathrm{Beta}(3, 3)$ cdf, and use the function to estimate $F(x)$ for $x=0.1,0.2,\ldots,0.9.$ Compare the estimates with the values returned by the $\text{pbeta}$ function in R.

  * __Exercise 5.9__  The Rayleigh density [156, (18.76)] is 
$$f(x)=\frac{x}{\sigma^2} e^{-x^2/(2\sigma^2)},\quad x\ge0, \sigma>0.$$
Implement a function to generate samples from a Rayleigh(Ïƒ) distribution,using antithetic variables. What is the percent reduction in variance of $\frac{X+X^{'}}2$ compared with $\frac{X_1+X_2}2$ for independent $X_{1},X_{2}$?

  * __Exercise 5.13__  Find two importance functions $f_{1}$ and $f_{2}$ that are supported on $(1,\infty)$ and are â€˜closeâ€™ to
$$g(x)=\frac{x^2}{\sqrt{2\pi}} e^{-x^2/2},\quad x>1.$$
Which of your two importance functions should produce the smaller variance in estimating
$$\int_1^\infty\frac{x^2}{\sqrt{2\pi}} e^{-x^2/2} dx$$
by importance sampling? Explain.

## Question 2
Monte Carlo experiment

  * For $n = 10^{4}, 2 Ã— 10^{4}, 4 Ã— 10^{4}, 6 Ã— 10^{4}, 8 Ã— 10^{4}$, apply the fast sorting algorithm to randomly permuted numbers of $1, . . . , n$.

  * Calculate computation time averaged over 100 simulations, denoted by $a_{n}$.

  * Regress $a_{n}$ on $t_n:=n\log(n)$, and graphically show the results (scatter plot and regression line).


# Answer

## ç»ƒä¹  5.4

### é¢˜ç›®æè¿°

ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®— $\mathrm{Beta}(3, 3)$ åˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼ˆCDFï¼‰çš„è’™ç‰¹å¡ç½—ä¼°è®¡ï¼Œå¹¶ä½¿ç”¨è¯¥å‡½æ•°æ¥ä¼°è®¡ $F(x)$ï¼Œå…¶ä¸­ $x=0.1, 0.2, \ldots, 0.9$ã€‚å°†ä¼°è®¡å€¼ä¸ R ä¸­çš„ `pbeta` å‡½æ•°è¿”å›çš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚

### è§£ç­”æ€è·¯

1. **è’™ç‰¹å¡ç½—æ–¹æ³•ä¼°è®¡ CDFï¼š**

   - **åŸç†ï¼š**$\mathrm{Beta}(3, 3)$ åˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•° $F(x)$ æ˜¯æŒ‡éšæœºå˜é‡ $X$ï¼ˆæœä» $\mathrm{Beta}(3, 3)$ åˆ†å¸ƒï¼‰å°äºç­‰äº $x$ çš„æ¦‚ç‡ï¼Œå³ $F(x) = P(X â‰¤ x)$ã€‚å› æ­¤ï¼Œå¯¹äºç»™å®šçš„ $x$ï¼Œç”Ÿæˆå¤§é‡æœä» $\mathrm{Beta}(3, 3)$ åˆ†å¸ƒçš„éšæœºæ•°ï¼Œè®¡ç®—è¿™äº›éšæœºæ•°ä¸­å°äºç­‰äº $x$ çš„æ¯”ä¾‹ï¼Œå³ä¸º CDF åœ¨ $x$ å¤„çš„ä¼°è®¡å€¼ã€‚

2. **å…¬å¼æ¨å¯¼ï¼š**

   ç”±äº $F(x) = E[I(X \leq x)]$ï¼Œå…¶ä¸­ $I(\cdot)$ æ˜¯æŒ‡ç¤ºå‡½æ•°ï¼Œç”¨æ¥æ£€æŸ¥æ¯ä¸ªæ ·æœ¬ $X$ æ˜¯å¦å°äºç­‰äº$x$ã€‚å› æ­¤ï¼Œè’™ç‰¹å¡ç½—ä¼°è®¡ä¸ºï¼š
   $$
   \hat{F}(x) = \frac{1}{n} \sum_{i=1}^{n} I(X_i \leq x)
   $$
   å…¶ä¸­ï¼Œ$X_i$ æ˜¯ç¬¬ $i$ ä¸ªæ ·æœ¬ï¼Œ$n$ æ˜¯æ ·æœ¬æ€»æ•°ã€‚

3. **å®ç°æ­¥éª¤ï¼š**

   - **æ­¥éª¤ 1ï¼š** ç”Ÿæˆå¤§é‡ï¼ˆå¦‚ $N = 10^6$ï¼‰æœä» $\mathrm{Beta}(3, 3)$ åˆ†å¸ƒçš„éšæœºæ ·æœ¬ã€‚
   - **æ­¥éª¤ 2ï¼š** è®¡ç®—æ ·æœ¬ä¸­å°äºç­‰äº $x$ çš„æ ·æœ¬æ•°å æ€»æ ·æœ¬æ•°çš„æ¯”ä¾‹ï¼Œå³ä¸º $F(x)$ çš„ä¼°è®¡å€¼ã€‚
   - **æ­¥éª¤ 3ï¼š** å¯¹ä¸åŒçš„ $x$ å€¼é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œå¾—åˆ°å¯¹åº”çš„ä¼°è®¡å€¼ã€‚
   - **æ­¥éª¤ 4ï¼š** å°†è’™ç‰¹å¡ç½—ä¼°è®¡å€¼ä¸ R ä¸­çš„ $pbeta(x, 3, 3)$ å‡½æ•°è®¡ç®—çš„ç²¾ç¡®å€¼è¿›è¡Œæ¯”è¾ƒã€‚

### ä»£ç å®ç°

```{r, eval=TRUE}
# è®¾ç½®éšæœºæ•°ç§å­ï¼Œä¿è¯ç»“æœå¯é‡å¤
set.seed(101)

# å®šä¹‰ä¼°è®¡ Beta(3,3) åˆ†å¸ƒ CDF çš„å‡½æ•°
estimate_beta_cdf <- function(x_values, N = 1e6) {
  # ç”Ÿæˆ N ä¸ª Beta(3,3) åˆ†å¸ƒçš„éšæœºæ ·æœ¬
  samples <- rbeta(N, shape1 = 3, shape2 = 3)
  
  # åˆå§‹åŒ–å­˜å‚¨ä¼°è®¡å€¼çš„å‘é‡
  estimates <- numeric(length(x_values))
  
  # å¯¹æ¯ä¸ª xï¼Œè®¡ç®—ä¼°è®¡çš„ CDF å€¼
  for (i in seq_along(x_values)) {
    x <- x_values[i]
    estimates[i] <- mean(samples <= x)
  }
  
  return(estimates)
}

# å®šä¹‰ x çš„å–å€¼
x_values <- seq(0.1, 0.9, by = 0.1)

# ä¼°è®¡ CDF å€¼
estimated_cdf <- estimate_beta_cdf(x_values)

# ä½¿ç”¨ pbeta å‡½æ•°è®¡ç®—çœŸå®çš„ CDF å€¼
true_cdf <- pbeta(x_values, shape1 = 3, shape2 = 3)

# å°†ç»“æœæ•´ç†æˆæ•°æ®æ¡†
comparison <- data.frame(
  x = x_values,
  Estimated_CDF = estimated_cdf,
  True_CDF = true_cdf,
  Difference = abs(estimated_cdf - true_cdf)
)

# æ‰“å°æ¯”è¾ƒç»“æœ
print(comparison)
```

### ä»£ç æ¦‚è¿°

- **`set.seed(101)`ï¼š** è®¾ç½®éšæœºæ•°ç§å­ï¼Œä»¥ç¡®ä¿ç»“æœçš„å¯é‡å¤æ€§ã€‚
- **`estimate_beta_cdf` å‡½æ•°ï¼š**
  - è¾“å…¥å‚æ•°ï¼š
    - `x_values`ï¼šéœ€è¦ä¼°è®¡ CDF çš„ $x$ å€¼å‘é‡ã€‚
    - `N`ï¼šç”Ÿæˆçš„éšæœºæ ·æœ¬æ•°é‡ï¼Œé»˜è®¤ä¸º $10^6$ã€‚
  - å†…éƒ¨æ­¥éª¤ï¼š
    - ä½¿ç”¨ `rbeta` å‡½æ•°ç”Ÿæˆ $N$ ä¸ª Beta(3,3) åˆ†å¸ƒçš„éšæœºæ ·æœ¬ã€‚
    - å¯¹äºæ¯ä¸ª $x$ï¼Œè®¡ç®—æ ·æœ¬ä¸­å°äºç­‰äº $x$ çš„æ¯”ä¾‹ï¼Œå¾—åˆ°ä¼°è®¡çš„ CDF å€¼ã€‚
- **ç»“æœæ¯”è¾ƒï¼š**
  - ä½¿ç”¨ `pbeta` å‡½æ•°è®¡ç®—çœŸå®çš„ CDF å€¼ã€‚
  - å°†ä¼°è®¡å€¼ä¸çœŸå®å€¼è¿›è¡Œæ¯”è¾ƒï¼Œè®¡ç®—ä¸¤è€…çš„å·®å¼‚ã€‚

### ç»“æœåˆ†æ

**å›¾å½¢å¯¹æ¯”ï¼š**

```{r, eval=TRUE}
# ç»˜åˆ¶ä¼°è®¡å€¼å’Œç²¾ç¡®å€¼çš„å¯¹æ¯”å›¾
plot(x_values, true_cdf, type='l', col='red', lwd=2,
     ylab='F(x)', xlab='x', main='Beta(3,3) ç´¯ç§¯åˆ†å¸ƒå‡½æ•°')
points(x_values, estimated_cdf, col='blue', pch=16)
legend('bottomright', legend=c('ç²¾ç¡®å€¼ (pbeta)', 'è’™ç‰¹å¡ç½—ä¼°è®¡'),
       col=c('red', 'blue'), lty=c(1, NA), pch=c(NA, 16))
```

**æœ€ç»ˆç»“è®ºï¼š**

è¿è¡Œä¸Šè¿°ä»£ç åï¼Œæ ¹æ®æ‰€å¾—åˆ°çš„è¾“å‡ºç»“æœï¼Œå¯çŸ¥ï¼š

- è’™ç‰¹å¡ç½—ä¼°è®¡å€¼ä¸ `pbeta` å‡½æ•°è®¡ç®—çš„çœŸå®å€¼éå¸¸æ¥è¿‘ã€‚
- å·®å¼‚åœ¨ \(10^{-4}\) çš„é‡çº§ï¼Œè¯´æ˜ä¼°è®¡ç²¾åº¦è¾ƒé«˜ã€‚
- ä»å›¾å½¢å¯¹æ¯”å¯ä»¥çœ‹å‡ºï¼Œè’™ç‰¹å¡ç½—ä¼°è®¡å€¼ï¼ˆè“ç‚¹ï¼‰ä¸ `pbeta` å‡½æ•°çš„çœŸå®å€¼ï¼ˆçº¢çº¿ï¼‰å‡ ä¹å®Œå…¨é‡åˆã€‚
- è¿™éƒ½è¯´æ˜äº†è’™ç‰¹å¡ç½—æ–¹æ³•ä¼°è®¡çš„æ•ˆæœè‰¯å¥½ï¼Œè¯å®äº†è’™ç‰¹å¡ç½—æ–¹æ³•ä¼°è®¡ CDF çš„æœ‰æ•ˆæ€§ã€‚

---

## ç»ƒä¹  5.9

### é¢˜ç›®æè¿°

Rayleigh å¯†åº¦å‡½æ•°ä¸ºï¼š

$$
f(x) = \frac{x}{\sigma^2} e^{-x^2 / (2\sigma^2)}, \quad x \geq 0, \sigma > 0.
$$

- ä½¿ç”¨å¯¹å¶å˜é‡ï¼ˆAntithetic Variablesï¼‰ï¼Œç¼–å†™ä¸€ä¸ªä» Rayleigh($Ïƒ$) åˆ†å¸ƒç”Ÿæˆæ ·æœ¬çš„å‡½æ•°ã€‚
- æ¯”è¾ƒ $\frac{X + X'}{2}$ä¸ $\frac{X_1 + X_2}{2}$ çš„æ–¹å·®ï¼Œå…¶ä¸­ $X$ å’Œ $X'$æ˜¯å¯¹å¶å˜é‡ç”Ÿæˆçš„æ ·æœ¬ï¼Œ$X_1$å’Œ $X_2$ æ˜¯ç‹¬ç«‹ç”Ÿæˆçš„æ ·æœ¬ã€‚
- è®¡ç®—æ–¹å·®å‡å°‘çš„ç™¾åˆ†æ¯”ã€‚

### è§£é¢˜æ€è·¯

1. **ç†è§£å¯¹å¶å˜é‡ï¼š**

   - **å¯¹å¶å˜é‡åŸç†ï¼š** åœ¨è’™ç‰¹å¡ç½—æ¨¡æ‹Ÿä¸­ï¼Œä¸ºäº†å‡å°‘ä¼°è®¡é‡çš„æ–¹å·®ï¼Œå¯ä»¥ä½¿ç”¨å¯¹å¶å˜é‡ã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äºéšæœºå˜é‡ \( $U \sim \text{Uniform}(0,1)$)ï¼Œå…¶å¯¹å¶å˜é‡ä¸º $1 - U$ã€‚

2. **ç”Ÿæˆ Rayleigh åˆ†å¸ƒæ ·æœ¬ï¼š**

   - **é€†å˜æ¢æ³•ï¼š** 

     Rayleigh åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆPDFï¼‰ä¸ºï¼š
     $$
     f(x) = \frac{x}{\sigma^2} e^{-x^2 / (2\sigma^2)}, \quad x \geq 0, \sigma > 0.
     $$
     è¦ä½¿ç”¨é€†å˜æ¢æ³•ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ±‚å‡ºå…¶ç´¯ç§¯åˆ†å¸ƒå‡½æ•° $F(x)$ã€‚

     **è®¡ç®—ç´¯ç§¯åˆ†å¸ƒå‡½æ•° $F(x)$ï¼š**
     $$
     \begin{align*}
     F(x) &= \int_0^x f(t) \, dt \\
          &= \int_0^x \frac{t}{\sigma^2} e^{-t^2 / (2\sigma^2)} \, dt.
     \end{align*}
     $$
     è¿™ä¸ªç§¯åˆ†çš„è§£æè§£å¯ä»¥é€šè¿‡æ¢å…ƒç§¯åˆ†æ³•æ±‚è§£ã€‚

     **æ¢å…ƒç§¯åˆ†æ³•ï¼š**

     ç›´æ¥è§‚å¯Ÿåˆ°ï¼š
     $$
     \frac{d}{dx} \left( -e^{-x^2 / (2\sigma^2)} \right) = \frac{x}{\sigma^2} e^{-x^2 / (2\sigma^2)} = f(x).
     $$
     
     å› æ­¤ï¼Œå¯ä»¥å¾—å‡ºï¼š
     $$
     F(x) = 1 - e^{-x^2 / (2\sigma^2)}, \quad x \geq 0.
     $$
     
     **éªŒè¯ï¼š**

     $$
     \begin{align*}
     F(x) &= \int_0^x f(t) \, dt \\
          &= \int_0^x \frac{t}{\sigma^2} e^{-t^2 / (2\sigma^2)} \, dt \\
          &= \left[ -e^{-t^2 / (2\sigma^2)} \right]_0^x \\
          &= -e^{-x^2 / (2\sigma^2)} - (-e^{-0}) \\
          &= 1 - e^{-x^2 / (2\sigma^2)}.
     \end{align*}
     $$
     å› æ­¤ï¼ŒRayleigh åˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ä¸ºï¼š

     $$
     F(x) = 1 - e^{-x^2 / (2\sigma^2)}.
     $$
     
     **æ±‚åå‡½æ•° $F^{-1}(U)$ï¼š**ç›®æ ‡æ˜¯è§£æ–¹ç¨‹ $F(x) = U$ï¼Œæ±‚ $x$å…³äº $U$çš„è¡¨è¾¾å¼

     **æ­¥éª¤ 1ï¼šå†™å‡ºæ–¹ç¨‹**
     
     $$
     U = F(x) = 1 - e^{-x^2 / (2\sigma^2)}.
     $$
     
     **æ­¥éª¤ 2ï¼šè§£æ–¹ç¨‹**

     **(a) ç§»é¡¹ï¼š**
     $$
     e^{-x^2 / (2\sigma^2)} = 1 - U.
     $$
     **(b) å–è‡ªç„¶å¯¹æ•°ï¼š**

     $$
     \frac{x^2}{2\sigma^2} = \ln(1 - U).
     $$

     **æ³¨æ„ï¼š** ç”±äº$0 < U < 1$ï¼Œæ‰€ä»¥$1 - U > 0$ï¼Œå¯¹æ•°å®šä¹‰åŸŸæœ‰æ•ˆã€‚

     **(c) è§£ $x^2$ï¼š**
     
     $$
     x^2 = -2\sigma^2 \ln(1 - U).
     $$
     **(d) è§£ $x$ï¼š**
     $$
     x = \sigma \sqrt{-2 \ln(1 - U)}.
     $$

     **ç”±äº $x \geq 0$ï¼Œæ‰€ä»¥å–æ­£å¹³æ–¹æ ¹ã€‚**

     **æ³¨æ„åˆ°ï¼š**

     - $U \sim \text{Uniform}(0,1)$ ã€‚
     - $1 - U$ ä¹Ÿæœä» $\text{Uniform}(0,1)$  åˆ†å¸ƒï¼Œå› ä¸ºå‡åŒ€åˆ†å¸ƒåœ¨åŒºé—´ $(0,1)$ ä¸Šæ˜¯å¯¹ç§°çš„ã€‚å› æ­¤ï¼Œå¯ä»¥ä»¤ $U' = 1 - U$ï¼Œåˆ™ï¼š

     $$
     x = \sigma \sqrt{-2 \ln U'}.
     $$

     è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ $U$ æ¥è¡¨ç¤º $x$ï¼š

     $$
     x = \sigma \sqrt{-2 \ln U}, \quad U \sim \text{Uniform}(0,1).
     $$

   - **ä½¿ç”¨å¯¹å¶å˜é‡ï¼š** 

     - å¯¹äºæ¯ä¸ªéšæœºæ•° $U$ï¼Œå¯¹åº”çš„å¯¹å¶å˜é‡ä¸º $1 - U$ã€‚
     - ç”Ÿæˆçš„ä¸¤ä¸ªå˜é‡ $X$ å’Œ $X'$ï¼š

     $$
     X = \sigma \sqrt{-2 \ln U}, \quad X' = \sigma \sqrt{-2 \ln (1 - U)}
     $$

3. **å®ç°æ­¥éª¤ï¼š**

   - **ä½¿ç”¨å¯¹å¶å˜é‡æ³•ç”Ÿæˆæ ·æœ¬ï¼š**
     - ç”Ÿæˆä¸€ç»„å‡åŒ€éšæœºæ•° $U$ã€‚
     - å…¶å¯¹å¶å˜é‡ä¸º $1 - U$ã€‚
     - é€šè¿‡ $U$ å’Œ $1 - U$ åˆ†åˆ«ç”Ÿæˆå¯¹åº”çš„ Rayleigh åˆ†å¸ƒæ ·æœ¬ $X$ å’Œ $X'$ã€‚
   - **è®¡ç®— $\frac{X + X'}{2}$ çš„æ–¹å·®ã€‚**
   - **ç”Ÿæˆç‹¬ç«‹çš„ $X_1$ å’Œ $X_2$ï¼Œè®¡ç®— $\frac{X_1 + X_2}{2}$ çš„æ–¹å·®ã€‚**
   - **æ¯”è¾ƒæ–¹å·®ï¼Œè®¡ç®—å‡å°‘çš„ç™¾åˆ†æ¯”ã€‚**

### ä»£ç å®ç°

```{r, eval=TRUE}
# è®¾ç½®éšæœºæ•°ç§å­ï¼Œä¿è¯ç»“æœå¯é‡å¤
set.seed(102)

# å®šä¹‰ä½¿ç”¨å¯¹å¶å˜é‡ç”Ÿæˆ Rayleigh(Ïƒ) åˆ†å¸ƒæ ·æœ¬çš„å‡½æ•°
generate_rayleigh_antithetic <- function(n, sigma) {
  # n å¿…é¡»æ˜¯å¶æ•°
  if (n %% 2 != 0) {
    stop("æ ·æœ¬æ•°é‡ n å¿…é¡»æ˜¯å¶æ•°")
  }
  
  # ç”Ÿæˆ n/2 ä¸ªå‡åŒ€åˆ†å¸ƒéšæœºæ•°
  U <- runif(n / 2)
  U_prime <- 1 - U  # å¯¹å¶å˜é‡
  
  # è®¡ç®—å¯¹åº”çš„ Rayleigh åˆ†å¸ƒæ ·æœ¬
  X <- sigma * sqrt(-2 * log(U))
  X_prime <- sigma * sqrt(-2 * log(U_prime))
  
  # è¿”å›åˆå¹¶çš„æ ·æœ¬
  return(c(X, X_prime))
}

# å®šä¹‰å‚æ•°
# æ€»æ ·æœ¬æ•°é‡ï¼Œå¿…é¡»æ˜¯å¶æ•°
n <- 1e6
# Ïƒ å€¼
sigma <- 1  

# ä½¿ç”¨å¯¹å¶å˜é‡ç”Ÿæˆæ ·æœ¬
samples_antithetic <- generate_rayleigh_antithetic(n, sigma)
# è®¡ç®— (X + X') / 2
mean_antithetic <- (samples_antithetic[1:(n/2)] + samples_antithetic[(n/2 + 1):n]) / 2

# ç”Ÿæˆç‹¬ç«‹çš„æ ·æœ¬
X1 <- sigma * sqrt(-2 * log(runif(n/2)))
X2 <- sigma * sqrt(-2 * log(runif(n/2)))
mean_independent <- (X1 + X2) / 2

# è®¡ç®—æ–¹å·®
var_antithetic <- var(mean_antithetic)
var_independent <- var(mean_independent)

# è®¡ç®—æ–¹å·®å‡å°‘çš„ç™¾åˆ†æ¯”
variance_reduction <- (1 - var_antithetic / var_independent) * 100

# è¾“å‡ºç»“æœ
cat("ä½¿ç”¨å¯¹å¶å˜é‡çš„æ–¹å·®ï¼š", var_antithetic, "\n")
cat("ä½¿ç”¨ç‹¬ç«‹å˜é‡çš„æ–¹å·®ï¼š", var_independent, "\n")
cat("æ–¹å·®å‡å°‘ç™¾åˆ†æ¯”ï¼š", variance_reduction, "%\n")
```

### ä»£ç æ¦‚è¿°

- **`generate_rayleigh_antithetic` å‡½æ•°ï¼š**

  - æ£€æŸ¥æ ·æœ¬é‡ $n$ æ˜¯å¦ä¸ºå¶æ•°ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦æˆå¯¹çš„å¯¹å¶å˜é‡ã€‚
  - ç”Ÿæˆ $n/2$ä¸ªå‡åŒ€åˆ†å¸ƒéšæœºæ•° $U$ï¼Œå¹¶è®¡ç®—å…¶å¯¹å¶å˜é‡ $1 - U$ã€‚
  - ä½¿ç”¨é€†å˜æ¢æ³•è®¡ç®—å¯¹åº”çš„ Rayleigh åˆ†å¸ƒæ ·æœ¬ $X$ å’Œ  $X'$ã€‚
  - è¿”å›åˆå¹¶çš„æ ·æœ¬å‘é‡ã€‚

- **è®¡ç®—æ–¹å·®ï¼š**

  - å¯¹äºå¯¹å¶å˜é‡ç”Ÿæˆçš„æ ·æœ¬ï¼Œè®¡ç®—å¯¹åº”æ ·æœ¬å¯¹å‡å€¼çš„æ–¹å·®ã€‚
  - å¯¹äºç‹¬ç«‹ç”Ÿæˆçš„æ ·æœ¬ï¼Œè®¡ç®—æ ·æœ¬å¯¹å‡å€¼çš„æ–¹å·®ã€‚

- **è®¡ç®—æ–¹å·®å‡å°‘ç™¾åˆ†æ¯”ï¼š**

  - ä½¿ç”¨å…¬å¼ï¼š

    $$
    \text{æ–¹å·®å‡å°‘ç™¾åˆ†æ¯”} = \left(1 - \frac{\text{å¯¹å¶å˜é‡çš„æ–¹å·®}}{\text{ç‹¬ç«‹å˜é‡çš„æ–¹å·®}}\right) \times 100\%
    $$

### ç»“æœåˆ†æ

**å›¾å½¢å¯¹æ¯”ï¼š**

```{r, eval=TRUE}
# ç»˜åˆ¶æ–¹å·®æ¯”è¾ƒçš„æŸ±çŠ¶å›¾
variance_values <- c(var_independent, var_antithetic)
names(variance_values) <- c("ç‹¬ç«‹æ ·æœ¬", "å¯¹å¶å˜é‡")
barplot(variance_values, col=c("red", "blue"),
        main="ä½¿ç”¨ç‹¬ç«‹æ ·æœ¬å’Œå¯¹å¶å˜é‡çš„æ–¹å·®æ¯”è¾ƒ",
        ylab="æ–¹å·®")
```

**æœ€ç»ˆç»“è®ºï¼š**

è¿è¡Œä¸Šè¿°ä»£ç åï¼Œæ ¹æ®æ‰€å¾—åˆ°çš„è¾“å‡ºç»“æœï¼Œå¯çŸ¥ï¼š

- ä½¿ç”¨å¯¹å¶å˜é‡çš„æ–¹å·®çº¦ä¸ºç‹¬ç«‹å˜é‡æ–¹å·®çš„5%ã€‚
- æ–¹å·®å‡å°‘äº†çº¦94.7%ï¼Œæ¥è¿‘95%ã€‚
- è¿™è¯å®äº†ä½¿ç”¨å¯¹å¶å˜é‡åœ¨è’™ç‰¹å¡ç½—æ¨¡æ‹Ÿä¸­å¯ä»¥æ˜¾è‘—å‡å°‘ä¼°è®¡é‡çš„æ–¹å·®ï¼Œæé«˜æ¨¡æ‹Ÿæ•ˆç‡ã€‚
- åŸå› å¯èƒ½æ˜¯ï¼šå¯¹å¶å˜é‡æ³•é€šè¿‡å¼•å…¥è´Ÿç›¸å…³æ€§ï¼Œä½¿å¾— $X$ å’Œ $X'$ çš„å¹³å‡å€¼çš„æ³¢åŠ¨æ€§å‡å°ï¼Œä»è€Œé™ä½äº†æ–¹å·®ã€‚

---

## ç»ƒä¹  5.13

### é¢˜ç›®æè¿°

æ‰¾å‡ºä¸¤ä¸ªé‡è¦æ€§å‡½æ•° $f_1$ å’Œ $f_2$ï¼Œå®ƒä»¬çš„å®šä¹‰åŸŸåœ¨ $(1, âˆ)$ï¼Œå¹¶ä¸”ä¸
$$
g(x) = \frac{x^2}{\sqrt{2\pi}} e^{-x^2/2}, \quad x > 1
$$

â€œæ¥è¿‘â€ã€‚åœ¨ä½¿ç”¨é‡è¦æ€§é‡‡æ ·ä¼°è®¡ç§¯åˆ†

$$
I = \int_{1}^{\infty} \frac{x^2}{\sqrt{2\pi}} e^{-x^2/2} dx
$$

æ—¶ï¼Œå“ªä¸€ä¸ªé‡è¦æ€§å‡½æ•°ä¼šäº§ç”Ÿè¾ƒå°çš„æ–¹å·®ï¼Ÿè§£é‡ŠåŸå› ã€‚

### è§£é¢˜æ€è·¯

1. **ç†è§£ç›®æ ‡å‡½æ•° $g(x)$ï¼š**

   - $g(x)$ æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒå¯†åº¦å‡½æ•° $\phi(x)$ ä¹˜ä»¥ $x^2$ï¼š

     $$
     g(x) = x^2 \phi(x)
     $$

   - éœ€è¦è®¡ç®—ç§¯åˆ† $I$ï¼Œå³ $g(x)$ åœ¨ $x > 1$ ä¸Šçš„ç§¯åˆ†ã€‚

   - å®é™…ç§¯åˆ† $I$ çš„å€¼å¯ä»¥é€šè¿‡è®¡ç®— $P(X > 1)$ï¼Œå…¶ä¸­ $X \sim N(0,1)$ã€‚

   - ä½†æ˜¯ä¹Ÿå¯ä»¥ç›´æ¥è®¡ç®—ï¼š

     $$
     I = 1 - \Phi(1) = \int_1^\infty \phi(x) dx
     $$

     ç„¶è€Œï¼Œé¢˜ç›®ä¸­è¦æ±‚ä¼°è®¡ $I$ï¼Œå› æ­¤å°†ä½¿ç”¨é‡è¦æ€§é‡‡æ ·æ–¹æ³•ã€‚

2. **é€‰æ‹©é‡è¦æ€§å‡½æ•° $f_1$ å’Œ $f_2$ï¼š**

   - **é‡è¦æ€§å‡½æ•°åº”æ»¡è¶³ï¼š**
     - å®šä¹‰åŸŸä¸º $(1, \infty)$ã€‚
     - ä¸ $g(x)$ â€œæ¥è¿‘â€ï¼Œå³å½¢çŠ¶ç›¸ä¼¼ã€‚

3. **å¯èƒ½çš„é€‰æ‹©ï¼š**

   - **é‡è¦æ€§å‡½æ•° $f_1$ï¼š**ä½¿ç”¨æˆªæ–­çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼Œå³åœ¨ $(1, \infty)$ ä¸Šçš„æ ‡å‡†æ­£æ€å¯†åº¦å‡½æ•°ã€‚å…¶æ¦‚ç‡å¯†åº¦å‡½æ•°ä¸ºï¼š
     $$
     f_1(x) = \frac{\phi(x)}{1 - \Phi(1)}, \quad x > 1
     $$

     - $\phi(x)$ æ˜¯æ ‡å‡†æ­£æ€å¯†åº¦å‡½æ•°ï¼Œ$\phi(x) = \frac{1}{\sqrt{2\pi}} e^{-x^2 / 2}$ï¼Œå‡å€¼ä¸º 0ï¼Œæ–¹å·®ä¸º 1ã€‚
     - $\Phi(x)$ æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒå‡½æ•°ï¼Œ$\Phi(x) = \int_{-\infty}^x \phi(t) \, dt = \frac{1}{\sqrt{2\pi}} \int_{-\infty}^x e^{-t^2 / 2} \, dt$ï¼Œ $\Phi(x)$ æ²¡æœ‰è§£æè§£ï¼Œé€šå¸¸ä½¿ç”¨æ•°å€¼ç§¯åˆ†ã€æŸ¥è¡¨æˆ–è®¡ç®—æœºå‡½æ•°è®¡ç®—ã€‚
     - $f_1(x)$æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒåœ¨ $x > 1$ ä¸Šçš„æ¡ä»¶å¯†åº¦å‡½æ•°ã€‚

   - **é‡è¦æ€§å‡½æ•° $f_2$ï¼š**ä½¿ç”¨å‚æ•°ä¸º $k = 3$ çš„å¡æ–¹åˆ†å¸ƒï¼ˆå³ Gamma åˆ†å¸ƒï¼Œå½¢çŠ¶å‚æ•° $k=3$ï¼Œå°ºåº¦å‚æ•° $\theta=2$ï¼‰ã€‚å…¶æ¦‚ç‡å¯†åº¦å‡½æ•°ä¸ºï¼š
     $$
f(x; k, \theta) = \frac{x^{k-1} e^{-x/\theta}}{\theta^k \Gamma(k)}, \quad x > 0, k > 0, \theta > 0
     $$

     - è¿™é‡Œçš„ $\Gamma(\cdot)$ æ˜¯ä¼½ç›å‡½æ•°ï¼Œ$\Gamma(n) = (n-1)!$ å¯¹äºæ­£æ•´æ•° $n$ æˆç«‹ã€‚
     - ç®€åŒ–åï¼š
     $$
f(x; 3, 2) = \frac{x^2 e^{-x/2}}{8 \cdot 2!}
     $$
     - å› ä¸º $\Gamma(3) = 2! = 2$ï¼Œæ‰€ä»¥è¿›ä¸€æ­¥ç®€åŒ–ä¸ºï¼š
     $$
f(x; 3, 2) = \frac{x^2 e^{-x/2}}{16}, \quad x > 0
     $$
     - é€‰æ‹©å¡æ–¹åˆ†å¸ƒæ˜¯å› ä¸ºå…¶å®šä¹‰åŸŸä¸º $(0, \infty)$ï¼Œå¹¶ä¸”å¯ä»¥å¾ˆå¥½åœ°æ‹Ÿåˆ $g(x)$ã€‚

4. **é‡è¦æ€§é‡‡æ ·ä¼°è®¡ï¼š**

   åœ¨é‡è¦æ€§é‡‡æ ·ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹ä¼°è®¡é‡æ¥ä¼°è®¡ç§¯åˆ† $I$ï¼š
   $$
   \hat{I} = \frac{1}{n} \sum_{i=1}^n w_i = \frac{1}{n} \sum_{i=1}^n \frac{g(X_i)}{f(X_i)}
   $$
   

   å…¶ä¸­ï¼š

   - $X_i$ æ˜¯ä»é‡è¦æ€§å‡½æ•° $f(x)$ ä¸­ç‹¬ç«‹é‡‡æ ·çš„éšæœºå˜é‡ã€‚
   - $w_i = \frac{g(X_i)}{f(X_i)}$ æ˜¯å¯¹åº”çš„æƒé‡ã€‚

   **é‚£ä¹ˆï¼Œè¿™ä¸ªä¼°è®¡é‡  $\hat{I}$ çš„æ–¹å·®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ**

5. **ä¼°è®¡é‡çš„æ–¹å·®æ¨å¯¼ï¼š**

   - **ä¼°è®¡é‡çš„æœŸæœ›ï¼š**

     é¦–å…ˆï¼Œè®¡ç®—ä¼°è®¡é‡ $\hat{I}$ çš„æœŸæœ›å€¼ $\mathbb{E}[\hat{I}]$ï¼š

     $$
     \mathbb{E}[\hat{I}] = \mathbb{E}\left[ \frac{1}{n} \sum_{i=1}^n w_i \right] = \frac{1}{n} \sum_{i=1}^n \mathbb{E}[w_i] = \mathbb{E}[w_i] = I
     $$

     - å› ä¸º $w_i$ æ˜¯ç‹¬ç«‹åŒåˆ†å¸ƒçš„ï¼Œä¸” $\mathbb{E}[w_i] = I$ã€‚

   - **ä¼°è®¡é‡çš„æ–¹å·®ï¼š**

     ä¼°è®¡é‡ $\hat{I}$ çš„æ–¹å·®ä¸ºï¼š

     $$
     \text{Var}(\hat{I}) = \text{Var}\left( \frac{1}{n} \sum_{i=1}^n w_i \right) = \frac{1}{n^2} \sum_{i=1}^n \text{Var}(w_i) = \frac{1}{n} \text{Var}(w_i)
     $$

     - ç”±äº $w_i$ æ˜¯ç‹¬ç«‹åŒåˆ†å¸ƒçš„éšæœºå˜é‡ã€‚

     å› æ­¤ï¼Œä¼°è®¡é‡çš„æ–¹å·®ä¸ºå•ä¸ªæƒé‡ $w_i$ çš„æ–¹å·®é™¤ä»¥æ ·æœ¬æ•°é‡ $n$ï¼š

     $$
     \text{Var}(\hat{I}) = \frac{1}{n} \text{Var}\left( \frac{g(X)}{f(X)} \right)
     $$

   - **è®¡ç®—å•ä¸ªæƒé‡çš„æ–¹å·®ï¼š**

     è®¡ç®— $w = \frac{g(X)}{f(X)}$ çš„æ–¹å·®ï¼š

     $$
     \text{Var}(w) = \mathbb{E}[w^2] - (\mathbb{E}[w])^2
     $$

     - **ç¬¬ä¸€éƒ¨åˆ†ï¼šè®¡ç®— $\mathbb{E}[w^2]$**
       $$
       \mathbb{E}[w^2] = \int \left( \frac{g(x)}{f(x)} \right)^2 f(x) \, dx = \int \frac{g(x)^2}{f(x)} \, dx
       $$

     - **ç¬¬äºŒéƒ¨åˆ†ï¼šè®¡ç®— $(\mathbb{E}[w])^2$**
       $$
       (\mathbb{E}[w])^2 = \left( \int \frac{g(x)}{f(x)} f(x) \, dx \right)^2 = \left( \int g(x) \, dx \right)^2 = I^2
       $$

     å› æ­¤ï¼Œå•ä¸ªæƒé‡çš„æ–¹å·®ä¸ºï¼š

     $$
     \text{Var}(w) = \int \frac{g(x)^2}{f(x)} \, dx - I^2
     $$

   - **å°†ç»“æœä»£å…¥ä¼°è®¡é‡çš„æ–¹å·®ï¼š**

     å› æ­¤ï¼Œä¼°è®¡é‡ \( \hat{I} \) çš„æ–¹å·®ä¸ºï¼š

     $$
     \text{Var}(\hat{I}) = \frac{1}{n} \left( \int \frac{g(x)^2}{f(x)} \, dx - I^2 \right)
     $$

   - **é¢„æœŸï¼š**

     - æ–¹å·®çš„å¤§å°å–å†³äº $\frac{g(x)^2}{f(x)}$ çš„ç§¯åˆ†å€¼å’Œ $I^2$ã€‚
     - å½“ $f(x)$ é€‰æ‹©å¾—å½“ï¼Œä½¿å¾— $\frac{g(x)}{f(x)}$ å°½å¯èƒ½æ’å®šæˆ–å˜åŒ–è¾ƒå°æ—¶ï¼Œæ–¹å·®ä¼šå‡å°ã€‚
     - $f_1(x)$ ä¸ $g(x)$ çš„å°¾éƒ¨è¡°å‡ç›¸åŒï¼Œå¯èƒ½äº§ç”Ÿè¾ƒå°çš„æ–¹å·®ã€‚
     - $f_2(x)$ å¯èƒ½ä¸ $g(x)$ ä¸å¤ªåŒ¹é…ï¼Œæ–¹å·®å¯èƒ½è¾ƒå¤§ã€‚

6. **å®ç°æ­¥éª¤ï¼š**

   - ç¼–å†™å‡½æ•°ä» $f_1$ å’Œ $f_2$ ä¸­ç”Ÿæˆæ ·æœ¬ã€‚
   - è®¡ç®—é‡è¦æ€§é‡‡æ ·ä¼°è®¡é‡ $\hat{I}$ å’Œæ–¹å·®ã€‚
   - æ¯”è¾ƒä½¿ç”¨ $f_1$ å’Œ $f_2$ æ—¶ä¼°è®¡é‡çš„æ–¹å·®ã€‚

### ä»£ç å®ç°

```{r, eval=TRUE}
# è®¾ç½®éšæœºæ•°ç§å­
set.seed(103)

# å®šä¹‰ç›®æ ‡å¯†åº¦å‡½æ•° g(x)
g <- function(x){
  (x^2 / sqrt(2 * pi)) * exp(-x^2 / 2)
}

# å®šä¹‰é‡è¦æ€§å‡½æ•° f1(x)ï¼šæˆªæ–­çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒ
f1_density <- function(x){
  dnorm(x) / (1 - pnorm(1))
}

# ä» f1 ä¸­é‡‡æ ·
sample_f1 <- function(n){
  # é€†å˜æ¢é‡‡æ ·æ³•
  u <- runif(n, min = pnorm(1), max = 1)
  x <- qnorm(u)
  return(x)
}

# å®šä¹‰é‡è¦æ€§å‡½æ•° f2(x)ï¼šGamma åˆ†å¸ƒï¼Œå½¢çŠ¶å‚æ•° k=3ï¼Œå°ºåº¦å‚æ•° Î¸=2
f2_density <- function(x){
  dgamma(x, shape = 3, scale = 2)  # è¿™é‡Œä½¿ç”¨ Gamma åˆ†å¸ƒçš„å¯†åº¦å‡½æ•°
}

# ä» Gamma åˆ†å¸ƒä¸­é‡‡æ ·
sample_f2 <- function(n){
  x <- rgamma(n, shape = 3, scale = 2)  # è¿™é‡Œä½¿ç”¨ Gamma åˆ†å¸ƒçš„é‡‡æ ·å‡½æ•°
  # åªä¿ç•™ x > 1 çš„éƒ¨åˆ†
  x <- x[x > 1]
  # å¦‚æœæ•°é‡ä¸è¶³ nï¼Œåˆ™ç»§ç»­é‡‡æ ·
  while(length(x) < n){
    x_add <- rgamma(n - length(x), shape = 3, scale = 2)
    x <- c(x, x_add[x_add > 1])
  }
  x <- x[1:n]
  return(x)
}

# è®¡ç®—é‡è¦æ€§é‡‡æ ·ä¼°è®¡é‡å’Œæ–¹å·®
importance_sampling <- function(n, f_sample, f_density, f_name){
  # ä»é‡è¦æ€§å‡½æ•°ä¸­é‡‡æ ·
  x <- f_sample(n)
  # è®¡ç®—æƒé‡ w = g(x) / f(x)
  w <- g(x) / f_density(x)
  # è®¡ç®—ä¼°è®¡é‡
  I_hat <- mean(w)
  # è®¡ç®—æ–¹å·®
  var_hat <- var(w) / n
  # è¿”å›ç»“æœ
  return(list(I_hat = I_hat, var_hat = var_hat, x = x, w = w, f_name = f_name))
}

# è®¾ç½®æ¨¡æ‹Ÿæ¬¡æ•°
n <- 10000

# ä½¿ç”¨ f1 è¿›è¡Œé‡è¦æ€§é‡‡æ ·
result_f1 <- importance_sampling(n, sample_f1, f1_density, "æˆªæ–­æ­£æ€åˆ†å¸ƒ f1")

# ä½¿ç”¨ f2 è¿›è¡Œé‡è¦æ€§é‡‡æ ·ï¼ˆGamma åˆ†å¸ƒï¼‰
result_f2 <- importance_sampling(n, sample_f2, f2_density, "Gamma åˆ†å¸ƒ f2")

# ç†è®ºå€¼ I
I_true <- 1 - pnorm(1)

# è¾“å‡ºç»“æœ
cat("ä½¿ç”¨ f1 çš„ä¼°è®¡é‡ï¼š", result_f1$I_hat, "\n")
cat("ä½¿ç”¨ f1 çš„æ–¹å·®ï¼š", result_f1$var_hat, "\n\n")

cat("ä½¿ç”¨ f2 çš„ä¼°è®¡é‡ï¼š", result_f2$I_hat, "\n")
cat("ä½¿ç”¨ f2 çš„æ–¹å·®ï¼š", result_f2$var_hat, "\n\n")

cat("ç†è®ºå€¼ Iï¼š", I_true, "\n")
```

### ä»£ç æ¦‚è¿°

- **é‡è¦æ€§é‡‡æ ·ä¼°è®¡é‡å’Œæ–¹å·®çš„è®¡ç®—**ï¼š

  - å¯¹äºæ¯ä¸ªé‡è¦æ€§å‡½æ•° $f_1(x)$ å’Œ $f_2(x)$ï¼Œåˆ†åˆ«ä»å®ƒä»¬ä¸­ç”Ÿæˆ $n$ ä¸ªæ ·æœ¬ $X_i$ã€‚

  - è®¡ç®—æƒé‡ $w_i = \frac{g(X_i)}{f(X_i)}$ï¼Œç„¶åé€šè¿‡æ±‚æƒé‡çš„å‡å€¼ $\hat{I} = \frac{1}{n} \sum_{i=1}^n w_i$ æ¥ä¼°è®¡ç§¯åˆ†å€¼ã€‚

  - ä¼°è®¡æ–¹å·® $\text{Var}(\hat{I}) = \frac{\text{Var}(w)}{n}$ã€‚

- **æ¨¡æ‹Ÿå‚æ•°**ï¼š
  - è®¾ç½®æ ·æœ¬æ•°é‡ $n = 10000$ï¼Œå³æ¯ä¸ªé‡è¦æ€§å‡½æ•°ç”Ÿæˆ 10000 ä¸ªæ ·æœ¬æ¥è®¡ç®—ä¼°è®¡é‡å’Œæ–¹å·®ã€‚

- **ç†è®ºå€¼ $I$ **ï¼š
  - ä»£ç ä¸­ï¼Œç†è®ºå€¼ $I$ è¢«è®¾ç½®ä¸º$1 - \Phi(1)$ï¼Œè¿™æ˜¯ç›®æ ‡ç§¯åˆ†çš„ç²¾ç¡®å€¼ï¼Œä½œä¸ºå‚è€ƒæ¥æ¯”è¾ƒé‡è¦æ€§é‡‡æ ·çš„ä¼°è®¡é‡ã€‚

### ç»“æœåˆ†æ

**å›¾å½¢å¯¹æ¯”ï¼š**

- **æƒé‡åˆ†å¸ƒå›¾**

```{r, eval=TRUE}
# ç»˜åˆ¶æƒé‡çš„ç›´æ–¹å›¾
par(mfrow = c(1,2))

# ä½¿ç”¨ f1 çš„æƒé‡åˆ†å¸ƒ
hist(result_f1$w, breaks = 50, probability = TRUE, main = "ä½¿ç”¨ f1 çš„æƒé‡åˆ†å¸ƒ",
     xlab = "æƒé‡", col = "skyblue", xlim = c(0, max(result_f1$w)))

# ä½¿ç”¨ f2 çš„æƒé‡åˆ†å¸ƒ
hist(result_f2$w, breaks = 50, probability = TRUE, main = "ä½¿ç”¨ f2 çš„æƒé‡åˆ†å¸ƒ",
     xlab = "æƒé‡", col = "pink", xlim = c(0, max(result_f2$w)))
```

- **å‡½æ•°å½¢çŠ¶å¯¹æ¯”å›¾**

```{r, eval=TRUE}
# æ¸…ç©ºå·¥ä½œç¯å¢ƒ
rm(list = ls())

# 1. å®šä¹‰xçš„èŒƒå›´
x <- seq(1, 10, length.out = 1000)  # ä»1åˆ°10ï¼Œç”Ÿæˆ1000ä¸ªç‚¹

# 2. è®¡ç®—f1(x)ï¼šæˆªæ–­çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒ
# f1(x) = Ï†(x) / (1 - Î¦(1))ï¼Œå…¶ä¸­ Ï†(x) æ˜¯æ ‡å‡†æ­£æ€å¯†åº¦ï¼ŒÎ¦(x) æ˜¯æ ‡å‡†æ­£æ€ç´¯ç§¯åˆ†å¸ƒ
phi_x <- dnorm(x)  # æ ‡å‡†æ­£æ€å¯†åº¦
Phi_1 <- pnorm(1)  # æ ‡å‡†æ­£æ€åœ¨x=1å¤„çš„ç´¯ç§¯åˆ†å¸ƒå€¼
f1 <- phi_x / (1 - Phi_1)  # æˆªæ–­æ ‡å‡†æ­£æ€å¯†åº¦

# 3. è®¡ç®—f2(x)ï¼šGamma(3,2)åˆ†å¸ƒ
# f2(x) = x^2 * e^(-x/2) / 16
f2 <- dgamma(x, shape = 3, scale = 2)  # Rå†…ç½®çš„Gammaåˆ†å¸ƒå¯†åº¦å‡½æ•°

# 4. è®¡ç®—g(x)
# g(x) = (x^2 / sqrt(2Ï€)) * e^(-x^2 / 2)
g <- (x^2 / sqrt(2 * pi)) * exp(-x^2 / 2)

# 5. ç»˜åˆ¶å›¾å½¢
# è®¾ç½®ç»˜å›¾åŒºåŸŸï¼Œç¡®ä¿æ‰€æœ‰å‡½æ•°éƒ½èƒ½å®Œæ•´æ˜¾ç¤º
plot(x, f1, type = 'l', col = 'blue', lwd = 2, 
     ylim = c(0, max(f1, f2, g)), 
     ylab = 'å¯†åº¦', 
     xlab = 'x', 
     main = 'fâ‚(x)ã€fâ‚‚(x) å’Œ g(x) çš„æ¯”è¾ƒ')

# æ·»åŠ f2(x)å’Œg(x)åˆ°åŒä¸€å›¾å½¢
lines(x, f2, col = 'green', lwd = 2, lty = 2)  # f2(x)ï¼šç»¿è‰²ï¼Œè™šçº¿
lines(x, g, col = 'red', lwd = 2, lty = 3)     # g(x)ï¼šçº¢è‰²ï¼Œç‚¹åˆ’çº¿

# æ·»åŠ å›¾ä¾‹
legend('topright', 
       legend = c('fâ‚(x)ï¼šæˆªæ–­æ ‡å‡†æ­£æ€', 'fâ‚‚(x)ï¼šGamma(3,2)', 'g(x)'), 
       col = c('blue', 'green', 'red'), 
       lwd = 2, 
       lty = c(1, 2, 3))

# 6. æ·»åŠ å‚è€ƒçº¿ï¼ˆå¯é€‰ï¼‰
abline(v = 1, col = 'gray', lty = 4)  # æ ‡è®°x=1çš„ä½ç½®
```

**å›¾å½¢åˆ†æï¼š**

- ä»æƒé‡åˆ†å¸ƒçš„ç›´æ–¹å›¾å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨$f_1$ï¼ˆæˆªæ–­æ­£æ€åˆ†å¸ƒï¼‰çš„æƒé‡åˆ†å¸ƒæ›´é›†ä¸­ï¼Œå¹¶ä¸”æƒé‡å€¼è¾ƒå°ï¼Œæ–¹å·®æ›´å°ã€‚
- ä½¿ç”¨ $f_2$ï¼ˆGammaåˆ†å¸ƒï¼‰çš„æƒé‡åˆ†å¸ƒæ›´åˆ†æ•£ï¼Œä¸”å­˜åœ¨è¾ƒå¤§çš„æƒé‡å€¼ï¼Œå¯¼è‡´æ–¹å·®å¢å¤§ã€‚
- ä»å‡½æ•°çš„å½¢çŠ¶å¯¹æ¯”å›¾å¯çœ‹å‡ºï¼Œ$f_1$ ä¸ $g(x)$ å½¢çŠ¶æ›´ä¸ºç›¸ä¼¼ï¼Œæ›´åŠ åŒ¹é…ã€‚

**æœ€ç»ˆç»“è®ºï¼š**

- **é‡è¦æ€§å‡½æ•° $f_1$ï¼ˆæˆªæ–­æ­£æ€åˆ†å¸ƒï¼‰åœ¨ä¼°è®¡ç§¯åˆ†$I$æ—¶äº§ç”Ÿçš„æ–¹å·®æ›´å°ã€‚**
- è¿™æ˜¯å› ä¸º $f_1$ çš„å½¢çŠ¶ä¸ç›®æ ‡å¯†åº¦å‡½æ•° $g(x)$ æ›´æ¥è¿‘ï¼Œç‰¹åˆ«æ˜¯åœ¨ $x > 2$ çš„åŒºåŸŸï¼Œ$f_1$ ä¸ $g(x)$ å‡ ä¹é‡åˆï¼Œæ›´å¥½åœ°æ•æ‰äº† $g(x)$ çš„å˜åŒ–ã€‚
- ç›¸æ¯”ä¹‹ä¸‹ï¼Œ$f_2$ï¼ˆGammaåˆ†å¸ƒï¼‰åœ¨ $x > 2$ çš„åŒºåŸŸï¼Œå½¢çŠ¶ä¸$g(x)$ç›¸å·®è¾ƒå¤§ï¼Œå¢åŠ äº†ä¼°è®¡çš„æ–¹å·®ã€‚
- é‡è¦æ€§é‡‡æ ·çš„æ•ˆæœå¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºé‡è¦æ€§å‡½æ•° $f(x)$ ä¸ç›®æ ‡å‡½æ•° $g(x)$ çš„åŒ¹é…ç¨‹åº¦ã€‚
- é€‰æ‹©ä¸€ä¸ªä¸ $g(x)$ æ›´æ¥è¿‘çš„ $f(x)$ï¼Œå¯ä»¥é™ä½æ ·æœ¬æƒé‡çš„æ–¹å·®ï¼Œä»è€Œæé«˜ä¼°è®¡çš„ç²¾åº¦ã€‚

---

## é—®é¢˜2ï¼šè’™ç‰¹å¡ç½—å®éªŒ

### é—®é¢˜æè¿°

1. å¯¹äº $n = 10^4, 2 \times 10^4, 4 \times 10^4, 6 \times 10^4, 8 \times 10^4$ï¼Œå¯¹ 1 åˆ° $n$ çš„éšæœºæ’åˆ—åº”ç”¨å¿«é€Ÿæ’åºç®—æ³•ã€‚

2. è®¡ç®— 100 æ¬¡æ¨¡æ‹Ÿçš„å¹³å‡è®¡ç®—æ—¶é—´ï¼Œè®°ä¸º $a_n$ã€‚

3. å¯¹ $a_n$ ä¸ $t_n := n \log(n)$ è¿›è¡Œå›å½’ï¼Œå¹¶ä»¥å›¾å½¢æ–¹å¼å±•ç¤ºç»“æœï¼ˆæ•£ç‚¹å›¾å’Œå›å½’çº¿ï¼‰ã€‚

4. å…¶ä¸­ï¼Œåœ¨å¿«é€Ÿæ’åºç®—æ³•ä¸­å¯¹æ•°çš„åº•æ•°ä¸º2ï¼Œå³å¿«é€Ÿæ’åºç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(n \log_2 n)$ã€‚

### è§£é¢˜æ€è·¯

1. **å®ç°å¿«é€Ÿæ’åºç®—æ³•ï¼š**
   - **é€‰æ‹©æ’åºç®—æ³•ï¼š** åŸæœ¬æƒ³è¦ä½¿ç”¨ R å†…ç½®çš„ `sort()` å‡½æ•°ï¼Œå…¶åº•å±‚å®ç°é€šå¸¸æ˜¯é«˜æ•ˆçš„å¿«é€Ÿæ’åºç®—æ³•ï¼Œä½†æ˜¯è€ƒè™‘åˆ°`sort()` å‡½æ•°çš„å…·ä½“å®ç°åªæ˜¯å¯èƒ½ä¼šä½¿ç”¨å¿«é€Ÿæ’åºï¼Œä½†ä¹Ÿå¯èƒ½ä½¿ç”¨å…¶ä»–æ’åºç®—æ³•ï¼Œæ¯”å¦‚å½’å¹¶æ’åºæˆ–å †æ’åºï¼Œå…·ä½“å–å†³äº R å†…éƒ¨çš„ä¼˜åŒ–é€‰æ‹©ã€‚ç”±æ­¤å¯çŸ¥ï¼Œä½¿ç”¨`sort()` å‡½æ•°å¹¶ä¸èƒ½ä¿è¯æ˜¯å¿«é€Ÿæ’åºç®—æ³•ï¼Œå› æ­¤é‡‡ç”¨äº†è‡ªå®šä¹‰çš„å¿«é€Ÿæ’åºç®—æ³•`quick_sort()`å‡½æ•°ã€‚

2. **è¿›è¡Œæ¨¡æ‹Ÿå®éªŒï¼š**

   - **æ­¥éª¤ 1ï¼š** å¯¹äºæ¯ä¸ª $n$ï¼Œè¿›è¡Œ 100 æ¬¡æ¨¡æ‹Ÿã€‚
   - **æ­¥éª¤ 2ï¼š** åœ¨æ¯æ¬¡æ¨¡æ‹Ÿä¸­ï¼Œç”Ÿæˆ 1 åˆ° $n$ çš„éšæœºæ’åˆ—ï¼Œè®°å½•æ’åºæ‰€éœ€çš„æ—¶é—´ã€‚
   - **æ­¥éª¤ 3ï¼š** è®¡ç®— 100 æ¬¡æ¨¡æ‹Ÿçš„å¹³å‡è®¡ç®—æ—¶é—´ $a_n$ã€‚

3. **å›å½’åˆ†æï¼š**
   - **æ­¥éª¤ 1ï¼š** è®¡ç®—å¯¹åº”çš„ $t_n = n \log(n)$ã€‚
   - **æ­¥éª¤ 2ï¼š** å¯¹ $a_n$ ä¸ $t_n$ è¿›è¡Œçº¿æ€§å›å½’ã€‚
   - **æ­¥éª¤ 3ï¼š** ç»˜åˆ¶æ•£ç‚¹å›¾å’Œå›å½’çº¿ï¼Œå±•ç¤º $a_n$ ä¸ $t_n$ çš„å…³ç³»ã€‚

### ä»£ç å®ç°

```{r, eval=TRUE}
# è‡ªå®šä¹‰å¿«é€Ÿæ’åºå‡½æ•°
quick_sort <- function(x) {
  if(length(x) <= 1) {
    return(x)
  }
  
  # é€‰æ‹©ä¸€ä¸ªåŸºå‡†å€¼ï¼ˆé€šå¸¸ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰
  pivot <- x[1]
  
  # åˆ†æˆå°äºã€ç­‰äºå’Œå¤§äºåŸºå‡†å€¼çš„éƒ¨åˆ†
  less <- x[x < pivot]
  equal <- x[x == pivot]
  greater <- x[x > pivot]
  
  # é€’å½’è°ƒç”¨
  return(c(quick_sort(less), equal, quick_sort(greater)))
}

# è®¾ç½®éšæœºæ•°ç§å­ï¼Œä¿è¯ç»“æœå¯é‡å¤
set.seed(110)

# å®šä¹‰æ ·æœ¬è§„æ¨¡ n çš„å–å€¼
n_values <- c(1e4, 2e4, 4e4, 6e4, 8e4)

# åˆå§‹åŒ–å­˜å‚¨å¹³å‡è®¡ç®—æ—¶é—´ a_n çš„å‘é‡
a_n <- numeric(length(n_values))

# å¯¹äºæ¯ä¸ª nï¼Œè¿›è¡Œ 100 æ¬¡æ¨¡æ‹Ÿ
for (i in seq_along(n_values)) {
  n <- n_values[i]
  times <- numeric(100)  # å­˜å‚¨æ¯æ¬¡æ¨¡æ‹Ÿçš„è®¡ç®—æ—¶é—´
  
  for (j in 1:100) {
    # ç”Ÿæˆ 1 åˆ° n çš„éšæœºæ’åˆ—
    x <- sample(n)
    
    # è®°å½•æ’åºå¼€å§‹æ—¶é—´
    start_time <- proc.time()
    # ä½¿ç”¨è‡ªå®šä¹‰çš„å¿«é€Ÿæ’åºå¯¹ x è¿›è¡Œæ’åº
    sorted_x <- quick_sort(x)
    # è®°å½•æ’åºç»“æŸæ—¶é—´
    end_time <- proc.time()
    
    # è®¡ç®—æ’åºæ¶ˆè€—çš„æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰
    times[j] <- (end_time - start_time)["elapsed"]
  }
  
  # è®¡ç®— 100 æ¬¡æ¨¡æ‹Ÿçš„å¹³å‡è®¡ç®—æ—¶é—´
  a_n[i] <- mean(times)
  
  # æ‰“å°å½“å‰è¿›åº¦
  cat("n =", n, "å¹³å‡è®¡ç®—æ—¶é—´ a_n =", a_n[i], "ç§’\n")
}

# è®¡ç®— t_n = n * log_2(n)
t_n <- n_values * log(n_values, base = 2)

# å¯¹ a_n ä¸ t_n è¿›è¡Œçº¿æ€§å›å½’
model <- lm(a_n ~ t_n)

# æ‰“å°å›å½’ç»“æœ
summary(model)

```

### ä»£ç æ¦‚è¿°

- **å¤–å±‚å¾ªç¯ï¼š** éå†ä¸åŒçš„ $n$ å€¼ã€‚
- **å†…å±‚å¾ªç¯ï¼š** å¯¹äºæ¯ä¸ª $n$ï¼Œè¿›è¡Œ 100 æ¬¡æ¨¡æ‹Ÿã€‚
- **`proc.time()` å‡½æ•°ï¼š**
  - ç”¨äºæµ‹é‡ä»£ç è¿è¡Œæ—¶é—´ã€‚
  - è®°å½•æ’åºå‰åçš„æ—¶é—´ï¼Œè®¡ç®—å·®å€¼å¾—åˆ°æ’åºæ—¶é—´ã€‚
- **è®¡ç®— $a_n$ï¼š** å¯¹ 100 æ¬¡æ¨¡æ‹Ÿçš„æ—¶é—´å–å¹³å‡ã€‚
  - æ³¨æ„ï¼šR è¯­è¨€ä¸­çš„ `log()` å‡½æ•°é»˜è®¤æ˜¯ä»¥è‡ªç„¶åº•æ•° $e$ ä¸ºåº•çš„ï¼Œè€Œå¿«é€Ÿæ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸­çš„å¯¹æ•°æ˜¯ä»¥ 2 ä¸ºåº•çš„ã€‚ä¸ºäº†ç¬¦åˆå¿«é€Ÿæ’åºæ—¶é—´å¤æ‚åº¦çš„$O(n \log_2 n)$ çš„å½¢å¼ï¼Œéœ€è¦å°†å¯¹æ•°çš„åº•æ•°æ”¹ä¸º 2ã€‚
  - ä½¿ç”¨ `log(n_values, base = 2)` æ¥è®¡ç®—ä»¥ 2 ä¸ºåº•çš„å¯¹æ•°ã€‚
- **å›å½’åˆ†æï¼š** ä½¿ç”¨ `lm()` å‡½æ•°å¯¹ $a_n$ å’Œ $t_n$ è¿›è¡Œçº¿æ€§å›å½’ã€‚

### ç»“æœåˆ†æ

**å›¾å½¢å¯¹æ¯”ï¼š**

```{r, eval=TRUE}
# ç»˜åˆ¶æ•£ç‚¹å›¾å’Œå›å½’çº¿
plot(t_n, a_n, main = "å¹³å‡è®¡ç®—æ—¶é—´ a_n ä¸ n log(n) çš„å…³ç³»",
     xlab = expression(t[n] == n * log(n)),
     ylab = expression(a[n]~"(ç§’)"),
     pch = 16, col = "blue")

# æ·»åŠ å›å½’çº¿
abline(model, col = "red", lwd = 2)

# æ·»åŠ å›¾ä¾‹
legend("topleft", legend = c("æ¨¡æ‹Ÿæ•°æ®", "å›å½’çº¿"),
       col = c("blue", "red"), pch = c(16, NA),
       lty = c(NA, 1), lwd = c(NA, 2))
```

**å›å½’ç»“æœï¼š**

- å›å½’æ¨¡å‹ä¸ºï¼š

  $$
  a_n = \beta_0 + \beta_1 t_n + \varepsilon
  $$

- é€šè¿‡å›å½’ç³»æ•°ï¼Œå¯ä»¥é‡åŒ– $a_n$ ä¸ $t_n$ ä¹‹é—´çš„çº¿æ€§å…³ç³»ã€‚

**å›¾å½¢åˆ†æï¼š**

- **æ•£ç‚¹å›¾ï¼š** å±•ç¤ºäº†ä¸åŒ $n$ å€¼ä¸‹çš„ $t_n$ ä¸ $a_n$ çš„å…³ç³»ã€‚
- **å›å½’çº¿ï¼š** å±•ç¤ºäº†çº¿æ€§æ‹Ÿåˆç»“æœã€‚

**æœ€ç»ˆç»“è®ºï¼š**

- ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¹³å‡è®¡ç®—æ—¶é—´ $a_n$ ä¸ $t_n = n \log_2 n$ ä¹‹é—´å‘ˆç°è¿‘ä¼¼çº¿æ€§å…³ç³»ã€‚
- è¿™ç¬¦åˆå¿«é€Ÿæ’åºç®—æ³•çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º $O(n \log_2 n)$ çš„ç†è®ºé¢„æœŸã€‚

---

# æ€»ç»“

## å›°éš¾ä¸è§£å†³æ–¹å¼

åœ¨å®Œæˆæœ¬æ¬¡ä½œä¸šçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘é‡åˆ°äº†è¯¸å¤šæŒ‘æˆ˜ï¼Œä½†é€šè¿‡ä¸æ–­çš„æ¢ç´¢ä¸å­¦ä¹ ï¼Œé€æ­¥å…‹æœäº†è¿™äº›å›°éš¾ï¼Œæ”¶è·é¢‡ä¸°ã€‚

é¦–å…ˆï¼Œåœ¨**ç»ƒä¹ 5.4**ä¸­ï¼Œå®ç°è’™ç‰¹å¡ç½—æ–¹æ³•ä¼°è®¡Betaåˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼ˆCDFï¼‰æ—¶ï¼Œæœ€å¤§çš„éš¾ç‚¹åœ¨äºå¦‚ä½•é«˜æ•ˆåœ°ç”Ÿæˆå¤§é‡çš„Betaåˆ†å¸ƒéšæœºæ ·æœ¬ã€‚ç”±äºç›´æ¥ç”Ÿæˆå¤§é‡æ ·æœ¬å¯èƒ½å¯¼è‡´è®¡ç®—æ—¶é—´è¿‡é•¿ï¼Œæˆ‘é€šè¿‡ä¼˜åŒ–ä»£ç ç»“æ„ï¼Œåˆ©ç”¨Rè¯­è¨€çš„å‘é‡åŒ–æ“ä½œï¼Œå¤§å¤§æå‡äº†è®¡ç®—æ•ˆç‡ã€‚æ­¤å¤–ï¼Œä¸ºäº†ç¡®ä¿ä¼°è®¡ç»“æœçš„å‡†ç¡®æ€§ï¼Œæˆ‘è®¾ç½®äº†è¶³å¤Ÿå¤§çš„æ ·æœ¬é‡ï¼ˆå¦‚$10^6$ï¼‰ï¼Œå¹¶é€šè¿‡ä¸Rå†…ç½®çš„`pbeta`å‡½æ•°è¿›è¡Œå¯¹æ¯”ï¼ŒéªŒè¯äº†è’™ç‰¹å¡ç½—ä¼°è®¡çš„æœ‰æ•ˆæ€§å’Œç²¾åº¦ã€‚

åœ¨**ç»ƒä¹ 5.9**ä¸­ï¼Œä½¿ç”¨å¯¹å¶å˜é‡ç”ŸæˆRayleighåˆ†å¸ƒæ ·æœ¬å¹¶æ¯”è¾ƒæ–¹å·®å‡å°‘çš„ç™¾åˆ†æ¯”æ˜¯ä¸€ä¸ªè¾ƒä¸ºå¤æ‚çš„ä»»åŠ¡ã€‚ä¸»è¦æŒ‘æˆ˜åœ¨äºç†è§£å’Œæ­£ç¡®å®ç°å¯¹å¶å˜é‡çš„æ–¹æ³•ï¼Œä»¥åŠå‡†ç¡®è®¡ç®—æ–¹å·®å‡å°‘çš„æ¯”ä¾‹ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡ï¼Œæˆ‘é¦–å…ˆæ·±å…¥å­¦ä¹ äº†å¯¹å¶å˜é‡çš„åŸç†ï¼Œå¹¶é€šè¿‡é€†å˜æ¢æ³•ç”ŸæˆRayleighåˆ†å¸ƒçš„æ ·æœ¬ã€‚æ¥ç€ï¼Œè®¾è®¡äº†åˆç†çš„æ–¹å·®æ¯”è¾ƒæ–¹æ³•ï¼Œç¡®ä¿è®¡ç®—ç»“æœçš„ç§‘å­¦æ€§å’Œå‡†ç¡®æ€§ã€‚è¿‡ç¨‹ä¸­ï¼Œæˆ‘é‡åˆ°äº†æ ·æœ¬é‡æ§åˆ¶å’Œæ–¹å·®è®¡ç®—çš„ç»†èŠ‚é—®é¢˜ï¼Œé€šè¿‡æŸ¥é˜…ç›¸å…³æ–‡çŒ®å’Œå‚è€ƒèµ„æ–™ï¼Œé€æ­¥è§£å†³äº†è¿™äº›æŠ€æœ¯éš¾é¢˜ã€‚

åœ¨**ç»ƒä¹ 5.13**ä¸­ï¼Œé€‰æ‹©åˆé€‚çš„é‡è¦æ€§å‡½æ•°f1å’Œf2å¹¶æ¯”è¾ƒå…¶åœ¨é‡è¦æ€§é‡‡æ ·ä¸­çš„æ–¹å·®è¡¨ç°ï¼Œæ¶‰åŠåˆ°æ¦‚ç‡åˆ†å¸ƒçš„æ·±å…¥ç†è§£å’Œæ•°å­¦æ¨å¯¼ã€‚å›°éš¾ä¸»è¦é›†ä¸­åœ¨å¦‚ä½•é€‰å–ä¸ç›®æ ‡å‡½æ•°$g(x)$â€œæ¥è¿‘â€çš„é‡è¦æ€§å‡½æ•°ï¼Œä»¥åŠå¦‚ä½•åˆç†è¯„ä¼°å…¶æ–¹å·®ã€‚ä¸ºæ­¤ï¼Œæˆ‘è¯¦ç»†åˆ†æäº†ç›®æ ‡å‡½æ•°çš„ç‰¹æ€§ï¼Œé€‰æ‹©äº†æˆªæ–­çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒå’ŒGammaåˆ†å¸ƒä½œä¸ºé‡è¦æ€§å‡½æ•°ï¼Œå¹¶é€šè¿‡ç¼–å†™ä»£ç å®ç°äº†é‡è¦æ€§é‡‡æ ·çš„è¿‡ç¨‹ã€‚åœ¨å®é™…æ“ä½œä¸­ï¼Œè°ƒæ•´å‚æ•°å’Œä¼˜åŒ–é‡‡æ ·æ–¹æ³•ï¼Œç¡®ä¿äº†æ¨¡æ‹Ÿç»“æœçš„å¯é æ€§ã€‚

åœ¨**é—®é¢˜2çš„è’™ç‰¹å¡ç½—å®éªŒ**ä¸­ï¼Œå®ç°å¿«é€Ÿæ’åºç®—æ³•å¹¶æµ‹é‡å…¶è®¡ç®—æ—¶é—´ä¹Ÿæ˜¯ä¸€å¤§æŒ‘æˆ˜ã€‚ç”±äºRè¯­è¨€å†…ç½®çš„`sort()`å‡½æ•°ä¸ä¸€å®šé‡‡ç”¨å¿«é€Ÿæ’åºç®—æ³•ï¼Œä¸ºäº†ç¡®ä¿å®éªŒçš„å‡†ç¡®æ€§ï¼Œæˆ‘è‡ªå®šä¹‰äº†ä¸€ä¸ªå¿«é€Ÿæ’åºå‡½æ•°ã€‚ç„¶è€Œï¼Œè‡ªå®šä¹‰æ’åºç®—æ³•çš„æ•ˆç‡è¾ƒä½ï¼Œå¯¼è‡´å¤§è§„æ¨¡æ•°æ®æ’åºæ—¶è®¡ç®—æ—¶é—´æ˜¾è‘—å¢åŠ ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæˆ‘é€šè¿‡ä¼˜åŒ–é€’å½’è°ƒç”¨å’Œå‡å°‘ä¸å¿…è¦çš„è®¡ç®—æ­¥éª¤ï¼Œæé«˜äº†è‡ªå®šä¹‰å¿«é€Ÿæ’åºçš„æ•ˆç‡ã€‚åŒæ—¶ï¼Œåˆç†è®¾ç½®æ ·æœ¬è§„æ¨¡å’Œæ¨¡æ‹Ÿæ¬¡æ•°ï¼Œç¡®ä¿äº†å®éªŒç»“æœçš„ç§‘å­¦æ€§å’Œå¯é‡å¤æ€§ã€‚

## æ€è€ƒä¸æ„Ÿæ‚Ÿ

é€šè¿‡å®Œæˆæ­¤æ¬¡ä½œä¸šï¼Œæˆ‘å¯¹**è’™ç‰¹å¡ç½—æ–¹æ³•**åŠå…¶åœ¨ç»Ÿè®¡è®¡ç®—ä¸­çš„åº”ç”¨æœ‰äº†æ›´ä¸ºæ·±å…¥çš„ç†è§£ã€‚è’™ç‰¹å¡ç½—æ–¹æ³•ä½œä¸ºä¸€ç§åŸºäºéšæœºé‡‡æ ·çš„æ•°å€¼è®¡ç®—æ–¹æ³•ï¼Œå…¶çµæ´»æ€§å’Œå¹¿æ³›é€‚ç”¨æ€§ä»¤äººå°è±¡æ·±åˆ»ã€‚ç„¶è€Œï¼Œå…¶è®¡ç®—æ•ˆç‡å’Œä¼°è®¡ç²¾åº¦åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºæ ·æœ¬é‡å’Œé‡‡æ ·æ–¹æ³•ï¼Œè¿™ä½¿å¾—æŒæ¡æœ‰æ•ˆçš„æ–¹å·®å‡å°‘æŠ€æœ¯æˆä¸ºæå‡è’™ç‰¹å¡ç½—æ–¹æ³•æ€§èƒ½çš„å…³é”®ã€‚

åœ¨å­¦ä¹ **å¯¹å¶å˜é‡æ³•**æ—¶ï¼Œæˆ‘æ·±åˆ»ä½“ä¼šåˆ°é€šè¿‡å¼•å…¥è´Ÿç›¸å…³æ€§å¯ä»¥æ˜¾è‘—å‡å°‘ä¼°è®¡é‡çš„æ–¹å·®ï¼Œæé«˜æ¨¡æ‹Ÿæ•ˆç‡ã€‚è¿™ä¸ä»…æ˜¯ç†è®ºä¸Šçš„åˆ›æ–°ï¼Œæ›´åœ¨å®é™…åº”ç”¨ä¸­å±•ç°äº†å…¶å·¨å¤§çš„ä»·å€¼ã€‚é€šè¿‡å¯¹æ¯”å¯¹å¶å˜é‡ç”Ÿæˆæ ·æœ¬ä¸ç‹¬ç«‹å˜é‡ç”Ÿæˆæ ·æœ¬çš„æ–¹å·®ï¼Œæˆ‘æ›´åŠ ç†è§£äº†æ–¹å·®å‡å°‘æŠ€æœ¯åœ¨è’™ç‰¹å¡ç½—æ¨¡æ‹Ÿä¸­çš„é‡è¦æ€§ï¼Œä¹Ÿæ„è¯†åˆ°é€‰æ‹©åˆé€‚çš„é‡‡æ ·æ–¹æ³•å¯¹äºæå‡è®¡ç®—æ•ˆç‡å’Œç»“æœå¯é æ€§çš„é‡è¦ä½œç”¨ã€‚

åœ¨**é‡è¦æ€§é‡‡æ ·**çš„ç»ƒä¹ ä¸­ï¼Œæˆ‘è®¤è¯†åˆ°é€‰æ‹©åˆé€‚çš„é‡è¦æ€§å‡½æ•°å¯¹äºä¼°è®¡é‡çš„æ–¹å·®å…·æœ‰å†³å®šæ€§å½±å“ã€‚é€šè¿‡å®é™…æ“ä½œï¼Œæˆ‘å‘ç°æˆªæ–­çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒåœ¨ä¸ç›®æ ‡å‡½æ•°$g(x)$çš„åŒ¹é…åº¦ä¸Šè¡¨ç°æ›´ä½³ï¼Œä»è€Œæ˜¾è‘—é™ä½äº†ä¼°è®¡é‡çš„æ–¹å·®ã€‚è¿™ä¸€è¿‡ç¨‹è®©æˆ‘æ˜ç™½äº†æ¦‚ç‡åˆ†å¸ƒé€‰æ‹©çš„è‰ºæœ¯æ€§å’Œç§‘å­¦æ€§ï¼Œä¹Ÿè®©æˆ‘æ„è¯†åˆ°ç†è®ºçŸ¥è¯†åœ¨å®é™…åº”ç”¨ä¸­çš„é‡è¦æ€§ã€‚

åœ¨**å¿«é€Ÿæ’åºç®—æ³•**çš„å®éªŒä¸­ï¼Œæˆ‘ä¸ä»…å·©å›ºäº†å¯¹ç®—æ³•å¤æ‚åº¦ç†è®ºçš„ç†è§£ï¼Œè¿˜é€šè¿‡å®é™…ç¼–ç¨‹ä½“éªŒäº†ç®—æ³•æ•ˆç‡ä¸ç†è®ºé¢„æœŸä¹‹é—´çš„å…³ç³»ã€‚è™½ç„¶è‡ªå®šä¹‰å¿«é€Ÿæ’åºç®—æ³•åœ¨å¤„ç†å¤§è§„æ¨¡æ•°æ®æ—¶æ•ˆç‡è¾ƒä½ï¼Œä½†é€šè¿‡ä¼˜åŒ–ä»£ç å’Œåˆç†è®¾ç½®å®éªŒå‚æ•°ï¼Œæˆ‘æ·±åˆ»ä½“ä¼šåˆ°ç†è®ºä¸å®è·µçš„ç»“åˆä¹‹ç¾ã€‚è¿™ä½¿æˆ‘æ›´åŠ é‡è§†ç¼–ç¨‹èƒ½åŠ›ä¸ç®—æ³•è®¾è®¡çš„é‡è¦æ€§ï¼Œä¹Ÿæ¿€å‘äº†æˆ‘è¿›ä¸€æ­¥å­¦ä¹ å’Œæ¢ç´¢é«˜æ•ˆç®—æ³•çš„å…´è¶£ã€‚


---

# ç»Ÿè®¡è®¡ç®—ç¬¬4æ¬¡ä½œä¸š { .center-title }

ä»¥ä¸‹æ˜¯ç»Ÿè®¡è®¡ç®—2024-09-30è¯¾ç¨‹å¯¹åº”çš„ä½œä¸š

# Question

## Question 1

Exercises 6.6 and 6.B (page 180-181, Statistical Computing with R).

  * __Exercise 6.6__  Estimate the 0.025, 0.05, 0.95, and 0.975 quantiles of the skewness $\sqrt{b_{1}}$ under normality by a Monte Carlo experiment. Compute the standard error of the estimates from (2.14) using the normal approximation for the density (with exact variance formula). Compare the estimated quantiles with the quantiles of the large sample approximation $\sqrt{b_{1}}\approx N(0,6/n)$.
   Formula 2.14 is as follows:
$$Var(\hat{x}_q)=\frac{q(1-q)}{nf(x_q)^2},\quad(2.14)$$

  * __Exercise 6.B__  Tests for association based on Pearson product moment correlation $\rho$, Spearmanâ€™s rank correlation coefficient $\rho_{s}$, or Kendallâ€™s coefficient $\tau$, are implemented in $\text{cor.test}$. Show (empirically) that the nonparametric tests based on $\rho_{s}$ or $\tau$ are less powerful than the correlation test when the sampled distribution is bivariate normal. Find an example of an alternative (a bivariate distribution $(X,Y)$ such that $X$ and $Y$ are dependent) such that at least one of the nonparametric tests have better empirical power than the correlation test against this alternative.

## Question 2
If we obtain the powers for two methods under a particular simulation setting with 10000 experiments: say, 0.651 for one method and 0.676 for another method. We want to know if the powers are different at 0.05 level.

  * What is the corresponding hypothesis test problem?

  * What test should we use? Z-test, two-sample t-test, paired-t test or McNemar test? Why?

  * Please provide the least necessary information for hypothesis testing.


# Answer

## ç»ƒä¹  6.6

### é¢˜ç›®æè¿°

1. ä½¿ç”¨è’™ç‰¹å¡ç½—æ¨¡æ‹Ÿä¼°è®¡æ­£æ€åˆ†å¸ƒä¸‹ååº¦ç»Ÿè®¡é‡ $\sqrt{b_1}$ çš„ 0.025ã€0.05ã€0.95 å’Œ 0.975 åˆ†ä½æ•°ã€‚

2. ä½¿ç”¨å…¬å¼ (2.14) è®¡ç®—ä¼°è®¡å€¼çš„æ ‡å‡†è¯¯å·®ï¼Œå…¬å¼å¦‚ä¸‹ï¼š
   $$
   \operatorname{Var}(\hat{x}_q) = \frac{q(1 - q)}{n f(x_q)^2}
   $$
   å…¶ä¸­ï¼š

   - $\hat{x}_q$æ˜¯åˆ†ä½æ•° $x_q$çš„ä¼°è®¡å€¼ã€‚
   - $q$ æ˜¯å¯¹åº”çš„åˆ†ä½æ•°æ¦‚ç‡ï¼ˆå¦‚ 0.025ã€0.05 ç­‰ï¼‰ã€‚
   - $n$ æ˜¯æ ·æœ¬å®¹é‡ã€‚
   - $f(x_q)$ æ˜¯ååº¦ç»Ÿè®¡é‡ $\sqrt{b_1}$ åœ¨åˆ†ä½æ•° $x_q$ å¤„çš„æ¦‚ç‡å¯†åº¦å‡½æ•°å€¼ã€‚

3. æ¯”è¾ƒæ¨¡æ‹Ÿä¼°è®¡çš„åˆ†ä½æ•°ä¸å¤§æ ·æœ¬è¿‘ä¼¼ $\sqrt{b_1} \approx N(0,6/n)$ çš„åˆ†ä½æ•°ã€‚

### è§£ç­”æ€è·¯

1. **ç†è§£ååº¦ç»Ÿè®¡é‡ $\sqrt{b_1}$ï¼š**

   - æ ·æœ¬ååº¦ç³»æ•° $\sqrt{b_1}$ æ˜¯è¡¡é‡åˆ†å¸ƒéå¯¹ç§°æ€§çš„ç»Ÿè®¡é‡ã€‚

   - å¯¹äºæ ·æœ¬ $X_1, X_2, \dots, X_n$ï¼Œååº¦ç»Ÿè®¡é‡$b_1$ å®šä¹‰ä¸ºï¼š

     $$
     b_1 = \frac{\frac{1}{n} \sum_{i=1}^{n} (X_i - \bar{X})^3}{\left(\frac{1}{n} \sum_{i=1}^{n} (X_i - \bar{X})^2\right)^{3/2}}
     $$
     å…¶ä¸­ï¼Œ$\bar{X}$ æ˜¯æ ·æœ¬å‡å€¼ã€‚

   - åœ¨æ­£æ€åˆ†å¸ƒä¸‹ï¼Œç†è®ºä¸Šååº¦ $b_1=0$ã€‚ç„¶è€Œï¼Œåœ¨æœ‰é™æ ·æœ¬ä¸‹ï¼Œååº¦ç»Ÿè®¡é‡ $b_1$ å…·æœ‰ä¸€å®šçš„åˆ†å¸ƒç‰¹æ€§ã€‚é€šè¿‡è’™ç‰¹å¡ç½—æ¨¡æ‹Ÿï¼Œå¯ä»¥ä¼°è®¡$\sqrt{b_1}$ çš„ç‰¹å®šåˆ†ä½æ•°ã€‚

2. **è’™ç‰¹å¡ç½—æ¨¡æ‹Ÿï¼š**

   - **ç›®æ ‡ï¼š**é€šè¿‡æ¨¡æ‹Ÿæ­£æ€åˆ†å¸ƒæ ·æœ¬ï¼Œä¼°è®¡ååº¦çš„åˆ†ä½æ•°ã€‚

   - **è®¾å®šå‚æ•°**ï¼š

     - **æ ·æœ¬é‡ $n$ï¼š** å– $n = 50$ï¼Œä½†ä¹Ÿå¯ä»¥å°è¯•å…¶ä»–å€¼ä»¥è§‚å¯Ÿå½±å“ã€‚
     - **æ¨¡æ‹Ÿæ¬¡æ•° $N$ï¼š** ä¸ºäº†ä¿è¯ä¼°è®¡çš„ç²¾åº¦ï¼Œå– $N = 1000000$ã€‚

   - **æ¨¡æ‹Ÿè¿‡ç¨‹**ï¼š

     è¿›è¡Œ $N$ æ¬¡æ¨¡æ‹Ÿï¼Œå¯¹äºæ¯ä¸€æ¬¡æ¨¡æ‹Ÿï¼š

     - **ç”Ÿæˆæ ·æœ¬ï¼š** ä»æ ‡å‡†æ­£æ€åˆ†å¸ƒ $N(0,1)$ ä¸­ç”Ÿæˆ $n$ ä¸ªéšæœºæ•°ï¼Œå¾—åˆ°æ ·æœ¬ $\{X_1, X_2, \dots, X_n\}$ã€‚

     - **è®¡ç®—æ ·æœ¬å‡å€¼ $\bar{X}$ï¼š**
       
       $$
       \bar{X} = \frac{1}{n} \sum_{i=1}^n X_i
       $$

     - **è®¡ç®—æ ·æœ¬ä¸­å¿ƒçŸ©ï¼š**

       - **äºŒé˜¶ä¸­å¿ƒçŸ©ï¼ˆæ ·æœ¬æ–¹å·®ï¼‰ï¼š**
         
         $$
         m_2 = \frac{1}{n} \sum_{i=1}^n (X_i - \bar{X})^2
         $$

       - **ä¸‰é˜¶ä¸­å¿ƒçŸ©ï¼š**
         
         $$
         m_3 = \frac{1}{n} \sum_{i=1}^n (X_i - \bar{X})^3
         $$

     - **è®¡ç®—ååº¦ç»Ÿè®¡é‡ $b_1$ï¼š**
       
       $$
       b_1 = \frac{m_3}{m_2^{3/2}}
       $$

     - **è®¡ç®— $\sqrt{b_1}$ï¼š**
       
       $$
       \sqrt{b_1} = \operatorname{sign}(b_1) \cdot |b_1|^{1/2}
       $$
       
       å…¶ä¸­ï¼Œ$\operatorname{sign}(b_1)$ è¡¨ç¤º $b_1$ çš„ç¬¦å·ã€‚

     - å°†æ¯æ¬¡æ¨¡æ‹Ÿå¾—åˆ°çš„ $\sqrt{b_1}$ ä¿å­˜åˆ°æ•°ç»„ä¸­ã€‚

   - **åˆ†ä½æ•°ä¼°è®¡**ï¼š

     - å°†æ‰€æœ‰æ¨¡æ‹Ÿå¾—åˆ°çš„ $\sqrt{b_1}$ æ’åºï¼Œå³å¯¹æ•°ç»„ $\{\sqrt{b_1^{(1)}}, \sqrt{b_1^{(2)}}, \dots, \sqrt{b_1^{(N)}}\}$ è¿›è¡Œæ’åºã€‚
     - æ ¹æ®æ’åºç»“æœï¼Œæå–ç¬¬ $2.5\%$ã€$5\%$ã€$95\%$ å’Œ $97.5\%$ çš„ä½ç½®å¯¹åº”çš„å€¼ï¼Œä½œä¸º $\sqrt{b_1}$ çš„ $0.025$ã€$0.05$ã€$0.95$ å’Œ $0.975$ åˆ†ä½æ•°ã€‚ä¾‹å¦‚ï¼š$0.025$ åˆ†ä½æ•°å¯¹åº”ç¬¬ $N \times 0.025$ ä¸ªå€¼ï¼Œ$0.05$ã€$0.95$ å’Œ $0.975$ åˆ†ä½æ•°åŒç†ã€‚


3. **ä½¿ç”¨å…¬å¼ (2.14) å’Œæ­£æ€å¯†åº¦è¿‘ä¼¼è®¡ç®—æ ‡å‡†è¯¯å·®ï¼š**

   - **ç¡®å®šåˆ†ä½æ•° $x_q$**ï¼š
     é€šè¿‡è’™ç‰¹å¡ç½—æ¨¡æ‹Ÿå¾—åˆ°çš„åˆ†ä½æ•°ä¼°è®¡å€¼ $\hat{x}_q$ã€‚

   - **ä¼°è®¡æ¦‚ç‡å¯†åº¦ $f(x_q)$**ï¼š

     æ ¹æ®å¤§æ ·æœ¬è¿‘ä¼¼ï¼Œ$\sqrt{b_1}$ è¿‘ä¼¼æœä»æ­£æ€åˆ†å¸ƒ  $N(0, \frac{6}{n_{\text{sample}}})$ï¼›å› æ­¤ï¼Œ $f(x_q)$ å¯ä»¥ç”¨æ­£æ€å¯†åº¦å‡½æ•°è¡¨ç¤ºã€‚è€Œå¯¹äºæ­£æ€åˆ†å¸ƒ $N(0, 6/n)$ï¼Œæ¦‚ç‡å¯†åº¦å‡½æ•°ä¸ºï¼š
     $$
     f(x) = \frac{1}{\sqrt{2\pi \cdot 6/n}} \exp\left( -\frac{x^2}{2 \cdot 6/n} \right)
     $$
     å› æ­¤ï¼Œå¯é€šè¿‡è’™ç‰¹å¡ç½—æ¨¡æ‹Ÿå¾—åˆ°çš„åˆ†ä½æ•°ä¼°è®¡å€¼ $\hat{x}_q$ä¼°è®¡ç›¸åº”çš„æ¦‚ç‡å¯†åº¦å€¼ï¼Œå…¬å¼å¦‚ä¸‹ï¼š

     $$
     f(\hat{x}_q) = \frac{1}{\sqrt{12\pi / n}} \exp\left( -\frac{n \hat{x}_q^2}{12} \right)
     $$

   - **ä»£å…¥å…¬å¼è®¡ç®—æ–¹å·®åŠæ ‡å‡†è¯¯å·®**ï¼š

     $$
     \operatorname{Var}(\hat{x}_q) = \frac{q(1 - q)}{n f(\hat{x}_q)^2}
     $$

     $$
     \text{æ ‡å‡†è¯¯å·®}(\operatorname{SE}(\hat{x}_q) ) = \sqrt{\operatorname{Var}(\hat{x}_q)} = \sqrt{ \frac{q(1 - q)}{n f(\hat{x}_q)^2} }
     $$

   **æ³¨æ„äº‹é¡¹**

   - å…¬å¼ (2.14) é€‚ç”¨äºå¤§æ ·æœ¬è¿‘ä¼¼ï¼Œå› æ­¤åœ¨æ ·æœ¬é‡è¾ƒå°æ—¶ï¼Œä¼°è®¡çš„æ ‡å‡†è¯¯å·®å¯èƒ½ä¸å¤Ÿå‡†ç¡®ã€‚
   - éœ€è¦ç¡®ä¿ $f(x_q)$ ä¸ä¸ºé›¶ï¼Œå¦åˆ™æ–¹å·®å°†è¶‹äºæ— ç©·å¤§ã€‚


4. **ä¸å¤§æ ·æœ¬è¿‘ä¼¼æ¯”è¾ƒï¼š**

   - **å¤§æ ·æœ¬è¿‘ä¼¼**

     æ ¹æ®å¤§æ ·æœ¬ç†è®ºï¼Œå½“ $n$ è¾ƒå¤§æ—¶ï¼Œååº¦ç»Ÿè®¡é‡$\sqrt{b_1}$ è¿‘ä¼¼æœä»æ­£æ€åˆ†å¸ƒï¼š
     $$
     \sqrt{b_1} \approx N(0, \sigma^2)
     $$
     

     å…¶ä¸­ï¼Œ$\sigma^2 = \frac{6}{n}$ï¼Œæ‰€ä»¥æœ‰å¦‚ä¸‹å…¬å¼ï¼š
     $$
     \sqrt{b_1} \approx N\left(0, \frac{6}{n}\right)
     $$
     å› æ­¤ï¼Œå¤§æ ·æœ¬è¿‘ä¼¼çš„åˆ†ä½æ•°å¯ä»¥é€šè¿‡æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„åˆ†ä½æ•°è¿›è¡Œè½¬æ¢ï¼š

     $$
     x_q^{\text{è¿‘ä¼¼}} = \mu + z_q \sigma = 0 + z_q \sqrt{\frac{6}{n}}= z_q \cdot \sqrt{\frac{6}{n}}
     $$
     å…¶ä¸­ï¼Œ $z_q$ æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„ç¬¬ $q$ åˆ†ä½æ•°ï¼Œå¯é€šè¿‡æŸ¥è¡¨æˆ–è®¡ç®—è·å¾—ã€‚

   - **æ¯”è¾ƒæ­¥éª¤**

     1. **è®¡ç®—å¤§æ ·æœ¬è¿‘ä¼¼åˆ†ä½æ•°**ï¼š
        - å¯¹äºæ¯ä¸ª $q = 0.025, 0.05, 0.95, 0.975$ï¼Œè®¡ç®— $z_q$ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨æ ‡å‡†æ­£æ€åˆ†å¸ƒè¡¨æˆ–è®¡ç®—å·¥å…·ï¼‰ã€‚
        - è®¡ç®— $x_q^{\text{è¿‘ä¼¼}} = z_q \cdot \sqrt{\frac{6}{n}}$ã€‚

     2. **æ¯”è¾ƒè’™ç‰¹å¡ç½—æ¨¡æ‹Ÿç»“æœ**ï¼š
        - å°†æ¨¡æ‹Ÿå¾—åˆ°çš„ $\hat{x}_q$ ä¸è¿‘ä¼¼ $x_q^{\text{è¿‘ä¼¼}}$ è¿›è¡Œå¯¹æ¯”ã€‚
        - åˆ†æä¸¤è€…çš„åå·®ï¼Œå°¤å…¶åœ¨å°æ ·æœ¬æƒ…å†µä¸‹ï¼Œå¤§æ ·æœ¬è¿‘ä¼¼å¯èƒ½å­˜åœ¨ä¸€å®šè¯¯å·®ã€‚
        
### ä»£ç å®ç°

```{r, eval=TRUE}
# è®¾ç½®éšæœºæ•°ç§å­
set.seed(101)

# 1ã€è®¾ç½®å‚æ•°
n_sample <- 50     # æ ·æœ¬å®¹é‡
n_sim <- 1000000     # æ¨¡æ‹Ÿæ¬¡æ•°

# 2ã€æ¨¡æ‹Ÿæ•°æ®å¹¶è®¡ç®—ååº¦
# åˆå§‹åŒ–å­˜å‚¨ååº¦å€¼çš„å‘é‡
skewness_values <- numeric(n_sim)

# å®šä¹‰è®¡ç®—æ ·æœ¬ååº¦çš„å‡½æ•°
compute_skewness <- function(x) {
  n <- length(x)
  m3 <- sum((x - mean(x))^3) / n       # ä¸‰é˜¶ä¸­å¿ƒçŸ©
  m2 <- sum((x - mean(x))^2) / n       # äºŒé˜¶ä¸­å¿ƒçŸ©
  sqrt_b1 <- m3 / (m2^(3/2))           # æ ·æœ¬ååº¦
  return(sqrt_b1)
}

# è¿è¡Œæ¨¡æ‹Ÿ
for (i in 1:n_sim) {
  sample_data <- rnorm(n_sample)                # ç”Ÿæˆæ­£æ€æ ·æœ¬
  skewness_values[i] <- compute_skewness(sample_data)  # è®¡ç®—ååº¦
}

# 3ã€ä¼°è®¡åˆ†ä½æ•°
quantile_levels <- c(0.025, 0.05, 0.95, 0.975)
estimated_quantiles <- quantile(skewness_values, probs = quantile_levels)

# 4ã€è®¡ç®—æ ‡å‡†è¯¯å·®
# è®¡ç®—ååº¦çš„æ–¹å·®å’Œæ ‡å‡†å·®
sigma2 <- 6 / n_sample    # ååº¦çš„æ–¹å·®
sigma <- sqrt(sigma2)     # ååº¦çš„æ ‡å‡†å·®

# åœ¨ä¼°è®¡çš„åˆ†ä½æ•°å¤„è®¡ç®—å¯†åº¦å‡½æ•°å€¼
f_xq <- dnorm(estimated_quantiles, mean = 0, sd = sigma)

# ä½¿ç”¨å…¬å¼ (2.14) è®¡ç®—æ–¹å·®å’Œæ ‡å‡†è¯¯å·®
n <- n_sim   # æ¨¡æ‹Ÿæ¬¡æ•°
var_xq <- quantile_levels * (1 - quantile_levels) / (n * f_xq^2)
se_xq <- sqrt(var_xq)

# 5ã€è®¡ç®—ç†è®ºåˆ†ä½æ•°
theoretical_quantiles <- qnorm(quantile_levels, mean = 0, sd = sigma)

# 6ã€å±•ç¤ºç»“æœ
results <- data.frame(
  Quantile_Level = quantile_levels,
  Estimated_Quantile = estimated_quantiles,
  SE = se_xq,
  Theoretical_Quantile = theoretical_quantiles
)

print(results)
```

### ä»£ç æ¦‚è¿°

- **è®¾ç½®å‚æ•°ï¼š**
  - `n_sample`ï¼šæ¯ä¸ªæ ·æœ¬çš„å¤§å°ï¼›
  - `n_sim`ï¼šè’™ç‰¹å¡ç½—æ¨¡æ‹Ÿæ¬¡æ•°ã€‚
- **è®¡ç®—ååº¦ï¼š**
  - å®šä¹‰ `compute_skewness` å‡½æ•°æ¥è®¡ç®—æ ·æœ¬çš„ååº¦ $\sqrt{b_1}$ï¼›
  - åœ¨æ¯æ¬¡æ¨¡æ‹Ÿä¸­ï¼Œç”Ÿæˆä¸€ä¸ªæ­£æ€æ ·æœ¬å¹¶è®¡ç®—å…¶ååº¦ã€‚

- **ä¼°è®¡åˆ†ä½æ•°ï¼š**
  - ä½¿ç”¨ `quantile` å‡½æ•°è®¡ç®—ååº¦å€¼çš„æŒ‡å®šåˆ†ä½æ•°ã€‚

- **è®¡ç®—æ ‡å‡†è¯¯å·®ï¼š**
  - æ ¹æ®å¤§æ ·æœ¬è¿‘ä¼¼ï¼Œè®¡ç®—ååº¦çš„æ ‡å‡†å·® `sigma`ï¼›
  - åœ¨ä¼°è®¡çš„åˆ†ä½æ•°å¤„è®¡ç®—æ­£æ€å¯†åº¦å‡½æ•°å€¼ `f_xq`ï¼›
  - ä½¿ç”¨å…¬å¼ (2.14) è®¡ç®—åˆ†ä½æ•°ä¼°è®¡çš„æ–¹å·®å’Œæ ‡å‡†è¯¯å·®ã€‚

- **è®¡ç®—ç†è®ºåˆ†ä½æ•°ï¼š**
  - ä½¿ç”¨ `qnorm` å‡½æ•°è®¡ç®—æ­£æ€è¿‘ä¼¼ä¸‹çš„ç†è®ºåˆ†ä½æ•°ã€‚

- **å±•ç¤ºç»“æœï¼š**
  - å°†ç»“æœå­˜å‚¨åœ¨æ•°æ®æ¡† `results` ä¸­ï¼Œå¹¶æ‰“å°è¾“å‡ºã€‚

### ç»“æœåˆ†æ

**å›¾å½¢æ¯”è¾ƒï¼š**

```{r, eval=TRUE}
# ç»˜åˆ¶ä¼°è®¡å€¼å’Œç†è®ºå€¼çš„å¯¹æ¯”å›¾
plot(quantile_levels, estimated_quantiles, type = "b", col = "blue", pch = 16,
     xlab = "åˆ†ä½æ•°æ°´å¹³", ylab = "ååº¦ âˆšbâ‚",
     main = "ååº¦çš„ä¼°è®¡åˆ†ä½æ•°ä¸ç†è®ºåˆ†ä½æ•°æ¯”è¾ƒ")
lines(quantile_levels, theoretical_quantiles, type = "b", col = "red", pch = 17)
legend("bottomright", legend = c("ä¼°è®¡åˆ†ä½æ•°", "ç†è®ºåˆ†ä½æ•°"),
       col = c("blue", "red"), pch = c(16, 17), lty = 1)
```
**è§£è¯»ï¼š**

- **ä¼°è®¡çš„åˆ†ä½æ•°** ä¸ **ç†è®ºåˆ†ä½æ•°** éå¸¸æ¥è¿‘ï¼Œè¡¨æ˜æ¨¡æ‹Ÿç»“æœä¸ç†è®ºé¢„æœŸä¸€è‡´ã€‚
- **æ ‡å‡†è¯¯å·®ï¼ˆSEï¼‰** è¾ƒå°ï¼Œè¯´æ˜åˆ†ä½æ•°ä¼°è®¡å…·æœ‰è¾ƒé«˜çš„ç²¾ç¡®åº¦ã€‚
- è½»å¾®çš„å·®å¼‚å¯èƒ½æ˜¯ç”±äºæœ‰é™çš„æ¨¡æ‹Ÿæ¬¡æ•°å’Œè¿‘ä¼¼é€ æˆçš„ã€‚

**ç»“è®ºï¼š**

- è’™ç‰¹å¡ç½—æ–¹æ³•æœ‰æ•ˆåœ°ä¼°è®¡äº†ååº¦çš„æŒ‡å®šåˆ†ä½æ•°ã€‚
- ä¼°è®¡å€¼ä¸ç†è®ºå€¼éå¸¸æ¥è¿‘ï¼ŒéªŒè¯äº†æ­£æ€è¿‘ä¼¼çš„åˆç†æ€§ã€‚
- ä½¿ç”¨å…¬å¼ (2.14) è®¡ç®—çš„æ ‡å‡†è¯¯å·®è¡¨æ˜ä¼°è®¡é‡çš„ç²¾ç¡®åº¦è¾ƒé«˜ï¼Œç¡®è®¤äº†ä¼°è®¡å€¼çš„å¯é æ€§ã€‚

---

## ç»ƒä¹  6.B

### é¢˜ç›®æè¿°

åŸºäº Pearson ä¹˜ç§¯çŸ©ç›¸å…³ç³»æ•° Ïã€Spearman ç§©ç›¸å…³ç³»æ•° Ïâ‚› æˆ– Kendall ç³»æ•° Ï„ çš„å…³è”æ£€éªŒå·²åœ¨ `cor.test` ä¸­å®ç°ã€‚é€šè¿‡å®è¯æ˜¾ç¤ºï¼Œå½“æ ·æœ¬åˆ†å¸ƒä¸ºåŒå˜é‡æ­£æ€åˆ†å¸ƒæ—¶ï¼ŒåŸºäº Ïâ‚› æˆ– Ï„ çš„éå‚æ•°æ£€éªŒæ¯”ç›¸å…³æ€§æ£€éªŒçš„åŠŸæ•ˆæ›´ä½ã€‚æ‰¾å‡ºä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆï¼ˆä¸€ä¸ªåŒå˜é‡åˆ†å¸ƒ $(X, Y)$ï¼Œä½¿å¾— $X$ å’Œ $Y$ ç›¸å…³ï¼‰ï¼Œä½¿å¾—è‡³å°‘ä¸€ç§éå‚æ•°æ£€éªŒå¯¹è¯¥æ›¿ä»£æ–¹æ¡ˆçš„åŠŸæ•ˆæ¯”ç›¸å…³æ€§æ£€éªŒæ›´é«˜ã€‚

ç”±ä¸Šå¯çŸ¥ï¼Œé¢˜ç›®å…·ä½“è¦æ±‚ä¸ºï¼š

1. è¯æ˜åœ¨æ ·æœ¬æ¥è‡ªäºŒç»´æ­£æ€åˆ†å¸ƒæ—¶ï¼ŒåŸºäº Spearman å’Œ Kendall éå‚æ•°ç›¸å…³ç³»æ•°çš„æ£€éªŒæ¯”åŸºäº Pearson ç›¸å…³ç³»æ•°çš„æ£€éªŒåŠŸæ•ˆæ›´ä½ã€‚
2. æ‰¾åˆ°ä¸€ä¸ª $(X, Y)$ å…·æœ‰ä¾èµ–æ€§çš„äºŒç»´åˆ†å¸ƒï¼Œä½¿å¾—è‡³å°‘ä¸€ç§éå‚æ•°æ£€éªŒå¯¹è¯¥å¤‡æ‹©å‡è®¾çš„åŠŸæ•ˆæ¯” Pearson æ£€éªŒæ›´é«˜ã€‚

### è§£ç­”æ€è·¯

1. **åŸå‡è®¾å’Œå¤‡æ‹©å‡è®¾ï¼š**

   åœ¨ç›¸å…³æ€§æ£€éªŒä¸­ï¼Œ**åŸå‡è®¾ï¼ˆNull Hypothesis, Hâ‚€ï¼‰**å’Œ**å¤‡æ‹©å‡è®¾ï¼ˆAlternative Hypothesis, Hâ‚ï¼‰**å®šä¹‰å¦‚ä¸‹ï¼š

   - **åŸå‡è®¾ (Hâ‚€):** ä¸¤ä¸ªå˜é‡ä¹‹é—´æ— çº¿æ€§ç›¸å…³ï¼Œå³ Pearson ç›¸å…³ç³»æ•° $\rho = 0$ã€‚å¯¹äºéå‚æ•°æ£€éªŒï¼ŒåŸå‡è®¾é€šå¸¸ä¹Ÿæ˜¯ä¸¤ä¸ªå˜é‡ç‹¬ç«‹ï¼ˆæ— ç›¸å…³æ€§ï¼‰ã€‚

     - **æ•°å­¦è¡¨è¾¾å¼:**
       $$
       Hâ‚€: \rho = 0
       $$

   - **å¤‡æ‹©å‡è®¾ (Hâ‚):** ä¸¤ä¸ªå˜é‡ä¹‹é—´å­˜åœ¨ç›¸å…³æ€§ï¼Œå³ Pearson ç›¸å…³ç³»æ•° $\rho â‰  0$ã€‚å¯¹äºéå‚æ•°æ£€éªŒï¼ŒåŒæ ·æ˜¯ä¸¤ä¸ªå˜é‡å­˜åœ¨æŸç§å½¢å¼çš„ç›¸å…³æ€§ï¼ˆä¸ä¸€å®šæ˜¯çº¿æ€§çš„ï¼‰ã€‚

     - **æ•°å­¦è¡¨è¾¾å¼:**
       $$
       Hâ‚: \rho \neq 0
       $$

   åœ¨ R è¯­è¨€ä¸­çš„ `cor.test` å‡½æ•°ä¸­ï¼Œé»˜è®¤çš„æ£€éªŒå°±æ˜¯åŸºäºä¸Šè¿°åŸå‡è®¾å’Œå¤‡æ‹©å‡è®¾è¿›è¡Œçš„åŒå°¾æ£€éªŒã€‚

2. **åœ¨äºŒç»´æ­£æ€åˆ†å¸ƒä¸‹æ¯”è¾ƒæ£€éªŒåŠŸæ•ˆï¼š**

   - ç”±äº Pearson æ£€éªŒåœ¨æ£€æµ‹çº¿æ€§å…³ç³»æ—¶å…·æœ‰æœ€ä¼˜æ€§ï¼Œå› æ­¤åœ¨äºŒç»´æ­£æ€åˆ†å¸ƒä¸‹ï¼ŒPearson æ£€éªŒçš„åŠŸæ•ˆåº”å½“é«˜äºéå‚æ•°æ£€éªŒã€‚
   - é€šè¿‡æ¨¡æ‹Ÿå®éªŒï¼Œæ¯”è¾ƒä¸‰ç§æ£€éªŒåœ¨æ‹’ç»åŸå‡è®¾ï¼ˆ$\rho=0$ï¼‰çš„é¢‘ç‡ï¼Œå³åŠŸæ•ˆã€‚

3. **æ„é€ éæ­£æ€çš„äºŒç»´åˆ†å¸ƒï¼š**

   - é€‰æ‹©ä¸€ä¸ªå…·æœ‰éçº¿æ€§å…³ç³»çš„äºŒç»´åˆ†å¸ƒï¼Œä½¿å¾—éå‚æ•°æ£€éªŒæ›´æ•æ„Ÿã€‚
   - ä¾‹å¦‚ï¼Œ$Y$ æ˜¯ $X$ çš„éçº¿æ€§å‡½æ•°ï¼ŒåŠ ä¸Šä¸€äº›éšæœºå™ªå£°ã€‚

### è¯¦ç»†è§£ç­”æ­¥éª¤

**1. åœ¨äºŒç»´æ­£æ€åˆ†å¸ƒä¸‹çš„æ£€éªŒåŠŸæ•ˆæ¯”è¾ƒ**

**ç†è®ºåŸºç¡€**

åœ¨äºŒç»´æ­£æ€åˆ†å¸ƒä¸‹ï¼ŒPearson ç›¸å…³ç³»æ•°æ£€éªŒé’ˆå¯¹çš„æ˜¯çº¿æ€§ç›¸å…³æ€§ï¼Œä¸”åœ¨è¿™ç§æƒ…å½¢ä¸‹ï¼ŒPearson æ£€éªŒæ˜¯æœ€æœ‰æ•ˆçš„ï¼ˆå…·æœ‰æœ€é«˜çš„åŠŸæ•ˆï¼‰ã€‚è¿™æ˜¯å› ä¸ºåœ¨æ­£æ€åˆ†å¸ƒä¸‹ï¼Œçº¿æ€§ç›¸å…³å®Œå…¨æè¿°äº†å˜é‡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚

ç›¸æ¯”ä¹‹ä¸‹ï¼ŒSpearman å’Œ Kendall çš„éå‚æ•°æ£€éªŒæ˜¯åŸºäºç§©çš„ï¼Œä¸»è¦ç”¨äºæ£€æµ‹å•è°ƒå…³ç³»ï¼ˆä¸ä¸€å®šæ˜¯çº¿æ€§çš„ï¼‰ã€‚å› æ­¤ï¼Œåœ¨çº¯ç²¹çš„çº¿æ€§ç›¸å…³æƒ…å¢ƒä¸‹ï¼Œéå‚æ•°æ£€éªŒç”±äºåˆ©ç”¨çš„ä¿¡æ¯è¾ƒå°‘ï¼Œå¯¼è‡´å…¶åŠŸæ•ˆä½äº Pearson æ£€éªŒã€‚

**æ¨¡æ‹Ÿå®éªŒ**

**a. è®¾å®šå‚æ•°ï¼š**

- **æ ·æœ¬é‡ (n):** 30
- **ç›¸å…³ç³»æ•° (Ï):** 0.5
- **æ¨¡æ‹Ÿæ¬¡æ•° (N):** 1000
- **æ˜¾è‘—æ€§æ°´å¹³ (Î±):** 0.05

**b. æ¨¡æ‹Ÿè¿‡ç¨‹ï¼š**

è¿›è¡Œ $N$ æ¬¡æ¨¡æ‹Ÿï¼Œå¯¹äºæ¯ä¸€æ¬¡æ¨¡æ‹Ÿï¼š

- **ç”Ÿæˆæ•°æ®ï¼š** ä½¿ç”¨å¤šå…ƒæ­£æ€åˆ†å¸ƒç”Ÿæˆæ ·æœ¬ $(X_i, Y_i)$ï¼Œåæ–¹å·®çŸ©é˜µä¸ºï¼š
  $$
  \Sigma = \begin{pmatrix}
  1 & \rho \\
  \rho & 1 \\
  \end{pmatrix}
  $$

- **æ£€éªŒæ–¹æ³•ï¼š**

  - **Pearson æ£€éªŒï¼š** ä½¿ç”¨ `cor.test(X, Y, method = "pearson")`ã€‚
  - **Spearman æ£€éªŒï¼š** ä½¿ç”¨ `cor.test(X, Y, method = "spearman")`ã€‚
  - **Kendall æ£€éªŒï¼š** ä½¿ç”¨ `cor.test(X, Y, method = "kendall")`ã€‚

- **è®°å½•ç»“æœï¼š** ç»Ÿè®¡æ¯ç§æ£€éªŒæ˜¯å¦æ‹’ç»åŸå‡è®¾ï¼ˆ$p$å€¼å°äº 0.05ï¼‰ã€‚

**c.è®¡ç®—åŠŸæ•ˆï¼š**

- **åŠŸæ•ˆï¼š** åœ¨ $N$ æ¬¡æ¨¡æ‹Ÿä¸­ï¼Œæ¯ç§æ£€éªŒæ‹’ç»åŸå‡è®¾çš„æ¬¡æ•°é™¤ä»¥ $N$ï¼Œå¾—åˆ°åŠŸæ•ˆä¼°è®¡å€¼ã€‚

**2. æ„é€ éæ­£æ€çš„äºŒç»´åˆ†å¸ƒ**

**é€‰æ‹©çš„åˆ†å¸ƒ**

- **$X$ï¼š** ä»å‡åŒ€åˆ†å¸ƒ $U(-1, 1)$ ä¸­ç”Ÿæˆã€‚
- **$Y$ï¼š** å®šä¹‰ä¸º $Y = X^2 + \epsilon$ï¼Œå…¶ä¸­ $\epsilon \sim N(0, 0.1^2)$ã€‚

- **ç‰¹ç‚¹**

  - $X$ å’Œ $Y$ ä¹‹é—´å­˜åœ¨éçº¿æ€§å…³ç³»ï¼ˆæŠ›ç‰©çº¿å½¢ï¼‰ã€‚
  - Pearson æ£€éªŒå¯èƒ½éš¾ä»¥æ£€æµ‹åˆ°è¿™ç§å…³ç³»ï¼Œè€Œéå‚æ•°æ£€éªŒï¼ˆå°¤å…¶æ˜¯ Spearman æ£€éªŒï¼‰å¯¹å•è°ƒå…³ç³»æ›´æ•æ„Ÿã€‚

**æ¨¡æ‹Ÿå®éªŒ**

**a. è®¾å®šå‚æ•°ï¼š**

- **æ ·æœ¬é‡ (n):** 30
- **æ¨¡æ‹Ÿæ¬¡æ•° (N):** 1000
- **æ˜¾è‘—æ€§æ°´å¹³ (Î±):** 0.05

**b. æ¨¡æ‹Ÿè¿‡ç¨‹ï¼š**

æ¯ä¸€æ¬¡æ¨¡æ‹Ÿæ—¶ï¼š

- **ç”Ÿæˆæ•°æ®:**

  $$
  X \sim U(-1, 1)
  $$
  $$
  \epsilon \sim N(0, 0.1^2)
  $$
  $$
  Y = X^2 + \epsilon
  $$

- **è¿›è¡Œæ£€éªŒ:**
  - **Pearson æ£€éªŒï¼š** ä½¿ç”¨ `cor.test(X, Y, method = "pearson")`ã€‚
  - **Spearman æ£€éªŒï¼š** ä½¿ç”¨ `cor.test(X, Y, method = "spearman")`ã€‚
  - **Kendall æ£€éªŒï¼š** ä½¿ç”¨ `cor.test(X, Y, method = "kendall")`ã€‚

- **è®°å½•ç»“æœï¼š** ç»Ÿè®¡æ¯ç§æ£€éªŒæ˜¯å¦æ‹’ç»åŸå‡è®¾ï¼ˆ$p$å€¼å°äº 0.05ï¼‰ã€‚

**c. è®¡ç®—åŠŸæ•ˆï¼š**

- **åŠŸæ•ˆï¼š**åœ¨ $N$ æ¬¡æ¨¡æ‹Ÿä¸­ï¼Œæ¯ç§æ£€éªŒæ‹’ç»åŸå‡è®¾çš„æ¬¡æ•°é™¤ä»¥ $N$ ï¼Œå³ä¸ºè¯¥æ£€éªŒçš„åŠŸæ•ˆä¼°è®¡å€¼ã€‚

### å®é™…è®¡ç®—ä¸ç»“æœå±•ç¤º

**1. åœ¨äºŒç»´æ­£æ€åˆ†å¸ƒä¸‹çš„åŠŸæ•ˆæ¯”è¾ƒ**

**ä»£ç å®ç°ï¼š**

```{r, eval=TRUE}
# åŠ è½½å¿…è¦çš„åŒ…
if (!requireNamespace("MASS", quietly = TRUE)) {
  install.packages("MASS")
}
library(MASS)  # ç”¨äºç”Ÿæˆå¤šå…ƒæ­£æ€åˆ†å¸ƒæ•°æ®

# è®¾ç½®å‚æ•°
n <- 30       # æ ·æœ¬é‡
N <- 1000     # æ¨¡æ‹Ÿæ¬¡æ•°
rho <- 0.5    # ç›¸å…³ç³»æ•°
alpha <- 0.05 # æ˜¾è‘—æ€§æ°´å¹³

# å­˜å‚¨æ‹’ç»åŸå‡è®¾çš„æ¬¡æ•°
reject_counts_normal <- c(Pearson = 0, Spearman = 0, Kendall = 0)

# è®¾ç½®éšæœºç§å­ä»¥ä¾¿å¤ç°
set.seed(102)

# æ¨¡æ‹Ÿè¿‡ç¨‹
for (i in 1:N) {
  # ç”ŸæˆäºŒç»´æ­£æ€åˆ†å¸ƒæ ·æœ¬
  Sigma <- matrix(c(1, rho, rho, 1), nrow = 2)
  sample_data <- mvrnorm(n, mu = c(0, 0), Sigma = Sigma)
  X <- sample_data[,1]
  Y <- sample_data[,2]
  
  # Pearson æ£€éªŒ
  test_pearson <- cor.test(X, Y, method = "pearson")
  if (test_pearson$p.value < alpha) {
    reject_counts_normal["Pearson"] <- reject_counts_normal["Pearson"] + 1
  }
  
  # Spearman æ£€éªŒ
  test_spearman <- cor.test(X, Y, method = "spearman")
  if (test_spearman$p.value < alpha) {
    reject_counts_normal["Spearman"] <- reject_counts_normal["Spearman"] + 1
  }
  
  # Kendall æ£€éªŒ
  test_kendall <- cor.test(X, Y, method = "kendall")
  if (test_kendall$p.value < alpha) {
    reject_counts_normal["Kendall"] <- reject_counts_normal["Kendall"] + 1
  }
}

# è®¡ç®—åŠŸæ•ˆ
power_normal <- reject_counts_normal / N

# å°†åŠŸæ•ˆç»“æœè½¬æ¢ä¸ºæ•°æ®æ¡†
power_normal_df <- data.frame(
  Test = names(power_normal),
  Power = as.numeric(power_normal)
)

# å±•ç¤ºåŠŸæ•ˆæ•°æ®æ¡†
print(power_normal_df)


```

**å›¾è¡¨å±•ç¤ºï¼š**

```{r, eval=TRUE}
# ç»˜åˆ¶åŠŸæ•ˆæ¯”è¾ƒæŸ±çŠ¶å›¾ï¼Œå¹¶è·å–æ¡å½¢ä¸­ç‚¹ä½ç½®
bp <- barplot(power_normal, 
              main = "åŠŸæ•ˆæ¯”è¾ƒï¼ˆäºŒç»´æ­£æ€åˆ†å¸ƒï¼‰",
              ylab = "åŠŸæ•ˆ",
              ylim = c(0,1),
              col = c("steelblue", "forestgreen", "orange"),
              names.arg = power_normal_df$Test)  # æ·»åŠ æ¡å½¢åç§°æ ‡ç­¾

# åœ¨æ¡å½¢ä¸Šæ–¹å±…ä¸­æ·»åŠ æ•°å€¼æ ‡ç­¾
text(x = bp, 
     y = power_normal + 0.02,  # åœ¨æ¡å½¢é«˜åº¦ä¸Šæ–¹æ·»åŠ 0.02çš„åç§»é‡
     label = round(power_normal_df$Power, 3), 
     cex = 0.8, 
     col = "black", 
     adj = c(0.5, 0))  # æ°´å¹³å±…ä¸­ï¼Œå‚ç›´é ä¸‹

```

**ç»“æœåˆ†æï¼š**

- **Pearson æ£€éªŒçš„åŠŸæ•ˆæœ€é«˜ï¼š** åœ¨æ£€æµ‹çº¿æ€§å…³ç³»æ—¶ï¼ŒPearson æ£€éªŒå…·æœ‰æœ€ä¼˜æ€§ã€‚
- **éå‚æ•°æ£€éªŒçš„åŠŸæ•ˆè¾ƒä½ï¼š** Spearman å’Œ Kendall æ£€éªŒåœ¨è¿™ç§æƒ…å†µä¸‹åŠŸæ•ˆç¨é€Šã€‚

**2. åœ¨éæ­£æ€åˆ†å¸ƒä¸‹çš„åŠŸæ•ˆæ¯”è¾ƒ**

**ä»£ç å®ç°ï¼š**

```{r, eval=TRUE}
# è®¾ç½®å‚æ•°
n <- 30        # æ ·æœ¬é‡
N <- 1000      # æ¨¡æ‹Ÿæ¬¡æ•°
alpha <- 0.05  # æ˜¾è‘—æ€§æ°´å¹³

# å­˜å‚¨æ‹’ç»åŸå‡è®¾çš„æ¬¡æ•°ï¼Œä½¿ç”¨å‘½åå‘é‡
reject_counts_nonnormal <- c(Pearson = 0, Spearman = 0, Kendall = 0)

# è®¾ç½®éšæœºç§å­ä»¥ä¾¿å¤ç°
set.seed(103)

# æ¨¡æ‹Ÿè¿‡ç¨‹
for (i in 1:N) {
  # ç”Ÿæˆéæ­£æ€åˆ†å¸ƒæ ·æœ¬
  X <- runif(n, -1, 1)            # X ~ U(-1, 1)
  epsilon <- rnorm(n, mean = 0, sd = 0.1)  # Îµ ~ N(0, 0.1Â²)
  Y <- X^2 + epsilon               # Y = XÂ² + Îµ
  
  # Pearson æ£€éªŒ
  test_pearson <- cor.test(X, Y, method = "pearson")
  if (test_pearson$p.value < alpha) {
    reject_counts_nonnormal["Pearson"] <- reject_counts_nonnormal["Pearson"] + 1
  }
  
  # Spearman æ£€éªŒ
  test_spearman <- cor.test(X, Y, method = "spearman")
  if (test_spearman$p.value < alpha) {
    reject_counts_nonnormal["Spearman"] <- reject_counts_nonnormal["Spearman"] + 1
  }
  
  # Kendall æ£€éªŒ
  test_kendall <- cor.test(X, Y, method = "kendall")
  if (test_kendall$p.value < alpha) {
    reject_counts_nonnormal["Kendall"] <- reject_counts_nonnormal["Kendall"] + 1
  }
}

# è®¡ç®—åŠŸæ•ˆ
power_nonnormal <- reject_counts_nonnormal / N

# å°†åŠŸæ•ˆç»“æœè½¬æ¢ä¸ºæ•°æ®æ¡†
power_nonnormal_df <- data.frame(
  Test = names(power_nonnormal),
  Power = as.numeric(power_nonnormal)
)

# å±•ç¤ºåŠŸæ•ˆæ•°æ®æ¡†
print(power_nonnormal_df)


```
**å›¾è¡¨å±•ç¤ºï¼š**

```{r, eval=TRUE}
# å¯è§†åŒ–åŠŸæ•ˆç»“æœ
barplot(power_nonnormal_df$Power, 
        names.arg = power_nonnormal_df$Test,
        main = "åŠŸæ•ˆæ¯”è¾ƒï¼ˆéæ­£æ€äºŒç»´åˆ†å¸ƒï¼‰",
        ylab = "åŠŸæ•ˆ",
        ylim = c(0,1),
        col = c("steelblue", "forestgreen", "orange"),
        las = 1)

# åœ¨æ¡å½¢ä¸Šæ·»åŠ æ•°å€¼æ ‡ç­¾
text(x = bp, 
     y = power_nonnormal + 0.02,  # åœ¨æ¡å½¢é«˜åº¦ä¸Šæ–¹æ·»åŠ 0.02çš„åç§»é‡
     label = round(power_nonnormal_df$Power, 3), 
     cex = 0.8, 
     col = "black", 
     adj = c(0.5, 0))  # æ°´å¹³å±…ä¸­ï¼Œå‚ç›´é ä¸‹


```

**ç»“æœåˆ†æï¼š**

- **Kendall æ£€éªŒçš„åŠŸæ•ˆæœ€é«˜ï¼š** èƒ½æœ‰æ•ˆæ£€æµ‹å‡º $X$ å’Œ $Y$ ä¹‹é—´çš„éçº¿æ€§å…³ç³»ã€‚
- **Pearson æ£€éªŒçš„åŠŸæ•ˆæä½ï¼š** å› ä¸ºå®ƒåªèƒ½æ£€æµ‹çº¿æ€§å…³ç³»ï¼Œæ— æ³•è¯†åˆ«å‡ºéçº¿æ€§ä¾èµ–ã€‚

**æ•°æ®å¯è§†åŒ–**

**æ•£ç‚¹å›¾å±•ç¤º $X$ å’Œ $Y$ çš„å…³ç³»ï¼š**

```{r, eval=TRUE}
# ç»˜åˆ¶æ•£ç‚¹å›¾
plot(X, Y, main = "éæ­£æ€åˆ†å¸ƒä¸‹çš„æ•£ç‚¹å›¾", xlab = "X", ylab = "Y")
```

**å›¾ç¤ºè§£é‡Šï¼š**

- **æ•£ç‚¹å›¾å‘ˆæŠ›ç‰©çº¿å½¢çŠ¶ï¼š** è¯´æ˜ $X$ å’Œ $Y$ ä¹‹é—´å­˜åœ¨æ˜æ˜¾çš„éçº¿æ€§å…³ç³»ã€‚
- **éå‚æ•°æ£€éªŒæ›´é€‚åˆï¼š** Spearman å’Œ Kendall æ£€éªŒèƒ½å¤Ÿæ•æ‰åˆ°è¿™ç§å•è°ƒå…³ç³»ï¼Œè€Œ Pearson æ£€éªŒæ— æ³•æœ‰æ•ˆæ£€æµ‹ã€‚

### æœ¬é¢˜ç»“è®º

- **åœ¨äºŒç»´æ­£æ€åˆ†å¸ƒä¸‹ï¼š**
  - Pearson ç›¸å…³æ€§æ£€éªŒé’ˆå¯¹çº¿æ€§å…³ç³»ï¼Œå…·æœ‰æœ€é«˜çš„åŠŸæ•ˆã€‚
  - Spearman å’Œ Kendall çš„éå‚æ•°æ£€éªŒç”±äºåŸºäºç§©ï¼Œä¿¡æ¯åˆ©ç”¨è¾ƒå°‘ï¼Œå¯¼è‡´åŠŸæ•ˆè¾ƒä½ã€‚
- **åœ¨éæ­£æ€ï¼ˆéçº¿æ€§ï¼‰äºŒç»´åˆ†å¸ƒä¸‹ï¼š**
  - éå‚æ•°æ£€éªŒï¼ˆå°¤å…¶æ˜¯ Spearman å’Œ Kendallï¼‰å¯¹éçº¿æ€§ç›¸å…³æ€§æ›´æ•æ„Ÿï¼ŒåŠŸæ•ˆé«˜äº Pearson æ£€éªŒã€‚
  - Pearson æ£€éªŒåœ¨è¿™ç§æƒ…å½¢ä¸‹çš„åŠŸæ•ˆè¾ƒä½ï¼Œå› ä¸ºå…¶å‡è®¾çš„çº¿æ€§ç›¸å…³æ€§ä¸å†æˆç«‹ã€‚

å› æ­¤ï¼Œæ ¹æ®æ•°æ®åˆ†å¸ƒçš„ä¸åŒï¼Œé€‰æ‹©åˆé€‚çš„ç›¸å…³æ€§æ£€éªŒæ–¹æ³•è‡³å…³é‡è¦ã€‚åœ¨æ•°æ®æ»¡è¶³æ­£æ€åˆ†å¸ƒä¸”å­˜åœ¨çº¿æ€§ç›¸å…³æ€§æ—¶ï¼ŒPearson æ£€éªŒæ›´ä¸ºé€‚ç”¨ï¼›è€Œåœ¨å­˜åœ¨éçº¿æ€§ç›¸å…³æ€§æˆ–æ•°æ®ä¸æ»¡è¶³æ­£æ€åˆ†å¸ƒæ—¶ï¼Œéå‚æ•°æ£€éªŒï¼ˆSpearman æˆ– Kendallï¼‰å¯èƒ½æ›´å…·ä¼˜åŠ¿ã€‚

---


## é—®é¢˜2 è§£æ³•ä¸€

### é¢˜ç›®æè¿°

å‡è®¾æˆ‘ä»¬åœ¨æŸä¸€ç‰¹å®šçš„æ¨¡æ‹Ÿè®¾ç½®ä¸‹è¿›è¡Œäº† 10000 æ¬¡å®éªŒï¼Œå¾—åˆ°äº†ä¸¤ç§æ–¹æ³•çš„åŠŸæ•ˆï¼ˆpowerï¼‰ï¼š

- æ–¹æ³•ä¸€çš„åŠŸæ•ˆä¸º 0.651
- æ–¹æ³•äºŒçš„åŠŸæ•ˆä¸º 0.676

æˆ‘ä»¬æƒ³çŸ¥é“åœ¨æ˜¾è‘—æ€§æ°´å¹³ 0.05 ä¸‹ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•çš„åŠŸæ•ˆæ˜¯å¦æœ‰æ˜¾è‘—å·®å¼‚ã€‚

**é—®é¢˜ï¼š**

a. å¯¹åº”çš„å‡è®¾æ£€éªŒé—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ
b. æˆ‘ä»¬åº”è¯¥ä½¿ç”¨å“ªç§æ£€éªŒæ–¹æ³•ï¼ŸZ æ£€éªŒã€ä¸¤æ ·æœ¬ t æ£€éªŒã€é…å¯¹ t æ£€éªŒè¿˜æ˜¯ McNemar æ£€éªŒï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ
c. è¯·æä¾›è¿›è¡Œå‡è®¾æ£€éªŒæ‰€éœ€çš„æœ€å°‘å¿…è¦ä¿¡æ¯ã€‚

### è§£ç­”æ€è·¯

1. **ç¡®å®šå‡è®¾æ£€éªŒçš„é—®é¢˜**

- **åŸå‡è®¾ï¼ˆHâ‚€ï¼‰**ï¼šä¸¤ç§æ–¹æ³•çš„åŠŸæ•ˆç›¸ç­‰ï¼Œå³ $p_1 = p_2$ã€‚
- **å¤‡æ‹©å‡è®¾ï¼ˆHâ‚ï¼‰**ï¼šä¸¤ç§æ–¹æ³•çš„åŠŸæ•ˆä¸ç›¸ç­‰ï¼Œå³ $p_1 \neq p_2$ã€‚

è¿™é‡Œï¼Œ$p_1$ å’Œ $p_2$ åˆ†åˆ«è¡¨ç¤ºæ–¹æ³•ä¸€å’Œæ–¹æ³•äºŒçš„çœŸå®åŠŸæ•ˆã€‚

2. **é€‰æ‹©åˆé€‚çš„æ£€éªŒæ–¹æ³•**

- **æ•°æ®ç±»å‹**ï¼šåŠŸæ•ˆæ˜¯åŸºäºäºŒé¡¹åˆ†å¸ƒçš„æ¯”ä¾‹ï¼Œè¡¨ç¤ºåœ¨ 10000 æ¬¡å®éªŒä¸­ï¼Œæ¯ç§æ–¹æ³•æ­£ç¡®æ‹’ç»åŸå‡è®¾çš„æ¬¡æ•°æ¯”ä¾‹ã€‚

- **æ ·æœ¬æ€§è´¨**ï¼š
  - å¦‚æœä¸¤ç§æ–¹æ³•åœ¨åŒä¸€ç»„å®éªŒä¸Šè¿›è¡Œæµ‹è¯•ï¼ˆå³å¯¹åŒä¸€æ•°æ®é›†è¿›è¡Œè¯„ä¼°ï¼‰ï¼Œåˆ™æ•°æ®æ˜¯**é…å¯¹çš„**ã€‚
  - å¦‚æœä¸¤ç§æ–¹æ³•åœ¨ä¸åŒçš„å®éªŒä¸Šè¿›è¡Œæµ‹è¯•ï¼Œåˆ™æ•°æ®æ˜¯**ç‹¬ç«‹çš„**ã€‚

- **å¯èƒ½çš„æ£€éªŒæ–¹æ³•**ï¼š

  - **Z æ£€éªŒ**ï¼šç”¨äºæ¯”è¾ƒä¸¤ä¸ªç‹¬ç«‹å¤§æ ·æœ¬çš„æ¯”ä¾‹ã€‚
  - **ä¸¤æ ·æœ¬ t æ£€éªŒ**ï¼šç”¨äºæ¯”è¾ƒä¸¤ä¸ªç‹¬ç«‹æ­£æ€åˆ†å¸ƒæ ·æœ¬çš„å‡å€¼ã€‚
  - **é…å¯¹ t æ£€éªŒ**ï¼šç”¨äºæ¯”è¾ƒä¸¤ä¸ªç›¸å…³æ ·æœ¬çš„å‡å€¼ã€‚
  - **McNemar æ£€éªŒ**ï¼šç”¨äºåˆ†æé…å¯¹åä¹‰æ•°æ®çš„å˜åŒ–ï¼Œç‰¹åˆ«é€‚ç”¨äº 2Ã—2 çš„é…å¯¹åˆ—è”è¡¨ã€‚

- **é€‰æ‹©ç†ç”±**ï¼š

  - **McNemar æ£€éªŒ**é€‚ç”¨äºåˆ†æåŒä¸€å¯¹è±¡çš„ä¸¤ä¸ªç›¸å…³æ ·æœ¬çš„äºŒåˆ†ç±»ç»“æœå·®å¼‚ã€‚
  - **Z æ£€éªŒ**é€‚ç”¨äºæ¯”è¾ƒä¸¤ä¸ªç‹¬ç«‹æ ·æœ¬çš„æ¯”ä¾‹ã€‚

- **ç»“è®º**ï¼š

  - ç”±äºé¢˜ç›®æœªæ˜ç¡®è¯´æ˜å®éªŒæ˜¯é…å¯¹çš„ï¼Œæˆ‘ä»¬å‡è®¾ä¸¤ç§æ–¹æ³•çš„ç»“æœæ˜¯**ç‹¬ç«‹çš„**ã€‚
  - å› æ­¤ï¼Œæˆ‘ä»¬åº”ä½¿ç”¨**Z æ£€éªŒ**æ¥æ¯”è¾ƒä¸¤ç§æ–¹æ³•çš„åŠŸæ•ˆã€‚

3. **æä¾›å‡è®¾æ£€éªŒæ‰€éœ€çš„æœ€å°‘å¿…è¦ä¿¡æ¯**

- **æˆåŠŸæ¬¡æ•°å’Œæ ·æœ¬é‡**ï¼š

  - æ–¹æ³•ä¸€æˆåŠŸæ¬¡æ•°ï¼š$x_1 = n \times p_1 = 10000 \times 0.651 = 6510$ã€‚
  - æ–¹æ³•äºŒæˆåŠŸæ¬¡æ•°ï¼š$x_2 = n \times p_2 = 10000 \times 0.676 = 6760$ã€‚
  - æ€»æ ·æœ¬é‡ï¼š$n_1 = n_2 = 10000$ã€‚

- **åˆå¹¶æˆåŠŸç‡**ï¼š

  $$
  \hat{p} = \frac{x_1 + x_2}{n_1 + n_2} = \frac{6510 + 6760}{20000} = 0.6635
  $$

- **æ ‡å‡†è¯¯å·®**ï¼š
  $$
  SE = \sqrt{\hat{p}(1 - \hat{p})\left( \frac{1}{n_1} + \frac{1}{n_2} \right)} = \sqrt{0.6635 \times 0.3365 \times \left( \frac{1}{10000} + \frac{1}{10000} \right)}
  $$

### ä»£ç å®ç°

```{r, eval=TRUE}
# è®¾ç½®å‚æ•°
n <- 10000  # æ€»å®éªŒæ¬¡æ•°
p1_hat <- 0.651  # æ–¹æ³•ä¸€çš„åŠŸæ•ˆä¼°è®¡
p2_hat <- 0.676  # æ–¹æ³•äºŒçš„åŠŸæ•ˆä¼°è®¡

# è®¡ç®—æˆåŠŸæ¬¡æ•°
x1 <- n * p1_hat
x2 <- n * p2_hat

# è®¡ç®—åˆå¹¶æˆåŠŸç‡
p_pool <- (x1 + x2) / (2 * n)

# è®¡ç®—æ ‡å‡†è¯¯å·®
SE <- sqrt(p_pool * (1 - p_pool) * (2 / n))

# è®¡ç®— Z ç»Ÿè®¡é‡
z_value <- (p1_hat - p2_hat) / SE

# è®¡ç®—åŒä¾§ P å€¼
p_value <- 2 * pnorm(-abs(z_value))

# è¾“å‡ºç»“æœ
cat("Z ç»Ÿè®¡é‡ =", z_value, "\n")
cat("P å€¼ =", p_value, "\n")
```

### ç»“æœåˆ†æ

è¿è¡Œä¸Šè¿°ä»£ç ï¼Œæ ¹æ®æ‰€å¾—ç»“æœå¯çŸ¥ï¼š

- **Z ç»Ÿè®¡é‡**ä¸º -3.741ï¼Œè¡¨ç¤ºæ–¹æ³•äºŒçš„åŠŸæ•ˆæ˜¾è‘—é«˜äºæ–¹æ³•ä¸€ã€‚
- **P å€¼**ä¸º 0.00018ï¼Œè¿œå°äºæ˜¾è‘—æ€§æ°´å¹³ 0.05ã€‚

**ç»“è®º**ï¼š

- **æ‹’ç»åŸå‡è®¾ Hâ‚€**ï¼šåœ¨æ˜¾è‘—æ€§æ°´å¹³ 0.05 ä¸‹ï¼Œä¸¤ç§æ–¹æ³•çš„åŠŸæ•ˆå­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚
- **è§£é‡Š**ï¼šæ–¹æ³•äºŒçš„åŠŸæ•ˆæ˜¾è‘—é«˜äºæ–¹æ³•ä¸€ã€‚

### å›¾å½¢åˆ†æ

ä¸ºäº†æ›´ç›´è§‚åœ°å±•ç¤ºæ£€éªŒç»“æœï¼Œæˆ‘ä»¬å¯ä»¥ç»˜åˆ¶æ ‡å‡†æ­£æ€åˆ†å¸ƒæ›²çº¿ï¼Œå¹¶æ ‡æ³¨ Z ç»Ÿè®¡é‡çš„ä½ç½®ã€‚

```{r, eval=TRUE}
# ç»˜åˆ¶æ ‡å‡†æ­£æ€åˆ†å¸ƒæ›²çº¿
x_vals <- seq(-5, 5, length = 1000)
y_vals <- dnorm(x_vals)
plot(x_vals, y_vals, type = "l", lwd = 2, col = "blue", main = "æ ‡å‡†æ­£æ€åˆ†å¸ƒ", xlab = "Z å€¼", ylab = "å¯†åº¦")

# æ ‡æ³¨ Z ç»Ÿè®¡é‡ä½ç½®
abline(v = z_value, col = "red", lwd = 2, lty = 2)
abline(v = -z_value, col = "red", lwd = 2, lty = 2)

# æ·»åŠ å›¾ä¾‹
legend("topright", legend = c("Z ç»Ÿè®¡é‡"), col = c("red"), lwd = 2, lty = 2)
```

**å›¾å½¢è¯´æ˜**ï¼š

- è“è‰²æ›²çº¿ä¸ºæ ‡å‡†æ­£æ€åˆ†å¸ƒã€‚
- çº¢è‰²è™šçº¿ä¸ºè®¡ç®—å¾—åˆ°çš„ Z ç»Ÿè®¡é‡ä½ç½®ã€‚
- Z å€¼ä½äºæ›²çº¿çš„å°¾éƒ¨åŒºåŸŸï¼Œå¯¹åº”çš„ P å€¼å¾ˆå°ï¼Œè¿›ä¸€æ­¥æ”¯æŒæˆ‘ä»¬æ‹’ç»åŸå‡è®¾çš„ç»“è®ºã€‚

### è§£æ³•ä¸€ç»“è®º

- **é—®é¢˜ a å›ç­”**ï¼šå¯¹åº”çš„å‡è®¾æ£€éªŒé—®é¢˜æ˜¯æ£€éªŒä¸¤ç§æ–¹æ³•çš„åŠŸæ•ˆæ˜¯å¦ç›¸ç­‰ï¼Œå³ $H_0: p_1 = p_2$ å¯¹æ¯” $H_1: p_1 \neq p_2$ã€‚

- **é—®é¢˜ b å›ç­”**ï¼šæˆ‘ä»¬åº”ä½¿ç”¨**Zæ£€éªŒ**ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æ¯”è¾ƒä¸¤ç»„ç‹¬ç«‹æ ·æœ¬çš„å¤§æ ·æœ¬æ¯”ä¾‹ï¼Œä¸”ç¼ºä¹é…å¯¹æ•°æ®è¿›è¡Œ McNemar æ£€éªŒã€‚

- **é—®é¢˜ c å›ç­”**ï¼šå‡è®¾æ£€éªŒæ‰€éœ€çš„æœ€å°‘å¿…è¦ä¿¡æ¯åŒ…æ‹¬ï¼š

  - æ¯ç§æ–¹æ³•çš„æˆåŠŸæ¬¡æ•°ï¼ˆ$x_1 = 6510$ï¼Œ$x_2 = 6760$ï¼‰ã€‚
  - æ€»æ ·æœ¬é‡ï¼ˆ$n_1 = n_2 = 10000$ï¼‰ã€‚
  - åˆå¹¶æˆåŠŸç‡ï¼ˆ$\hat{p} = 0.6635$ï¼‰ã€‚
  - æ ‡å‡†è¯¯å·®ï¼ˆé€šè¿‡ $SE = \sqrt{\hat{p}(1 - \hat{p})(\frac{1}{n_1} + \frac{1}{n_2})}$ è®¡ç®—ï¼‰ã€‚
  - Z ç»Ÿè®¡é‡å’Œå¯¹åº”çš„ P å€¼ã€‚

**æ€»ä½“è€Œè¨€**ï¼Œé€šè¿‡ Z æ£€éªŒï¼Œæˆ‘ä»¬æœ‰å……åˆ†çš„è¯æ®è¡¨æ˜ä¸¤ç§æ–¹æ³•çš„åŠŸæ•ˆåœ¨ç»Ÿè®¡ä¸Šå­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ–¹æ³•äºŒçš„æ€§èƒ½ä¼˜äºæ–¹æ³•ä¸€ã€‚

---

## é—®é¢˜2 è§£æ³•äºŒ

### é¢˜ç›®å›é¡¾

å·²çŸ¥åœ¨æŸä¸ªæ¨¡æ‹Ÿè®¾å®šä¸‹ï¼Œç»è¿‡ 10000 æ¬¡å®éªŒï¼Œæ–¹æ³•1çš„åŠŸæ•ˆä¸º 0.651ï¼Œæ–¹æ³•2çš„åŠŸæ•ˆä¸º 0.676ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨æ˜¾è‘—æ€§æ°´å¹³ 0.05 ä¸‹ï¼Œåˆ¤æ–­è¿™ä¸¤ä¸ªåŠŸæ•ˆæ˜¯å¦æœ‰æ˜¾è‘—å·®å¼‚ã€‚

### è§£ç­”æ€è·¯

1. **å¯¹åº”çš„å‡è®¾æ£€éªŒé—®é¢˜**

- **åŸå‡è®¾ $H_0$ï¼š** ä¸¤ç§æ–¹æ³•çš„åŠŸæ•ˆæ²¡æœ‰æ˜¾è‘—å·®å¼‚ï¼Œå³ $p_1 = p_2$ã€‚
- **å¤‡æ‹©å‡è®¾ $H_a$ï¼š** ä¸¤ç§æ–¹æ³•çš„åŠŸæ•ˆæœ‰æ˜¾è‘—å·®å¼‚ï¼Œå³ $p_1 \ne p_2$ã€‚

2. **é€‰æ‹©é€‚å½“çš„æ£€éªŒæ–¹æ³•**

- **é€‰æ‹© McNemar æ£€éªŒã€‚**

**åŸå› ï¼š**

- **æ•°æ®æ€§è´¨ï¼š** ä¸¤ç§æ–¹æ³•åœ¨åŒä¸€ç»„å®éªŒï¼ˆ10000 æ¬¡ï¼‰ä¸­è¿›è¡Œï¼Œç»“æœæ˜¯é…å¯¹çš„ï¼ˆç›¸å…³çš„ï¼‰ã€‚
- **æ£€éªŒé€‚ç”¨æ€§ï¼š** McNemar æ£€éªŒé€‚ç”¨äºé…å¯¹äºŒåˆ†ç±»æ•°æ®ï¼Œæ£€éªŒä¸¤ç§æ–¹æ³•çš„æˆåŠŸç‡æ˜¯å¦æœ‰å·®å¼‚ã€‚

3. **æ„å»º 2x2 åˆ—è”è¡¨å¹¶è¿›è¡Œ McNemar æ£€éªŒ**

|                 | æ–¹æ³• B æˆåŠŸ | æ–¹æ³• B å¤±è´¥ | è¡Œåˆè®¡ |
| --------------- | ----------- | ----------- | ------ |
| **æ–¹æ³• A æˆåŠŸ** | a           | b           | a + b  |
| **æ–¹æ³• A å¤±è´¥** | c           | d           | c + d  |
| **åˆ—åˆè®¡**      | a + c       | b + d       | N      |

**åˆ¤æ–­æ˜¾è‘—æ€§**ï¼š

- å°†è®¡ç®—å¾—åˆ°çš„ $\chi^2$ å€¼ä¸è‡ªç”±åº¦ä¸º 1 çš„å¡æ–¹åˆ†å¸ƒä¸´ç•Œå€¼æ¯”è¾ƒï¼›
- å¦‚æœ $\chi^2$ å€¼å¤§äºä¸´ç•Œå€¼ï¼Œåˆ™æ‹’ç»åŸå‡è®¾ã€‚

**ç”±äºæ²¡æœ‰å…·ä½“çš„å®éªŒç»“æœï¼Œæˆ‘ä»¬éœ€è¦æ¨¡æ‹Ÿæ•°æ®ã€‚**

**å‡è®¾ï¼š**

- **æ€»æ ·æœ¬é‡ï¼š** $N = 10000$ã€‚
- **æ–¹æ³•1æ‹’ç»åŸå‡è®¾çš„æ¬¡æ•°ï¼š** $n_1 = 6510$ã€‚
- **æ–¹æ³•2æ‹’ç»åŸå‡è®¾çš„æ¬¡æ•°ï¼š** $n_2 = 6760$ã€‚

**ä¸ºäº†æ„å»º McNemar æ£€éªŒæ‰€éœ€çš„å››æ ¼åˆ—è”è¡¨ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“åœ¨æ¯æ¬¡å®éªŒä¸­ï¼Œä¸¤ç§æ–¹æ³•æ˜¯å¦åŒæ—¶æ‹’ç»æˆ–æ¥å—åŸå‡è®¾ã€‚**

**æ¨¡æ‹Ÿæ­¥éª¤ï¼š**

1. **ç”Ÿæˆæ–¹æ³•1å’Œæ–¹æ³•2çš„æ£€éªŒç»“æœï¼š**

   - å¯¹äºæ¯æ¬¡å®éªŒ $i$ï¼Œç”Ÿæˆæ–¹æ³•1å’Œæ–¹æ³•2çš„æ£€éªŒç»“æœï¼Œç»“æœä¸º0ï¼ˆä¸æ‹’ç»åŸå‡è®¾ï¼‰æˆ–1ï¼ˆæ‹’ç»åŸå‡è®¾ï¼‰ã€‚

2. **æ ¹æ®å·²çŸ¥åŠŸæ•ˆç”Ÿæˆç»“æœï¼š**

   - æ–¹æ³•1çš„æ‹’ç»æ¦‚ç‡ä¸º 0.651ã€‚
   - æ–¹æ³•2çš„æ‹’ç»æ¦‚ç‡ä¸º 0.676ã€‚

3. **è®¡ç®—å››æ ¼è¡¨ä¸­çš„ aã€bã€cã€dï¼š**

   - aï¼šæ–¹æ³•1å’Œæ–¹æ³•2éƒ½æ‹’ç»åŸå‡è®¾çš„æ¬¡æ•°ã€‚
   - bï¼šæ–¹æ³•1æ‹’ç»ï¼Œæ–¹æ³•2ä¸æ‹’ç»çš„æ¬¡æ•°ã€‚
   - cï¼šæ–¹æ³•1ä¸æ‹’ç»ï¼Œæ–¹æ³•2æ‹’ç»çš„æ¬¡æ•°ã€‚
   - dï¼šæ–¹æ³•1å’Œæ–¹æ³•2éƒ½ä¸æ‹’ç»åŸå‡è®¾çš„æ¬¡æ•°ã€‚

### ä»£ç å®ç°

```{r, eval=TRUE}
Sys.setlocale("LC_ALL", "Chinese")  # è®¾ç½®ä¸ºä¸­æ–‡ç¯å¢ƒ

# è®¾ç½®å‚æ•°
N <- 10000  # æ€»å®éªŒæ¬¡æ•°
p1 <- 0.651 # æ–¹æ³•1çš„åŠŸæ•ˆ
p2 <- 0.676 # æ–¹æ³•2çš„åŠŸæ•ˆ

set.seed(104)  # è®¾ç½®éšæœºç§å­ï¼Œä¿è¯ç»“æœå¯é‡å¤

# ç”Ÿæˆæ–¹æ³•1çš„æ£€éªŒç»“æœï¼ˆ0ï¼šä¸æ‹’ç»ï¼Œ1ï¼šæ‹’ç»ï¼‰
result1 <- rbinom(N, size = 1, prob = p1)

# ç”Ÿæˆæ–¹æ³•2çš„æ£€éªŒç»“æœï¼ˆ0ï¼šä¸æ‹’ç»ï¼Œ1ï¼šæ‹’ç»ï¼‰
result2 <- rbinom(N, size = 1, prob = p2)

# æ„å»ºå››æ ¼è¡¨
# aï¼šæ–¹æ³•1æ‹’ç»ï¼Œæ–¹æ³•2æ‹’ç»
a <- sum(result1 == 1 & result2 == 1)

# bï¼šæ–¹æ³•1æ‹’ç»ï¼Œæ–¹æ³•2ä¸æ‹’ç»
b <- sum(result1 == 1 & result2 == 0)

# cï¼šæ–¹æ³•1ä¸æ‹’ç»ï¼Œæ–¹æ³•2æ‹’ç»
c <- sum(result1 == 0 & result2 == 1)

# dï¼šæ–¹æ³•1ä¸æ‹’ç»ï¼Œæ–¹æ³•2ä¸æ‹’ç»
d <- sum(result1 == 0 & result2 == 0)

# æ„å»ºåˆ—è”è¡¨
contingency_table <- matrix(c(a, b, c, d), nrow = 2,
                            dimnames = list("æ–¹æ³•1" = c("æ‹’ç»", "ä¸æ‹’ç»"),
                                            "æ–¹æ³•2" = c("æ‹’ç»", "ä¸æ‹’ç»")))
print("åˆ—è”è¡¨ï¼š")
print(contingency_table)

# è®¡ç®— McNemar æ£€éªŒç»Ÿè®¡é‡
# å¦‚æœ b + c >= 25ï¼Œå¯ä»¥ä½¿ç”¨è¿‘ä¼¼çš„å¡æ–¹åˆ†å¸ƒ
# å¦åˆ™ï¼Œåº”ä½¿ç”¨ç²¾ç¡®çš„äºŒé¡¹æ£€éªŒ
if ((b + c) >= 25) {
  # è¿‘ä¼¼å¡æ–¹æ£€éªŒ
  chi_square <- (abs(b - c) - 1)^2 / (b + c)
  p_value <- 1 - pchisq(chi_square, df = 1)
} else {
  # ç²¾ç¡®äºŒé¡¹æ£€éªŒ
  p_value <- 2 * pbinom(min(b, c), size = b + c, prob = 0.5)
}

cat("McNemar æ£€éªŒç»Ÿè®¡é‡ï¼š", chi_square, "\n")
cat("p å€¼ï¼š", p_value, "\n")
```

### ç»“æœåˆ†æ

**è§£é‡Šï¼š**

- **åˆ—è”è¡¨ï¼š**

  |             | æ–¹æ³•2æ‹’ç» | æ–¹æ³•2ä¸æ‹’ç» |
  | ----------- | --------- | ----------- |
  | æ–¹æ³•1æ‹’ç»   | 4404      | 2342        |
  | æ–¹æ³•1ä¸æ‹’ç» | 2155      | 1099        |

- **è®¡ç®—çš„ McNemar æ£€éªŒç»Ÿè®¡é‡ï¼š** 7.693129

- **å¯¹åº”çš„ p å€¼ï¼š** 0.005543145

**ç»“è®ºï¼š**

- **ç”±äº p å€¼è¿œå°äºæ˜¾è‘—æ€§æ°´å¹³ 0.05ï¼Œæ‹’ç»åŸå‡è®¾ $H_0$ã€‚**
- **è¿™è¡¨æ˜ä¸¤ç§æ–¹æ³•çš„åŠŸæ•ˆå­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚**

### å›¾è¡¨å±•ç¤º

**ï¼ˆ1ï¼‰åˆ—è”è¡¨çš„å¯è§†åŒ–**

```{r, eval=TRUE}
# åŠ è½½ç»˜å›¾åŒ…
library(ggplot2)
library(reshape2)

# å°†å››æ ¼åˆ—è”è¡¨è½¬æ¢ä¸ºæ•°æ®æ¡†
table_df <- as.data.frame.table(contingency_table)
colnames(table_df) <- c("æ–¹æ³•1", "æ–¹æ³•2", "æ¬¡æ•°")

# ç»˜åˆ¶çƒ­åŠ›å›¾
ggplot(table_df, aes(x = æ–¹æ³•2, y = æ–¹æ³•1, fill = æ¬¡æ•°)) +
  geom_tile(color = "white") +
  geom_text(aes(label = æ¬¡æ•°), color = "black", size = 5) +
  scale_fill_gradient(low = "white", high = "steelblue") +
  theme_minimal() +
  ggtitle("åˆ—è”è¡¨çƒ­åŠ›å›¾") + 
  theme(plot.title = element_text(hjust = 0.5))

```

**å›¾ç¤ºè§£é‡Šï¼š**

- **çƒ­åŠ›å›¾å±•ç¤ºäº†å››æ ¼åˆ—è”è¡¨ä¸­æ¯ä¸ªå•å…ƒæ ¼çš„æ¬¡æ•°ã€‚**
- **é¢œè‰²æ·±æµ…ä»£è¡¨æ¬¡æ•°çš„å¤šå°‘ï¼Œæ•°å€¼æ ‡æ³¨åœ¨æ–¹å—ä¸­å¤®ã€‚**

**ï¼ˆ2ï¼‰McNemar æ£€éªŒç»“æœçš„å¯è§†åŒ–**

ç”±äº McNemar æ£€éªŒçš„ç»Ÿè®¡é‡æœä»å¡æ–¹åˆ†å¸ƒï¼ˆè‡ªç”±åº¦ä¸º1ï¼‰ï¼Œå¯ä»¥ç»˜åˆ¶å¡æ–¹åˆ†å¸ƒæ›²çº¿ï¼Œå¹¶æ ‡æ³¨æ£€éªŒç»Ÿè®¡é‡çš„ä½ç½®ã€‚

```{r, eval=TRUE}
# ç»˜åˆ¶å¡æ–¹åˆ†å¸ƒæ›²çº¿
x_vals <- seq(0, 25, by = 0.01)
y_vals <- dchisq(x_vals, df = 1)

plot(x_vals, y_vals, type = "l", lwd = 2, col = "blue",
     xlab = expression(chi^2), ylab = "å¯†åº¦",
     main = "è‡ªç”±åº¦ä¸º1çš„å¡æ–¹åˆ†å¸ƒ")

# æ ‡æ³¨æ£€éªŒç»Ÿè®¡é‡çš„ä½ç½®
abline(v = chi_square, col = "red", lwd = 2, lty = 2)
text(chi_square, max(y_vals)/2, labels = paste("ç»Ÿè®¡é‡ =", round(chi_square, 2)),
     pos = 4, col = "red")

# è®¡ç®—è‡ªç”±åº¦ä¸º1ï¼Œæ˜¾è‘—æ€§æ°´å¹³Î± = 0.05æ—¶çš„å¡æ–¹åˆ†å¸ƒä¸´ç•Œå€¼
critical_value <- qchisq(0.95, df = 1)

# æ ‡æ³¨ä¸´ç•Œå€¼çš„ä½ç½®
abline(v = critical_value, col = "green", lwd = 2, lty = 2)
text(critical_value, max(y_vals)/2, labels = paste("ä¸´ç•Œå€¼ =", round(critical_value, 2)),
     pos = 4, col = "green")

```

**å›¾ç¤ºè§£é‡Šï¼š**

- **è“è‰²æ›²çº¿ï¼š** è‡ªç”±åº¦ä¸º1çš„å¡æ–¹åˆ†å¸ƒå¯†åº¦å‡½æ•°ã€‚
- **çº¢è‰²è™šçº¿ï¼š** æ ‡æ³¨äº†è®¡ç®—å¾—åˆ°çš„æ£€éªŒç»Ÿè®¡é‡çš„ä½ç½®ã€‚
- **ç»¿è‰²è™šçº¿ï¼š** æ ‡æ³¨äº†è‡ªç”±åº¦ä¸º1ï¼Œæ˜¾è‘—æ€§æ°´å¹³Î± = 0.05æ—¶çš„å¡æ–¹åˆ†å¸ƒä¸´ç•Œå€¼ã€‚
- **æ£€éªŒç»Ÿè®¡é‡åœ¨å³ä¾§å°¾éƒ¨åŒºåŸŸï¼Œä¸”æ˜¾è‘—å¤§äºå¡æ–¹åˆ†å¸ƒçš„ä¸´ç•Œå€¼ï¼Œè¯´æ˜å¯¹åº” p å€¼è¿œå°äº 0.05ï¼Œå› æ­¤ï¼Œæœ‰è¶³å¤Ÿç†ç”±æ‹’ç»åŸå‡è®¾ $H_0$ï¼Œæ¥å—å¤‡æ‹©å‡è®¾ $H_1$**

### æ³¨æ„äº‹é¡¹

- **éšæœºæ¨¡æ‹Ÿçš„ç»“æœå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼š**æ¯æ¬¡è¿è¡Œä»£ç ç”Ÿæˆçš„å››æ ¼åˆ—è”è¡¨å’Œæ£€éªŒç»Ÿè®¡é‡å¯èƒ½ä¼šç•¥æœ‰å·®å¼‚ï¼Œä½†æ€»ä½“ç»“è®ºåº”ä¿æŒä¸€è‡´ã€‚
- **McNemar æ£€éªŒçš„è¿‘ä¼¼æ¡ä»¶ï¼š** å½“ $b + c \geq 25$ æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿‘ä¼¼çš„å¡æ–¹æ£€éªŒï¼Œå¦åˆ™åº”ä½¿ç”¨ç²¾ç¡®çš„äºŒé¡¹æ£€éªŒã€‚
- **å‡è®¾çš„åˆç†æ€§ï¼š** ç”±äºæ˜¯åŸºäºå·²çŸ¥çš„åŠŸæ•ˆå€¼æ¨¡æ‹Ÿæ•°æ®ï¼Œå‡è®¾ä¸¤ç§æ–¹æ³•çš„æ£€éªŒç»“æœæ˜¯ç‹¬ç«‹çš„ã€‚ä½†åœ¨å®é™…æƒ…å†µä¸­ï¼Œæ£€éªŒç»“æœå¯èƒ½å­˜åœ¨ç›¸å…³æ€§ã€‚

### è§£æ³•äºŒç»“è®º

- **é€šè¿‡æ¨¡æ‹Ÿæ•°æ®å¹¶è¿›è¡Œ McNemar æ£€éªŒï¼Œå¾—å‡ºä¸¤ç§æ–¹æ³•çš„åŠŸæ•ˆæœ‰æ˜¾è‘—å·®å¼‚çš„ç»“è®ºã€‚**
- **æ–¹æ³•2çš„åŠŸæ•ˆæ˜¾è‘—é«˜äºæ–¹æ³•1ã€‚**

---

# æ€»ç»“

## å›°éš¾ä¸è§£å†³æ–¹å¼

åœ¨å®Œæˆæœ¬æ¬¡å®éªŒæŠ¥å‘Šçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘é‡åˆ°äº†è¯¸å¤šæŒ‘æˆ˜ï¼Œå°¤å…¶æ˜¯åœ¨è’™ç‰¹å¡ç½—æ¨¡æ‹Ÿå’Œå‡è®¾æ£€éªŒæ–¹æ³•çš„åº”ç”¨ä¸Šã€‚

é¦–å…ˆï¼Œ**ç»ƒä¹ 6.6**è¦æ±‚é€šè¿‡è’™ç‰¹å¡ç½—å®éªŒä¼°è®¡ååº¦ç»Ÿè®¡é‡$\sqrt{b_{1}}$çš„ç‰¹å®šåˆ†ä½æ•°ï¼Œå¹¶ä¸å¤§æ ·æœ¬æ­£æ€è¿‘ä¼¼ç»“æœè¿›è¡Œæ¯”è¾ƒã€‚ç”±äºååº¦ç»Ÿè®¡é‡çš„è®¡ç®—æ¶‰åŠåˆ°æ ·æœ¬çš„é«˜é˜¶ä¸­å¿ƒçŸ©ï¼Œè¿™ä½¿å¾—ç¼–å†™é«˜æ•ˆä¸”å‡†ç¡®çš„æ¨¡æ‹Ÿä»£ç æˆä¸ºä¸€å¤§éš¾é¢˜ã€‚åœ¨åˆæ¬¡å°è¯•ä¸­ï¼Œç”±äºå¯¹ååº¦çš„ç†è§£ä¸å¤Ÿæ·±å…¥ï¼Œå¯¼è‡´æ¨¡æ‹Ÿç»“æœä¸ç†è®ºé¢„æœŸå­˜åœ¨è¾ƒå¤§åå·®ã€‚é€šè¿‡æŸ¥é˜…ç›¸å…³æ–‡çŒ®å’Œåå¤è°ƒè¯•ä»£ç ï¼Œæˆ‘é€æ­¥æŒæ¡äº†ååº¦ç»Ÿè®¡é‡çš„è®¡ç®—æ–¹æ³•ï¼Œå¹¶ä¼˜åŒ–äº†æ¨¡æ‹Ÿè¿‡ç¨‹ä¸­çš„æ•°æ®ç”Ÿæˆä¸ç»Ÿè®¡é‡è®¡ç®—æ­¥éª¤ï¼Œæœ€ç»ˆå¾—åˆ°äº†ä¸ç†è®ºç›¸ç¬¦çš„ç»“æœã€‚

**ç»ƒä¹ 6.B**åˆ™æ¶‰åŠåˆ°ä¸åŒç›¸å…³æ€§æ£€éªŒæ–¹æ³•çš„åŠŸæ•ˆæ¯”è¾ƒã€‚åœ¨æ¨¡æ‹ŸåŒå˜é‡æ­£æ€åˆ†å¸ƒä¸‹çš„æ£€éªŒåŠŸæ•ˆæ—¶ï¼Œæˆ‘å‘ç°ç†è§£ä¸åŒæ£€éªŒæ–¹æ³•åœ¨ç‰¹å®šåˆ†å¸ƒä¸‹çš„è¡¨ç°å·®å¼‚å¹¶ä¸ç›´è§‚ã€‚ç‰¹åˆ«æ˜¯å¦‚ä½•æ„å»ºåˆé€‚çš„åŒå˜é‡åˆ†å¸ƒä»¥å±•ç¤ºéå‚æ•°æ£€éªŒåœ¨æŸäº›æƒ…å†µä¸‹ä¼˜äºPearsonæ£€éªŒï¼Œè¿™éœ€è¦å¯¹ç»Ÿè®¡æ£€éªŒçš„ç†è®ºåŸºç¡€æœ‰æ·±å…¥çš„ç†è§£ã€‚é€šè¿‡å¤šæ¬¡æ¨¡æ‹Ÿå®éªŒå’Œå¯¹æ¯”åˆ†æï¼Œæˆ‘é€æ­¥ç†è§£äº†ä¸åŒæ£€éªŒæ–¹æ³•åœ¨é¢å¯¹çº¿æ€§ä¸éçº¿æ€§å…³ç³»æ—¶çš„ä¼˜åŠ¿ä¸å±€é™ï¼Œå¹¶æˆåŠŸæ‰¾åˆ°äº†é€‚åˆçš„åŒå˜é‡åˆ†å¸ƒç¤ºä¾‹æ¥éªŒè¯é¢˜ç›®è¦æ±‚ã€‚

åœ¨**é—®é¢˜2**ä¸­ï¼Œå¦‚ä½•é€‰æ‹©åˆé€‚çš„å‡è®¾æ£€éªŒæ–¹æ³•ä¹Ÿæ˜¯ä¸€å¤§æŒ‘æˆ˜ã€‚é¢˜ç›®è¦æ±‚åœ¨ä¸¤ç§æ–¹æ³•çš„åŠŸæ•ˆæ¯”è¾ƒä¸­ï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚åˆæ­¥åˆ†ææ—¶ï¼Œæˆ‘å¯¹äºæ˜¯å¦åº”é€‰æ‹©Zæ£€éªŒæˆ–McNemaræ£€éªŒå­˜åœ¨ç–‘æƒ‘ã€‚é€šè¿‡æ·±å…¥å­¦ä¹ å‡è®¾æ£€éªŒçš„åŸºæœ¬åŸç†å’Œé€‚ç”¨æ¡ä»¶ï¼Œç»“åˆå®é™…é—®é¢˜çš„ç‰¹ç‚¹ï¼Œæˆ‘æœ€ç»ˆç¡®å®šäº†ä½¿ç”¨Zæ£€éªŒå’ŒMcNemaræ£€éªŒä¸¤ç§ä¸åŒçš„æ–¹æ³•ï¼Œå¹¶é€šè¿‡æ¨¡æ‹Ÿæ•°æ®éªŒè¯äº†å„è‡ªçš„é€‚ç”¨æ€§å’Œæ£€éªŒç»“æœçš„åˆç†æ€§ã€‚

## æ€è€ƒä¸æ„Ÿæ‚Ÿ

æ­¤æ¬¡å®éªŒçš„å®Œæˆä¸ä»…è®©æˆ‘æ·±å…¥ç†è§£äº†ç»Ÿè®¡è®¡ç®—ä¸å‡è®¾æ£€éªŒçš„å…·ä½“åº”ç”¨ï¼Œæ›´è®©æˆ‘å¯¹ç»Ÿè®¡å­¦åœ¨å®é™…é—®é¢˜ä¸­çš„é‡è¦æ€§æœ‰äº†æ›´æ·±åˆ»çš„è®¤è¯†ã€‚é€šè¿‡è’™ç‰¹å¡ç½—æ¨¡æ‹Ÿï¼Œæˆ‘ä½“ä¼šåˆ°äº†ç»Ÿè®¡ç†è®ºåœ¨å®é™…ä¸­çš„å…·ä½“å®ç°è¿‡ç¨‹ï¼Œç†è§£äº†å¤§æ ·æœ¬è¿‘ä¼¼ä¸å®é™…åˆ†å¸ƒä¹‹é—´çš„å…³ç³»ä¸å·®å¼‚ã€‚è¿™ç§ä»ç†è®ºåˆ°å®è·µçš„è½¬åŒ–è¿‡ç¨‹ï¼Œæå¤§åœ°æå‡äº†æˆ‘å¯¹ç»Ÿè®¡æ¨¡å‹çš„ç›´è§‚ç†è§£ã€‚

åœ¨æ¯”è¾ƒä¸åŒç›¸å…³æ€§æ£€éªŒæ–¹æ³•çš„åŠŸæ•ˆæ—¶ï¼Œæˆ‘æ·±åˆ»ä½“ä¼šåˆ°é€‰æ‹©åˆé€‚çš„ç»Ÿè®¡æ–¹æ³•å¯¹äºç ”ç©¶ç»“æœçš„é‡è¦æ€§ã€‚ä¸åŒçš„æ£€éªŒæ–¹æ³•åœ¨é¢å¯¹ä¸åŒçš„æ•°æ®åˆ†å¸ƒå’Œå…³ç³»å½¢å¼æ—¶ï¼Œè¡¨ç°å‡ºä¸åŒçš„æ•æ„Ÿæ€§å’Œæ•ˆèƒ½ã€‚è¿™ä¸ä»…æé†’æˆ‘åœ¨å®é™…å·¥ä½œä¸­éœ€è¦æ ¹æ®æ•°æ®çš„ç‰¹æ€§å’Œç ”ç©¶é—®é¢˜çš„éœ€æ±‚ï¼Œçµæ´»é€‰æ‹©åˆé€‚çš„ç»Ÿè®¡å·¥å…·ï¼Œè¿˜è®©æˆ‘æ„è¯†åˆ°ç»Ÿè®¡æ–¹æ³•çš„é€‰æ‹©å¯¹ç ”ç©¶ç»“è®ºçš„å¯é æ€§å’Œæœ‰æ•ˆæ€§å…·æœ‰å†³å®šæ€§çš„å½±å“ã€‚

æ­¤å¤–ï¼Œé€šè¿‡å¯¹å‡è®¾æ£€éªŒé—®é¢˜çš„æ·±å…¥æ¢è®¨ï¼Œæˆ‘æ›´åŠ ç†è§£äº†ç»Ÿè®¡æ˜¾è‘—æ€§ä¸å®é™…æ„ä¹‰ä¹‹é—´çš„å…³ç³»ã€‚åœ¨æ¨¡æ‹Ÿå®éªŒä¸­ï¼Œä¸åŒæ£€éªŒæ–¹æ³•çš„åŠŸæ•ˆå·®å¼‚ä¸ä»…åæ˜ äº†ç»Ÿè®¡æ–¹æ³•æœ¬èº«çš„ç‰¹ç‚¹ï¼Œä¹Ÿæé†’æˆ‘ä»¬åœ¨è¿›è¡Œç»Ÿè®¡åˆ†ææ—¶ï¼Œéœ€å…¨é¢è€ƒè™‘æ•°æ®çš„ç”Ÿæˆè¿‡ç¨‹å’Œæ½œåœ¨çš„åˆ†å¸ƒç‰¹æ€§ï¼Œé¿å…å› æ–¹æ³•é€‰æ‹©ä¸å½“è€Œå¯¼è‡´ç»“è®ºåé¢‡ã€‚

æœ€é‡è¦çš„æ˜¯ï¼Œè¿™æ¬¡å®éªŒè®©æˆ‘æ„è¯†åˆ°ç»Ÿè®¡å­¦ä¸ä»…ä»…æ˜¯æ¯ç‡¥çš„å…¬å¼å’Œè®¡ç®—ï¼Œæ›´æ˜¯ä¸€é—¨ç»“åˆç†è®ºä¸å®è·µã€é€»è¾‘ä¸åˆ›é€ çš„ç§‘å­¦ã€‚æ¯ä¸€ä¸ªç»Ÿè®¡é—®é¢˜çš„è§£å†³ï¼Œéƒ½éœ€è¦æˆ‘ä»¬å…·å¤‡æ‰å®çš„ç†è®ºåŸºç¡€ã€çµæ´»çš„æ€ç»´æ–¹å¼å’Œä¸¥è°¨çš„å®è·µæ€åº¦ã€‚


---

# ç»Ÿè®¡è®¡ç®—è¯¾å ‚ä½œä¸š { .center-title }

ä»¥ä¸‹æ˜¯ç»Ÿè®¡è®¡ç®—2024-10-14è¯¾ç¨‹è¯¾é—´20åˆ†é’Ÿå®Œæˆçš„è¯¾å ‚ä½œä¸š

# Question

* Class work 

    + Use the bootstrap method (R = 10000) to calculate the sample mean difference for comparing the following two independent samples:
```{r, eval=TRUE}
    d1 <- c(-2.961, 0.478, -0.391, -0.869, -0.460, 
            -0.937, 0.779, -1.409, 0.027, -1.569);
    d2  <- c(1.608, 1.009,  0.878,  1.600, -0.263,  
             0.680, 2.280,  2.390, 1.793,  8.091, 1.468)
```
    + The outputs should include original statistic, sample standard error, and bootstrap standard error.

# Answer

**ä½¿ç”¨Bootstrapæ–¹æ³•è®¡ç®—ä¸¤ä¸ªç‹¬ç«‹æ ·æœ¬çš„å‡å€¼å·®å¼‚**

ä¸¤ä¸ªç‹¬ç«‹çš„æ ·æœ¬æ•°æ®é›†ï¼š

```{r, eval=TRUE}
d1 <- c(-2.961, 0.478, -0.391, -0.869, -0.460, -0.937, 0.779, -1.409, 0.027, -1.569)
d2 <- c(1.608, 1.009, 0.878, 1.600, -0.263, 0.680, 2.280, 2.390, 1.793, 8.091, 1.468)
```

ç›®æ ‡æ˜¯ï¼š

1. è®¡ç®—åŸå§‹æ ·æœ¬çš„å‡å€¼å·®å¼‚ï¼›
2. è®¡ç®—æ ·æœ¬æ ‡å‡†è¯¯å·®ï¼›
3. ä½¿ç”¨Bootstrapæ–¹æ³•ï¼ˆé‡å¤æŠ½æ ·R=10000æ¬¡ï¼‰è®¡ç®—å‡å€¼å·®å¼‚çš„Bootstrapæ ‡å‡†è¯¯å·®ã€‚


## 1. è®¡ç®—åŸå§‹æ ·æœ¬çš„å‡å€¼å·®å¼‚

è®¡ç®—ä¸¤ä¸ªæ ·æœ¬çš„å‡å€¼ï¼Œç„¶åæ±‚å·®å¼‚ã€‚

```{r, eval=TRUE}
# è®¡ç®—æ ·æœ¬d1çš„å‡å€¼
mean_d1 <- mean(d1)

# è®¡ç®—æ ·æœ¬d2çš„å‡å€¼
mean_d2 <- mean(d2)

# è®¡ç®—å‡å€¼å·®å¼‚ï¼ˆd1å‡å€¼ - d2å‡å€¼ï¼‰
mean_diff <- mean_d1 - mean_d2

# è¾“å‡ºç»“æœ
cat("æ ·æœ¬d1çš„å‡å€¼ä¸ºï¼š", mean_d1, "\n")
cat("æ ·æœ¬d2çš„å‡å€¼ä¸ºï¼š", mean_d2, "\n")
cat("åŸå§‹æ ·æœ¬çš„å‡å€¼å·®å¼‚ä¸ºï¼š", mean_diff, "\n")
```

---

## 2. è®¡ç®—æ ·æœ¬æ ‡å‡†è¯¯å·®

æ ‡å‡†è¯¯å·®ç”¨äºè¡¡é‡æ ·æœ¬å‡å€¼çš„å˜å¼‚æ€§ã€‚å¯¹äºä¸¤ä¸ªç‹¬ç«‹æ ·æœ¬ï¼Œå‡å€¼å·®å¼‚çš„æ ‡å‡†è¯¯å·®å¯ä»¥é€šè¿‡ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼š

$$
SE = \sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}}
$$

å…¶ä¸­ï¼Œ$s_1^2$ å’Œ$s_2^2$ åˆ†åˆ«æ˜¯ä¸¤ä¸ªæ ·æœ¬çš„æ–¹å·®ï¼Œ$n_1$ å’Œ $n_2$ åˆ†åˆ«æ˜¯æ ·æœ¬å¤§å°ã€‚

```{r, eval=TRUE}
# è®¡ç®—æ ·æœ¬d1çš„æ–¹å·®å’Œå¤§å°
var_d1 <- var(d1)
n1 <- length(d1)

# è®¡ç®—æ ·æœ¬d2çš„æ–¹å·®å’Œå¤§å°
var_d2 <- var(d2)
n2 <- length(d2)

# è®¡ç®—æ ‡å‡†è¯¯å·®
SE <- sqrt(var_d1 / n1 + var_d2 / n2)

# è¾“å‡ºç»“æœ
cat("å‡å€¼å·®å¼‚çš„æ ·æœ¬æ ‡å‡†è¯¯å·®ä¸ºï¼š", SE, "\n")
```



---

## 3. ä½¿ç”¨Bootstrapæ–¹æ³•è®¡ç®—Bootstrapæ ‡å‡†è¯¯å·®

Bootstrapæ–¹æ³•é€šè¿‡å¯¹åŸå§‹æ•°æ®è¿›è¡Œæœ‰æ”¾å›çš„é‡å¤æŠ½æ ·ï¼Œä¼°è®¡ç»Ÿè®¡é‡çš„åˆ†å¸ƒï¼Œä»è€Œè®¡ç®—æ ‡å‡†è¯¯å·®ã€‚

**æ­¥éª¤ï¼š**

1. è®¾ç½®é‡å¤æŠ½æ ·æ¬¡æ•° \( R = 10000 \)ï¼›
2. åˆå§‹åŒ–ä¸€ä¸ªå‘é‡ç”¨äºå­˜å‚¨æ¯æ¬¡Bootstrapçš„å‡å€¼å·®å¼‚ï¼›
3. è¿›è¡Œ \( R \) æ¬¡é‡å¤æŠ½æ ·ï¼š
   - å¯¹æ ·æœ¬ \( d1 \) å’Œ \( d2 \) åˆ†åˆ«è¿›è¡Œæœ‰æ”¾å›çš„æŠ½æ ·ï¼Œå¾—åˆ° \( d1^* \) å’Œ \( d2^* \)ï¼›
   - è®¡ç®— \( d1^* \) å’Œ \( d2^* \) çš„å‡å€¼å·®å¼‚ï¼›
   - å°†å‡å€¼å·®å¼‚å­˜å‚¨åˆ°å‘é‡ä¸­ï¼›
4. è®¡ç®—Bootstrapæ ‡å‡†è¯¯å·®ï¼Œå³å‡å€¼å·®å¼‚çš„æ ‡å‡†å·®ã€‚

```{r, eval=TRUE}
# è®¾ç½®é‡å¤æŠ½æ ·æ¬¡æ•°
R <- 10000

# åˆå§‹åŒ–å‘é‡ç”¨äºå­˜å‚¨å‡å€¼å·®å¼‚
boot_diff <- numeric(R)

# è®¾ç½®éšæœºæ•°ç§å­ä»¥ä¿è¯ç»“æœå¯é‡å¤
set.seed(123)

# å¼€å§‹BootstrapæŠ½æ ·
for (i in 1:R) {
  # å¯¹d1å’Œd2è¿›è¡Œæœ‰æ”¾å›çš„æŠ½æ ·
  boot_d1 <- sample(d1, size = n1, replace = TRUE)
  boot_d2 <- sample(d2, size = n2, replace = TRUE)
  
  # è®¡ç®—æŠ½æ ·åçš„å‡å€¼å·®å¼‚
  boot_diff[i] <- mean(boot_d1) - mean(boot_d2)
}

# è®¡ç®—Bootstrapæ ‡å‡†è¯¯å·®
boot_SE <- sd(boot_diff)

# è¾“å‡ºç»“æœ
cat("å‡å€¼å·®å¼‚çš„Bootstrapæ ‡å‡†è¯¯å·®ä¸ºï¼š", boot_SE, "\n")
```


---

# æ€»ç»“

- **åŸå§‹æ ·æœ¬çš„å‡å€¼å·®å¼‚ï¼š** $-2.688836$
- **å‡å€¼å·®å¼‚çš„æ ·æœ¬æ ‡å‡†è¯¯å·®ï¼š** $0.7393791$
- **å‡å€¼å·®å¼‚çš„Bootstrapæ ‡å‡†è¯¯å·®ï¼š** $0.7139026$

é€šè¿‡æ¯”è¾ƒæ ·æœ¬æ ‡å‡†è¯¯å·®å’ŒBootstrapæ ‡å‡†è¯¯å·®ï¼Œå¯ä»¥å‘ç°ä¸¤è€…éå¸¸æ¥è¿‘ï¼Œè¿™è¡¨æ˜Bootstrapæ–¹æ³•æä¾›äº†å‡å€¼å·®å¼‚æ ‡å‡†è¯¯å·®çš„ä¸€ä¸ªå¯é ä¼°è®¡ã€‚

---

**å®Œæ•´çš„Rä»£ç ï¼š**

```{r, eval=TRUE}
# åŸå§‹æ•°æ®
d1 <- c(-2.961, 0.478, -0.391, -0.869, -0.460, -0.937, 0.779, -1.409, 0.027, -1.569)
d2 <- c(1.608, 1.009, 0.878, 1.600, -0.263, 0.680, 2.280, 2.390, 1.793, 8.091, 1.468)

# 1. è®¡ç®—åŸå§‹æ ·æœ¬çš„å‡å€¼å·®å¼‚
mean_d1 <- mean(d1)
mean_d2 <- mean(d2)
mean_diff <- mean_d1 - mean_d2
cat("æ ·æœ¬d1çš„å‡å€¼ä¸ºï¼š", mean_d1, "\n")
cat("æ ·æœ¬d2çš„å‡å€¼ä¸ºï¼š", mean_d2, "\n")
cat("åŸå§‹æ ·æœ¬çš„å‡å€¼å·®å¼‚ä¸ºï¼š", mean_diff, "\n")

# 2. è®¡ç®—æ ·æœ¬æ ‡å‡†è¯¯å·®
var_d1 <- var(d1)
n1 <- length(d1)
var_d2 <- var(d2)
n2 <- length(d2)
SE <- sqrt(var_d1 / n1 + var_d2 / n2)
cat("å‡å€¼å·®å¼‚çš„æ ·æœ¬æ ‡å‡†è¯¯å·®ä¸ºï¼š", SE, "\n")

# 3. ä½¿ç”¨Bootstrapæ–¹æ³•è®¡ç®—Bootstrapæ ‡å‡†è¯¯å·®
R <- 10000
boot_diff <- numeric(R)
set.seed(123)
for (i in 1:R) {
  boot_d1 <- sample(d1, size = n1, replace = TRUE)
  boot_d2 <- sample(d2, size = n2, replace = TRUE)
  boot_diff[i] <- mean(boot_d1) - mean(boot_d2)
}
boot_SE <- sd(boot_diff)
cat("å‡å€¼å·®å¼‚çš„Bootstrapæ ‡å‡†è¯¯å·®ä¸ºï¼š", boot_SE, "\n")
```

---

**ä»£ç æ¦‚è¿°ï¼š**

- **`mean()`å‡½æ•°**ï¼šè®¡ç®—å‘é‡çš„å‡å€¼ã€‚
- **`var()`å‡½æ•°**ï¼šè®¡ç®—å‘é‡çš„æ ·æœ¬æ–¹å·®ã€‚
- **`length()`å‡½æ•°**ï¼šè·å–å‘é‡çš„é•¿åº¦ï¼Œå³æ ·æœ¬å¤§å°ã€‚
- **`sample()`å‡½æ•°**ï¼šä»å‘é‡ä¸­æŠ½æ ·ï¼Œ`replace = TRUE`è¡¨ç¤ºæœ‰æ”¾å›æŠ½æ ·ã€‚
- **`set.seed()`å‡½æ•°**ï¼šè®¾ç½®éšæœºæ•°ç§å­ï¼Œä¿è¯ç»“æœçš„å¯é‡å¤æ€§ã€‚
- **`sd()`å‡½æ•°**ï¼šè®¡ç®—å‘é‡çš„æ ‡å‡†å·®ï¼Œè¿™é‡Œç”¨äºè®¡ç®—Bootstrapå‡å€¼å·®å¼‚çš„æ ‡å‡†è¯¯å·®ã€‚

---

# ç»Ÿè®¡è®¡ç®—ç¬¬5æ¬¡ä½œä¸š { .center-title }

ä»¥ä¸‹æ˜¯ç»Ÿè®¡è®¡ç®—2024-10-14è¯¾ç¨‹å¯¹åº”çš„ä½œä¸š

# Question

## Question 1

Of $N=1000$ hypotheses, $950$ are null and $50$ are alternative. The p-value under any null hypothesis is uniformly distributed (use runif), and the p-value under any alternative hypothesis follows the beta distribution with parameter $0.1$ and $1$ (use rbeta). Obtain Bonferroni adjusted p-values and B-H adjusted p-values. Calculate FWER, FDR, and TPR under nominal level $Î±=0.1$ for each of the two adjustment methods based on $m=10000$ simulation replicates. You should output the $6$ numbers($3Ã—2$) to a $3Ã—2$ table (column names: Bonferroni correction, B-Hcorrection; row names: FWER, FDR, TPR). Comment the results.

## Question 2

Exercises 7.4-7.5 (pages 212, Statistical Computating with R).

  * __Exercise 7.4__  Refer to the air-conditioning data set $aircondit$ provided in the boot package. The $12$ observations are the times in hours between failures of air-conditioning equipment [63, Example 1.1]ï¼š
$$3, 5, 7, 18, 43, 85, 91, 98, 100, 130, 230, 487.$$
Assume that the times between failures follow an exponential model $Exp(Î»)$. Obtain the $MLE$ of the hazard rate $Î»$ and use bootstrap to estimate the bias and standard error of the estimate.

  * __Exercise 7.5__  Refer to Exercise 7.4. Compute $95\%$ bootstrap conï¬dence intervals for the mean time between failures $1/Î»$ by the standard normal, basic, percentile, and $BCa$ methods. Compare the intervals and explain why they may diï¬€er.

# Answer

## é—®é¢˜1

### é¢˜ç›®æè¿°

å…±æœ‰ $N=1000$ ä¸ªå‡è®¾ï¼Œå…¶ä¸­ $950$ ä¸ªæ˜¯åŸå‡è®¾ï¼ˆ$H_0$ï¼‰ï¼Œ$50$ ä¸ªæ˜¯å¤‡æ‹©å‡è®¾ï¼ˆ$H_1$ï¼‰ã€‚å¯¹äºä»»æ„åŸå‡è®¾ï¼Œå…¶ p å€¼æœä»å‡åŒ€åˆ†å¸ƒï¼ˆä½¿ç”¨ `runif` ç”Ÿæˆï¼‰ï¼›å¯¹äºä»»æ„å¤‡æ‹©å‡è®¾ï¼Œå…¶ p å€¼æœä»å‚æ•°ä¸º$(0.1, 1)$çš„ Beta åˆ†å¸ƒï¼ˆä½¿ç”¨ `rbeta` ç”Ÿæˆï¼‰ã€‚è®¡ç®— Bonferroni æ ¡æ­£åçš„ p å€¼å’Œ Benjamini-Hochberg (B-H) æ ¡æ­£åçš„ p å€¼ã€‚

åœ¨æ˜¾è‘—æ€§æ°´å¹³ $Î±=0.1$ çš„æ¡ä»¶ä¸‹ï¼Œé€šè¿‡ $m=10000$ æ¬¡æ¨¡æ‹Ÿé‡å¤è®¡ç®—æ¯ç§æ ¡æ­£æ–¹æ³•ä¸‹çš„ FWERï¼ˆå®¶æ—é”™è¯¯ç‡ï¼‰ã€FDRï¼ˆé”™è¯¯å‘ç°ç‡ï¼‰å’Œ TPRï¼ˆçœŸé˜³æ€§ç‡ï¼‰ã€‚å°† 6 ä¸ªç»“æœæ•°å€¼ï¼ˆ$3*2$ï¼‰è¾“å‡ºåˆ°ä¸€ä¸ª $3Ã—2$ çš„è¡¨æ ¼ä¸­ï¼ˆåˆ—åï¼šBonferroni æ ¡æ­£, B-H æ ¡æ­£ï¼›è¡Œåï¼šFWER, FDR, TPRï¼‰ã€‚æœ€åå¯¹ç»“æœè¿›è¡Œåˆ†æè®¨è®ºã€‚

### è§£ç­”æ€è·¯

1. **ç†è®ºèƒŒæ™¯**

   - åœ¨å‡è®¾æ£€éªŒä¸­ï¼Œé€šå¸¸åŒæ—¶è¿›è¡Œå¤šä¸ªæ£€éªŒï¼Œè€Œæ¯ä¸ªæ£€éªŒéƒ½æœ‰å¯èƒ½çŠ¯ä¸‹ç¬¬ä¸€ç±»é”™è¯¯ï¼ˆå³é”™åˆ¤åŸå‡è®¾ä¸ºå‡ï¼‰ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé€šå¸¸éœ€è¦åº”ç”¨å¤šé‡æ£€éªŒæ ¡æ­£æ–¹æ³•ã€‚åœ¨æœ¬é¢˜ä¸­ï¼Œå‡è®¾çš„æ€»æ•°ä¸º $N=1000$ï¼Œå…¶ä¸­ $950$ ä¸ªæ˜¯åŸå‡è®¾ï¼ˆ$H_0$ï¼‰ï¼Œ$50$ ä¸ªæ˜¯å¤‡æ‹©å‡è®¾ï¼ˆ$H_1$ï¼‰ã€‚

     - **åŸå‡è®¾ï¼ˆ$H_0$ï¼‰çš„ p å€¼åˆ†å¸ƒï¼š**  
  å½“åŸå‡è®¾ä¸ºçœŸæ—¶ï¼Œp å€¼æœä» $U(0, 1)$ å‡åŒ€åˆ†å¸ƒã€‚è¡¨ç¤ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œp å€¼éšæœºå‡åŒ€åœ°åˆ†å¸ƒåœ¨åŒºé—´ $[0, 1]$ å†…ã€‚

     - **å¤‡æ‹©å‡è®¾ï¼ˆ$H_1$ï¼‰çš„ p å€¼åˆ†å¸ƒï¼š**  
  å½“å¤‡æ‹©å‡è®¾ä¸ºçœŸæ—¶ï¼Œp å€¼çš„åˆ†å¸ƒä¸å†å‡åŒ€ã€‚å–å†³äºæ£€éªŒçš„ç»Ÿè®¡åŠ›ï¼Œp å€¼æ›´æœ‰å¯èƒ½é›†ä¸­åœ¨è¾ƒå°çš„æ•°å€¼åŒºåŸŸã€‚ä¸ºæ¨¡æ‹Ÿè¿™ç§æƒ…å†µï¼Œä½¿ç”¨å‚æ•°ä¸º $(0.1, 1)$ çš„ Beta åˆ†å¸ƒï¼Œè¯¥åˆ†å¸ƒçš„å¯†åº¦åœ¨é è¿‘ 0 çš„åœ°æ–¹è¾ƒé«˜ï¼Œæ„å‘³ç€å¤‡æ‹©å‡è®¾ä¸‹è¾ƒå°çš„ p å€¼æ›´å¯èƒ½å‡ºç°ï¼Œå‘ç°æ˜¾è‘—æ€§æ›´å®¹æ˜“ã€‚

2. **å¤šé‡æ£€éªŒæ ¡æ­£æ–¹æ³•**

   - åœ¨å¤šé‡å‡è®¾æ£€éªŒçš„åœºæ™¯ä¸­ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨å¸¸è§„æ˜¾è‘—æ€§æ°´å¹³ï¼ˆå¦‚ $Î± = 0.1$ï¼‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¿‡å¤šçš„é”™è¯¯å‘ç°ã€‚ä¸ºé¿å…è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦è¿›è¡Œæ ¡æ­£ã€‚

    - **Bonferroni æ ¡æ­£ï¼š**  
  Bonferroni æ ¡æ­£æ˜¯ä¸€ç§æ§åˆ¶å®¶æ—é”™è¯¯ç‡ï¼ˆFWERï¼‰çš„ä¸¥æ ¼æ–¹æ³•ã€‚å®ƒé€šè¿‡å°†æ˜¾è‘—æ€§æ°´å¹³ $\alpha$ é™¤ä»¥æ£€éªŒæ¬¡æ•° $N$ï¼Œå°†æ¯ä¸ªå•ç‹¬æ£€éªŒçš„æ˜¾è‘—æ€§æ°´å¹³è°ƒæ•´ä¸º $\alpha / N$ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ $\alpha = 0.1$ ä¸” $N=1000$ï¼Œåˆ™æ¯ä¸ªæ£€éªŒçš„æ˜¾è‘—æ€§æ°´å¹³ä¸º $0.1/1000 = 0.0001$ã€‚Bonferroni æ ¡æ­£çš„æ‹’ç»å‡†åˆ™ä¸ºï¼š
  $$
  p_i < \frac{\alpha}{N}
  $$
  è¿™ç§æ ¡æ­£æ–¹æ³•éå¸¸ä¸¥æ ¼åœ°æ§åˆ¶ç¬¬ä¸€ç±»é”™è¯¯ï¼Œä½†å¯èƒ½ä¼šæ˜¾è‘—é™ä½ç»Ÿè®¡åŠŸæ•ˆï¼Œå³å®¹æ˜“å¯¼è‡´å‡é˜´æ€§ã€‚

    - **Benjamini-Hochberg (B-H) æ ¡æ­£ï¼š**  
  B-H æ ¡æ­£æ—¨åœ¨æ§åˆ¶é”™è¯¯å‘ç°ç‡ï¼ˆFDRï¼‰ï¼Œè€Œä¸æ˜¯åƒ Bonferroni é‚£æ ·ä¸¥æ ¼æ§åˆ¶å®¶æ—é”™è¯¯ç‡ã€‚B-H æ ¡æ­£å¯¹ p å€¼è¿›è¡Œæ’åºï¼Œå¹¶æ ¹æ®æ’åºåçš„ p å€¼ä¸è°ƒæ•´åçš„æ˜¾è‘—æ€§æ°´å¹³è¿›è¡Œæ¯”è¾ƒï¼Œæ‹’ç»é‚£äº› p å€¼æ»¡è¶³ï¼š
  $$
  p_{(i)} \leq \frac{i}{N} \alpha
  $$
  å…¶ä¸­ $p_{(i)}$ æ˜¯æ’åºåçš„ç¬¬ $i$ ä¸ª p å€¼ï¼Œ$N$ æ˜¯æ€»æ£€éªŒæ•°ï¼Œ$\alpha$ æ˜¯æ˜¾è‘—æ€§æ°´å¹³ã€‚è¿™ç§æ–¹æ³•ç›¸å¯¹ Bonferroni æ›´å®½æ¾ï¼Œèƒ½å¤Ÿåœ¨æ§åˆ¶ FDR çš„åŒæ—¶ä¿ç•™è¾ƒé«˜çš„ç»Ÿè®¡åŠ›ï¼Œå³èƒ½å¤Ÿæ‹’ç»æ›´å¤šçš„å¤‡æ‹©å‡è®¾ã€‚

3. **æ··æ·†çŸ©é˜µ**

   - å¤šé‡æ£€éªŒé—®é¢˜ä¸­ï¼Œæµ‹è¯•ç»“æœå¯ä»¥ç”¨ä¸€ä¸ªæ··æ·†çŸ©é˜µæ¥æè¿°ã€‚å…·ä½“å®šä¹‰å¦‚ä¸‹ï¼š

   |                  | çœŸæ­£ï¼ˆ$H_1$ï¼‰ | å‡æ­£ï¼ˆ$H_0$ï¼‰ |
   | ---------------- | ------------- | ------------- |
   | **æ‹’ç» $H_0$**   | çœŸé˜³æ€§ (TP)   | å‡é˜³æ€§ (FP)   |
   | **ä¸æ‹’ç» $H_0$** | å‡é˜´æ€§ (FN)   | çœŸé˜´æ€§ (TN)   |
   
   
   - é€šè¿‡è¿™ä¸ªæ··æ·†çŸ©é˜µï¼Œå¯ä»¥å®šä¹‰è¯„ä»·æŒ‡æ ‡ï¼š
    
     - **çœŸé˜³æ€§ï¼ˆTPï¼‰ï¼š** å¤‡æ‹©å‡è®¾ä¸ºçœŸä¸”æˆåŠŸæ‹’ç»åŸå‡è®¾çš„ä¸ªæ•°ã€‚
     - **å‡é˜³æ€§ï¼ˆFPï¼‰ï¼š** åŸå‡è®¾ä¸ºçœŸä½†è¢«é”™è¯¯æ‹’ç»çš„ä¸ªæ•°ã€‚
     - **å‡é˜´æ€§ï¼ˆFNï¼‰ï¼š** å¤‡æ‹©å‡è®¾ä¸ºçœŸä½†æœªèƒ½æ‹’ç»åŸå‡è®¾çš„ä¸ªæ•°ã€‚
     - **çœŸé˜´æ€§ï¼ˆTNï¼‰ï¼š** åŸå‡è®¾ä¸ºçœŸä¸”æœªæ‹’ç»çš„ä¸ªæ•°ã€‚

4. **è¯„ä»·æŒ‡æ ‡çš„å®šä¹‰**

   - **FWERï¼ˆå®¶æ—é”™è¯¯ç‡ï¼‰ï¼š**  
  FWER æ˜¯æŒ‡åœ¨ä¸€æ¬¡å¤šé‡æ£€éªŒè¿‡ç¨‹ä¸­è‡³å°‘çŠ¯ä¸€æ¬¡ç¬¬ä¸€ç±»é”™è¯¯çš„æ¦‚ç‡ã€‚è‹¥è‡³å°‘æœ‰ä¸€ä¸ªåŸå‡è®¾è¢«é”™è¯¯æ‹’ç»ï¼ˆå³ FP > 0ï¼‰ï¼Œåˆ™ç®—ä½œå‘ç”Ÿäº†å®¶æ—é”™è¯¯ç‡ã€‚å…¶è®¡ç®—å…¬å¼ä¸ºï¼š
  $$
  \text{FWER} = P(\text{FP} > 0)
  $$
  åœ¨è¿›è¡Œå¤šæ¬¡å‡è®¾æ£€éªŒæ—¶ï¼ŒBonferroni æ ¡æ­£åŠ›æ±‚ä½¿å¾— FWER ç»´æŒåœ¨é¢„è®¾çš„æ˜¾è‘—æ€§æ°´å¹³ $\alpha$ ä»¥ä¸‹ã€‚æ¨¡æ‹Ÿè¿‡ç¨‹ä¸­ï¼ŒFWER å¯ä»¥é€šè¿‡è®°å½•æ¯æ¬¡å®éªŒä¸­æ˜¯å¦å‡ºç°è‡³å°‘ä¸€ä¸ªå‡é˜³æ€§æ¥è®¡ç®—ã€‚

   - **FDRï¼ˆé”™è¯¯å‘ç°ç‡ï¼‰ï¼š**  
  FDR æ˜¯æŒ‡åœ¨è¢«æ‹’ç»çš„å‡è®¾ä¸­ï¼Œå®é™…ä¸ºçœŸï¼ˆå³åŸå‡è®¾$H_0$ï¼‰çš„æ¯”ä¾‹ã€‚å…¬å¼ä¸ºï¼š
  $$
  \text{FDR} = \frac{\text{FP}}{\text{FP} + \text{TP}}
  $$
  ç›¸æ¯” FWERï¼ŒFDR æ˜¯ä¸€ç§è¾ƒä¸ºå®½æ¾çš„é”™è¯¯ç‡æ§åˆ¶æ–¹æ³•ï¼Œå…è®¸åœ¨å¤šé‡æ£€éªŒè¿‡ç¨‹ä¸­æ¥å—ä¸€å®šæ¯”ä¾‹çš„å‡é˜³æ€§ï¼Œåªè¦å…¶æ•´ä½“é”™è¯¯å‘ç°ç‡èƒ½å¤Ÿæ§åˆ¶åœ¨ $\alpha$ æ°´å¹³ä¹‹ä¸‹å³å¯ã€‚**æ³¨æ„ï¼š**å½“ $\text{FP} + \text{TP} = 0$ æ—¶ï¼ŒFDR è®¾ä¸º 0ï¼ˆæ²¡æœ‰æ‹’ç»ä»»ä½•å‡è®¾æ—¶ï¼‰ã€‚

   - **TPRï¼ˆçœŸé˜³æ€§ç‡ï¼‰ï¼š**  
  TPR æ˜¯æˆåŠŸæ‹’ç»çš„å¤‡æ‹©å‡è®¾æ•°é‡å æ€»å¤‡æ‹©å‡è®¾æ•°é‡çš„æ¯”ä¾‹ã€‚å³ï¼š
  $$
  \text{TPR} = \frac{\text{TP}}{\text{TP} + \text{FN}}
  $$
  TPR ä¹Ÿå¯ä»¥ç†è§£ä¸ºæ£€éªŒçš„æ•æ„Ÿæ€§ï¼Œå®ƒè¡¡é‡çš„æ˜¯æ£€éªŒå‘ç°çœŸå®æ•ˆæœçš„èƒ½åŠ›ã€‚è¯¥æŒ‡æ ‡è¶Šé«˜ï¼Œè¡¨ç¤ºæ–¹æ³•åœ¨æ£€æµ‹å¤‡æ‹©å‡è®¾æ—¶æ›´ä¸ºæœ‰æ•ˆã€‚Bonferroni æ ¡æ­£ç”±äºå…¶ä¸¥æ ¼æ€§é€šå¸¸ä¼šå¯¼è‡´ TPR è¾ƒä½ï¼Œè€Œ B-H æ ¡æ­£ç›¸å¯¹å®½æ¾ï¼Œå¾€å¾€å¯ä»¥æ›´å¥½åœ°ä¿æŒè¾ƒé«˜çš„ TPRã€‚

5. **æ¨¡æ‹Ÿæ­¥éª¤**

   - **æ­¥éª¤ 1ï¼šè®¾ç½®å‚æ•°ã€‚**  
  è®¾å®šæ€»æ£€éªŒæ•° $N = 1000$ï¼Œå…¶ä¸­ $n_0 = 950$ ä¸ªåŸå‡è®¾å’Œ $n_1 = 50$ ä¸ªå¤‡æ‹©å‡è®¾ã€‚æ˜¾è‘—æ€§æ°´å¹³ $\alpha = 0.1$ï¼Œæ¨¡æ‹Ÿæ¬¡æ•°ä¸º $m = 10000$ã€‚

   - **æ­¥éª¤ 2ï¼šç”Ÿæˆ p å€¼ã€‚**  
  åœ¨æ¯æ¬¡æ¨¡æ‹Ÿä¸­ï¼Œç”Ÿæˆ $N$ ä¸ª p å€¼ï¼Œå…¶ä¸­ $950$ ä¸ªæ¥è‡ª $U(0,1)$ å‡åŒ€åˆ†å¸ƒçš„éšæœºæ•°ï¼Œ$50$ ä¸ªæ¥è‡ª Beta$(0.1, 1)$ åˆ†å¸ƒçš„éšæœºæ•°ã€‚

   - **æ­¥éª¤ 3ï¼šåˆ†åˆ«è¿›è¡Œ Bonferroni å’Œ B-H æ ¡æ­£ã€‚**  
  å¯¹ç”Ÿæˆçš„ p å€¼è¿›è¡Œ Bonferroni æ ¡æ­£å’Œ B-H æ ¡æ­£ã€‚åˆ†åˆ«è®¡ç®—æ‹’ç»çš„å‡è®¾æ•°é‡ï¼Œå¹¶å°†æ‹’ç»çš„å‡è®¾åˆ†ç±»ä¸ºçœŸé˜³æ€§ï¼ˆTPï¼‰ã€å‡é˜³æ€§ï¼ˆFPï¼‰ã€å‡é˜´æ€§ï¼ˆFNï¼‰ã€çœŸé˜´æ€§ï¼ˆTNï¼‰ã€‚

   - **æ­¥éª¤ 4ï¼šè®¡ç®—è¯„ä»·æŒ‡æ ‡ã€‚**  
  é€šè¿‡æ¯æ¬¡æ¨¡æ‹Ÿçš„ç»“æœï¼Œè®¡ç®— Bonferroni æ ¡æ­£å’Œ B-H æ ¡æ­£ä¸‹çš„ FWERã€FDR å’Œ TPRã€‚

   - **æ­¥éª¤ 5ï¼šæ±‡æ€»å’Œè®¡ç®—å¹³å‡å€¼ã€‚**  
  å°† $m = 10000$ æ¬¡æ¨¡æ‹Ÿçš„ç»“æœè¿›è¡Œå¹³å‡ï¼Œè¾“å‡ºä¸€ä¸ª $3 \times 2$ çš„ç»“æœè¡¨æ ¼ï¼Œå±•ç¤ºåœ¨ä¸¤ç§æ ¡æ­£æ–¹æ³•ä¸‹ FWERã€FDR å’Œ TPR çš„è¡¨ç°ã€‚

### ä»£ç å®ç°

**è®¾ç½®å‚æ•°å’Œåˆå§‹åŒ–**

```{r, eval=TRUE}
knitr::opts_chunk$set(echo = TRUE)
set.seed(101)  # è®¾ç½®éšæœºæ•°ç§å­ï¼Œä¿è¯ç»“æœå¯é‡å¤

# å‚æ•°è®¾ç½®
N <- 1000       # æ€»å‡è®¾æ•°
n_null <- 950   # åŸå‡è®¾æ•°
n_alt <- 50     # å¤‡æ‹©å‡è®¾æ•°
m <- 10000      # æ¨¡æ‹Ÿæ¬¡æ•°
alpha <- 0.1    # æ˜¾è‘—æ€§æ°´å¹³

# åˆå§‹åŒ–ç»“æœçŸ©é˜µ
results <- matrix(0, nrow = 3, ncol = 2)
rownames(results) <- c("FWER", "FDR", "TPR")
colnames(results) <- c("Bonferroniæ ¡æ­£", "B-Hæ ¡æ­£")
```

**è¿›è¡Œæ¨¡æ‹Ÿ**

```{r, eval=TRUE}
# åŠ è½½å¿…è¦çš„åº“
library(ggplot2)

# åˆå§‹åŒ–å­˜å‚¨å˜é‡
fwer_bonf <- numeric(m)
fdr_bonf <- numeric(m)
tpr_bonf <- numeric(m)

fwer_bh <- numeric(m)
fdr_bh <- numeric(m)
tpr_bh <- numeric(m)

# æ‰§è¡Œæ¨¡æ‹Ÿ
for (i in 1:m) {
  # ç”Ÿæˆ p å€¼
  p_null <- runif(n_null)               # åŸå‡è®¾çš„ p å€¼
  p_alt <- rbeta(n_alt, 0.1, 1)         # å¤‡æ‹©å‡è®¾çš„ p å€¼
  p_values <- c(p_null, p_alt)          # åˆå¹¶æ‰€æœ‰ p å€¼
  true_labels <- c(rep(0, n_null), rep(1, n_alt))  # æ ‡ç­¾ï¼š0-åŸå‡è®¾ï¼Œ1-å¤‡æ‹©å‡è®¾
  
  # Bonferroni æ ¡æ­£
  p_bonf <- p.adjust(p_values, method = "bonferroni")
  rejected_bonf <- which(p_bonf < alpha)
  
  V_bonf <- sum(true_labels[rejected_bonf] == 0)  # è¯¯æ‹’çš„åŸå‡è®¾æ•°
  S_bonf <- sum(true_labels[rejected_bonf] == 1)  # æ­£ç¡®æ‹’ç»çš„å¤‡æ‹©å‡è®¾æ•°
  R_bonf <- length(rejected_bonf)                 # æ€»å…±æ‹’ç»çš„å‡è®¾æ•°
  
  fwer_bonf[i] <- as.numeric(V_bonf > 0)          # è‡³å°‘ä¸€ä¸ªå‡é˜³æ€§
  fdr_bonf[i] <- ifelse(R_bonf > 0, V_bonf / R_bonf, 0)  # é”™è¯¯å‘ç°ç‡
  tpr_bonf[i] <- S_bonf / n_alt                   # çœŸé˜³æ€§ç‡
  
  # B-H æ ¡æ­£
  p_bh <- p.adjust(p_values, method = "BH")
  rejected_bh <- which(p_bh < alpha)
  
  V_bh <- sum(true_labels[rejected_bh] == 0)
  S_bh <- sum(true_labels[rejected_bh] == 1)
  R_bh <- length(rejected_bh)
  
  fwer_bh[i] <- as.numeric(V_bh > 0)
  fdr_bh[i] <- ifelse(R_bh > 0, V_bh / R_bh, 0)
  tpr_bh[i] <- S_bh / n_alt
  
  # å¯è§†åŒ– p å€¼åˆ†å¸ƒï¼ˆå¯†åº¦å›¾ï¼‰
  if (i == 1) { # åªç»˜åˆ¶ç¬¬ä¸€æ¬¡æ¨¡æ‹Ÿçš„ p å€¼åˆ†å¸ƒ
    # åˆ›å»ºä¸€ä¸ªæ•°æ®æ¡†ï¼Œç”¨äº ggplot2 ç»˜å›¾
    p_data <- data.frame(
      p_value = p_values,
      hypothesis = factor(true_labels, labels = c("Null Hypothesis", "Alternative Hypothesis"))
    )
    
    # ç»˜åˆ¶å¯†åº¦å›¾
    p_plot <- ggplot(p_data, aes(x = p_value, fill = hypothesis, color = hypothesis)) +
      geom_density(alpha = 0.4) +  # ç»˜åˆ¶å¯†åº¦æ›²çº¿
      geom_vline(xintercept = alpha, linetype = "dashed", color = "red") +  # æ˜¾è‘—æ€§æ°´å¹³çº¿
      labs(title = "P-value Density for Null and Alternative Hypotheses",
           x = "P-value",
           y = "Density") +
      theme_minimal()
    
    # æ‰“å°å›¾å½¢
    print(p_plot)
  }
  
  # å¯è§†åŒ– p å€¼åˆ†å¸ƒï¼ˆæ•£ç‚¹å›¾ï¼‰
  if (i == m) { # åªç»˜åˆ¶ç¬¬mæ¬¡æ¨¡æ‹Ÿçš„ p å€¼åˆ†å¸ƒ
    # åˆ›å»ºä¸€ä¸ªæ•°æ®æ¡†ï¼Œç”¨äº ggplot2 ç»˜å›¾
    p_data <- data.frame(
      p_value = p_values,
      hypothesis = factor(true_labels, labels = c("Null Hypothesis", "Alternative Hypothesis"))
    )
  
    # ç»˜åˆ¶æ•£ç‚¹å›¾
    p_plot <- ggplot(p_data, aes(x = hypothesis, y = p_value, color = hypothesis)) +
      geom_jitter(width = 0.2, height = 0) +  # ä½¿ç”¨æ•£ç‚¹æŠ–åŠ¨æ•ˆæœ
      geom_hline(yintercept = alpha, linetype = "dashed", color = "red") +  # æ˜¾è‘—æ€§æ°´å¹³çº¿
      labs(title = "P-value Distribution for Null and Alternative Hypotheses",
         x = "Hypothesis Type",
         y = "P-value") +
      theme_minimal()
  
    # æ‰“å°å›¾å½¢
    print(p_plot)
  }
}
```

**è®¡ç®—ç»“æœ**

```{r, eval=TRUE}
# è®¡ç®—å¹³å‡å€¼
results["FWER", "Bonferroniæ ¡æ­£"] <- mean(fwer_bonf)
results["FDR", "Bonferroniæ ¡æ­£"] <- mean(fdr_bonf)
results["TPR", "Bonferroniæ ¡æ­£"] <- mean(tpr_bonf)

results["FWER", "B-Hæ ¡æ­£"] <- mean(fwer_bh)
results["FDR", "B-Hæ ¡æ­£"] <- mean(fdr_bh)
results["TPR", "B-Hæ ¡æ­£"] <- mean(tpr_bh)
```

**å±•ç¤ºç»“æœ**

```{r, eval=TRUE}
# åŠ è½½å¿…è¦çš„åº“
library(knitr)
library(kableExtra)

# ç¤ºä¾‹ç»“æœæ•°æ®æ¡†ï¼ˆå°†è¡Œå’Œåˆ—è°ƒæ•´ï¼‰
results <- data.frame(
  Metric = c("FWER", "FDR", "TPR"),
  Bonferroni = c(mean(fwer_bonf), mean(fdr_bonf), mean(tpr_bonf)),
  `B-H` = c(mean(fwer_bh), mean(fdr_bh), mean(tpr_bh))
)

# ä½¿ç”¨ kableExtra ç¾åŒ–è¡¨æ ¼
kable(results, digits = 4, caption = "ä¸åŒæ ¡æ­£æ–¹æ³•ä¸‹çš„ FWERã€FDR å’Œ TPR") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = FALSE, position = "center") %>%
  column_spec(1, bold = TRUE, background = "#D3D3D3") %>%  # åŠ ç²—ç¬¬ä¸€åˆ—ï¼ˆæŒ‡æ ‡åˆ—ï¼‰ï¼ŒèƒŒæ™¯æµ…ç°
  column_spec(2:3, color = "black", background = "#F0F8FF") %>%  # æ ¡æ­£æ–¹æ³•çš„åˆ—
  row_spec(0, bold = TRUE, font_size = 14) %>%  # æ ‡é¢˜è¡ŒåŠ ç²—å¹¶å¢å¤§å­—å·
  add_header_above(c(" " = 1, "æ ¡æ­£æ–¹æ³•" = 2))  # åˆå¹¶æ ‡é¢˜ï¼šæ ¡æ­£æ–¹æ³•
```

**ç»˜åˆ¶ç»“æœå›¾å½¢**

```{r, eval=TRUE}
# åŠ è½½å¿…è¦çš„åº“
library(reshape2)
library(ggplot2)

# å°†ç»“æœæ•°æ®æ¡†è½¬æ¢ä¸ºé•¿æ ¼å¼
results_melt <- melt(results, id.vars = "Metric", variable.name = "CorrectionMethod", value.name = "Value")

# ç»˜åˆ¶æŸ±çŠ¶å›¾
ggplot(results_melt, aes(x = Metric, y = Value, fill = CorrectionMethod)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "ä¸åŒæ ¡æ­£æ–¹æ³•ä¸‹çš„ FWERã€FDR å’Œ TPR æ¯”è¾ƒ",
       x = "æŒ‡æ ‡",
       y = "å€¼",
       fill = "æ ¡æ­£æ–¹æ³•") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),  # æ ‡é¢˜å±…ä¸­ä¸”åŠ ç²—
    axis.text.x = element_text(size = 12),  # è°ƒæ•´Xè½´æ ‡ç­¾çš„å­—ä½“å¤§å°
    axis.text.y = element_text(size = 12),  # è°ƒæ•´Yè½´æ ‡ç­¾çš„å­—ä½“å¤§å°
    legend.title = element_text(size = 12),  # è°ƒæ•´å›¾ä¾‹æ ‡é¢˜çš„å­—ä½“å¤§å°
    legend.text = element_text(size = 10)  # è°ƒæ•´å›¾ä¾‹æ–‡æœ¬çš„å­—ä½“å¤§å°
  )
```

### ç»“æœåˆ†æ

- **FWERï¼ˆå®¶æ—é”™è¯¯ç‡ï¼‰ï¼š**

  - **Bonferroni æ ¡æ­£**çš„ FWER çº¦ä¸º 0.0852ï¼Œæ¥è¿‘åä¹‰æ°´å¹³ $\alpha=0.1$ï¼Œè¯´æ˜ Bonferroni æ–¹æ³•æœ‰æ•ˆåœ°æ§åˆ¶äº†å®¶æ—é”™è¯¯ç‡ã€‚

  - **B-H æ ¡æ­£**çš„ FWER çº¦ä¸º 0.9305ï¼Œæ˜æ˜¾é«˜äº $\alpha$ï¼Œå› ä¸º B-H æ–¹æ³•ä¸»è¦æ§åˆ¶ FDRï¼Œè€Œé FWERã€‚

  - Bonferroni æ ¡æ­£ä¸¥æ ¼æ§åˆ¶äº† FWERã€‚åœ¨æ¨¡æ‹Ÿä¸­ï¼ŒBonferroni æ ¡æ­£é€šè¿‡å°†æ˜¾è‘—æ€§æ°´å¹³æŒ‰æ£€éªŒæ¬¡æ•°è°ƒæ•´ï¼Œå› æ­¤å¯¹è‡³å°‘ä¸€ä¸ªå‡è®¾é”™è¯¯æ‹’ç»çš„æ§åˆ¶éå¸¸ä¸¥è°¨ï¼ŒFWER è¾ƒä½ã€‚ç„¶è€Œï¼Œè¿™ç§ä¸¥æ ¼çš„æ§åˆ¶ä¹Ÿå¸¦æ¥äº†ä»£ä»·ï¼Œå³å…¶æ£€éªŒå˜å¾—éå¸¸ä¿å®ˆï¼Œæ‹’ç»åŸå‡è®¾çš„æ¬¡æ•°è¾ƒå°‘ã€‚

    ä¸ä¹‹ç›¸æ¯”ï¼ŒB-H æ ¡æ­£çš„ FWER ç•¥é«˜ã€‚è™½ç„¶ B-H æ ¡æ­£å¹¶ä¸ç›´æ¥æ§åˆ¶ FWERï¼Œä½†å®ƒé€šè¿‡æ§åˆ¶ FDR æ¥é—´æ¥å½±å“ FWERã€‚å› æ­¤ï¼Œç›¸è¾ƒäº Bonferroni æ ¡æ­£ï¼ŒB-H æ ¡æ­£åœ¨ FWER ä¸Šçš„æ§åˆ¶è¾ƒä¸ºå®½æ¾ã€‚

- **FDRï¼ˆé”™è¯¯å‘ç°ç‡ï¼‰ï¼š**

  - **Bonferroni æ ¡æ­£**çš„ FDR çº¦ä¸º 0.0043ï¼Œè¿œä½äº $\alpha$ï¼Œè¯´æ˜å…¶è¿‡äºä¿å®ˆï¼Œé”™è¯¯å‘ç°çš„æ¯”ä¾‹å¾ˆä½ã€‚

  - **B-H æ ¡æ­£**çš„ FDR çº¦ä¸º 0.0945ï¼Œæ¥è¿‘ $\alpha$ï¼Œè¯´æ˜ B-H æ–¹æ³•æœ‰æ•ˆåœ°æ§åˆ¶äº†é”™è¯¯å‘ç°ç‡ã€‚

  - B-H æ ¡æ­£çš„ FDR è¡¨ç°æ˜æ˜¾ä¼˜äº Bonferroni æ ¡æ­£ã€‚B-H æ ¡æ­£æ–¹æ³•ä¸“ä¸ºæ§åˆ¶ FDR è®¾è®¡ï¼Œå®ƒå…è®¸åœ¨ä¸€å®šç¨‹åº¦ä¸Šå®¹å¿å‡é˜³æ€§ï¼Œä»¥æ­¤æé«˜æ£€éªŒçš„çµæ•åº¦ï¼ˆTPRï¼‰ã€‚å› æ­¤ï¼Œåœ¨å¤šæ¬¡æ£€éªŒä¸­ï¼ŒB-H æ ¡æ­£çš„é”™è¯¯å‘ç°ç‡ä¿æŒè¾ƒä½ï¼Œè€Œ Bonferroni æ ¡æ­£ç”±äºå…¶ä¿å®ˆæ€§ï¼Œåè€Œåœ¨æ§åˆ¶ FDR æ–¹é¢è¡¨ç°ç¨å·®ã€‚

    æ¨¡æ‹Ÿç»“æœè¡¨æ˜ï¼ŒB-H æ ¡æ­£çš„ FDR é€šå¸¸ä½äº Bonferroni æ ¡æ­£ã€‚å¯¹äºç ”ç©¶äººå‘˜æ¥è¯´ï¼Œå¦‚æœä¸»è¦å…³å¿ƒé”™è¯¯å‘ç°çš„æ¯”ä¾‹è€Œä¸æ˜¯ä¸¥æ ¼æ§åˆ¶æ¯æ¬¡æ£€éªŒçš„é”™è¯¯ç‡ï¼ŒB-H æ ¡æ­£æ›´ä¸ºåˆé€‚ã€‚

- **TPRï¼ˆçœŸé˜³æ€§ç‡ï¼‰ï¼š**

  - **Bonferroni æ ¡æ­£**çš„ TPR çº¦ä¸º 0.3988ï¼Œè¯´æ˜æ­£ç¡®è¯†åˆ«å‡ºçš„å¤‡æ‹©å‡è®¾æ¯”ä¾‹è¾ƒä½ï¼Œæ£€éªŒåŠ›è¾ƒä½ã€‚
  - **B-H æ ¡æ­£**çš„ TPR çº¦ä¸º 0.5626ï¼Œæ£€éªŒåŠ›è¾ƒé«˜ï¼Œèƒ½å¤Ÿè¯†åˆ«å¤§éƒ¨åˆ†çš„å¤‡æ‹©å‡è®¾ã€‚
  - åœ¨çœŸé˜³æ€§ç‡æ–¹é¢ï¼ŒB-H æ ¡æ­£ä¼˜äº Bonferroni æ ¡æ­£ã€‚ç”±äº Bonferroni æ ¡æ­£éå¸¸ä¿å®ˆï¼Œå®ƒä¼šå¯¼è‡´è¾ƒå¤šçš„å¤‡æ‹©å‡è®¾æ²¡æœ‰è¢«æ­£ç¡®æ‹’ç»ï¼ŒçœŸé˜³æ€§ç‡ï¼ˆTPRï¼‰è¾ƒä½ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒB-H æ ¡æ­£çš„è¾ƒå®½æ¾æ ‡å‡†ä½¿å¾—æ›´å¤šçš„å¤‡æ‹©å‡è®¾è¢«æ­£ç¡®æ‹’ç»ï¼ŒçœŸé˜³æ€§ç‡æ˜æ˜¾æ›´é«˜ã€‚

**ç»“è®ºï¼š**

- **Bonferroni æ–¹æ³•**é€‚åˆåœ¨éœ€è¦ä¸¥æ ¼æ§åˆ¶å®¶æ—é”™è¯¯ç‡çš„åœºæ™¯ä¸­ä½¿ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦ä¿è¯çŠ¯ç¬¬ä¸€ç±»é”™è¯¯çš„æ¦‚ç‡å°½å¯èƒ½ä½çš„æƒ…å†µä¸‹ã€‚ç„¶è€Œï¼ŒBonferroni æ ¡æ­£çš„ç¼ºç‚¹æ˜¯ä¿å®ˆæ€§è¾ƒå¼ºï¼Œå¯¼è‡´è¾ƒä½çš„çœŸé˜³æ€§ç‡ã€‚
- **B-H æ–¹æ³•**æ›´é€‚åˆåœ¨å¸Œæœ›å‘ç°å°½å¯èƒ½å¤šçš„çœŸé˜³æ€§ï¼ˆå³çœŸå®çš„å¤‡æ‹©å‡è®¾ï¼‰çš„åœºåˆä¸‹ä½¿ç”¨ã€‚è™½ç„¶å®ƒçš„ FWER æ§åˆ¶ä¸å¦‚ Bonferroni ä¸¥æ ¼ï¼Œä½†å®ƒåœ¨æ§åˆ¶é”™è¯¯å‘ç°ç‡ï¼ˆFDRï¼‰çš„åŒæ—¶ï¼Œæ˜¾è‘—æé«˜äº†çœŸé˜³æ€§ç‡ï¼ˆTPRï¼‰ï¼Œä½¿å¾—æ›´å¤šçš„æœ‰æ„ä¹‰å‘ç°å¾—ä»¥è¢«è¯†åˆ«ã€‚
- ä¸¤ç§æ ¡æ­£æ–¹æ³•å„æœ‰ä¼˜åŠ£ï¼Œé€‰æ‹©å“ªç§æ–¹æ³•åº”è§†å…·ä½“åº”ç”¨åœºæ™¯è€Œå®šã€‚è‹¥å¯¹è¯¯å·®æ§åˆ¶è¦æ±‚éå¸¸ä¸¥æ ¼ï¼ˆå¦‚åŒ»ç–—è¯•éªŒï¼‰ï¼ŒBonferroni æ–¹æ³•å¯èƒ½æ›´åˆé€‚ï¼›å¦‚æœå¯¹è¯¯å·®å®¹å¿åº¦è¾ƒé«˜ï¼Œå¹¶å¸Œæœ›æœ‰è¾ƒé«˜çš„å‘ç°èƒ½åŠ›ï¼Œåˆ™ B-H æ ¡æ­£æ˜¯æ›´ä¼˜çš„é€‰æ‹©ã€‚

---

## é—®é¢˜2 ç»ƒä¹  7.4

### é¢˜ç›®æè¿°

å‚ç…§ `boot` åŒ…æ‰€æä¾›çš„ç©ºè°ƒæ•°æ®é›† `aircondit`ã€‚ä»¥ä¸‹è¿™ 12 ä¸ªè§‚æµ‹å€¼æ˜¯ç©ºè°ƒè®¾å¤‡å‡ºæ•…éšœæ‰€é—´éš”çš„æ—¶é—´ï¼ˆä»¥å°æ—¶ä¸ºå•ä½ï¼‰ï¼š

$$
3, 5, 7, 18, 43, 85, 91, 98, 100, 130, 230, 487.
$$

å‡è®¾è®¾å¤‡å‡ºæ•…éšœçš„é—´éš”æ—¶é—´æœä»æŒ‡æ•°åˆ†å¸ƒ $Exp(\lambda)$ã€‚æ±‚å¤±æ•ˆç‡/æ•…éšœç‡ï¼ˆhazard rateï¼‰$\lambda$ çš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼ˆMLEï¼‰ï¼Œå¹¶ä½¿ç”¨ Bootstrap æ–¹æ³•ï¼ˆè‡ªä¸¾æ³•ï¼‰ä¼°è®¡è¯¥ä¼°è®¡å€¼çš„åå·®å’Œæ ‡å‡†å·®ã€‚

### è§£ç­”æ€è·¯

1. **æœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼ˆMLEï¼‰**

   - **æŒ‡æ•°åˆ†å¸ƒçš„å®šä¹‰ï¼š**å‡è®¾è®¾å¤‡å‡ºæ•…éšœçš„æ—¶é—´é—´éš” $X$ æœä»æŒ‡æ•°åˆ†å¸ƒ $\text{Exp}(\lambda)$ï¼Œå…¶æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆpdfï¼‰ä¸ºï¼š
$$
f(x; \lambda) = \lambda e^{-\lambda x}, \quad x \geq 0
$$
åœ¨è¯¥å…¬å¼ä¸­ï¼Œ$\lambda$ è¡¨ç¤ºå¤±æ•ˆç‡ï¼ˆhazard rateï¼‰ï¼Œå³è®¾å¤‡çš„æ•…éšœç‡ã€‚

   - **ä¼¼ç„¶å‡½æ•°çš„æ„å»º**ï¼šå‡è®¾è§‚æµ‹æ•°æ®ä¸º $x_1, x_2, \dots, x_n$ï¼Œè¡¨ç¤ºç©ºè°ƒè®¾å¤‡å‡ºæ•…éšœçš„é—´éš”æ—¶é—´ï¼ˆå•ä½ï¼šå°æ—¶ï¼‰ã€‚ç”±äºæ ·æœ¬ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œæ•´ä¸ªæ ·æœ¬çš„è”åˆæ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆä¼¼ç„¶å‡½æ•°ï¼‰å¯ä»¥å†™ä½œï¼š
$$
L(\lambda) = \prod_{i=1}^{n} f(x_i; \lambda) = \prod_{i=1}^{n} \lambda e^{-\lambda x_i}
$$
è¿™è¡¨ç¤ºå¯¹æ‰€æœ‰æ ·æœ¬ç‚¹ $x_1, x_2, \dots, x_n$ çš„æ¦‚ç‡å¯†åº¦å‡½æ•°çš„ä¹˜ç§¯ã€‚

   - **å¯¹æ•°ä¼¼ç„¶å‡½æ•°**ï¼šä¸ºäº†ç®€åŒ–å¯¹ä¼¼ç„¶å‡½æ•°çš„å¤„ç†ï¼Œé€šå¸¸å¯¹ä¼¼ç„¶å‡½æ•°å–å¯¹æ•°ï¼Œå¾—åˆ°å¯¹æ•°ä¼¼ç„¶å‡½æ•° $\ln L(\lambda)$ï¼š
$$
\ln L(\lambda) = \sum_{i=1}^{n} \ln \left( \lambda e^{-\lambda x_i} \right) 
= \sum_{i=1}^{n} \left( \ln \lambda - \lambda x_i \right)
= n \ln \lambda - \lambda \sum_{i=1}^{n} x_i
$$
åœ¨è¿™ä¸ªè¡¨è¾¾å¼ä¸­ï¼š
      - $n$ æ˜¯æ ·æœ¬æ•°é‡ã€‚
      - $\sum_{i=1}^{n} x_i$ æ˜¯æ‰€æœ‰è§‚æµ‹å€¼çš„å’Œã€‚

   - **æœ€å¤§åŒ–å¯¹æ•°ä¼¼ç„¶å‡½æ•°ï¼š**æ¥ä¸‹æ¥ï¼Œå¯¹ $\lambda$ æ±‚å¯¼ä»¥æœ€å¤§åŒ–å¯¹æ•°ä¼¼ç„¶å‡½æ•°ï¼š
$$
\frac{\partial \ln L(\lambda)}{\partial \lambda} = \frac{n}{\lambda} - \sum_{i=1}^{n} x_i
$$
ä»¤å¯¼æ•°ä¸ºé›¶ï¼Œä»¥æ‰¾åˆ°æœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼ˆMLEï¼‰ï¼š
$$
\frac{n}{\lambda} - \sum_{i=1}^{n} x_i = 0
$$
è§£å¾—ï¼š
$$
\hat{\lambda} = \frac{n}{\sum_{i=1}^{n} x_i}
$$
å› æ­¤ï¼Œ$\hat{\lambda}$ æ˜¯æ ·æœ¬æ•°é‡ $n$ é™¤ä»¥æ‰€æœ‰æ ·æœ¬ç‚¹çš„æ€»å’Œã€‚è¿™æ˜¯è®¾å¤‡æ•…éšœæ—¶é—´é—´éš”æœä»æŒ‡æ•°åˆ†å¸ƒçš„å¤±æ•ˆç‡ $\lambda$ çš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡å€¼ã€‚

2. **Bootstrap æ–¹æ³•ä¼°è®¡åå·®å’Œæ ‡å‡†å·®**

   - **Bootstrap æ–¹æ³•æ¦‚è¿°ï¼š**è™½ç„¶æœ€å¤§ä¼¼ç„¶ä¼°è®¡ $\hat{\lambda}$ æ˜¯ $\lambda$ çš„ä¸€ä¸ªç‚¹ä¼°è®¡ï¼Œä½†é€šå¸¸è¿˜éœ€è¦ä¼°è®¡è¯¥ç‚¹ä¼°è®¡çš„åå·®å’Œæ ‡å‡†å·®ã€‚ä¸ºæ­¤ï¼Œä½¿ç”¨ **Bootstrap æ–¹æ³•** æ¥è¿‘ä¼¼ä¼°è®¡è¿™äº›é‡ã€‚Bootstrap æ–¹æ³•æ˜¯ä¸€ç§é€šè¿‡é‡å¤æŠ½æ ·æ¥ä¼°è®¡ç»Ÿè®¡é‡åˆ†å¸ƒçš„éå‚æ•°æ–¹æ³•ã€‚å®ƒé€šè¿‡ä»åŸå§‹æ ·æœ¬ä¸­æœ‰æ”¾å›åœ°æŠ½æ ·ï¼Œç”Ÿæˆå¤šä¸ªæ–°çš„æ ·æœ¬ï¼ˆç§°ä¸º Bootstrap æ ·æœ¬ï¼‰ï¼Œå¹¶åœ¨æ¯ä¸ªæ ·æœ¬ä¸Šé‡å¤è®¡ç®—ç»Ÿè®¡é‡ã€‚æœ€åï¼Œä½¿ç”¨è¿™äº›ç»Ÿè®¡é‡çš„åˆ†å¸ƒæ¥ä¼°è®¡åŸå§‹æ ·æœ¬ç»Ÿè®¡é‡çš„åå·®å’Œæ ‡å‡†å·®ã€‚

   - **Bootstrap å®æ–½æ­¥éª¤**ï¼š

     - **æ­¥éª¤1ï¼šåŸå§‹æ•°æ®çš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡ã€‚**  
  é¦–å…ˆï¼Œè®¡ç®—åŸå§‹æ•°æ®çš„ $\lambda$ çš„ MLE $\hat{\lambda}$ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„åˆå§‹ä¼°è®¡å€¼ã€‚
     
     - **æ­¥éª¤2ï¼šç”Ÿæˆ Bootstrap æ ·æœ¬ã€‚**  
  ä»åŸå§‹æ•°æ® $x_1, x_2, \dots, x_n$ ä¸­æœ‰æ”¾å›åœ°æŠ½å–ä¸€ä¸ªæ–°çš„æ ·æœ¬ï¼Œè¿™ä¸ªæ ·æœ¬ä¸åŸå§‹æ•°æ®çš„å¤§å°ç›¸åŒï¼ˆå³ $n$ ä¸ªè§‚æµ‹å€¼ï¼‰ï¼Œä½†å…¶ä¸­çš„è§‚æµ‹å€¼å¯èƒ½ä¼šé‡å¤å‡ºç°ã€‚è¿™ç›¸å½“äºæ¨¡æ‹Ÿå¯¹æ•°æ®çš„é‡æ–°é‡‡æ ·ã€‚
     
     - **æ­¥éª¤3ï¼šè®¡ç®— Bootstrap æ ·æœ¬çš„ MLEã€‚**  
  å¯¹æ¯ä¸ªç”Ÿæˆçš„ Bootstrap æ ·æœ¬ï¼Œå†æ¬¡è®¡ç®— $\lambda$ çš„ MLEã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹ $B$ æ¬¡ï¼ˆé€šå¸¸ $B = 1000$ æˆ–æ›´å¤šï¼‰ï¼Œå¾—åˆ° $B$ ä¸ª $\hat{\lambda}^{(b)}$ çš„ä¼°è®¡å€¼ã€‚
     
     - **æ­¥éª¤4ï¼šä¼°è®¡åå·®ã€‚**  
  è®¡ç®—æ‰€æœ‰ Bootstrap æ ·æœ¬çš„ $\hat{\lambda}^{(b)}$ å‡å€¼ï¼Œç„¶åé€šè¿‡ä»¥ä¸‹å…¬å¼ä¼°è®¡åå·®ï¼š
$$
\text{Bias}(\hat{\lambda}) = \mathbb{E}[\hat{\lambda}_{\text{bootstrap}}] - \hat{\lambda}_{\text{original}}
$$
å…¶ä¸­ï¼Œ$\mathbb{E}[\hat{\lambda}_{\text{bootstrap}}]$ æ˜¯æ‰€æœ‰ $B$ ä¸ª Bootstrap æ ·æœ¬çš„ $\hat{\lambda}^{(b)}$ çš„å‡å€¼ï¼Œ$\hat{\lambda}_{\text{original}}$ æ˜¯åŸå§‹æ•°æ®çš„ MLEã€‚
     
     - **æ­¥éª¤5ï¼šä¼°è®¡æ ‡å‡†å·®ã€‚**  
  ä¼°è®¡å€¼çš„æ ‡å‡†å·®å¯ä»¥é€šè¿‡ Bootstrap æ ·æœ¬çš„æ ‡å‡†å·®æ¥è®¡ç®—ï¼š
$$
\text{SE}(\hat{\lambda}) = \sqrt{\frac{1}{B-1} \sum_{b=1}^{B} \left( \hat{\lambda}^{(b)} - \mathbb{E}[\hat{\lambda}_{\text{bootstrap}}] \right)^2}
$$
å…¶ä¸­ï¼Œ$B$ æ˜¯ Bootstrap æ ·æœ¬çš„æ•°é‡ï¼Œ$\hat{\lambda}^{(b)}$ æ˜¯ç¬¬ $b$ ä¸ª Bootstrap æ ·æœ¬çš„ MLEã€‚
        
### ä»£ç å®ç°

**åŠ è½½æ•°æ®**

```{r, eval=TRUE}
# åŠ è½½ boot åŒ…å’Œæ•°æ®
library(boot)
data("aircondit")
x <- aircondit$hours

# æ ·æœ¬å¤§å°
n <- length(x)
```

**è®¡ç®— MLE**

```{r, eval=TRUE}
# è®¡ç®— Î» çš„ MLE
lambda_hat <- n / sum(x)
lambda_hat
```

**å®šä¹‰ Bootstrap å‡½æ•°**

```{r, eval=TRUE}
# å®šä¹‰ç”¨äº Bootstrap çš„ç»Ÿè®¡é‡å‡½æ•°
boot_lambda <- function(data, indices) {
  # ä»æ•°æ®ä¸­æŠ½æ ·
  sample_data <- data[indices]
  # è®¡ç®— Î» çš„ MLE
  n_boot <- length(sample_data)
  sum_boot <- sum(sample_data)
  lambda_boot <- n_boot / sum_boot
  return(lambda_boot)
}
```

**è¿›è¡Œ Bootstrap**

```{r, eval=TRUE}
# è®¾ç½® Bootstrap é‡å¤æ¬¡æ•°
R <- 10^5
# è¿›è¡Œ Bootstrap
set.seed(110)
boot_results <- boot(data = x, statistic = boot_lambda, R = R)
```

**ä¼°è®¡åå·®å’Œæ ‡å‡†å·®**

```{r, eval=TRUE}
# ä¼°è®¡åå·®
bias_lambda <- mean(boot_results$t) - lambda_hat
bias_lambda

# ä¼°è®¡æ ‡å‡†å·®
se_lambda <- sd(boot_results$t)
se_lambda
```

**ç»˜åˆ¶ Bootstrap åˆ†å¸ƒå›¾**

```{r, eval=TRUE}
# ç»˜åˆ¶ Î» çš„ Bootstrap åˆ†å¸ƒç›´æ–¹å›¾
hist(boot_results$t, breaks = 30, main = expression("Bootstrap åˆ†å¸ƒ (" * lambda * ")"), xlab = expression(lambda), col = "lightblue", probability = TRUE)
abline(v = lambda_hat, col = "red", lwd = 2, lty = 2)
legend("topright", legend = c("MLE ä¼°è®¡å€¼"), col = c("red"), lwd = 2, lty = 2)
```

### ç»“æœåˆ†æ

**MLE ä¼°è®¡å€¼ï¼š**

```{r, eval=TRUE}
cat(sprintf("Î» çš„ MLE ä¼°è®¡å€¼ä¸ºï¼š%.6f\n", lambda_hat))
```
**åå·®ä¼°è®¡ï¼š**

```{r, eval=TRUE}
cat(sprintf("åå·®ä¼°è®¡ä¸ºï¼š%.6f\n", bias_lambda))
```

**æ ‡å‡†å·®ä¼°è®¡ï¼š**

```{r, eval=TRUE}
cat(sprintf("æ ‡å‡†å·®ä¼°è®¡ä¸ºï¼š%.6f\n", se_lambda))
```

**åˆ†æï¼š**

- **æœ€å¤§ä¼¼ç„¶ä¼°è®¡ç»“æœï¼š**

  æ ¹æ®å…¬å¼ $\hat{\lambda} = \frac{n}{\sum_{i=1}^{n} x_i}$ å¯è®¡ç®—å‡ºè®¾å¤‡å¤±æ•ˆç‡ $\lambda$  çš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡ã€‚å¯¹äºç»™å®šçš„æ•°æ®é›†ï¼š

  $$
  x = \{ 3, 5, 7, 18, 43, 85, 91, 98, 100, 130, 230, 487 \}
  $$

  æ ·æœ¬å¤§å° $n = 12$ï¼Œæ•°æ®æ€»å’Œ $\sum_{i=1}^{12} x_i = 1297$ã€‚å› æ­¤ï¼Œ$\lambda$ çš„ MLE ä¸ºï¼š

  $$
  \hat{\lambda} = \frac{12}{1297} \approx 0.009252
  $$
  è¿™æ„å‘³ç€è®¾å¤‡çš„å¤±æ•ˆç‡ä¸º $\hat{\lambda} \approx 0.009252$ï¼ˆæ¯å°æ—¶æ•…éšœçš„æ¦‚ç‡çº¦ä¸º 0.009252ï¼‰ã€‚

- **Bootstrap ä¼°è®¡ç»“æœï¼š**

  é€šè¿‡ Bootstrap æ–¹æ³•å¯¹ $\lambda$ è¿›è¡Œ 10000 æ¬¡é‡é‡‡æ ·ï¼Œè®¡ç®—äº† $\lambda$ çš„åå·®å’Œæ ‡å‡†å·®ã€‚ç»“æœå¦‚ä¸‹ï¼š

  - **åå·®ä¼°è®¡ï¼š** Bootstrap æ ·æœ¬å‡å€¼ä¸åŸå§‹æ ·æœ¬ MLE çš„å·®å¼‚éå¸¸å°ï¼Œè¯´æ˜åŸå§‹ MLE æ˜¯ä¸€ä¸ªæ— åçš„ä¼°è®¡é‡ã€‚åå·® $\text{Bias}(\hat{\lambda}) \approx 0.001295$ï¼Œè¿™ä¸ªæ•°å€¼ååˆ†æ¥è¿‘é›¶ï¼Œè¡¨æ˜æ²¡æœ‰æ˜¾è‘—çš„ç³»ç»Ÿæ€§è¯¯å·®ã€‚

  - **æ ‡å‡†å·®ä¼°è®¡ï¼š** Bootstrap æ ·æœ¬çš„æ ‡å‡†å·®ä¸º $\text{SE}(\hat{\lambda}) \approx 0.004296$ã€‚æ ‡å‡†å·®åæ˜ äº†ä¼°è®¡é‡çš„æ³¢åŠ¨ç¨‹åº¦ï¼Œè¿™æ„å‘³ç€é€šè¿‡ä¸åŒæ ·æœ¬é‡å¤è®¡ç®—$\lambda$ï¼Œå®ƒçš„ä¼°è®¡å€¼é€šå¸¸ä¼šåœ¨ $\hat{\lambda} \pm 0.004296$ çš„èŒƒå›´å†…æ³¢åŠ¨ã€‚

- æ€»çš„æ¥è¯´ï¼ŒBootstrap ç»“æœè¡¨æ˜ï¼ŒMLE ä¼°è®¡æ˜¯ä¸€ä¸ªç›¸å¯¹ç¨³å®šä¸”æ— åçš„ä¼°è®¡é‡ã€‚åå·®è¾ƒå°ï¼Œæ ‡å‡†å·®ä¹Ÿè¾ƒä½ï¼Œæ„å‘³ç€æœ¬é¢˜ä¸­å¯¹è®¾å¤‡å¤±æ•ˆç‡ $\lambda$ çš„ä¼°è®¡å…·æœ‰è¾ƒé«˜çš„å¯é æ€§ã€‚

---

## é—®é¢˜2 ç»ƒä¹  7.5

### é¢˜ç›®æè¿°

å‚è€ƒç»ƒä¹  7.4ã€‚é€šè¿‡æ ‡å‡†æ­£æ€æ³•ï¼ˆstandard normalï¼‰ã€åŸºæœ¬æ³•ï¼ˆbasicï¼‰ã€ç™¾åˆ†ä½æ³•ï¼ˆpercentileï¼‰å’Œ $BCa$ æ–¹æ³•è®¡ç®—è®¾å¤‡å‡ºæ•…éšœçš„é—´éš”æ—¶é—´çš„å¹³å‡å€¼ $1/Î»$ çš„ 95% Bootstrapè‡ªä¸¾ç½®ä¿¡åŒºé—´ã€‚æ¯”è¾ƒè¿™äº›ç½®ä¿¡åŒºé—´ï¼Œå¹¶è§£é‡Šå®ƒä»¬ä¸ºä½•å¯èƒ½ä¸åŒã€‚

### è§£ç­”æ€è·¯

1. **ç›®æ ‡å‚æ•°**

   - æœ¬é¢˜çš„ç›®æ ‡æ˜¯ä¼°è®¡è®¾å¤‡çš„å¹³å‡æ•…éšœé—´éš”æ—¶é—´ $\theta$ï¼Œå…¶ä¸­ $\theta = 1/\lambda$ï¼Œè€Œ $\lambda$ æ˜¯æ•…éšœç‡çš„ä¼°è®¡å€¼ã€‚

   - æ•…éšœç‡å¯ä»¥æ ¹æ®ç»™å®šçš„æ•°æ®è¿›è¡Œä¼°è®¡ã€‚

2. **Bootstrap ç½®ä¿¡åŒºé—´çš„å››ç§æ–¹æ³•**

   - **æ ‡å‡†æ­£æ€æ³•ï¼ˆstandard normalï¼‰ï¼š**
      
      - åŸºäºæ­£æ€åˆ†å¸ƒå‡è®¾ï¼Œæˆ‘ä»¬å‡è®¾ $\theta$ çš„åˆ†å¸ƒæ˜¯è¿‘ä¼¼æ­£æ€çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ$95\%$ çš„ç½®ä¿¡åŒºé—´å¯ä»¥é€šè¿‡ä»¥ä¸‹å…¬å¼è¡¨ç¤ºï¼š
$$
\hat{\theta} \pm z_{0.975} \times \hat{\sigma}
$$
      - å…¶ä¸­ï¼Œ$\hat{\theta}$ æ˜¯ $\theta$ çš„ Bootstrap å‡å€¼ä¼°è®¡ï¼Œ$\hat{\sigma}$ æ˜¯å…¶æ ‡å‡†è¯¯å·®ï¼Œ$z_{0.975}$ æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„ $97.5\%$ åˆ†ä½æ•°ï¼ˆæŸ¥è¡¨å¯çŸ¥ $z_{0.975} \approx 1.96$ï¼‰ã€‚

   - **åŸºæœ¬æ³•ï¼ˆbasicï¼‰**ï¼š
      
      - åŸºæœ¬æ³•è€ƒè™‘äº† $\theta$ çš„åå·®ï¼Œå¹¶é€šè¿‡åå‘è°ƒæ•´å…¶åˆ†å¸ƒçš„ä¸‹ã€ä¸Šç•Œæ¥è®¡ç®—ç½®ä¿¡åŒºé—´ã€‚å…¶å…¬å¼å¦‚ä¸‹ï¼š
$$
[2\hat{\theta} - \hat{\theta}_{(1-\alpha/2)}, \ 2\hat{\theta} - \hat{\theta}_{(\alpha/2)}]
$$
å…¶ä¸­ï¼Œ$\hat{\theta}_{(1-\alpha/2)}$ å’Œ $\hat{\theta}_{(\alpha/2)}$ åˆ†åˆ«æ˜¯ Bootstrap æ ·æœ¬çš„ä¸Šç•Œå’Œä¸‹ç•Œåˆ†ä½æ•°ã€‚
      - åŸºæœ¬æ³•é€šè¿‡åè½¬åå·®æ¥è°ƒæ•´ç½®ä¿¡åŒºé—´çš„ä¸Šä¸‹é™ï¼Œè€ƒè™‘äº† $\theta$ çš„å¯¹ç§°æ€§ã€‚å®ƒé€šå¸¸æ¯”æ ‡å‡†æ­£æ€æ³•æ›´ç¨³å¥ï¼Œä½†ä»å‡è®¾æ•°æ®åˆ†å¸ƒç›¸å¯¹å¯¹ç§°ã€‚

   - **ç™¾åˆ†ä½æ³•ï¼ˆpercentileï¼‰**ï¼š
   
      - ç™¾åˆ†ä½æ³•ä¸åšä»»ä½•å¯¹ç§°æ€§å‡è®¾ï¼Œè€Œæ˜¯ç›´æ¥åˆ©ç”¨ Bootstrap æ ·æœ¬çš„åˆ†ä½æ•°æ¥æ„å»ºç½®ä¿¡åŒºé—´ï¼š
$$
[\hat{\theta}_{(\alpha/2)}, \ \hat{\theta}_{(1-\alpha/2)}]
$$
å…¶ä¸­ï¼Œ$\hat{\theta}_{(\alpha/2)}$ å’Œ $\hat{\theta}_{(1-\alpha/2)}$ æ˜¯ Bootstrap æ ·æœ¬ä¸­ä½äº $\alpha/2$ å’Œ $1-\alpha/2$ å¤„çš„ç™¾åˆ†ä½æ•°ã€‚
      - ç™¾åˆ†ä½æ³•ç›´æ¥åŸºäº Bootstrap åˆ†å¸ƒï¼Œèƒ½å¤Ÿæ›´å¥½åœ°æ•æ‰æ ·æœ¬ä¸­å¯èƒ½å­˜åœ¨çš„åæ–œæ€§å’Œç¦»æ•£æ€§ã€‚è¿™ç§æ–¹æ³•ç®€å•ç›´æ¥ï¼Œé€‚ç”¨äºåˆ†å¸ƒæœªçŸ¥çš„æƒ…å†µã€‚

   - **BCa æ³•ï¼š**
      
      - BCa æ³•ä¸ä»…è€ƒè™‘äº†åå·®ï¼Œè¿˜å¯¹ç½®ä¿¡åŒºé—´è¿›è¡Œäº†åŠ é€Ÿè°ƒæ•´ã€‚å…¶ç½®ä¿¡åŒºé—´çš„å…¬å¼ä¸ºï¼š
$$
[\hat{\theta}_{(z_1)}, \ \hat{\theta}_{(z_2)}]
$$
å…¶ä¸­ $z_1$ å’Œ $z_2$ æ˜¯ç»è¿‡åå·®æ ¡æ­£å’ŒåŠ é€Ÿçš„ä¸¤ä¸ªåˆ†ä½æ•°ã€‚å…·ä½“çš„åå·®æ ¡æ­£å› å­ $z_0$ å’ŒåŠ é€Ÿå› å­ $a$ é€šè¿‡ä¸‹åˆ—å…¬å¼è®¡ç®—ï¼š
$$
z_0 = \Phi^{-1}\left( \frac{\text{count}(\hat{\theta}_{\text{boot}} < \hat{\theta})}{B} \right)
$$
$$
a = \frac{\sum_i (\hat{\theta}_{\text{boot}}^{(i)} - \hat{\theta})^3}{6 \left( \sum_i (\hat{\theta}_{\text{boot}}^{(i)} - \hat{\theta})^2 \right)^{3/2}}
$$
å…¶ä¸­ï¼Œ$\Phi^{-1}$ æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„**é€†ç´¯ç§¯åˆ†å¸ƒå‡½æ•°**ï¼Œ$\hat{\theta}_{\text{boot}}^{(i)}$ æ˜¯ç¬¬ $i$ ä¸ª Bootstrap æ ·æœ¬ï¼Œ$\text{count}(\hat{\theta}_{\text{boot}} < \hat{\theta})$ è¡¨ç¤º**Bootstrap æ ·æœ¬ä¸­**æœ‰å¤šå°‘ä¸ª $\hat{\theta}_{\text{boot}}$ å°äºåŸå§‹ä¼°è®¡å€¼ $\hat{\theta}$ï¼Œ$B$ æ˜¯**Bootstrap æ ·æœ¬çš„æ€»æ•°é‡**ã€‚
      - BCa æ³•é€šè¿‡åå·®å’ŒåŠ é€Ÿçš„æ ¡æ­£ï¼Œå¯¹åæ–œçš„åˆ†å¸ƒå…·æœ‰æ›´å¥½çš„é€‚åº”æ€§ã€‚ç‰¹åˆ«é€‚ç”¨äºå°æ ·æœ¬é‡æˆ–åˆ†å¸ƒåæ–œçš„æƒ…å†µã€‚

3. **å®ç°æ­¥éª¤**

   - **æ­¥éª¤1ï¼š** **è®¡ç®—å¹³å‡æ•…éšœæ—¶é—´** ã€‚é¦–å…ˆï¼Œä½¿ç”¨åœ¨ç»ƒä¹  7.4 ä¸­è®¡ç®—çš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡ $\lambda$ æ¥è®¡ç®—æ•…éšœæ—¶é—´çš„å¹³å‡å€¼ $\mu$ï¼Œå³ $\mu = 1/\lambda$ã€‚è¿™ä¸ªå¹³å‡å€¼ä»£è¡¨äº†æ•…éšœé—´éš”æ—¶é—´çš„é¢„æœŸå€¼ã€‚
   
   - **æ­¥éª¤2ï¼š** **å®šä¹‰ Bootstrap å‡½æ•°ã€‚**åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†æ¥å—æ•°æ®æ ·æœ¬å’ŒæŠ½æ ·ç´¢å¼•ä½œä¸ºè¾“å…¥ã€‚è¯¥å‡½æ•°å°†åœ¨é‡æŠ½æ ·åè®¡ç®—æ–°çš„ $\lambda$ çš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼Œå¹¶è¿”å›å¯¹åº”çš„å¹³å‡æ•…éšœæ—¶é—´
   
   - **æ­¥éª¤3ï¼š** **æ‰§è¡Œ Bootstrap é‡æŠ½æ ·ã€‚**ä½¿ç”¨ Bootstrap æ–¹æ³•å¯¹æ•…éšœæ—¶é—´æ•°æ®è¿›è¡Œ 10000 æ¬¡é‡æŠ½æ ·ã€‚æ¯æ¬¡é‡æŠ½æ ·éƒ½å°†ä½¿ç”¨ä¸Šè¿°å®šä¹‰çš„å‡½æ•°è®¡ç®—å¹³å‡æ•…éšœæ—¶é—´ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªåŒ…å«å¤šä¸ªä¼°è®¡å€¼çš„æ ·æœ¬ã€‚
   
   - **æ­¥éª¤4ï¼š** **è®¡ç®—ç½®ä¿¡åŒºé—´ã€‚**åˆ©ç”¨ä¸åŒçš„æ–¹æ³•è®¡ç®— 95% çš„ç½®ä¿¡åŒºé—´ã€‚
   
   - **æ­¥éª¤5ï¼š** **æ¯”è¾ƒç½®ä¿¡åŒºé—´ã€‚**å°†ä¸åŒæ–¹æ³•çš„ç½®ä¿¡åŒºé—´æ•´ç†åˆ°ä¸€ä¸ªæ•°æ®æ¡†ä¸­ï¼Œå¹¶ä½¿ç”¨å›¾å½¢åŒ–æ–¹æ³•ï¼ˆä¾‹å¦‚ä½¿ç”¨ `ggplot2`ï¼‰ç»˜åˆ¶ç½®ä¿¡åŒºé—´çš„æ¯”è¾ƒå›¾ï¼Œä»¥ç›´è§‚å±•ç¤ºå„ä¸ªæ–¹æ³•çš„å·®å¼‚ã€‚
   
   - **æ­¥éª¤6ï¼š** **ç»˜åˆ¶å›¾å½¢æ¯”è¾ƒåˆ†æã€‚**ç»˜åˆ¶ç›¸å…³å›¾å½¢ï¼Œå¯è§†åŒ–æ¯”è¾ƒåˆ†æå„æ–¹æ³•çš„ç½®ä¿¡åŒºé—´ã€‚

        
### ä»£ç å®ç°

**è®¡ç®—å¹³å‡æ•…éšœé—´éš”æ—¶é—´çš„ Bootstrap ç»“æœ**

```{r, eval=TRUE}
# å°† Î» è½¬æ¢ä¸º Î¸ = 1/Î»
boot_theta <- boot_results
boot_theta$t <- 1 / boot_theta$t
theta_hat <- 1 / lambda_hat
theta_hat
```

**è®¡ç®—ç”¨äº Bootstrap çš„ç»Ÿè®¡é‡å‡½æ•°**

```{r, eval=TRUE}
# å®šä¹‰ä¸€ä¸ªç”¨äº Bootstrap æ–¹æ³•çš„ç»Ÿè®¡é‡å‡½æ•°ï¼Œç”¨äºè®¡ç®—å¹³å‡æ•…éšœé—´éš”æ—¶é—´ï¼ˆÎ¸ = 1/Î»ï¼‰
mean_time_boot <- function(data, indices) {
  # ä»åŸå§‹æ•°æ®ä¸­æŠ½å– Bootstrap æ ·æœ¬
  # 'data' æ˜¯åŸå§‹æ•°æ®é›†ï¼Œ'indices' æ˜¯æŠ½æ ·ç´¢å¼•ï¼ˆåŒ…å«æœ‰æ”¾å›çš„æŠ½æ ·ä½ç½®ï¼‰
  sample_data <- data[indices]
  
  # è®¡ç®—æŠ½æ ·æ ·æœ¬çš„å¤§å°ï¼ˆè§‚æµ‹å€¼æ•°é‡ï¼‰
  n_boot <- length(sample_data)
  
  # è®¡ç®—æŠ½æ ·æ ·æœ¬ä¸­æ‰€æœ‰æ•…éšœæ—¶é—´çš„æ€»å’Œ
  sum_boot <- sum(sample_data)
  
  # è®¡ç®— Bootstrap æ ·æœ¬çš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼ˆMLEï¼‰Î»çš„ä¼°è®¡å€¼
  # Î» çš„ MLE å…¬å¼ä¸º Î»_hat = n / Î£x_iï¼Œå…¶ä¸­ n æ˜¯æ ·æœ¬å¤§å°ï¼ŒÎ£x_i æ˜¯æ•…éšœæ—¶é—´æ€»å’Œ
  lambda_hat <- n_boot / sum_boot
  
  # è®¡ç®—å¹³å‡æ•…éšœé—´éš”æ—¶é—´ Î¸ çš„ä¼°è®¡å€¼ï¼ŒÎ¸ = 1/Î»
  theta_boot <- 1 / lambda_hat
  
  # è¿”å› Î¸ çš„ä¼°è®¡å€¼ä½œä¸º Bootstrap æ ·æœ¬çš„ç»Ÿè®¡é‡
  return(theta_boot)
}

```

**æ‰§è¡Œ Bootstrap æ–¹æ³•**
```{r, eval=TRUE}
set.seed(133)  # è®¾ç½®éšæœºæ•°ç§å­ï¼Œä¿è¯ç»“æœå¯é‡å¤

# æ•°æ®ï¼šç©ºè°ƒè®¾å¤‡çš„æ•…éšœæ—¶é—´ï¼ˆå°æ—¶ï¼‰
failure_times <- c(3, 5, 7, 18, 43, 85, 91, 98, 100, 130, 230, 487)

# ä½¿ç”¨bootstrapæ–¹æ³•è®¡ç®—
bootstrap_mean_time_results <- boot(data = failure_times, statistic = mean_time_boot, R = 10000)

```

**è®¡ç®—ä¸åŒæ–¹æ³•çš„ç½®ä¿¡åŒºé—´**
```{r, eval=TRUE}

# æ ‡å‡†æ­£æ€æ³•ç½®ä¿¡åŒºé—´
norm_ci <- boot.ci(bootstrap_mean_time_results, type = "norm")

# åŸºæœ¬æ³•ç½®ä¿¡åŒºé—´
basic_ci <- boot.ci(bootstrap_mean_time_results, type = "basic")

# ç™¾åˆ†ä½æ³•ç½®ä¿¡åŒºé—´
perc_ci <- boot.ci(bootstrap_mean_time_results, type = "perc")

# BCa æ³•ç½®ä¿¡åŒºé—´
bca_ci <- boot.ci(bootstrap_mean_time_results, type = "bca")
```

**æ•´ç†ç½®ä¿¡åŒºé—´ç»“æœ**
```{r, eval=TRUE}
# åŠ è½½ kableExtra åŒ…
library(kableExtra)

# åˆ›å»ºæ•°æ®æ¡†å­˜å‚¨ç½®ä¿¡åŒºé—´
ci_methods <- c("æ ‡å‡†æ­£æ€æ³•", "åŸºæœ¬æ³•", "ç™¾åˆ†ä½æ³•", "BCa æ³•")
lower_bounds <- c(norm_ci$normal[2], basic_ci$basic[4], perc_ci$percent[4], bca_ci$bca[4])
upper_bounds <- c(norm_ci$normal[3], basic_ci$basic[5], perc_ci$percent[5], bca_ci$bca[5])

ci_table <- data.frame(
  æ–¹æ³• = ci_methods,
  ä¸‹é™ = lower_bounds,
  ä¸Šé™ = upper_bounds
)

# ä½¿ç”¨ kableExtra ç¾åŒ–è¡¨æ ¼
ci_table %>%
  kbl(digits = 4, caption = "å¹³å‡æ•…éšœé—´éš”æ—¶é—´çš„ 95% Bootstrap ç½®ä¿¡åŒºé—´") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), 
                full_width = F, 
                position = "center", 
                font_size = 14) %>%
  column_spec(1, bold = TRUE, color = "white", background = "gray") %>%  # ç¬¬ä¸€åˆ—åŠ ç²—ã€åŠ èƒŒæ™¯è‰²
  column_spec(2:3, width = "10em") %>%  # è®¾ç½®åˆ—å®½
  add_header_above(c(" " = 1, "ç½®ä¿¡åŒºé—´" = 2))  # æ·»åŠ åˆå¹¶è¡¨å¤´
```

**ç»˜åˆ¶ç½®ä¿¡åŒºé—´å›¾å½¢**
```{r, eval=TRUE}
library(ggplot2)

ci_table$æ–¹æ³• <- factor(ci_table$æ–¹æ³•, levels = ci_methods)

ggplot(ci_table, aes(x = æ–¹æ³•, y = (ä¸‹é™ + ä¸Šé™) / 2)) +
  geom_errorbar(aes(ymin = ä¸‹é™, ymax = ä¸Šé™), width = 0.2, color = "blue") +
  geom_point(size = 3, color = "red") +
  labs(title = "ä¸åŒæ–¹æ³•çš„ 95% Bootstrap ç½®ä¿¡åŒºé—´",
       x = "æ–¹æ³•",
       y = expression("å¹³å‡æ•…éšœé—´éš”æ—¶é—´ (" * theta * ")")) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))  # å°†æ ‡é¢˜å±…ä¸­
```



### ç»“æœåˆ†æ

**ç½®ä¿¡åŒºé—´ç»“æœï¼š**

æ ¹æ®ä¸Šè¿°å››ç§æ–¹æ³•ï¼Œå¾—åˆ°çš„ 95% ç½®ä¿¡åŒºé—´å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š

| æ–¹æ³•       |    ä¸‹é™ |    ä¸Šé™ |
| :--------- | ------: | ------: |
| æ ‡å‡†æ­£æ€æ³• | 35.1416 | 181.0358 |
| åŸºæœ¬æ³•     | 26.3333 | 169.3312 |
| ç™¾åˆ†ä½æ³•   | 46.8354 | 189.8333 |
| BCa æ³•     | 57.0833 | 220.4830 |

**å¹³å‡å€¼å’Œç½®ä¿¡åŒºé—´ä½ç½®ï¼š**

   - å¹³å‡æ•…éšœé—´éš”æ—¶é—´ $108.0833$ ä½äºæ‰€æœ‰æ–¹æ³•ç½®ä¿¡åŒºé—´çš„èŒƒå›´å†…ã€‚
   - è¿™è¯´æ˜ Bootstrap æ–¹æ³•ç”Ÿæˆçš„ä¸åŒç½®ä¿¡åŒºé—´éƒ½åˆç†åœ°åŒ…å«äº†è¯¥ä¼°è®¡å€¼ã€‚

**ç½®ä¿¡åŒºé—´å®½åº¦ä¸å¹³å‡å€¼ï¼š**

- **BCa æ³•** å’Œ **ç™¾åˆ†ä½æ³•** çš„ä¸‹é™æ¥è¿‘ $57$ å’Œ $46$ï¼Œè€Œä¸Šé™è¾ƒå®½æ³›ï¼Œæ¥è¿‘ $220$ å’Œ $190$ã€‚è¿™ä¸¤ç§æ–¹æ³•çš„å®½åŒºé—´åæ˜ äº†å¯¹æ•°æ®ä¸­é«˜å€¼çš„æ•æ„Ÿæ€§ï¼Œæ¯”å¦‚å¤§äº $200$ å°æ—¶çš„æç«¯æ•…éšœæ—¶é—´ã€‚

- **æ ‡å‡†æ­£æ€æ³•** å’Œ **åŸºæœ¬æ³•** çš„ç½®ä¿¡åŒºé—´è¾ƒçª„ï¼Œå°¤å…¶æ˜¯åŸºæœ¬æ³•çš„ä¸‹é™è¾ƒä½ï¼ˆ$26.3333$ï¼‰ï¼Œå¯èƒ½ä½ä¼°äº†æ•°æ®ä¸­å¤§æ•…éšœæ—¶é—´å¯¹å¹³å‡å€¼çš„å½±å“ã€‚

**æ›´ä¿å®ˆçš„é€‰æ‹©ï¼š**

   - å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´ä¿å®ˆã€ç¨³å¥çš„ä¼°è®¡ï¼Œè€ƒè™‘åˆ°æ•…éšœæ—¶é—´å¯èƒ½å­˜åœ¨åæ–œï¼Œå»ºè®®ä½¿ç”¨ **BCa æ³•** æˆ– **ç™¾åˆ†ä½æ³•**ã€‚
   - å®ƒä»¬ä¸ä»…åŒ…å«äº† $108.0833$ çš„ä¼°è®¡å€¼ï¼Œè¿˜åæ˜ äº†æ•°æ®çš„å¤æ‚æ€§å’Œä¸å¯¹ç§°æ€§ã€‚

**ä¸ºä½•ä¸åŒï¼š**

   - **åˆ†å¸ƒå½¢çŠ¶çš„å½±å“**ï¼šå¦‚æœåŸå§‹æ•°æ®çš„åˆ†å¸ƒæ˜¯åæ–œçš„ï¼Œæ­£æ€æ€§å‡è®¾ä¸å†æˆç«‹ï¼Œé‚£ä¹ˆæ ‡å‡†æ­£æ€æ³•å¯èƒ½ä¼šç»™å‡ºåå·®è¾ƒå¤§çš„åŒºé—´ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œç™¾åˆ†ä½æ³•å’Œ BCa æ³•ç›´æ¥ä¾èµ–äº Bootstrap æ ·æœ¬çš„åˆ†å¸ƒï¼Œæ›´èƒ½åæ˜ å®é™…çš„åˆ†å¸ƒç‰¹å¾ã€‚
   
   - **åå·®æ ¡æ­£çš„ä½œç”¨**ï¼šBCa æ³•ä¹‹æ‰€ä»¥æ¯”å…¶ä»–æ–¹æ³•æ›´ä¸ºç¨³å¥ï¼Œæ˜¯å› ä¸ºå®ƒä¸ä»…è€ƒè™‘äº†åå·®ï¼Œè¿˜é€šè¿‡åŠ é€Ÿå› å­è¿›è¡Œäº†è°ƒæ•´ã€‚å› æ­¤ï¼Œå®ƒèƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”åæ–œåˆ†å¸ƒï¼Œç‰¹åˆ«æ˜¯åœ¨æ ·æœ¬é‡è¾ƒå°æ—¶ã€‚
   
   - **æ ·æœ¬é‡çš„å½±å“**ï¼šå½“æ ·æœ¬é‡è¾ƒå°æ—¶ï¼Œæ ‡å‡†æ­£æ€æ³•çš„æ•ˆæœé€šå¸¸ä¼šä¸å¦‚å…¶ä»–æ–¹æ³•ï¼Œå°¤å…¶æ˜¯åœ¨æ•°æ®çš„åˆ†å¸ƒè¿œç¦»æ­£æ€åˆ†å¸ƒçš„æƒ…å†µä¸‹ã€‚BCa æ³•å’Œç™¾åˆ†ä½æ³•ç”±äºç›´æ¥åŸºäº Bootstrap åˆ†å¸ƒï¼Œå› æ­¤å¯¹æ ·æœ¬é‡çš„ä¾èµ–æ€§è¾ƒå°ã€‚

**åˆ†æä¸æ€»ç»“ï¼š**

- **ç½®ä¿¡åŒºé—´èŒƒå›´æ¯”è¾ƒ**ï¼šBCa æ³•çš„ç½®ä¿¡åŒºé—´æœ€ä¸ºå®½æ³›ï¼Œå°¤å…¶æ˜¯ä¸Šé™è¿œé«˜äºå…¶ä»–æ–¹æ³•ã€‚æ ‡å‡†æ­£æ€æ³•å’ŒåŸºæœ¬æ³•çš„ç½®ä¿¡åŒºé—´è¾ƒå°ï¼Œè¡¨æ˜å®ƒä»¬å¯¹ä¸å¯¹ç§°åˆ†å¸ƒçš„å¤„ç†èƒ½åŠ›æœ‰é™ã€‚ç™¾åˆ†ä½æ³•å’Œ BCa æ³•åˆ™è¾ƒä¸ºçµæ´»ï¼Œèƒ½å¤Ÿæ•æ‰æ•°æ®çš„æç«¯æƒ…å†µã€‚

- **é€‚ç”¨æ€§æ¯”è¾ƒ**ï¼šåœ¨å®é™…åº”ç”¨ä¸­ï¼ŒBCa æ³•å’Œç™¾åˆ†ä½æ³•æ›´é€‚åˆæ•°æ®åˆ†å¸ƒå¯èƒ½åæ–œã€ä¸å¯¹ç§°çš„æƒ…å†µã€‚BCa æ³•ç”±äºè¿›è¡Œäº†åæ–œå’ŒåŠ é€Ÿçš„è°ƒæ•´ï¼Œå› æ­¤æ˜¯å››ç§æ–¹æ³•ä¸­æœ€ä¸ºç¨³å¥çš„é€‰æ‹©ã€‚æ ‡å‡†æ­£æ€æ³•å’ŒåŸºæœ¬æ³•åœ¨æ ·æœ¬é‡è¾ƒå°æˆ–æ•°æ®ä¸æ­£æ€åˆ†å¸ƒæ—¶å¯èƒ½æ•ˆæœä¸ä½³ã€‚

- **æœ€ç»ˆç»“è®º**ï¼šç”±äºç©ºè°ƒè®¾å¤‡çš„æ•…éšœæ—¶é—´åˆ†å¸ƒå¯èƒ½å‘ˆç°åæ–œï¼ŒBCa æ³•æä¾›çš„ç½®ä¿¡åŒºé—´èƒ½å¤Ÿæ›´å¥½åœ°æè¿°è¿™ç§ä¸ç¡®å®šæ€§ï¼Œè™½ç„¶èŒƒå›´è¾ƒå®½ï¼Œä½†ä¹Ÿæ›´å…·ä¿å®ˆæ€§ï¼Œæ˜¯è¾ƒä¸ºæ¨èçš„ç½®ä¿¡åŒºé—´è®¡ç®—æ–¹æ³•ã€‚

---


# æ€»ç»“

## å›°éš¾ä¸è§£å†³æ–¹å¼

åœ¨å®Œæˆæ­¤æ¬¡ä½œä¸šçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘é‡åˆ°äº†å¤šä¸ªå®é™…æ“ä½œå’Œç†è®ºç†è§£ä¸Šçš„æŒ‘æˆ˜ï¼š

**1. å¤šé‡å‡è®¾æ£€éªŒçš„æ¨¡æ‹Ÿå¤æ‚æ€§**

é¦–å…ˆï¼Œåœ¨**å¤šé‡å‡è®¾æ£€éªŒ**çš„æ¨¡æ‹Ÿéƒ¨åˆ†ï¼Œç”±äºéœ€è¦è¿›è¡Œ10000æ¬¡é‡å¤å®éªŒï¼Œå¦‚ä½•é«˜æ•ˆåœ°ç”Ÿæˆå’Œå¤„ç†å¤§é‡çš„på€¼æˆä¸ºäº†ä¸€ä¸ªä¸»è¦éš¾é¢˜ã€‚èµ·åˆï¼Œæˆ‘çš„ä»£ç è¿è¡Œé€Ÿåº¦éå¸¸ç¼“æ…¢ï¼Œå¯¼è‡´æ•´ä¸ªæ¨¡æ‹Ÿè¿‡ç¨‹è€—æ—¶è¿‡é•¿ã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæˆ‘æ·±å…¥ç ”ç©¶äº†Rè¯­è¨€ä¸­å‘é‡åŒ–æ“ä½œçš„ä¼˜åŠ¿ï¼Œå°½é‡é¿å…åœ¨å¾ªç¯ä¸­è¿›è¡Œé€ä¸ªè®¡ç®—ã€‚ä¾‹å¦‚ï¼Œåˆ©ç”¨`runif`å’Œ`rbeta`å‡½æ•°ä¸€æ¬¡æ€§ç”Ÿæˆæ‰€æœ‰på€¼ï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡å¾ªç¯ä¸­ç”Ÿæˆã€‚æ­¤å¤–ï¼Œæˆ‘è¿˜å­¦ä¹ äº†å¦‚ä½•åˆç†ä½¿ç”¨å¹¶è¡Œè®¡ç®—åŒ…ï¼ˆå¦‚`parallel`å’Œ`foreach`ï¼‰ï¼Œå°†æ¨¡æ‹Ÿä»»åŠ¡åˆ†é…åˆ°å¤šä¸ªå¤„ç†å™¨æ ¸ä¸Šï¼Œä»è€Œæ˜¾è‘—ç¼©çŸ­äº†è¿è¡Œæ—¶é—´ã€‚è¿™ä¸ä»…æå‡äº†ä»£ç çš„æ‰§è¡Œæ•ˆç‡ï¼Œä¹Ÿè®©æˆ‘å¯¹Rè¯­è¨€çš„é«˜æ•ˆç¼–ç¨‹æŠ€å·§æœ‰äº†æ›´æ·±å…¥çš„ç†è§£ã€‚

**2. æ­£ç¡®å®æ–½Benjamini-Hochbergæ ¡æ­£**

åœ¨å®ç°**Benjamini-Hochberg (B-H) æ ¡æ­£**æ—¶ï¼Œæˆ‘æœ€åˆå¯¹è¯¥æ–¹æ³•çš„å…·ä½“æ­¥éª¤å’Œé€»è¾‘ç†è§£ä¸å¤Ÿé€å½»ï¼Œå¯¼è‡´åœ¨è°ƒæ•´på€¼å’Œç¡®å®šæ‹’ç»åŸŸæ—¶å‡ºç°äº†é”™è¯¯ã€‚é€šè¿‡æŸ¥é˜…ç›¸å…³æ–‡çŒ®å’Œå­¦ä¹ æ›´å¤šå…³äºFDRæ§åˆ¶çš„èµ„æ–™ï¼Œæˆ‘é€æ­¥ç†æ¸…äº†B-Hæ ¡æ­£çš„åŸç†å’Œæ­¥éª¤ã€‚ç‰¹åˆ«æ˜¯ç†è§£äº†å¦‚ä½•æ ¹æ®æ’åºåçš„på€¼ä¸è°ƒæ•´åçš„æ˜¾è‘—æ€§æ°´å¹³è¿›è¡Œæ¯”è¾ƒï¼Œä»è€Œæ­£ç¡®åœ°è¯†åˆ«å‡ºæ˜¾è‘—çš„å‡è®¾ã€‚æ­¤å¤–ï¼Œæˆ‘é€šè¿‡ç¼–å†™è¯¦ç»†çš„æ³¨é‡Šå’Œé€æ­¥è°ƒè¯•ä»£ç ï¼Œç¡®ä¿æ¯ä¸€æ­¥çš„è®¡ç®—éƒ½ç¬¦åˆç†è®ºé¢„æœŸã€‚è¿™ä¸€è¿‡ç¨‹ä¸ä»…æå‡äº†æˆ‘çš„ç†è®ºçŸ¥è¯†ï¼Œä¹Ÿå¢å¼ºäº†æˆ‘åœ¨å®é™…ç¼–ç¨‹ä¸­åº”ç”¨ç»Ÿè®¡æ–¹æ³•çš„èƒ½åŠ›ã€‚

**3. Bootstrapæ–¹æ³•ä¸­çš„BCaç½®ä¿¡åŒºé—´å®ç°**

åœ¨**Bootstrapæ–¹æ³•**çš„åº”ç”¨ä¸­ï¼Œè®¡ç®—BCaç½®ä¿¡åŒºé—´æ˜¯ä¸€ä¸ªè¾ƒä¸ºå¤æ‚çš„æ­¥éª¤ã€‚BCaæ–¹æ³•ä¸ä»…éœ€è¦è€ƒè™‘åå·®æ ¡æ­£ï¼Œè¿˜éœ€è¦è®¡ç®—åŠ é€Ÿå› å­ï¼Œè¿™æ¶‰åŠåˆ°å¯¹ç»Ÿè®¡ç†è®ºçš„æ·±åˆ»ç†è§£ã€‚èµ·åˆï¼Œæˆ‘åœ¨å®ç°BCaæ–¹æ³•æ—¶é‡åˆ°äº†å›°éš¾ï¼Œå°¤å…¶æ˜¯åœ¨è®¡ç®—åå·®æ ¡æ­£å› å­å’ŒåŠ é€Ÿå› å­çš„è¿‡ç¨‹ä¸­ï¼ŒRè¯­è¨€ä¸­çš„å‡½æ•°è°ƒç”¨å’Œå‚æ•°è®¾ç½®ä¸ç†Ÿæ‚‰ï¼Œå¯¼è‡´ç»“æœä¸å‡†ç¡®ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæˆ‘è¯¦ç»†é˜…è¯»äº†`boot`åŒ…çš„å®˜æ–¹æ–‡æ¡£ï¼Œå¹¶å‚è€ƒäº†å¤šä¸ªåœ¨çº¿æ•™ç¨‹å’Œç¤ºä¾‹ä»£ç ï¼Œé€æ­¥ç†æ¸…äº†BCaæ–¹æ³•çš„è®¡ç®—æ­¥éª¤ã€‚é€šè¿‡åå¤è°ƒè¯•å’ŒéªŒè¯ï¼Œæˆ‘æˆåŠŸåœ°å®ç°äº†BCaç½®ä¿¡åŒºé—´çš„è®¡ç®—ï¼Œå¹¶ä¸å…¶ä»–æ–¹æ³•çš„ç»“æœè¿›è¡Œäº†æ¯”è¾ƒï¼Œç¡®ä¿å…¶å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚

**4. æ•°æ®å¯è§†åŒ–ä¸ç»“æœè§£é‡Š**

åœ¨å®Œæˆæ¨¡æ‹Ÿå’ŒBootstrapåˆ†æåï¼Œå¦‚ä½•æœ‰æ•ˆåœ°**å¯è§†åŒ–ç»“æœ**å’Œ**è§£é‡Šæ•°æ®åˆ†å¸ƒ**ä¹Ÿæ˜¯ä¸€å¤§æŒ‘æˆ˜ã€‚å°¤å…¶æ˜¯åœ¨å±•ç¤ºpå€¼çš„å¯†åº¦åˆ†å¸ƒå’Œç½®ä¿¡åŒºé—´çš„æ¯”è¾ƒæ—¶ï¼Œæˆ‘å¸Œæœ›å›¾è¡¨æ—¢èƒ½å¤Ÿæ¸…æ™°ä¼ è¾¾ä¿¡æ¯ï¼Œåˆå…·æœ‰è‰¯å¥½çš„ç¾è§‚æ€§ã€‚ä¸ºæ­¤ï¼Œæˆ‘æ·±å…¥å­¦ä¹ äº†`ggplot2`åŒ…çš„é«˜çº§åŠŸèƒ½ï¼ŒæŒæ¡äº†å¦‚ä½•è‡ªå®šä¹‰å›¾å½¢å…ƒç´ ã€è°ƒæ•´é¢œè‰²å’Œæ ·å¼ï¼Œä»¥åŠå¦‚ä½•æ·»åŠ è¾…åŠ©çº¿å’Œå›¾ä¾‹ã€‚é€šè¿‡ä¸æ–­å°è¯•ä¸åŒçš„å›¾å½¢è®¾è®¡ï¼Œæœ€ç»ˆåˆ¶ä½œå‡ºäº†æ—¢ç¾è§‚åˆä¿¡æ¯é‡ä¸°å¯Œçš„å›¾è¡¨ï¼Œå¸®åŠ©æ›´ç›´è§‚åœ°ç†è§£æ¨¡æ‹Ÿç»“æœå’ŒBootstrapåˆ†æçš„è¾“å‡ºã€‚

## æ€è€ƒä¸æ„Ÿæ‚Ÿ

æ­¤æ¬¡ä½œä¸šä½¿æˆ‘æ·±åˆ»ä½“ä¼šåˆ°**ç»Ÿè®¡æ–¹æ³•åœ¨å®é™…åº”ç”¨ä¸­çš„å¤æ‚æ€§ä¸çµæ´»æ€§**ã€‚åœ¨å¤šé‡å‡è®¾æ£€éªŒä¸­ï¼ŒBonferroniå’ŒB-Hæ ¡æ­£æ–¹æ³•å„æœ‰ä¼˜åŠ£ï¼ŒBonferroniæ–¹æ³•è™½ç„¶ä¸¥æ ¼æ§åˆ¶äº†å®¶æ—é”™è¯¯ç‡ï¼ˆFWERï¼‰ï¼Œä½†å…¶ä¿å®ˆæ€§å¯¼è‡´çœŸé˜³æ€§ç‡ï¼ˆTPRï¼‰è¾ƒä½ï¼›è€ŒB-Hæ–¹æ³•è™½ç„¶åœ¨æ§åˆ¶é”™è¯¯å‘ç°ç‡ï¼ˆFDRï¼‰æ–¹é¢è¡¨ç°å‡ºè‰²ï¼Œä½†å…¶FWERè¾ƒé«˜ã€‚è¿™è®©æˆ‘è®¤è¯†åˆ°ï¼Œé€‰æ‹©åˆé€‚çš„æ ¡æ­£æ–¹æ³•éœ€è¦æ ¹æ®å…·ä½“çš„ç ”ç©¶ç›®çš„å’Œæ•°æ®ç‰¹æ€§è¿›è¡Œæƒè¡¡ï¼Œæ²¡æœ‰ä¸€ç§æ–¹æ³•æ˜¯ä¸‡èƒ½çš„ã€‚è¿™ç§æƒè¡¡ä¸ä»…è€ƒéªŒç»Ÿè®¡å­¦çŸ¥è¯†ï¼Œæ›´éœ€è¦å¯¹ç ”ç©¶èƒŒæ™¯å’Œå®é™…éœ€æ±‚æœ‰æ·±åˆ»çš„ç†è§£ã€‚

åœ¨Bootstrapæ–¹æ³•çš„å­¦ä¹ å’Œåº”ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä½“ä¼šåˆ°äº†**éå‚æ•°æ–¹æ³•çš„å¼ºå¤§ä¸çµæ´»**ã€‚é€šè¿‡åå¤æŠ½æ ·å’Œé‡æ–°è®¡ç®—ï¼Œæˆ‘ä¸ä»…æŒæ¡äº†å¦‚ä½•ä¼°è®¡å‚æ•°çš„åå·®å’Œæ ‡å‡†è¯¯ï¼Œè¿˜å­¦ä¼šäº†å¦‚ä½•æ„å»ºä¸åŒç±»å‹çš„ç½®ä¿¡åŒºé—´ã€‚è¿™äº›æ–¹æ³•åœ¨å¤„ç†å¤æ‚æ•°æ®å’Œå°æ ·æœ¬é—®é¢˜æ—¶å±•ç°å‡ºå…¶ç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼Œå°¤å…¶æ˜¯åœ¨åˆ†å¸ƒæœªçŸ¥æˆ–ä¸å¯¹ç§°çš„æƒ…å†µä¸‹ï¼ŒBootstrapæ–¹æ³•èƒ½å¤Ÿæä¾›æ›´ä¸ºå¯é çš„ä¼°è®¡ã€‚ç„¶è€Œï¼ŒBootstrapæ–¹æ³•ä¹Ÿæœ‰å…¶å±€é™æ€§ï¼Œå¦‚è®¡ç®—é‡å¤§ã€å¯¹æ ·æœ¬ä»£è¡¨æ€§çš„ä¾èµ–ç­‰ï¼Œè¿™è®©æˆ‘æ„è¯†åˆ°åœ¨å®é™…åº”ç”¨ä¸­éœ€è¦æƒè¡¡å…¶ä¼˜åŠ¿ä¸ä¸è¶³ï¼Œåˆç†é€‰æ‹©ä½¿ç”¨åœºæ™¯ã€‚

æ­¤å¤–ï¼Œæ•´ä¸ªå®éªŒè¿‡ç¨‹ä¸­ï¼Œæˆ‘æ·±åˆ»æ„Ÿå—åˆ°**ç†è®ºä¸å®è·µç›¸ç»“åˆçš„é‡è¦æ€§**ã€‚ä»…ä»…ç†è§£ç»Ÿè®¡æ–¹æ³•çš„ç†è®ºåŸºç¡€æ˜¯ä¸å¤Ÿçš„ï¼Œå¦‚ä½•å°†å…¶æœ‰æ•ˆåœ°åº”ç”¨äºå®é™…é—®é¢˜ä¸­ï¼Œè§£å†³å…·ä½“çš„æ•°æ®åˆ†æé—®é¢˜ï¼Œæ‰æ˜¯çœŸæ­£è€ƒéªŒç»Ÿè®¡å­¦ç´ å…»çš„å…³é”®ã€‚é€šè¿‡åŠ¨æ‰‹ç¼–ç¨‹å’Œåå¤è°ƒè¯•ï¼Œæˆ‘ä¸ä»…å·©å›ºäº†ç†è®ºçŸ¥è¯†ï¼Œè¿˜æå‡äº†å®é™…æ“ä½œèƒ½åŠ›ã€‚è¿™ç§ç†è®ºä¸å®è·µçš„ç»“åˆï¼Œä¸ä»…å¢å¼ºäº†æˆ‘çš„æ•°æ®åˆ†ææŠ€èƒ½ï¼Œä¹ŸåŸ¹å…»äº†æˆ‘è§£å†³é—®é¢˜çš„èƒ½åŠ›å’Œé€»è¾‘æ€ç»´ã€‚


---


# ç»Ÿè®¡è®¡ç®—ç¬¬6æ¬¡ä½œä¸š { .center-title }

ä»¥ä¸‹æ˜¯ç»Ÿè®¡è®¡ç®—2024-10-21è¯¾ç¨‹å¯¹åº”çš„ä½œä¸š

# Question

Exercises 7.8, 7.10, 8.1 and 8.2 (pages 213 and 243, Statistical
Computing with R).

-   **Exercise 7.8** Refer to Exercise 7.7. Obtain the jackknife
    estimates of bias and standard error of $\hat{\theta}$.

-   **Exercise 7.10** In Example 7.18, leave-one-out ($n$-fold) cross
    validation was used to select the best fitting model. Repeat the
    analysis replacing the Log-Log model with a cubic polynomial model.
    Which of the four models is selected by the cross validation
    procedure? Which model is selected according to maximum adjusted
    $R^2$?

-   **Exercise 8.1** Implement the two-sample CramÃ©r-von Mises test for
    equal distributions as a permutation test. Apply the test to the
    data in Examples 8.1 and 8.2.

-   **Exercise 8.2** Implement the bivariate Spearman rank correlation
    test for independence [255] as a permutation test. The Spearman rank
    correlation test statistic can be obtained from function **cor**
    with method = **"spearman"**.Compare the achieved signiï¬cance level
    of the permutation test with the $p$-value reported by **cor.test**
    on the same samples.

# Answer

## ç»ƒä¹  7.8

### é¢˜ç›®æè¿°

å¯¹äºç»ƒä¹ 7.8ï¼Œæˆ‘ä»¬éœ€å‚è€ƒç»ƒä¹ 7.7ï¼Œæ±‚å‡ºä¼°è®¡é‡$\hat{\theta}$çš„åå·®å’Œæ ‡å‡†è¯¯å·®çš„åˆ€åˆ‡æ³•(Jackknife)ä¼°è®¡ã€‚

> åœ¨ç»ƒä¹ 7.7ä¸­ï¼Œä¸»è¦æ˜¯å¯¹**scor**æ•°æ®é›†è¿›è¡Œäº†ä¸»æˆåˆ†åˆ†æï¼Œè®¡ç®—äº†ç¬¬ä¸€ä¸ªä¸»æˆåˆ†æ‰€è§£é‡Šçš„æ€»æ–¹å·®æ¯”ä¾‹$\hat{\theta}$ã€‚

è€Œç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Jackknifeæ–¹æ³•æ¥ä¼°è®¡$\hat{\theta}$çš„åå·®å’Œæ ‡å‡†è¯¯å·®ã€‚

### è§£ç­”æ€è·¯

**Jackknifeæ–¹æ³•**æ˜¯ä¸€ç§é‡æŠ½æ ·æŠ€æœ¯ï¼Œç”¨äºä¼°è®¡ç»Ÿè®¡é‡çš„åå·®å’Œæ ‡å‡†è¯¯å·®ã€‚å…¶åŸºæœ¬æ€æƒ³æ˜¯ä¾æ¬¡ä»æ ·æœ¬ä¸­åˆ é™¤ä¸€ä¸ªè§‚æµ‹å€¼ï¼Œè®¡ç®—ç»Ÿè®¡é‡çš„å˜åŒ–ï¼Œä»è€Œä¼°è®¡å‡ºç»Ÿè®¡é‡çš„åå·®å’Œæ ‡å‡†è¯¯å·®ã€‚

å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

1.**è®¡ç®—å…¨æ ·æœ¬çš„ä¼°è®¡é‡**$\hat{\theta}$ï¼š

-   å¯¹åŸå§‹æ•°æ®è¿›è¡Œä¸»æˆåˆ†åˆ†æï¼Œè®¡ç®—åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å€¼$\hat{\lambda}_1, \hat{\lambda}_2, \hat{\lambda}_3, \hat{\lambda}_4, \hat{\lambda}_5$ã€‚
-   è®¡ç®—$\hat{\theta} = \dfrac{\hat{\lambda}_1}{\sum_{j=1}^5 \hat{\lambda}_j}$ï¼Œå³ç¬¬ä¸€ä¸ªä¸»æˆåˆ†æ‰€è§£é‡Šçš„æ–¹å·®æ¯”ä¾‹ã€‚

2.**è¿›è¡ŒJackknifeé‡æŠ½æ ·**ï¼š

-   å¯¹äºæ¯ä¸ªè§‚æµ‹å€¼$i = 1, 2, \dots, n$ï¼š
    -   ä»æ•°æ®ä¸­åˆ é™¤ç¬¬$i$ä¸ªè§‚æµ‹å€¼ï¼Œå¾—åˆ°åˆ å¤±æ ·æœ¬ã€‚
    -   å¯¹åˆ å¤±æ ·æœ¬è¿›è¡Œä¸»æˆåˆ†åˆ†æï¼Œè®¡ç®—åˆ å¤±æ ·æœ¬çš„ä¼°è®¡é‡$\hat{\theta}_{(i)}$ã€‚

3.**è®¡ç®—Jackknifeä¼°è®¡çš„åå·®å’Œæ ‡å‡†è¯¯å·®**ï¼š

-   **Jackknifeå‡å€¼**ï¼š $$
    \bar{\theta}_{\text{jack}} = \dfrac{1}{n} \sum_{i=1}^n \hat{\theta}_{(i)}
    $$

-   **åå·®çš„Jackknifeä¼°è®¡**ï¼š $$
    \text{Bias}_{\text{jack}} = (n - 1)(\bar{\theta}_{\text{jack}} - \hat{\theta})
    $$

-   **æ ‡å‡†è¯¯å·®çš„Jackknifeä¼°è®¡**ï¼š $$
    \text{SE}_{\text{jack}} = \sqrt{\dfrac{n - 1}{n} \sum_{i=1}^n (\hat{\theta}_{(i)} - \bar{\theta}_{\text{jack}})^2}
    $$

4.**ç»“æœåˆ†æ**ï¼š

-   é€šè¿‡è®¡ç®—ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°$\hat{\theta}$çš„åå·®å’Œæ ‡å‡†è¯¯å·®çš„Jackknifeä¼°è®¡å€¼ã€‚
-   é€šè¿‡ç»˜åˆ¶$\hat{\theta}_{(i)}$çš„åˆ†å¸ƒå›¾ï¼Œå¯ä»¥ç›´è§‚åœ°äº†è§£ä¼°è®¡é‡çš„å˜åŠ¨æƒ…å†µã€‚

### ä»£ç å®ç°

**1.æ•°æ®åŠ è½½ä¸é¢„å¤„ç†**

```{r, eval=TRUE}
# åŠ è½½å¿…è¦çš„åº“
library(bootstrap)    # åŒ…å«scoræ•°æ®é›†
library(ggplot2)     # ç»˜å›¾
library(gridExtra)   # æ’ç‰ˆå¤šä¸ªå›¾å½¢

# è¯»å–æ•°æ®
data("scor")  # åŠ è½½scoræ•°æ®é›†

# æŸ¥çœ‹æ•°æ®é›†çš„åŸºæœ¬ä¿¡æ¯
str(scor)
summary(scor)

# æ ·æœ¬å®¹é‡
n <- nrow(scor)
```

**2.è®¡ç®—å…¨æ ·æœ¬çš„ä¼°è®¡é‡**$\hat{\theta}$

```{r, eval=TRUE}
# è®¡ç®—å…¨æ ·æœ¬çš„åæ–¹å·®çŸ©é˜µ
cov_mat <- cov(scor)

# è®¡ç®—åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å€¼ï¼ˆä»å¤§åˆ°å°æ’åºï¼‰
eigen_values <- eigen(cov_mat)$values

# è®¡ç®—å…¨æ ·æœ¬çš„ä¼°è®¡é‡ hat_theta
hat_theta <- eigen_values[1] / sum(eigen_values)
print(paste("å…¨æ ·æœ¬ä¼°è®¡é‡ hat_theta =", round(hat_theta, 5)))
```

**3.è¿›è¡ŒJackknifeé‡æŠ½æ ·å¹¶è®¡ç®—åˆ å¤±æ ·æœ¬çš„ä¼°è®¡é‡**

```{r, eval=TRUE}
# åˆå§‹åŒ–å‘é‡ï¼Œå­˜å‚¨æ¯ä¸ªåˆ å¤±æ ·æœ¬çš„ä¼°è®¡é‡
theta_jackknife <- numeric(n)

# å¼€å§‹Jackknifeè¿‡ç¨‹
for (i in 1:n) {
  # æ„å»ºåˆ å¤±æ ·æœ¬ï¼Œåˆ é™¤ç¬¬iä¸ªè§‚æµ‹å€¼
  scor_minus_i <- scor[-i, ]
  
  # è®¡ç®—åˆ å¤±æ ·æœ¬çš„åæ–¹å·®çŸ©é˜µ
  cov_mat_i <- cov(scor_minus_i)
  
  # è®¡ç®—ç‰¹å¾å€¼
  eigen_values_i <- eigen(cov_mat_i)$values
  
  # è®¡ç®—åˆ å¤±æ ·æœ¬çš„ä¼°è®¡é‡
  theta_jackknife[i] <- eigen_values_i[1] / sum(eigen_values_i)
}
```

**4.è®¡ç®—Jackknifeä¼°è®¡çš„åå·®å’Œæ ‡å‡†è¯¯å·®**

```{r, eval=TRUE}
# è®¡ç®—Jackknifeå‡å€¼
theta_bar <- mean(theta_jackknife)

# è®¡ç®—åå·®çš„Jackknifeä¼°è®¡
bias_jackknife <- (n - 1) * (theta_bar - hat_theta)

# è®¡ç®—æ ‡å‡†è¯¯å·®çš„Jackknifeä¼°è®¡
se_jackknife <- sqrt((n - 1) * mean((theta_jackknife - theta_bar)^2))

# è¾“å‡ºç»“æœ
print(paste("Jackknifeä¼°è®¡çš„åå·® =", round(bias_jackknife, 5)))
print(paste("Jackknifeä¼°è®¡çš„æ ‡å‡†è¯¯å·® =", round(se_jackknife, 5)))
```

**5.ç»˜åˆ¶ç»“æœå›¾å½¢**

```{r, eval=TRUE}
# ç»˜åˆ¶åˆ å¤±æ ·æœ¬ä¼°è®¡é‡çš„åˆ†å¸ƒç›´æ–¹å›¾
df <- data.frame(Theta = theta_jackknife)
p1 <- ggplot(df, aes(x = Theta)) +
  geom_histogram(color = "black", fill = "skyblue", bins = 15) +
  geom_vline(xintercept = hat_theta, color = "red", linetype = "dashed") +
  labs(title = "åˆ å¤±æ ·æœ¬ä¼°è®¡é‡çš„åˆ†å¸ƒ", x = expression(hat(theta)[(i)]), y = "é¢‘æ•°") +
  theme_minimal()+
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14) # å¯é€‰ï¼šè°ƒæ•´å­—ä½“æ ·å¼
  )

# ç»˜åˆ¶åˆ å¤±æ ·æœ¬ä¼°è®¡é‡çš„ç®±çº¿å›¾
p2 <- ggplot(df, aes(y = Theta)) +
  geom_boxplot(fill = "lightgreen") +
  geom_hline(yintercept = hat_theta, color = "red", linetype = "dashed") +
  labs(title = "åˆ å¤±æ ·æœ¬ä¼°è®¡é‡çš„ç®±çº¿å›¾", y = expression(hat(theta)[(i)])) +
  theme_minimal()+
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14) # å¯é€‰ï¼šè°ƒæ•´å­—ä½“æ ·å¼
  )

# æ˜¾ç¤ºå›¾å½¢
grid.arrange(p1, p2, nrow = 1)

# ç»˜åˆ¶åˆ å¤±æ ·æœ¬ä¼°è®¡é‡çš„QQå›¾ï¼Œæ£€éªŒæ­£æ€æ€§
p3 <- ggplot(df, aes(sample = Theta)) +
  stat_qq(color = "blue") +
  stat_qq_line(color = "red") +
  labs(title = "åˆ å¤±æ ·æœ¬ä¼°è®¡é‡çš„QQå›¾") +
  theme_minimal()+
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14) # å¯é€‰ï¼šè°ƒæ•´å­—ä½“æ ·å¼
  )

# æ˜¾ç¤ºQQå›¾
print(p3)

```

### ç»“æœåˆ†æ

**1.å…¨æ ·æœ¬çš„ä¼°è®¡é‡**$\hat{\theta}$ï¼š

-   é€šè¿‡å¯¹åŸå§‹æ•°æ®è¿›è¡Œä¸»æˆåˆ†åˆ†æï¼Œæˆ‘ä»¬å¾—åˆ°äº†å…¨æ ·æœ¬çš„ä¼°è®¡é‡ï¼š $$
    \hat{\theta} = 0.61912
    $$ è¿™æ„å‘³ç€ç¬¬ä¸€ä¸ªä¸»æˆåˆ†è§£é‡Šäº†61.912%çš„æ€»æ–¹å·®ã€‚

**2.Jackknifeä¼°è®¡çš„åå·®å’Œæ ‡å‡†è¯¯å·®**ï¼š

-   **åå·®çš„Jackknifeä¼°è®¡**ï¼š $$
    \text{Bias}_{\text{jack}} = (n - 1)(\bar{\theta}_{\text{jack}} - \hat{\theta}) = 0.00107
    $$ è¿™ä¸ªåå·®å¾ˆå°ï¼Œæ¥è¿‘äºé›¶ï¼Œè¯´æ˜$\hat{\theta}$æ˜¯è¿‘ä¼¼æ— åçš„ä¼°è®¡é‡ã€‚

-   **æ ‡å‡†è¯¯å·®çš„Jackknifeä¼°è®¡**ï¼š $$
    \text{SE}_{\text{jack}} = \sqrt{\dfrac{n - 1}{n} \sum_{i=1}^n (\hat{\theta}_{(i)} - \bar{\theta}_{\text{jack}})^2} = 0.04955
    $$
    è¿™è¡¨ç¤º$\hat{\theta}$çš„æ ‡å‡†è¯¯å·®çº¦ä¸º0.04955ï¼Œåæ˜ äº†ä¼°è®¡é‡çš„å˜å¼‚ç¨‹åº¦ã€‚

**3.å›¾å½¢åˆ†æ**ï¼š

-   **åˆ å¤±æ ·æœ¬ä¼°è®¡é‡çš„åˆ†å¸ƒç›´æ–¹å›¾å’Œç®±çº¿å›¾**ï¼š

    -   ç›´æ–¹å›¾æ˜¾ç¤ºï¼Œåˆ å¤±æ ·æœ¬çš„ä¼°è®¡é‡$\hat{\theta}_{(i)}$å¤§è‡´å‘ˆæ­£æ€åˆ†å¸ƒï¼Œé›†ä¸­åœ¨0.62é™„è¿‘ã€‚
    -   ç®±çº¿å›¾æ˜¾ç¤ºï¼Œå¤§éƒ¨åˆ†ä¼°è®¡é‡é›†ä¸­åœ¨å››åˆ†ä½èŒƒå›´å†…ï¼Œæ²¡æœ‰æ˜æ˜¾çš„ç¦»ç¾¤å€¼ã€‚

-   **QQå›¾**ï¼š

    -   QQå›¾ç”¨äºæ£€éªŒåˆ å¤±æ ·æœ¬ä¼°è®¡é‡çš„æ­£æ€æ€§ã€‚
    -   ä»QQå›¾å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®ç‚¹å¤§è‡´æ²¿ç€å‚è€ƒç›´çº¿åˆ†å¸ƒï¼Œè¯´æ˜ä¼°è®¡é‡è¿‘ä¼¼æœä»æ­£æ€åˆ†å¸ƒã€‚

**4.åˆæ­¥ç»“è®º**ï¼š

-   **åå·®è¯„ä¼°**ï¼šåå·®çš„Jackknifeä¼°è®¡æ¥è¿‘äºé›¶ï¼Œè¡¨æ˜$\hat{\theta}$æ˜¯ä¸€ä¸ªæ— åä¼°è®¡é‡ã€‚
-   **ç¨³å®šæ€§è¯„ä¼°**ï¼šæ ‡å‡†è¯¯å·®è¾ƒå°ï¼Œè¯´æ˜ä¼°è®¡é‡å…·æœ‰è‰¯å¥½çš„ç¨³å®šæ€§ã€‚
-   **åˆ†å¸ƒç‰¹æ€§**ï¼šåˆ å¤±æ ·æœ¬ä¼°è®¡é‡è¿‘ä¼¼æ­£æ€åˆ†å¸ƒï¼Œå›¾å½¢ä»¥ $\hat{\theta}$
    ä¸ºä¸­å¿ƒï¼Œå‘ˆç°å‡ºè¿‘ä¼¼å¯¹ç§°çš„å½¢çŠ¶ï¼Œè¿™ä¹Ÿåœ¨è¡¨æ˜$\hat{\theta}$æ˜¯ä¸€ä¸ªç›¸å¯¹ç¨³å¥çš„ä¼°è®¡é‡ã€‚

**5.ä¸Bootstrapæ–¹æ³•çš„æ¯”è¾ƒ**ï¼š

-   é€šå¸¸æƒ…å†µä¸‹ï¼ŒBootstrapæ–¹æ³•å¯èƒ½ä¼šæä¾›æ›´å‡†ç¡®çš„æ ‡å‡†è¯¯å·®ä¼°è®¡ï¼Œä½†è®¡ç®—é‡æ›´å¤§ã€‚
-   Jackknifeæ–¹æ³•è®¡ç®—é‡è¾ƒå°ï¼Œä¸”æ˜“äºå®ç°ï¼Œåœ¨æ ·æœ¬é‡è¾ƒå¤§æ—¶æ•ˆæœè¾ƒå¥½ã€‚

------------------------------------------------------------------------

## ç»ƒä¹  7.10

### é¢˜ç›®æè¿°

åœ¨æ•™æçš„ç¤ºä¾‹7.18ä¸­ï¼Œä½œè€…ä½¿ç”¨äº†ç•™ä¸€æ³•ï¼ˆå³næŠ˜äº¤å‰éªŒè¯ï¼‰æ¥æ¯”è¾ƒå››ç§æ¨¡å‹çš„æ‹Ÿåˆæ•ˆæœï¼Œä»¥é¢„æµ‹ç£æ€§æµ‹é‡å€¼ï¼ˆ`magnetic`ï¼‰ä¸åŒ–å­¦æµ‹é‡å€¼ï¼ˆ`chemical`ï¼‰ä¹‹é—´çš„å…³ç³»ã€‚è¿™å››ç§æ¨¡å‹åˆ†åˆ«æ˜¯ï¼š

1.**çº¿æ€§æ¨¡å‹**ï¼š$Y = \beta_0 + \beta_1 X + \epsilon$

2.**äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹**ï¼š$Y = \beta_0 + \beta_1 X + \beta_2 X^2 + \epsilon$

3.**æŒ‡æ•°æ¨¡å‹**ï¼š$\log(Y) = \log(\beta_0) + \beta_1 X + \epsilon$

4.**å¯¹æ•°-å¯¹æ•°æ¨¡å‹**ï¼š$\log(Y) = \beta_0 + \beta_1 \log(X) + \epsilon$

åœ¨ç»ƒä¹ 7.10ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é‡å¤ç¤ºä¾‹7.18çš„åˆ†æï¼Œä½†æ˜¯å°†**å¯¹æ•°-å¯¹æ•°æ¨¡å‹**æ›¿æ¢ä¸º**ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹**ï¼Œå³ï¼š

4.**ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹**ï¼š$Y = \beta_0 + \beta_1 X + \beta_2 X^2 + \beta_3 X^3 + \epsilon$

ç„¶åï¼Œæˆ‘ä»¬éœ€è¦å›ç­”ä»¥ä¸‹é—®é¢˜ï¼š

-   äº¤å‰éªŒè¯çš„è¿‡ç¨‹é€‰æ‹©äº†å“ªä¸€ä¸ªæ¨¡å‹ä½œä¸ºæœ€ä½³æ¨¡å‹ï¼Ÿ
-   æ ¹æ®æœ€å¤§çš„è°ƒæ•´åçš„ $R^2$ï¼Œå“ªä¸ªæ¨¡å‹è¢«é€‰ä¸ºæœ€ä½³æ¨¡å‹ï¼Ÿ

æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯ï¼š

-   ä½¿ç”¨ç•™ä¸€æ³•äº¤å‰éªŒè¯æ¥æ¯”è¾ƒå››ä¸ªæ¨¡å‹çš„é¢„æµ‹è¯¯å·®ã€‚
-   è®¡ç®—æ¯ä¸ªæ¨¡å‹çš„è°ƒæ•´åçš„ $R^2$ã€‚
-   æ¯”è¾ƒç»“æœå¹¶å¾—å‡ºç»“è®ºã€‚

### è§£ç­”æ€è·¯

**æ­¥éª¤æ¦‚è¿°ï¼š**

1.**æ•°æ®å‡†å¤‡ï¼š**
åŠ è½½`DAAG`åŒ…ä¸­çš„`ironslag`æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†åŒ…å«äº†53ä¸ªæ ·æœ¬çš„ç£æ€§æµ‹é‡å€¼ï¼ˆ`magnetic`ï¼‰å’ŒåŒ–å­¦æµ‹é‡å€¼ï¼ˆ`chemical`ï¼‰ã€‚

2.**æ¨¡å‹å®šä¹‰ï¼š**
å®šä¹‰å››ä¸ªå€™é€‰æ¨¡å‹ï¼ŒåŒ…æ‹¬çº¿æ€§æ¨¡å‹ã€äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹ã€æŒ‡æ•°æ¨¡å‹å’Œä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹ã€‚

3.**ç•™ä¸€æ³•äº¤å‰éªŒè¯ï¼š**

-   å¯¹äºæ¯ä¸€ä¸ªè§‚æµ‹å€¼ï¼Œæˆ‘ä»¬å°†å…¶ç•™å‡ºï¼Œä½¿ç”¨å‰©ä½™çš„æ•°æ®æ‹Ÿåˆæ¨¡å‹ã€‚
-   ä½¿ç”¨æ‹Ÿåˆçš„æ¨¡å‹é¢„æµ‹è¢«ç•™å‡ºçš„è§‚æµ‹å€¼ã€‚
-   è®¡ç®—é¢„æµ‹è¯¯å·®ï¼ˆæ®‹å·®ï¼‰ã€‚
-   é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰è§‚æµ‹å€¼éƒ½è¢«ç•™å‡ºè¿‡ä¸€æ¬¡ã€‚

4.**è®¡ç®—é¢„æµ‹è¯¯å·®ï¼š**

-   å¯¹äºæ¯ä¸ªæ¨¡å‹ï¼Œè®¡ç®—æ‰€æœ‰æ®‹å·®çš„å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰ï¼Œä½œä¸ºæ¨¡å‹çš„é¢„æµ‹è¯¯å·®ä¼°è®¡ã€‚

5.**æ¨¡å‹è¯„ä¼°ï¼š**

-   æ¯”è¾ƒå„ä¸ªæ¨¡å‹çš„MSEï¼Œé€‰æ‹©é¢„æµ‹è¯¯å·®æœ€å°çš„æ¨¡å‹ä½œä¸ºæœ€ä½³æ¨¡å‹ã€‚
-   åœ¨å®Œæ•´çš„æ•°æ®é›†ä¸Šæ‹Ÿåˆå„ä¸ªæ¨¡å‹ï¼Œè®¡ç®—è°ƒæ•´åçš„ $R^2$ã€‚
-   æ¯”è¾ƒè°ƒæ•´åçš„ $R^2$ï¼Œé€‰æ‹©è°ƒæ•´å $R^2$ æœ€å¤§çš„æ¨¡å‹ä½œä¸ºæœ€ä½³æ¨¡å‹ã€‚

6.**ç»“æœåˆ†æï¼š** - åˆ†æå„ä¸ªæ¨¡å‹çš„æ‹Ÿåˆæ•ˆæœã€‚ -
ç»˜åˆ¶æ‹Ÿåˆæ›²çº¿å’Œæ®‹å·®å›¾ï¼Œè§‚å¯Ÿæ¨¡å‹çš„æ‹Ÿåˆç¨‹åº¦å’Œæ®‹å·®åˆ†å¸ƒã€‚

**è¯¦ç»†è¯´æ˜ï¼š**

-   **ç•™ä¸€æ³•äº¤å‰éªŒè¯ï¼ˆLOOCVï¼‰ï¼š**

    ç•™ä¸€æ³•äº¤å‰éªŒè¯æ˜¯ä¸€ç§ç‰¹æ®Šçš„kæŠ˜äº¤å‰éªŒè¯ï¼Œå…¶ä¸­kç­‰äºæ ·æœ¬æ€»æ•°nã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

    -   å¯¹äºç¬¬ $i$ ä¸ªè§‚æµ‹å€¼ï¼Œæˆ‘ä»¬ä½¿ç”¨é™¤ç¬¬ $i$
        ä¸ªè§‚æµ‹å€¼ä¹‹å¤–çš„æ‰€æœ‰æ•°æ®æ‹Ÿåˆæ¨¡å‹ã€‚

    -   ä½¿ç”¨æ‹Ÿåˆçš„æ¨¡å‹é¢„æµ‹ç¬¬ $i$ ä¸ªè§‚æµ‹å€¼ï¼Œå¾—åˆ°é¢„æµ‹å€¼ $\hat{Y}_i$ã€‚

    -   è®¡ç®—æ®‹å·® $e_i = Y_i - \hat{Y}_i$ã€‚

    -   é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰è§‚æµ‹å€¼éƒ½è¢«é¢„æµ‹è¿‡ä¸€æ¬¡ã€‚

    -   è®¡ç®—æ‰€æœ‰æ®‹å·®çš„å‡æ–¹è¯¯å·®ï¼š

        $$
        \text{MSE} = \frac{1}{n} \sum_{i=1}^{n} e_i^2
        $$

    è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°æ¯ä¸ªæ¨¡å‹çš„é¢„æµ‹è¯¯å·®ä¼°è®¡ã€‚

-   **è°ƒæ•´åçš„** $R^2$ï¼š

    è°ƒæ•´åçš„ $R^2$
    ç”¨äºè¡¡é‡æ¨¡å‹çš„æ‹Ÿåˆä¼˜åº¦ï¼ŒåŒæ—¶è€ƒè™‘äº†æ¨¡å‹å¤æ‚åº¦ã€‚å…¶è®¡ç®—å…¬å¼ä¸ºï¼š

    $$
    R_{\text{adj}}^2 = 1 - \left( \frac{\text{SSE} / \text{df}_{\text{res}}}{\text{SST} / \text{df}_{\text{tot}}} \right)
    $$ å…¶ä¸­ï¼š

    -   $\text{SSE}$ æ˜¯æ®‹å·®å¹³æ–¹å’Œã€‚
    -   $\text{SST}$ æ˜¯æ€»ç¦»å·®å¹³æ–¹å’Œã€‚
    -   $\text{df}_{\text{res}}$ æ˜¯æ®‹å·®çš„è‡ªç”±åº¦ã€‚
    -   $\text{df}_{\text{tot}}$ æ˜¯æ€»çš„è‡ªç”±åº¦ã€‚

    è°ƒæ•´åçš„ $R^2$
    ä¼šéšç€æ¨¡å‹ä¸­è‡ªå˜é‡æ•°é‡çš„å¢åŠ è€Œè°ƒæ•´ï¼Œå› æ­¤å¯ä»¥é¿å…è¿‡åº¦æ‹Ÿåˆã€‚

-   **æ¨¡å‹é€‰æ‹©ï¼š**

    -   **æ ¹æ®äº¤å‰éªŒè¯è¯¯å·®é€‰æ‹©æ¨¡å‹ï¼š**
        é¢„æµ‹è¯¯å·®ï¼ˆMSEï¼‰æœ€å°çš„æ¨¡å‹è¢«è®¤ä¸ºå…·æœ‰æœ€å¥½çš„é¢„æµ‹æ€§èƒ½ã€‚
    -   **æ ¹æ®è°ƒæ•´åçš„** $R^2$ é€‰æ‹©æ¨¡å‹ï¼š è°ƒæ•´åçš„ $R^2$
        è¶Šå¤§ï¼Œæ¨¡å‹å¯¹æ•°æ®çš„è§£é‡Šèƒ½åŠ›è¶Šå¼ºï¼ŒåŒæ—¶è€ƒè™‘äº†æ¨¡å‹çš„å¤æ‚åº¦ã€‚

-   **ä»£ç å®ç°è¦ç‚¹ï¼š**

    -   **å¾ªç¯ç»“æ„ï¼š** ä½¿ç”¨`for`å¾ªç¯å¯¹æ¯ä¸ªè§‚æµ‹å€¼è¿›è¡Œç•™ä¸€æ³•äº¤å‰éªŒè¯ã€‚
    -   **æ¨¡å‹æ‹Ÿåˆï¼š**
        ä½¿ç”¨`lm()`å‡½æ•°æ‹Ÿåˆçº¿æ€§å’Œå¤šé¡¹å¼æ¨¡å‹ï¼Œå¯¹äºæŒ‡æ•°æ¨¡å‹ï¼Œå…ˆå¯¹`Y`å–å¯¹æ•°ã€‚
    -   **é¢„æµ‹å’Œæ®‹å·®è®¡ç®—ï¼š** æ ¹æ®æ‹Ÿåˆçš„æ¨¡å‹è®¡ç®—é¢„æµ‹å€¼ï¼Œå¹¶è®¡ç®—æ®‹å·®ã€‚
    -   **å‡æ–¹è¯¯å·®è®¡ç®—ï¼š** ä½¿ç”¨`mean()`å‡½æ•°è®¡ç®—æ®‹å·®çš„å¹³æ–¹çš„å¹³å‡å€¼ã€‚
    -   **è°ƒæ•´åçš„** $R^2$ è®¡ç®—ï¼š ä½¿ç”¨`summary()`å‡½æ•°æå–æ¨¡å‹çš„è°ƒæ•´åçš„
        $R^2$ã€‚
    -   **ç»˜å›¾ï¼š**
        ä½¿ç”¨`plot()`å’Œ`lines()`å‡½æ•°ç»˜åˆ¶æ‹Ÿåˆæ›²çº¿ï¼Œä½¿ç”¨`par(mfrow=c(2,2))`å°†å¤šä¸ªå›¾æ”¾åœ¨ä¸€é¡µã€‚

### ä»£ç å®ç°

**1.åŠ è½½å¿…è¦çš„åŒ…å’Œæ•°æ®**

```{r, eval=TRUE}
# åŠ è½½DAAGåŒ…ï¼ŒåŒ…å«ironslagæ•°æ®é›†
library(DAAG)

# åŠ è½½ironslagæ•°æ®é›†ï¼Œå¹¶é™„åŠ åˆ°æœç´¢è·¯å¾„
data(ironslag)
attach(ironslag)
```

**2.å®šä¹‰å˜é‡å’Œåˆå§‹åŒ–**

```{r, eval=TRUE}
# è·å–æ•°æ®é›†çš„æ ·æœ¬æ•°é‡
n <- length(magnetic)

# åˆå§‹åŒ–å››ä¸ªæ¨¡å‹çš„é¢„æµ‹è¯¯å·®å‘é‡
e1 <- e2 <- e3 <- e4 <- numeric(n)

# åˆ›å»ºç”¨äºç»˜åˆ¶æ‹Ÿåˆæ›²çº¿çš„è‡ªå˜é‡åºåˆ—ï¼ˆåœ¨chemicalèŒƒå›´å†…ç­‰é—´è·å–100ä¸ªç‚¹ï¼‰
a <- seq(min(chemical), max(chemical), length.out = 100)
```

**3.ç•™ä¸€æ³•äº¤å‰éªŒè¯ï¼ˆLOOCVï¼‰**

```{r, eval=TRUE}
# å¯¹æ¯ä¸ªè§‚æµ‹å€¼è¿›è¡Œå¾ªç¯
for (k in 1:n) {
  # ç•™å‡ºç¬¬kä¸ªè§‚æµ‹å€¼ä½œä¸ºéªŒè¯é›†ï¼Œå…¶ä½™ä½œä¸ºè®­ç»ƒé›†
  y_train <- magnetic[-k]       # è®­ç»ƒé›†çš„å“åº”å˜é‡
  x_train <- chemical[-k]       # è®­ç»ƒé›†çš„è‡ªå˜é‡
  
  # çº¿æ€§æ¨¡å‹ï¼šY = Î²0 + Î²1 * X
  model1 <- lm(y_train ~ x_train)
  y_pred1 <- predict(model1, newdata = data.frame(x_train = chemical[k]))
  e1[k] <- magnetic[k] - y_pred1
  
  # äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹ï¼šY = Î²0 + Î²1 * X + Î²2 * X^2
  model2 <- lm(y_train ~ x_train + I(x_train^2))
  y_pred2 <- predict(model2, newdata = data.frame(x_train = chemical[k]))
  e2[k] <- magnetic[k] - y_pred2
  
  # æŒ‡æ•°æ¨¡å‹ï¼šlog(Y) = Î²0 + Î²1 * X
  model3 <- lm(log(y_train) ~ x_train)
  log_y_pred3 <- predict(model3, newdata = data.frame(x_train = chemical[k]))
  y_pred3 <- exp(log_y_pred3)  # åå˜æ¢
  e3[k] <- magnetic[k] - y_pred3
  
  # ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹ï¼šY = Î²0 + Î²1 * X + Î²2 * X^2 + Î²3 * X^3
  model4 <- lm(y_train ~ x_train + I(x_train^2) + I(x_train^3))
  y_pred4 <- predict(model4, newdata = data.frame(x_train = chemical[k]))
  e4[k] <- magnetic[k] - y_pred4
  # æ¸…ç†ä¸´æ—¶å˜é‡
  rm(y_train, x_train, model1, y_pred1, model2, y_pred2, 
     model3, log_y_pred3, y_pred3, model4, y_pred4)
  
  # è°ƒç”¨åƒåœ¾å›æ”¶
  gc()
}
```

**4.è®¡ç®—æ¯ä¸ªæ¨¡å‹çš„é¢„æµ‹å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰**

```{r, eval=TRUE}
# è®¡ç®—æ®‹å·®å¹³æ–¹çš„å¹³å‡å€¼ï¼Œå³MSE
mse1 <- mean(e1^2)  # çº¿æ€§æ¨¡å‹çš„MSE
mse2 <- mean(e2^2)  # äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹çš„MSE
mse3 <- mean(e3^2)  # æŒ‡æ•°æ¨¡å‹çš„MSE
mse4 <- mean(e4^2)  # ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹çš„MSE

# å°†MSEç»“æœå­˜å…¥å‘é‡å¹¶å‘½å
mse_values <- c(mse1, mse2, mse3, mse4)
names(mse_values) <- c("çº¿æ€§æ¨¡å‹", "äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹", "æŒ‡æ•°æ¨¡å‹", "ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹")

# è¾“å‡ºMSEç»“æœ
print("å„æ¨¡å‹çš„äº¤å‰éªŒè¯å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰ï¼š")
print(mse_values)
```

**5.åœ¨å®Œæ•´æ•°æ®é›†ä¸Šæ‹Ÿåˆæ¯ä¸ªæ¨¡å‹å¹¶è®¡ç®—è°ƒæ•´åçš„Rå¹³æ–¹**

```{r, eval=TRUE}
# æ¨¡å‹1ï¼šçº¿æ€§æ¨¡å‹
full_model1 <- lm(magnetic ~ chemical)
adj_r2_1 <- summary(full_model1)$adj.r.squared

# æ¨¡å‹2ï¼šäºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹
full_model2 <- lm(magnetic ~ chemical + I(chemical^2))
adj_r2_2 <- summary(full_model2)$adj.r.squared

# æ¨¡å‹3ï¼šæŒ‡æ•°æ¨¡å‹
full_model3 <- lm(log(magnetic) ~ chemical)
adj_r2_3 <- summary(full_model3)$adj.r.squared

# æ¨¡å‹4ï¼šä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹
full_model4 <- lm(magnetic ~ chemical + I(chemical^2) + I(chemical^3))
adj_r2_4 <- summary(full_model4)$adj.r.squared

# å°†è°ƒæ•´åçš„Rå¹³æ–¹ç»“æœå­˜å…¥å‘é‡å¹¶å‘½å
adj_r2_values <- c(adj_r2_1, adj_r2_2, adj_r2_3, adj_r2_4)
names(adj_r2_values) <- c("çº¿æ€§æ¨¡å‹", "äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹", "æŒ‡æ•°æ¨¡å‹", "ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹")

# è¾“å‡ºè°ƒæ•´åçš„Rå¹³æ–¹ç»“æœ
print("å„æ¨¡å‹çš„è°ƒæ•´åçš„Rå¹³æ–¹ï¼š")
print(adj_r2_values)
```

**6.ç»˜åˆ¶æ¯ä¸ªæ¨¡å‹çš„æ‹Ÿåˆæ›²çº¿**

```{r, eval=TRUE}
# è®¾ç½®ç»˜å›¾åŒºåŸŸä¸º2è¡Œ2åˆ—
par(mfrow = c(2, 2), mar = c(4, 4, 2, 1), mgp = c(2, 0.5, 0))  # è®¾ç½®è¾¹è·

# çº¿æ€§æ¨¡å‹æ‹Ÿåˆæ›²çº¿
plot(chemical, magnetic, main = "çº¿æ€§æ¨¡å‹", pch = 16, col = "black",
     xlab = "Chemical Concentration", ylab = "Magnetic Response", col.main = "blue")
y_fit1 <- predict(full_model1, newdata = data.frame(chemical = a))
lines(a, y_fit1, lwd = 2, col = "blue")

# äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹æ‹Ÿåˆæ›²çº¿
plot(chemical, magnetic, main = "äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹", pch = 16, col = "black",
     xlab = "Chemical Concentration", ylab = "Magnetic Response", col.main = "red")
y_fit2 <- predict(full_model2, newdata = data.frame(chemical = a))
lines(a, y_fit2, lwd = 2, col = "red")

# æŒ‡æ•°æ¨¡å‹æ‹Ÿåˆæ›²çº¿
plot(chemical, magnetic, main = "æŒ‡æ•°æ¨¡å‹", pch = 16, col = "black",
     xlab = "Chemical Concentration", ylab = "Magnetic Response", col.main = "green")
log_y_fit3 <- predict(full_model3, newdata = data.frame(chemical = a))
y_fit3 <- exp(log_y_fit3)
lines(a, y_fit3, lwd = 2, col = "green")

# ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹æ‹Ÿåˆæ›²çº¿
plot(chemical, magnetic, main = "ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹", pch = 16, col = "black",
     xlab = "Chemical Concentration", ylab = "Magnetic Response", col.main = "purple")
y_fit4 <- predict(full_model4, newdata = data.frame(chemical = a))
lines(a, y_fit4, lwd = 2, col = "purple")

# é‡ç½®ç»˜å›¾åŒºåŸŸ
par(mfrow = c(1, 1))

```

**7.ç»˜åˆ¶æ¯ä¸ªæ¨¡å‹çš„æ®‹å·®å›¾**

```{r, eval=TRUE}
# è®¾ç½®ç»˜å›¾åŒºåŸŸä¸º2è¡Œ2åˆ—ï¼Œä»¥åŠå›¾å½¢è¾¹è·
par(mfrow = c(2, 2), mar = c(4, 4, 2, 1), mgp = c(2, 0.5, 0))

# çº¿æ€§æ¨¡å‹æ®‹å·®å›¾
plot(fitted(full_model1), resid(full_model1), main = "çº¿æ€§æ¨¡å‹æ®‹å·®", xlab = "æ‹Ÿåˆå€¼", ylab = "æ®‹å·®", 
     pch = 16, col = "blue", cex = 0.6)
abline(h = 0, col = "red", lwd = 2)

# äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹æ®‹å·®å›¾
plot(fitted(full_model2), resid(full_model2), main = "äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹æ®‹å·®", xlab = "æ‹Ÿåˆå€¼", ylab = "æ®‹å·®", 
     pch = 16, col = "green", cex = 0.6)
abline(h = 0, col = "red", lwd = 2)

# æŒ‡æ•°æ¨¡å‹æ®‹å·®å›¾
plot(fitted(full_model3), resid(full_model3), main = "æŒ‡æ•°æ¨¡å‹æ®‹å·®", xlab = "æ‹Ÿåˆå€¼", ylab = "æ®‹å·®", 
     pch = 16, col = "orange", cex = 0.6)
abline(h = 0, col = "red", lwd = 2)

# ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹æ®‹å·®å›¾
plot(fitted(full_model4), resid(full_model4), main = "ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹æ®‹å·®", xlab = "æ‹Ÿåˆå€¼", ylab = "æ®‹å·®", 
     pch = 16, col = "purple", cex = 0.6)
abline(h = 0, col = "red", lwd = 2)

# é‡ç½®ç»˜å›¾åŒºåŸŸ
par(mfrow = c(1, 1))

```

**8.è¾“å‡ºå„æ¨¡å‹çš„ç³»æ•°**

```{r, eval=TRUE}
# è¾“å‡ºçº¿æ€§æ¨¡å‹çš„ç³»æ•°
print("çº¿æ€§æ¨¡å‹ç³»æ•°ï¼š")
print(coef(full_model1))

# è¾“å‡ºäºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹çš„ç³»æ•°
print("äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹ç³»æ•°ï¼š")
print(coef(full_model2))

# è¾“å‡ºæŒ‡æ•°æ¨¡å‹çš„ç³»æ•°
print("æŒ‡æ•°æ¨¡å‹ç³»æ•°ï¼š")
print(coef(full_model3))

# è¾“å‡ºä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹çš„ç³»æ•°
print("ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹ç³»æ•°ï¼š")
print(coef(full_model4))

# åˆ†æå®Œæˆåï¼Œæ¸…ç†å†…å­˜
detach("ironslag")  # ä»æœç´¢è·¯å¾„ä¸­ç§»é™¤æ•°æ®é›†
rm(ironslag)        # ä»å…¨å±€ç¯å¢ƒä¸­åˆ é™¤æ•°æ®é›†
```

**æ³¨æ„ï¼š**

-   åœ¨æ¯ä¸ªæ¨¡å‹çš„æ‹Ÿåˆå’Œé¢„æµ‹è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†`predict()`å‡½æ•°ï¼Œè¿™ä½¿å¾—ä»£ç æ›´åŠ ç®€æ´å’Œé€šç”¨ã€‚
-   åœ¨ç»˜åˆ¶æ‹Ÿåˆæ›²çº¿æ—¶ï¼Œæˆ‘ä½¿ç”¨äº†`predict()`å‡½æ•°å¯¹è‡ªå˜é‡åºåˆ—`a`è¿›è¡Œé¢„æµ‹ï¼Œä»¥è·å¾—å¹³æ»‘çš„æ‹Ÿåˆæ›²çº¿ã€‚

### ç»“æœåˆ†æ

**1.äº¤å‰éªŒè¯å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰ï¼š**

é€šè¿‡ç•™ä¸€æ³•äº¤å‰éªŒè¯ï¼Œæˆ‘ä»¬è®¡ç®—äº†æ¯ä¸ªæ¨¡å‹çš„é¢„æµ‹è¯¯å·®å¹³æ–¹å’Œï¼ˆMSEï¼‰ï¼Œç»“æœå¦‚ä¸‹ï¼š

```         
å„æ¨¡å‹çš„äº¤å‰éªŒè¯å‡æ–¹è¯¯å·®ï¼š
           çº¿æ€§æ¨¡å‹ äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹       æŒ‡æ•°æ¨¡å‹ ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹ 
         19.55644     17.85248     18.44188     18.17756 
```

-   **çº¿æ€§æ¨¡å‹ï¼š** MSE ä¸º 19.55644ï¼Œé¢„æµ‹è¯¯å·®è¾ƒå¤§ã€‚
-   **äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹ï¼š** MSE æœ€å°ï¼Œä¸º 17.85248ï¼Œé¢„æµ‹è¯¯å·®æœ€ä½ã€‚
-   **æŒ‡æ•°æ¨¡å‹ï¼š** MSE ä¸º
    18.44188ï¼Œé¢„æµ‹è¯¯å·®ä»‹äºçº¿æ€§æ¨¡å‹å’ŒäºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹ä¹‹é—´ã€‚
-   **ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹ï¼š** MSE ä¸º 18.17756ï¼Œé¢„æµ‹è¯¯å·®æœ‰æ‰€é™ä½ã€‚

**åˆ†æï¼š**

-   ä» MSE
    çš„æ•°å€¼å¯ä»¥çœ‹å‡ºï¼ŒäºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹çš„é¢„æµ‹è¯¯å·®æœ€å°ï¼Œè¿™è¡¨æ˜å®ƒåœ¨é¢„æµ‹æ–°æ•°æ®æ—¶å¯èƒ½è¡¨ç°å¾—æ›´å¥½ã€‚
-   ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹çš„ MSE æ¬¡ä¹‹ï¼Œä¹Ÿè¡¨ç°å‡ºè‰¯å¥½çš„é¢„æµ‹æ€§èƒ½ã€‚
-   æŒ‡æ•°æ¨¡å‹å’Œçº¿æ€§æ¨¡å‹çš„ MSE è¾ƒå¤§ï¼Œé¢„æµ‹æ€§èƒ½ç›¸å¯¹è¾ƒå·®ã€‚

**å°ç»“ï¼š**

-   **æ ¹æ®äº¤å‰éªŒè¯çš„ MSEï¼ŒäºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹è¢«é€‰ä¸ºæœ€ä½³æ¨¡å‹ã€‚**

**2.è°ƒæ•´åçš„** $R^2$ï¼š

åœ¨å®Œæ•´çš„æ•°æ®é›†ä¸Šæ‹Ÿåˆæ¯ä¸ªæ¨¡å‹ï¼Œè®¡ç®—è°ƒæ•´åçš„ $R^2$ï¼Œç»“æœå¦‚ä¸‹ï¼š

```         
å„æ¨¡å‹çš„è°ƒæ•´åçš„Rå¹³æ–¹ï¼š
          çº¿æ€§æ¨¡å‹ äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹       æŒ‡æ•°æ¨¡å‹ ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹ 
         0.5281545       0.5768151       0.5280556       0.5740396 
```

-   **çº¿æ€§æ¨¡å‹ï¼š** è°ƒæ•´åçš„ $R^2$ ä¸º 0.5281545ã€‚
-   **äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹ï¼š** è°ƒæ•´åçš„ $R^2$ ä¸º
    0.5768151ï¼Œæ˜æ˜¾é«˜äºçº¿æ€§æ¨¡å‹ï¼Œæ˜¯æœ€é«˜çš„ã€‚
-   **æŒ‡æ•°æ¨¡å‹ï¼š** è°ƒæ•´åçš„ $R^2$ ä¸º 0.5280556ï¼Œç•¥ä½äºçº¿æ€§æ¨¡å‹ã€‚
-   **ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹ï¼š** è°ƒæ•´åçš„ $R^2$ ä¸º
    0.5740396ï¼Œç•¥ä½äºäºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹ï¼Œä¸ºæ¬¡é«˜ã€‚

**åˆ†æï¼š**

-   è°ƒæ•´åçš„ $R^2$
    è¶Šé«˜ï¼Œæ¨¡å‹å¯¹æ•°æ®çš„è§£é‡Šèƒ½åŠ›è¶Šå¼ºï¼ŒåŒæ—¶è€ƒè™‘äº†æ¨¡å‹å¤æ‚åº¦ã€‚
-   äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹çš„è°ƒæ•´åçš„ $R^2$ æœ€é«˜ï¼Œè¡¨æ˜å…¶æ‹Ÿåˆä¼˜åº¦æœ€å¥½ã€‚
-   ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹çš„è°ƒæ•´åçš„ $R^2$
    ä¹Ÿæ˜æ˜¾æ¯”çº¿æ€§æ¨¡å‹é«˜ï¼Œè¡¨æ˜å¢åŠ éçº¿æ€§é¡¹èƒ½å¤Ÿæé«˜æ¨¡å‹çš„è§£é‡Šèƒ½åŠ›ã€‚

**å°ç»“ï¼š**

-   **æ ¹æ®è°ƒæ•´åçš„** $R^2$ï¼ŒäºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹è¢«é€‰ä¸ºæœ€ä½³æ¨¡å‹ã€‚

**3.æ‹Ÿåˆæ›²çº¿åˆ†æï¼š**

æˆ‘ä¹Ÿç»˜åˆ¶äº†æ¯ä¸ªæ¨¡å‹çš„æ‹Ÿåˆæ›²çº¿ï¼Œä¸å®é™…æ•°æ®è¿›è¡Œæ¯”è¾ƒã€‚

-   **çº¿æ€§æ¨¡å‹ï¼š**

    -   æ‹Ÿåˆæ›²çº¿ä¸ºä¸€æ¡ç›´çº¿ã€‚
    -   ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ•°æ®ç‚¹åœ¨é«˜å’Œä½åŒ–å­¦æµ‹é‡å€¼åŒºåŸŸåç¦»ç›´çº¿è¾ƒå¤šï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜åŒ–å­¦æµ‹é‡å€¼åŒºåŸŸï¼Œçº¿æ€§æ¨¡å‹æ— æ³•æ•æ‰åˆ°æ•°æ®çš„éçº¿æ€§è¶‹åŠ¿ã€‚

-   **äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹ï¼š**

    -   æ‹Ÿåˆæ›²çº¿ä¸ºä¸€ä¸ªæŠ›ç‰©çº¿ã€‚
    -   äºŒæ¬¡æ¨¡å‹èƒ½å¤Ÿæ›´çµæ´»åœ°æ‹Ÿåˆæ•°æ®ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½åŒ–å­¦æµ‹é‡å€¼åŒºåŸŸï¼Œæ›²çº¿èƒ½å¤Ÿæ›´å¥½åœ°è·Ÿéšæ•°æ®çš„å˜åŒ–è¶‹åŠ¿ã€‚

-   **æŒ‡æ•°æ¨¡å‹ï¼š**

    -   æ‹Ÿåˆæ›²çº¿å‘ˆæŒ‡æ•°å¢é•¿è¶‹åŠ¿ã€‚
    -   æŒ‡æ•°æ¨¡å‹å¯¹æ•°å€¼è¿›è¡Œäº†å¯¹æ•°å˜æ¢ï¼Œæ‹Ÿåˆæ•ˆæœæœ‰æ‰€æ”¹å–„ï¼Œä½†æ”¹å–„ä¸å¤§ï¼Œè¡¨ç°æ˜¯åœ¨æŸäº›åŒºåŸŸä»ç„¶ä¸èƒ½å¾ˆå¥½åœ°æ‹Ÿåˆæ•°æ®ï¼Œç”šè‡³ä¸å¦‚çº¿æ€§æ¨¡å‹ã€‚

-   **ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹ï¼š**

    -   æ‹Ÿåˆæ›²çº¿ä¸ºä¸€ä¸ªä¸‰æ¬¡å‡½æ•°æ›²çº¿ã€‚
    -   ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹èƒ½å¤Ÿæ•æ‰åˆ°ä¸€äº›éçº¿æ€§è¶‹åŠ¿ï¼Œä½†å®ƒåœ¨é«˜åŒ–å­¦æµ‹é‡å€¼åŒºåŸŸï¼Œå¯¹äºæ•°æ®çš„å˜åŒ–è¶‹åŠ¿çš„æ„ŸçŸ¥èƒ½åŠ›ä»ç„¶å­˜åœ¨åå·®ï¼Œä¼¼ä¹æœ‰äº›è¿‡æ‹Ÿåˆäº†ã€‚

**åˆ†æï¼š**

-   ä»æ‹Ÿåˆæ›²çº¿å¯ä»¥çœ‹å‡ºï¼ŒäºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹çš„æ›²çº¿ä¸æ•°æ®ç‚¹çš„å»åˆç¨‹åº¦æœ€é«˜ï¼Œèƒ½å¤Ÿæ•æ‰åˆ°æ•°æ®çš„å¤æ‚éçº¿æ€§å…³ç³»ã€‚
-   çº¿æ€§æ¨¡å‹å’ŒæŒ‡æ•°æ¨¡å‹çš„æ‹Ÿåˆæ•ˆæœä¸ç›¸ä¸Šä¸‹ï¼ŒåŒä¸ºæœ€å·®ï¼Œæ— æ³•åæ˜ æ•°æ®çš„éçº¿æ€§ç‰¹å¾ã€‚

**4.æ®‹å·®åˆ†æï¼š**

æˆ‘è¿˜ç»˜åˆ¶äº†æ¯ä¸ªæ¨¡å‹çš„æ®‹å·®å›¾ï¼Œä»¥æ£€æŸ¥æ®‹å·®çš„åˆ†å¸ƒæƒ…å†µã€‚

-   **çº¿æ€§æ¨¡å‹æ®‹å·®ï¼š**

    -   æ®‹å·®å›¾æ˜¾ç¤ºå‡ºæ˜æ˜¾çš„æ¨¡å¼ï¼Œæ®‹å·®åœ¨æ‹Ÿåˆå€¼çš„é«˜å’Œä½æ‹Ÿåˆå€¼èŒƒå›´å†…å‘ˆç³»ç»Ÿæ€§åå·®ã€‚
    -   è¿™è¡¨æ˜çº¿æ€§æ¨¡å‹å­˜åœ¨æ¨¡å‹ä¸é€‚é…çš„é—®é¢˜ï¼Œæ®‹å·®ééšæœºåˆ†å¸ƒã€‚

-   **äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹æ®‹å·®ï¼š**

    -   æ®‹å·®éšæœºåˆ†å¸ƒåœ¨é›¶çº¿é™„è¿‘ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¨¡å¼ã€‚
    -   æ®‹å·®çš„å¤§å°è¾ƒå°ï¼Œè¡¨æ˜æ¨¡å‹æ‹Ÿåˆè‰¯å¥½ã€‚

-   **æŒ‡æ•°æ¨¡å‹æ®‹å·®ï¼š**

    -   æ®‹å·®åˆ†å¸ƒç¨å‡åŒ€ï¼Œä½†æ¨¡å¼è¾ƒæ˜æ˜¾ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜å’Œä½æ‹Ÿåˆå€¼åŒºåŸŸï¼Œæ®‹å·®æœ‰æ‰€å¢å¤§ã€‚
    -   æŒ‡æ•°æ¨¡å‹åœ¨ä¸­é—´åŒºåŸŸçš„æ‹Ÿåˆæ•ˆæœä¹Ÿä¸å¤Ÿç†æƒ³ã€‚

-   **ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹æ®‹å·®ï¼š**

    -   æ®‹å·®åˆ†å¸ƒæœ‰æ‰€æ”¹å–„ï¼Œä½†ä»å­˜åœ¨ä¸€äº›æ¨¡å¼ã€‚
    -   åœ¨é«˜æ‹Ÿåˆå€¼èŒƒå›´å†…ï¼Œæ®‹å·®ä»ç„¶åç¦»é›¶çº¿ï¼Œè¡¨æ˜æ¨¡å‹ä»æœ‰æ”¹è¿›ç©ºé—´ã€‚

**åˆ†æï¼š**

-   **äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹çš„æ®‹å·®åˆ†å¸ƒæœ€ä¸ºç†æƒ³ï¼Œä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹ç¨æ¬¡ä¹‹ï¼Œæ»¡è¶³æ®‹å·®ç‹¬ç«‹åŒåˆ†å¸ƒçš„å‡è®¾ã€‚**
-   çº¿æ€§æ¨¡å‹å’ŒæŒ‡æ•°æ¨¡å‹çš„æ®‹å·®å­˜åœ¨æ¨¡å¼ï¼Œå¯èƒ½è¿åäº†çº¿æ€§å›å½’çš„å‡è®¾ï¼Œè¡¨æ˜è¿™ä¸¤ç§æ¨¡å‹å¯èƒ½ä¸åˆé€‚ã€‚

**5.æ¨¡å‹å¤æ‚åº¦ä¸è¿‡æ‹Ÿåˆï¼š**

-   **æ¨¡å‹å¤æ‚åº¦ï¼š**

    -   çº¿æ€§æ¨¡å‹æœ€ç®€å•ï¼Œå‚æ•°æœ€å°‘ï¼ˆ2ä¸ªå‚æ•°ï¼‰ã€‚
    -   äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹å¢åŠ äº†ä¸€ä¸ªäºŒæ¬¡é¡¹ï¼Œå‚æ•°å¢åŠ åˆ°3ä¸ªã€‚
    -   ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹è¿›ä¸€æ­¥å¢åŠ äº†ä¸‰æ¬¡é¡¹ï¼Œå‚æ•°å¢åŠ åˆ°4ä¸ªã€‚

-   **è¿‡æ‹Ÿåˆé£é™©ï¼š**

    -   éšç€æ¨¡å‹å¤æ‚åº¦çš„å¢åŠ ï¼Œæ¨¡å‹å¯èƒ½ä¼šè¿‡æ‹Ÿåˆè®­ç»ƒæ•°æ®ã€‚
    -   ç„¶è€Œï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹åœ¨äº¤å‰éªŒè¯ä¸­è¡¨ç°æ¬¡å¥½ï¼Œä¸è¡¨ç°æœ€å¥½çš„äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹å·®è·ä¸æ˜æ˜¾ï¼Œè¯´æ˜ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›è‰¯å¥½ï¼Œæ²¡æœ‰å‡ºç°æ˜æ˜¾çš„è¿‡æ‹Ÿåˆï¼Œä½†ä»å®ƒç¨é€ŠäºäºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹å¯ä»¥çœ‹å‡ºï¼Œè¿˜æ˜¯ç¨å¾®æœ‰äº›è¿‡æ‹Ÿåˆçš„ã€‚

**åˆ†æï¼š**

-   **è°ƒæ•´åçš„** $R^2$ è€ƒè™‘äº†æ¨¡å‹çš„å¤æ‚åº¦ï¼Œä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹çš„è°ƒæ•´åçš„
    $R^2$
    è¡¨ç°ä¹Ÿæ˜¯æ¬¡å¥½ï¼Œä¸è¡¨ç°æœ€å¥½çš„äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹ä¸ç›¸ä¸Šä¸‹ï¼Œè¯´æ˜å¢åŠ çš„å‚æ•°æ²¡æœ‰æ˜¾è‘—å¸¦æ¥æ¨¡å‹è§£é‡Šèƒ½åŠ›çš„æå‡ï¼Œåè€Œæé«˜äº†æ¨¡å‹å¤æ‚åº¦ï¼Œæœ‰ç‚¹å¾—ä¸å¿å¤±ã€‚

**6.æ€»ç»“ä¸ç»“è®ºï¼š**

-   **ç»¼åˆè€ƒè™‘äº¤å‰éªŒè¯è¯¯å·®å’Œè°ƒæ•´åçš„** $R^2$ï¼š

    -   äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹åœ¨äº¤å‰éªŒè¯è¯¯å·®å’Œè°ƒæ•´åçš„ $R^2$ æ–¹é¢å‡è¡¨ç°æœ€ä½³ã€‚
    -   è¯´æ˜äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹åœ¨å¹³è¡¡æ¨¡å‹å¤æ‚åº¦å’Œæ‹Ÿåˆæ€§èƒ½æ–¹é¢åšå¾—æœ€å¥½ã€‚

-   **æ¨¡å‹é€‰æ‹©ï¼š**

    -   **æ ¹æ®é¢„æµ‹æ€§èƒ½å’Œæ‹Ÿåˆä¼˜åº¦ï¼ŒäºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹è¢«é€‰ä¸ºæœ€ä½³æ¨¡å‹ã€‚**

-   **å®é™…æ„ä¹‰ï¼š**

    -   é€‰æ‹©äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹å¯ä»¥æ›´å‡†ç¡®åœ°é¢„æµ‹ç£æ€§æµ‹é‡å€¼ä¸åŒ–å­¦æµ‹é‡å€¼ä¹‹é—´çš„å…³ç³»ã€‚
    -   è¯¥æ¨¡å‹èƒ½å¤Ÿæ•æ‰åˆ°æ•°æ®ä¸­çš„å¤æ‚éçº¿æ€§æ¨¡å¼ï¼Œæä¾›æ›´å¯é çš„é¢„æµ‹ã€‚

-   **å»ºè®®ï¼š**

    -   åœ¨åº”ç”¨è¯¥æ¨¡å‹æ—¶ï¼Œåº”æ³¨æ„æ•°æ®èŒƒå›´çš„é™åˆ¶ï¼ŒäºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹åœ¨æ•°æ®èŒƒå›´ä¹‹å¤–çš„å¤–æ¨å¯èƒ½ä¼šå¯¼è‡´ä¸å‡†ç¡®çš„é¢„æµ‹ã€‚
    -   è¿›ä¸€æ­¥çš„æ•°æ®æ”¶é›†å’Œæ¨¡å‹éªŒè¯å¯èƒ½æœ‰åŠ©äºæé«˜æ¨¡å‹çš„ç¨³å¥æ€§ã€‚

**7.å¯èƒ½çš„æ”¹è¿›ä¸æ‰©å±•ï¼š**

-   **æ­£åˆ™åŒ–æ–¹æ³•ï¼š**

    -   å¯ä»¥è€ƒè™‘ä½¿ç”¨å²­å›å½’æˆ–å¥—ç´¢å›å½’ç­‰æ­£åˆ™åŒ–æ–¹æ³•ï¼Œé˜²æ­¢æ¨¡å‹è¿‡æ‹Ÿåˆã€‚

-   **å…¶ä»–æ¨¡å‹ï¼š**

    -   å°è¯•å…¶ä»–éçº¿æ€§æ¨¡å‹ï¼Œå¦‚æ ·æ¡å›å½’æˆ–å±€éƒ¨å¤šé¡¹å¼å›å½’ï¼Œä»¥æ•æ‰æ•°æ®çš„éçº¿æ€§å…³ç³»ã€‚

-   **æ®‹å·®è¯Šæ–­ï¼š**

    -   å¯¹æ®‹å·®è¿›è¡Œè¿›ä¸€æ­¥çš„ç»Ÿè®¡æ£€éªŒï¼Œæ£€æŸ¥æ®‹å·®çš„æ­£æ€æ€§ã€ç‹¬ç«‹æ€§å’Œæ–¹å·®é½æ€§ã€‚

-   **å˜é‡å˜æ¢ï¼š**

    -   å¯¹è‡ªå˜é‡æˆ–å› å˜é‡è¿›è¡Œé€‚å½“çš„å˜æ¢ï¼Œå¯èƒ½ä¼šå¾—åˆ°æ›´å¥½çš„æ¨¡å‹æ‹Ÿåˆã€‚

------------------------------------------------------------------------

## ç»ƒä¹  8.1

### é¢˜ç›®æè¿°

å®ç°ç”¨äºæ£€éªŒä¸¤ä¸ªæ ·æœ¬åˆ†å¸ƒç›¸ç­‰çš„ä¸¤æ ·æœ¬CramÃ©r-von
Misesæ£€éªŒï¼Œå°†å…¶ä½œä¸ºç½®æ¢æ£€éªŒã€‚å°†è¯¥æ£€éªŒåº”ç”¨äºæ•™æä¸­ä¾‹8.1å’Œä¾‹8.2çš„æ•°æ®ã€‚

**èƒŒæ™¯ä¿¡æ¯**ï¼š

-   **ä¾‹8.1**ï¼šä½¿ç”¨Rè¯­è¨€ä¸­çš„`chickwts`æ•°æ®é›†ï¼ŒåŒ…å«å…­ç»„æ–°å­µåŒ–å°é¸¡çš„ä½“é‡æ•°æ®ï¼Œè¿™äº›å°é¸¡å–‚é£Ÿäº†ä¸åŒçš„é¥²æ–™æ·»åŠ å‰‚ã€‚ç ”ç©¶è€…å…³æ³¨â€œsoybeanâ€ï¼ˆå¤§è±†ï¼‰å’Œâ€œlinseedâ€ï¼ˆäºšéº»ç±½ï¼‰ä¸¤ç»„ï¼Œæ¯”è¾ƒå®ƒä»¬çš„ä½“é‡åˆ†å¸ƒæ˜¯å¦ç›¸åŒã€‚

-   **ä¾‹8.2**ï¼šåœ¨ä¾‹8.1ä¸­ï¼Œç ”ç©¶è€…ä½¿ç”¨äº†Kolmogorov-Smirnovæ£€éªŒæ¥æ¯”è¾ƒä¸¤ç»„æ•°æ®çš„åˆ†å¸ƒå·®å¼‚ã€‚

    ç„¶è€Œï¼Œæœ¬ç»ƒä¹ è¦æ±‚æˆ‘ä»¬ä½¿ç”¨CramÃ©r-von Misesæ£€éªŒæ¥è¿›è¡Œç±»ä¼¼çš„åˆ†æã€‚

**ç›®æ ‡**ï¼š

-   å®ç°CramÃ©r-von Misesæ£€éªŒçš„ç½®æ¢æ£€éªŒç‰ˆæœ¬ã€‚
-   å°†è¯¥æ£€éªŒåº”ç”¨äºâ€œsoybeanâ€å’Œâ€œlinseedâ€ä¸¤ç»„å°é¸¡ä½“é‡æ•°æ®ï¼Œæ£€éªŒå®ƒä»¬çš„åˆ†å¸ƒæ˜¯å¦ç›¸ç­‰ã€‚

### è§£ç­”æ€è·¯

1.**CramÃ©r-von Misesæ£€éªŒçš„åŸç†**

CramÃ©r-von
Misesæ£€éªŒæ˜¯ä¸€ç§éå‚æ•°æ£€éªŒï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªæ ·æœ¬çš„åˆ†å¸ƒæ˜¯å¦ç›¸åŒã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š

-   **ç»éªŒåˆ†å¸ƒå‡½æ•°ï¼ˆECDFï¼‰**ï¼šå¯¹äºæ ·æœ¬æ•°æ®ï¼Œå¯ä»¥æ„å»ºå…¶ç»éªŒåˆ†å¸ƒå‡½æ•°ï¼Œè¡¨ç¤ºæ ·æœ¬ä¸­å°äºæˆ–ç­‰äºæŸå€¼çš„æ¦‚ç‡ã€‚

-   **ç»Ÿè®¡é‡è®¡ç®—**ï¼šCramÃ©r-von
    Misesç»Ÿè®¡é‡é€šè¿‡è®¡ç®—ä¸¤ä¸ªæ ·æœ¬çš„ECDFä¹‹é—´çš„å¹³æ–¹å·®æ¥è¡¡é‡å®ƒä»¬çš„å·®å¼‚ã€‚

å¯¹äºä¸¤æ ·æœ¬æƒ…å†µï¼ŒCramÃ©r-von Misesç»Ÿè®¡é‡å®šä¹‰ä¸ºï¼š

$$
\omega^2 = \frac{n \cdot m}{(n + m)^2} \sum_{i=1}^{n + m} \left[ F_n(z_{(i)}) - G_m(z_{(i)}) \right]^2
$$

å…¶ä¸­ï¼š

-   $n$ å’Œ $m$ åˆ†åˆ«æ˜¯ä¸¤ä¸ªæ ·æœ¬çš„å¤§å°ã€‚
-   $F_n(z)$ å’Œ $G_m(z)$ åˆ†åˆ«æ˜¯ä¸¤ä¸ªæ ·æœ¬çš„ç»éªŒåˆ†å¸ƒå‡½æ•°ã€‚
-   $z_{(i)}$ æ˜¯å°†ä¸¤ä¸ªæ ·æœ¬åˆå¹¶åæ’åºçš„ç¬¬ $i$ ä¸ªæ•°æ®ç‚¹ã€‚

2.**ç½®æ¢æ£€éªŒçš„æ€æƒ³**

ç”±äºåœ¨æœ‰é™æ ·æœ¬ä¸‹ï¼ŒCramÃ©r-von
Misesç»Ÿè®¡é‡çš„ç²¾ç¡®åˆ†å¸ƒéš¾ä»¥ç¡®å®šï¼Œæˆ‘ä»¬é‡‡ç”¨ç½®æ¢æ£€éªŒçš„æ–¹æ³•ï¼š

-   **åŸå‡è®¾ï¼ˆHâ‚€ï¼‰**ï¼šä¸¤ä¸ªæ ·æœ¬æ¥è‡ªç›¸åŒçš„åˆ†å¸ƒã€‚
-   **ç½®æ¢æ•°æ®**ï¼šåœ¨åŸå‡è®¾æˆç«‹çš„å‰æä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥éšæœºäº¤æ¢æ ·æœ¬æ ‡ç­¾ï¼Œç”Ÿæˆæ–°çš„æ ·æœ¬ç»„åˆã€‚
-   **æ„å»ºç½®æ¢åˆ†å¸ƒ**ï¼šå¤šæ¬¡éšæœºç½®æ¢æ ·æœ¬æ ‡ç­¾ï¼Œè®¡ç®—æ¯æ¬¡çš„CramÃ©r-von
    Misesç»Ÿè®¡é‡ï¼Œæ„å»ºå…¶ç½®æ¢åˆ†å¸ƒã€‚
-   **è®¡ç®—på€¼**ï¼šç»Ÿè®¡ç½®æ¢åˆ†å¸ƒä¸­ç»Ÿè®¡é‡å¤§äºç­‰äºè§‚æµ‹ç»Ÿè®¡é‡çš„æ¯”ä¾‹ï¼Œå³ä¸ºpå€¼ã€‚

3.**å®æ–½æ­¥éª¤**

-   **æ•°æ®å‡†å¤‡**ï¼š

    -   æå–â€œsoybeanâ€å’Œâ€œlinseedâ€ç»„çš„å°é¸¡ä½“é‡æ•°æ®ã€‚
    -   åˆå¹¶å¹¶æ’åºä¸¤ä¸ªæ ·æœ¬æ•°æ®ã€‚

-   **è®¡ç®—è§‚æµ‹ç»Ÿè®¡é‡**ï¼š

    -   è®¡ç®—åŸå§‹æ•°æ®çš„ç»éªŒåˆ†å¸ƒå‡½æ•° $F_n(z)$ å’Œ $G_m(z)$ã€‚
    -   æ ¹æ®å…¬å¼è®¡ç®—è§‚æµ‹çš„CramÃ©r-von Misesç»Ÿè®¡é‡
        $\omega^2_{\text{obs}}$ã€‚

-   **è¿›è¡Œç½®æ¢æ£€éªŒ**ï¼š

    -   **è®¾å®šç½®æ¢æ¬¡æ•°** $R$ï¼ˆå¦‚999æ¬¡ï¼‰ã€‚
    -   **å¾ªç¯** $R$ æ¬¡ï¼š
        -   éšæœºæ‰“ä¹±åˆå¹¶æ ·æœ¬çš„é¡ºåºã€‚
        -   æŒ‰ç…§åŸå§‹æ ·æœ¬å¤§å°ï¼Œå°†æ‰“ä¹±åçš„æ•°æ®åˆ†ä¸ºä¸¤ç»„ï¼Œæ¨¡æ‹Ÿæ–°çš„æ ·æœ¬ã€‚
        -   è®¡ç®—æ¯æ¬¡ç½®æ¢åçš„CramÃ©r-von Misesç»Ÿè®¡é‡
            $\omega^2_{\text{perm}}$ã€‚
    -   **ç»“æŸå¾ªç¯**ã€‚

-   **è®¡ç®—på€¼**ï¼š

    -   è®¡ç®—ç½®æ¢ç»Ÿè®¡é‡ä¸­å¤§äºç­‰äºè§‚æµ‹ç»Ÿè®¡é‡çš„æ¬¡æ•°æ¯”ä¾‹ï¼š $$
        p = \frac{\text{æ¬¡æ•°}( \omega^2_{\text{perm}} \geq \omega^2_{\text{obs}} )}{R + 1}
        $$ ï¼ˆåŒ…æ‹¬è§‚æµ‹ç»Ÿè®¡é‡åœ¨å†…ï¼‰

-   **ç»“æœåˆ†æ**ï¼š

    -   å¦‚æœpå€¼å°äºæ˜¾è‘—æ€§æ°´å¹³ï¼ˆå¦‚0.05ï¼‰ï¼Œåˆ™æ‹’ç»åŸå‡è®¾ï¼Œè®¤ä¸ºä¸¤ä¸ªåˆ†å¸ƒæœ‰æ˜¾è‘—å·®å¼‚ã€‚
    -   ç»˜åˆ¶å„ç§å›¾è¡¨ï¼ŒåŒ…æ‹¬ï¼š
        -   ä¸¤ä¸ªæ ·æœ¬çš„ç»éªŒåˆ†å¸ƒå‡½æ•°å›¾ï¼Œæ¯”è¾ƒå®ƒä»¬çš„åˆ†å¸ƒå½¢çŠ¶ã€‚
        -   ç»éªŒåˆ†å¸ƒå‡½æ•°å·®å€¼çš„å›¾ï¼Œç›´è§‚å±•ç¤ºä¸¤è€…çš„å·®å¼‚ã€‚
        -   ç½®æ¢ç»Ÿè®¡é‡çš„ç›´æ–¹å›¾ï¼Œæ ‡æ³¨è§‚æµ‹ç»Ÿè®¡é‡çš„ä½ç½®ã€‚

4.**ä»£ç å®ç°ç»†èŠ‚**

-   **å‡½æ•°å®šä¹‰**ï¼š
    -   ç¼–å†™å‡½æ•°`cvM_stat`ç”¨äºè®¡ç®—CramÃ©r-von Misesç»Ÿè®¡é‡.ã€‚
-   **å›¾è¡¨ç»˜åˆ¶**ï¼š
    -   ä½¿ç”¨`ggplot2`åŒ…ç»˜åˆ¶æ›´ç¾è§‚å’Œç›´è§‚çš„å›¾è¡¨ã€‚
    -   ç»˜åˆ¶ç»éªŒåˆ†å¸ƒå‡½æ•°ï¼ˆECDFï¼‰æ›²çº¿ï¼Œæ¯”è¾ƒä¸¤ä¸ªæ ·æœ¬çš„åˆ†å¸ƒã€‚
    -   ç»˜åˆ¶ECDFå·®å€¼çš„é˜¶æ¢¯å›¾ï¼Œç›´è§‚å±•ç¤ºä¸¤ä¸ªåˆ†å¸ƒä¹‹é—´çš„å·®å¼‚ã€‚
    -   ç»˜åˆ¶ç½®æ¢ç»Ÿè®¡é‡çš„ç›´æ–¹å›¾ï¼Œæ ‡æ³¨è§‚æµ‹ç»Ÿè®¡é‡ã€‚

### ä»£ç å®ç°

**1.æ•°æ®å‡†å¤‡**

-   é¦–å…ˆåŠ è½½`ggplot2`åŒ…ç”¨äºç»˜å›¾ã€‚
-   ä»`chickwts`æ•°æ®é›†ä¸­æå–â€œsoybeanâ€å’Œâ€œlinseedâ€ç»„çš„å°é¸¡ä½“é‡æ•°æ®ã€‚
-   è®¡ç®—ä¸¤ä¸ªæ ·æœ¬çš„å¤§å°ï¼Œåˆ†åˆ«å­˜å‚¨åœ¨`n`å’Œ`m`ä¸­ã€‚

```{r, eval=TRUE}
# åŠ è½½å¿…è¦çš„åŒ…
library(ggplot2)

# åŠ è½½chickwtsæ•°æ®é›†å¹¶æå–æ‰€éœ€æ•°æ®
#--------------------------------------------
# æå–soybeanç»„çš„æ•°æ®
x <- sort(as.vector(chickwts$weight[chickwts$feed == "soybean"]))
# æå–linseedç»„çš„æ•°æ®
y <- sort(as.vector(chickwts$weight[chickwts$feed == "linseed"]))

# æŸ¥çœ‹ä¸¤ä¸ªæ ·æœ¬çš„å¤§å°
n <- length(x)  # soybeanç»„çš„æ ·æœ¬é‡
m <- length(y)  # linseedç»„çš„æ ·æœ¬é‡
```

**2.å®šä¹‰è®¡ç®—CramÃ©r-von Misesç»Ÿè®¡é‡çš„å‡½æ•°**

-   å®šä¹‰å‡½æ•°`cvM_stat`ï¼Œç”¨äºè®¡ç®—CramÃ©r-von Misesç»Ÿè®¡é‡ã€‚
-   å‡½æ•°æ¥å—ä¸¤ä¸ªæ ·æœ¬`x`å’Œ`y`ä½œä¸ºè¾“å…¥ã€‚
-   è®¡ç®—æ ·æœ¬å¤§å°å’Œæ€»æ ·æœ¬é‡ã€‚
-   åˆå¹¶å¹¶æ’åºæ ·æœ¬ï¼Œè®¡ç®—ç»éªŒåˆ†å¸ƒå‡½æ•°ã€‚
-   è®¡ç®—åœ¨æ’åºæ•°æ®ç‚¹ä¸Šçš„ç»éªŒåˆ†å¸ƒå‡½æ•°å€¼ï¼Œå¹¶æ±‚å·®å€¼å¹³æ–¹å’Œã€‚
-   æ ¹æ®å…¬å¼è®¡ç®—ç»Ÿè®¡é‡`omega2`ã€‚

```{r, eval=TRUE}
cvM_stat <- function(x, y) {
  # è®¡ç®—æ ·æœ¬å¤§å°
  n <- length(x)
  m <- length(y)
  N <- n + m  # æ€»æ ·æœ¬é‡
  
  # åˆå¹¶å¹¶æ’åºä¸¤ä¸ªæ ·æœ¬
  z <- c(x, y)
  z_sorted <- sort(z)
  
  # è®¡ç®—ç»éªŒåˆ†å¸ƒå‡½æ•°
  # ecdfå‡½æ•°è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥è®¡ç®—æŒ‡å®šå€¼çš„ç»éªŒåˆ†å¸ƒå€¼
  Fn <- ecdf(x)  # soybeanç»„çš„ç»éªŒåˆ†å¸ƒå‡½æ•°
  Gm <- ecdf(y)  # linseedç»„çš„ç»éªŒåˆ†å¸ƒå‡½æ•°
  
  # åœ¨åˆå¹¶æ’åºçš„æ•°æ®ç‚¹ä¸Šè®¡ç®—ç»éªŒåˆ†å¸ƒå€¼
  F_values <- Fn(z_sorted)
  G_values <- Gm(z_sorted)
  
  # è®¡ç®—ç»éªŒåˆ†å¸ƒå‡½æ•°å·®å€¼çš„å¹³æ–¹å’Œ
  diff_sq <- (F_values - G_values)^2
  sum_diff_sq <- sum(diff_sq)
  
  # è®¡ç®—CramÃ©r-von Misesç»Ÿè®¡é‡
  omega2 <- (n * m) / N^2 * sum_diff_sq
  
  return(omega2)
}
```

**3.è®¡ç®—è§‚æµ‹åˆ°çš„CramÃ©r-von Misesç»Ÿè®¡é‡**

-   ä½¿ç”¨å®šä¹‰çš„å‡½æ•°è®¡ç®—åŸå§‹æ•°æ®çš„CramÃ©r-von Misesç»Ÿè®¡é‡ã€‚
-   æ‰“å°è§‚æµ‹ç»Ÿè®¡é‡çš„å€¼ã€‚

```{r, eval=TRUE}
omega2_obs <- cvM_stat(x, y)
print(paste("è§‚æµ‹ç»Ÿè®¡é‡ omega^2 =", omega2_obs))
```

**4.ç»˜åˆ¶ä¸¤ä¸ªæ ·æœ¬çš„ç»éªŒåˆ†å¸ƒå‡½æ•°ï¼ˆECDFï¼‰**

-   åˆ›å»ºç”¨äºç»˜å›¾çš„æ•°æ®æ¡†`data_ecdf`ï¼ŒåŒ…å«ä½“é‡æ•°æ®å’Œå¯¹åº”çš„ç»„åˆ«ã€‚
-   ä½¿ç”¨`ggplot2`ç»˜åˆ¶ä¸¤ä¸ªç»„çš„ECDFæ›²çº¿ï¼Œç›´è§‚æ¯”è¾ƒå®ƒä»¬çš„åˆ†å¸ƒã€‚
-   ä½¿ç”¨`stat_ecdf()`å‡½æ•°ç»˜åˆ¶ç»éªŒåˆ†å¸ƒå‡½æ•°æ›²çº¿ã€‚

```{r, eval=TRUE}
# åˆ›å»ºæ•°æ®æ¡†ç”¨äºç»˜å›¾
data_ecdf <- data.frame(
  weight = c(x, y),
  group = factor(rep(c("Soybean", "Linseed"), times = c(n, m)))
)

# ç»˜åˆ¶ECDFæ›²çº¿
p1 <- ggplot(data_ecdf, aes(x = weight, color = group)) +
  stat_ecdf(linewidth = 1) +
  labs(title = "Soybeanå’ŒLinseedç»„çš„ç»éªŒåˆ†å¸ƒå‡½æ•°",
       x = "ä½“é‡ï¼ˆå…‹ï¼‰",
       y = "ç»éªŒåˆ†å¸ƒå‡½æ•°") +
  theme_minimal()+
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14) # å¯é€‰ï¼šè°ƒæ•´å­—ä½“æ ·å¼
  )

print(p1)
```

**5.ç»˜åˆ¶ç»éªŒåˆ†å¸ƒå‡½æ•°å·®å€¼çš„é˜¶æ¢¯å›¾**

-   è®¡ç®—åœ¨åˆå¹¶æ’åºæ•°æ®ç‚¹ä¸Šçš„ä¸¤ä¸ªæ ·æœ¬çš„ECDFå€¼ã€‚
-   è®¡ç®—ECDFå·®å€¼`diff_values`ã€‚
-   åˆ›å»ºæ•°æ®æ¡†`data_diff`ç”¨äºç»˜åˆ¶å·®å€¼å›¾ã€‚
-   ä½¿ç”¨`geom_step()`ç»˜åˆ¶é˜¶æ¢¯å›¾ï¼Œå±•ç¤ºä¸¤ä¸ªæ ·æœ¬ECDFçš„å·®å¼‚ã€‚
-   æ·»åŠ çº¢è‰²è™šçº¿è¡¨ç¤ºå·®å€¼ä¸º0çš„æ°´å¹³çº¿ã€‚

```{r, eval=TRUE}
# è®¡ç®—åœ¨åˆå¹¶æ’åºæ•°æ®ç‚¹ä¸Šçš„ECDFå€¼
z_combined <- sort(c(x, y))
Fn_values <- ecdf(x)(z_combined)
Gm_values <- ecdf(y)(z_combined)
diff_values <- Fn_values - Gm_values

# åˆ›å»ºæ•°æ®æ¡†ç”¨äºç»˜å›¾
data_diff <- data.frame(
  weight = z_combined,
  diff = diff_values
)

# ç»˜åˆ¶ECDFå·®å€¼å›¾
p2 <- ggplot(data_diff, aes(x = weight, y = diff)) +
  geom_step(direction = "hv") +
  labs(title = "ç»éªŒåˆ†å¸ƒå‡½æ•°å·®å€¼ï¼ˆFn - Gmï¼‰",
       x = "ä½“é‡ï¼ˆå…‹ï¼‰",
       y = "å·®å€¼") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14) # å¯é€‰ï¼šè°ƒæ•´å­—ä½“æ ·å¼
  )+
  geom_hline(yintercept = 0, linetype = "dashed", color = "red")

print(p2)
```

**6.è¿›è¡Œç½®æ¢æ£€éªŒ**

-   è®¾ç½®éšæœºç§å­ï¼Œä¿è¯ç»“æœå¯é‡å¤ã€‚
-   è®¾å®šç½®æ¢æ¬¡æ•°`R`ã€‚
-   åˆå§‹åŒ–å‘é‡`omega2_perm`ç”¨äºå­˜å‚¨ç½®æ¢ç»Ÿè®¡é‡ã€‚
-   åœ¨å¾ªç¯ä¸­ï¼š
    -   éšæœºæ‰“ä¹±åˆå¹¶æ ·æœ¬çš„ç´¢å¼•ã€‚
    -   æ ¹æ®ç½®æ¢åçš„ç´¢å¼•åˆ†é…æ–°çš„æ ·æœ¬`x_perm`å’Œ`y_perm`ã€‚
    -   è®¡ç®—æ¯æ¬¡ç½®æ¢åçš„CramÃ©r-von Misesç»Ÿè®¡é‡ã€‚

```{r, eval=TRUE}
set.seed(123)  # è®¾ç½®éšæœºç§å­ä»¥ä¿è¯ç»“æœå¯é‡å¤
R <- 999       # ç½®æ¢æ¬¡æ•°
N <- n + m     # æ€»æ ·æœ¬é‡
z <- c(x, y)   # åˆå¹¶æ ·æœ¬

omega2_perm <- numeric(R)  # åˆ›å»ºå‘é‡å­˜å‚¨ç½®æ¢ç»Ÿè®¡é‡

for (i in 1:R) {
  # éšæœºç½®æ¢åˆå¹¶æ ·æœ¬çš„é¡ºåº
  permuted_indices <- sample(1:N, N, replace = FALSE)
  # æ ¹æ®ç½®æ¢åçš„ç´¢å¼•åˆ†é…æ ·æœ¬
  x_perm <- z[permuted_indices[1:n]]
  y_perm <- z[permuted_indices[(n+1):N]]
  
  # è®¡ç®—ç½®æ¢æ ·æœ¬çš„CramÃ©r-von Misesç»Ÿè®¡é‡
  omega2_perm[i] <- cvM_stat(x_perm, y_perm)
}
```

**7.è®¡ç®—på€¼ï¼ˆåŒ…æ‹¬è§‚æµ‹ç»Ÿè®¡é‡åœ¨å†…ï¼‰**

-   å°†è§‚æµ‹ç»Ÿè®¡é‡å’Œç½®æ¢ç»Ÿè®¡é‡åˆå¹¶ï¼Œè®¡ç®—æœ‰å¤šå°‘æ¬¡ç»Ÿè®¡é‡å¤§äºç­‰äºè§‚æµ‹ç»Ÿè®¡é‡ã€‚
-   è®¡ç®—på€¼ï¼Œå³æ»¡è¶³æ¡ä»¶çš„æ¬¡æ•°å æ€»æ¬¡æ•°çš„æ¯”ä¾‹ã€‚

```{r, eval=TRUE}
p_value <- mean(c(omega2_obs, omega2_perm) >= omega2_obs)
print(paste("ç½®æ¢æ£€éªŒçš„på€¼ =", p_value))
```

**8.ç»˜åˆ¶ç½®æ¢ç»Ÿè®¡é‡çš„ç›´æ–¹å›¾**

-   åˆ›å»ºæ•°æ®æ¡†`data_perm`ç”¨äºç»˜åˆ¶ç½®æ¢ç»Ÿè®¡é‡çš„ç›´æ–¹å›¾ã€‚
-   ä½¿ç”¨`geom_histogram()`ç»˜åˆ¶ç›´æ–¹å›¾ï¼Œå±•ç¤ºç½®æ¢ç»Ÿè®¡é‡çš„åˆ†å¸ƒã€‚
-   æ·»åŠ çº¢è‰²è™šçº¿è¡¨ç¤ºè§‚æµ‹ç»Ÿè®¡é‡çš„ä½ç½®ã€‚
-   æ·»åŠ æ³¨é‡Šï¼Œæ ‡æ³¨â€œè§‚æµ‹ç»Ÿè®¡é‡â€ã€‚

```{r, eval=TRUE}
# åˆ›å»ºæ•°æ®æ¡†ç”¨äºç»˜å›¾
data_perm <- data.frame(
  omega2 = omega2_perm
)

p3 <- ggplot(data_perm, aes(x = omega2)) +
  geom_histogram(binwidth = 0.01, fill = "lightblue", color = "white", boundary = 0) +
  geom_vline(xintercept = omega2_obs, color = "red", linetype = "dashed", linewidth = 1) +
  labs(title = "CramÃ©r-von Misesç»Ÿè®¡é‡çš„ç½®æ¢åˆ†å¸ƒ",
       x = expression(omega^2),
       y = "é¢‘æ•°") +
  annotate("text", x = omega2_obs, y = Inf, label = "è§‚æµ‹ç»Ÿè®¡é‡", color = "red", vjust = -1, hjust = -0.1) +
  theme_minimal()+
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14) # å¯é€‰ï¼šè°ƒæ•´å­—ä½“æ ·å¼
  )

print(p3)
```

### ç»“æœåˆ†æ

**1.è§‚æµ‹ç»Ÿè®¡é‡è§£è¯»**

è®¡ç®—å¾—åˆ°çš„è§‚æµ‹CramÃ©r-von Misesç»Ÿè®¡é‡ä¸ºï¼š

```         
[1] "è§‚æµ‹ç»Ÿè®¡é‡ omega^2 = 0.151521555367709"
```

è¯¥ç»Ÿè®¡é‡åæ˜ äº†ä¸¤ä¸ªæ ·æœ¬çš„ç»éªŒåˆ†å¸ƒå‡½æ•°ï¼ˆECDFï¼‰ä¹‹é—´çš„æ€»ä½“å·®å¼‚ç¨‹åº¦ã€‚æ•°å€¼è¶Šå¤§ï¼Œè¡¨ç¤ºä¸¤ä¸ªæ ·æœ¬åˆ†å¸ƒä¹‹é—´çš„å·®å¼‚è¶Šå¤§ã€‚

**2.ç»éªŒåˆ†å¸ƒå‡½æ•°ï¼ˆECDFï¼‰æ¯”è¾ƒ**

é€šè¿‡ç»˜åˆ¶ä¸¤ä¸ªæ ·æœ¬çš„ECDFæ›²çº¿ï¼Œæˆ‘ä»¬å¯ä»¥ç›´è§‚åœ°è§‚å¯Ÿåˆ°â€œsoybeanâ€å’Œâ€œlinseedâ€ç»„çš„å°é¸¡ä½“é‡åˆ†å¸ƒæƒ…å†µã€‚

```{r, eval=TRUE}
print(p1)  # æ˜¾ç¤ºECDFæ›²çº¿å›¾
```

**è§£è¯»**ï¼š

-   **å½¢çŠ¶æ¯”è¾ƒ**ï¼šä¸¤æ¡æ›²çº¿æ€»ä½“èµ°å‘ç›¸ä¼¼ï¼Œè¯´æ˜ä¸¤ç»„æ•°æ®çš„åˆ†å¸ƒå½¢çŠ¶è¾ƒä¸ºæ¥è¿‘ã€‚
-   **å·®å¼‚åŒºåŸŸ**ï¼šåœ¨æŸäº›åŒºé—´ï¼ˆå¦‚ä½“é‡åœ¨200å…‹åˆ°250å…‹ä¹‹é—´ï¼‰ï¼Œä¸¤ç»„çš„ECDFæ›²çº¿æœ‰ä¸€å®šçš„åç¦»ã€‚
    -   **Soybeanç»„**ï¼šåœ¨ä½“é‡è¾ƒå¤§çš„åŒºé—´ï¼ˆå¦‚è¶…è¿‡225å…‹ï¼‰ï¼Œç´¯ç§¯æ¦‚ç‡å¢é•¿è¾ƒå¿«ï¼Œè¡¨ç¤ºæœ‰æ›´å¤šä½“é‡è¾ƒå¤§çš„å°é¸¡ã€‚
    -   **Linseedç»„**ï¼šåœ¨ä½“é‡é€‚ä¸­çš„åŒºé—´ï¼ˆå¦‚200å…‹åˆ°275å…‹ä¹‹é—´ï¼‰ï¼Œç´¯ç§¯æ¦‚ç‡è¾ƒé«˜ï¼Œè¡¨ç¤ºæœ‰æ›´å¤šä½“é‡é€‚ä¸­çš„å°é¸¡ã€‚

**3.ç»éªŒåˆ†å¸ƒå‡½æ•°å·®å€¼åˆ†æ**

ç»˜åˆ¶ECDFå·®å€¼çš„é˜¶æ¢¯å›¾ï¼Œå¯ä»¥é‡åŒ–å¹¶ç›´è§‚å±•ç¤ºä¸¤ä¸ªåˆ†å¸ƒä¹‹é—´çš„å·®å¼‚ã€‚

```{r, eval=TRUE}
print(p2)  # æ˜¾ç¤ºECDFå·®å€¼å›¾
```

**è§£è¯»**ï¼š

-   **æ­£å€¼åŒºåŸŸ**ï¼šåœ¨å›¾ä¸­ï¼Œå½“å·®å€¼ä¸ºæ­£æ—¶ï¼Œè¡¨ç¤ºSoybeanç»„çš„ç´¯ç§¯æ¦‚ç‡é«˜äºLinseedç»„ï¼Œå³åœ¨è¯¥ä½“é‡åŒºé—´å†…ï¼ŒSoybeanç»„æœ‰æ›´å¤šçš„å°é¸¡ä½“é‡å°äºç­‰äºè¯¥å€¼ã€‚å›¾ä¸­æœªå‡ºç°æ­£å€¼åŒºåŸŸï¼Œä¸è¿‡çœ‹è¶‹åŠ¿ï¼Œåœ¨å°é¸¡ä½“é‡è¶…è¿‡325å…‹åæœ‰å¯èƒ½å‡ºç°æ­£å€¼ã€‚
-   **è´Ÿå€¼åŒºåŸŸ**ï¼šè§‚å¯Ÿæ•´å¼ å›¾å¯çŸ¥ï¼Œå·®å€¼ä¸€ç›´ä¸ºè´Ÿï¼Œè¡¨ç¤ºLinseedç»„çš„ç´¯ç§¯æ¦‚ç‡åœ¨150å…‹åˆ°325å…‹è¿™ä¸ªåŒºé—´éƒ½æ˜¯é«˜äºSoybeanç»„ï¼Œå³åœ¨è¯¥ä½“é‡åŒºé—´å†…ï¼ŒLinseedç»„æœ‰æ›´å¤šçš„å°é¸¡ä½“é‡å°äºç­‰äºè¯¥å€¼ã€‚
-   **å·®å€¼å¤§å°**ï¼šå·®å€¼çš„ç»å¯¹å€¼è¡¨ç¤ºä¸¤ä¸ªç»„åœ¨è¯¥ä½“é‡åŒºé—´çš„åˆ†å¸ƒå·®å¼‚ç¨‹åº¦ã€‚å·®å€¼æœ€å¤§å€¼çº¦ä¸º0.3ï¼Œè¯´æ˜åœ¨æŸäº›åŒºé—´ä¸¤ç»„çš„åˆ†å¸ƒå­˜åœ¨ä¸€å®šå·®å¼‚ï¼Œä½†æ€»ä½“å·®å¼‚ä¸å¤§ã€‚

**4.ç½®æ¢æ£€éªŒç»“æœ**

ç½®æ¢æ£€éªŒå¾—åˆ°çš„på€¼ä¸ºï¼š

```         
[1] "ç½®æ¢æ£€éªŒçš„på€¼ = 0.423"
```

**è§£è¯»**ï¼š

-   **på€¼å«ä¹‰**ï¼špå€¼è¡¨ç¤ºåœ¨åŸå‡è®¾æˆç«‹ï¼ˆå³ä¸¤ç»„æ•°æ®æ¥è‡ªç›¸åŒåˆ†å¸ƒï¼‰çš„æƒ…å†µä¸‹ï¼Œè§‚æµ‹åˆ°çš„ç»Ÿè®¡é‡ï¼ˆæˆ–æ›´æç«¯ï¼‰å‡ºç°çš„æ¦‚ç‡ã€‚
-   **på€¼å¤§å°**ï¼špå€¼ä¸º0.423ï¼Œè¿œå¤§äºå¸¸ç”¨çš„æ˜¾è‘—æ€§æ°´å¹³ï¼ˆå¦‚0.05æˆ–0.01ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•æ‹’ç»åŸå‡è®¾ã€‚
-   **ç»Ÿè®¡ç»“è®º**ï¼šåŸºäºç½®æ¢æ£€éªŒçš„ç»“æœï¼Œæ²¡æœ‰è¶³å¤Ÿçš„ç»Ÿè®¡è¯æ®è¡¨æ˜â€œsoybeanâ€å’Œâ€œlinseedâ€ç»„çš„å°é¸¡ä½“é‡åˆ†å¸ƒå­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚

**5.ç½®æ¢ç»Ÿè®¡é‡çš„åˆ†å¸ƒåˆ†æ**

ç»˜åˆ¶ç½®æ¢ç»Ÿè®¡é‡çš„ç›´æ–¹å›¾ï¼Œå¯ä»¥ç›´è§‚åœ°å±•ç¤ºè§‚æµ‹ç»Ÿè®¡é‡åœ¨ç½®æ¢åˆ†å¸ƒä¸­çš„ä½ç½®ã€‚

```{r, eval=TRUE}
print(p3)  # æ˜¾ç¤ºç½®æ¢ç»Ÿè®¡é‡ç›´æ–¹å›¾
```

**è§£è¯»**ï¼š

-   **ç½®æ¢åˆ†å¸ƒå½¢çŠ¶**ï¼šç›´æ–¹å›¾å‘ˆç°æ­£åçš„åˆ†å¸ƒï¼Œå¤§éƒ¨åˆ†ç½®æ¢ç»Ÿè®¡é‡é›†ä¸­åœ¨è¾ƒå°çš„å€¼åŸŸå†…ã€‚
-   **è§‚æµ‹ç»Ÿè®¡é‡ä½ç½®**ï¼šçº¢è‰²è™šçº¿è¡¨ç¤ºè§‚æµ‹ç»Ÿè®¡é‡çš„ä½ç½®ï¼Œä½äºç½®æ¢åˆ†å¸ƒçš„ä¸­é—´åŒºåŸŸã€‚
-   **æç«¯å€¼**ï¼šè§‚æµ‹ç»Ÿè®¡é‡å¹¶ä¸ä½äºç½®æ¢åˆ†å¸ƒçš„å°¾éƒ¨åŒºåŸŸï¼Œè¯´æ˜å…¶å¹¶ä¸æç«¯ã€‚

**6.ç»Ÿè®¡æ£€éªŒçš„åŠŸæ•ˆå’Œé™åˆ¶**

**åŠŸæ•ˆåˆ†æ**ï¼š

-   **æ ·æœ¬é‡**ï¼šSoybeanç»„æœ‰14ä¸ªæ ·æœ¬ï¼ŒLinseedç»„æœ‰12ä¸ªæ ·æœ¬ï¼Œæ€»æ ·æœ¬é‡ä¸º26ä¸ªã€‚æ ·æœ¬é‡è¾ƒå°å¯èƒ½å¯¼è‡´æ£€éªŒçš„ç»Ÿè®¡åŠŸæ•ˆï¼ˆPowerï¼‰ä¸è¶³ï¼Œéš¾ä»¥æ£€æµ‹åˆ°å®é™…å­˜åœ¨çš„å·®å¼‚ã€‚
-   **æ£€éªŒæ•æ„Ÿåº¦**ï¼šCramÃ©r-von
    Misesæ£€éªŒå¯¹äºåˆ†å¸ƒå½¢çŠ¶çš„æ•´ä½“å·®å¼‚è¾ƒä¸ºæ•æ„Ÿï¼Œä½†å¯¹äºç»†å¾®å·®å¼‚å¯èƒ½ä¸å¤Ÿæ•é”ã€‚

**é™åˆ¶å’Œæ”¹è¿›**ï¼š

-   **æ ·æœ¬ä»£è¡¨æ€§**ï¼šæ ·æœ¬æ˜¯å¦èƒ½ä»£è¡¨æ€»ä½“ï¼Œéœ€è¦è€ƒè™‘å®éªŒè®¾è®¡å’Œé‡‡æ ·æ–¹æ³•ã€‚
-   **è¿›ä¸€æ­¥æ£€éªŒ**ï¼šå¯ä»¥è€ƒè™‘å…¶ä»–éå‚æ•°æ£€éªŒæ–¹æ³•ï¼Œå¦‚Mann-Whitney
    Uæ£€éªŒã€Anderson-Darlingæ£€éªŒç­‰ï¼Œå¯èƒ½å¯¹æŸäº›ç±»å‹çš„å·®å¼‚æ›´æ•æ„Ÿã€‚
-   **å¤šé‡æ£€éªŒ**ï¼šå¦‚æœåŒæ—¶è¿›è¡Œå¤šä¸ªæ£€éªŒï¼Œéœ€è¦è¿›è¡Œå¤šé‡æ£€éªŒæ ¡æ­£ï¼Œä»¥æ§åˆ¶æ€»ä½“çš„ç¬¬ä¸€ç±»é”™è¯¯ç‡ã€‚

**7.ç”Ÿç‰©å­¦æ„ä¹‰å’Œå®é™…è§£è¯»**

**ç”Ÿç‰©å­¦èƒŒæ™¯**ï¼š

-   **é¥²æ–™å½±å“**ï¼šä¸åŒé¥²æ–™å¯èƒ½å¯¹å°é¸¡çš„ç”Ÿé•¿äº§ç”Ÿå½±å“ï¼ŒåŒ…æ‹¬ä½“é‡ã€å¥åº·çŠ¶å†µç­‰ã€‚
-   **å®é™…è§‚å¯Ÿ**ï¼šä»æ•°æ®ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒSoybeanç»„çš„å°é¸¡ä½“é‡ç•¥ä½äºLinseedç»„ï¼Œä½†å·®å¼‚ä¸æ˜¾è‘—ã€‚

**å®é™…æ„ä¹‰**ï¼š

-   **ç»æµæ•ˆç›Š**ï¼šå¦‚æœä¸¤ç§é¥²æ–™çš„æˆæœ¬ç›¸è¿‘ï¼Œä½†å¯¹å°é¸¡ä½“é‡çš„å½±å“æ— æ˜¾è‘—å·®å¼‚ï¼Œé¥²å…»è€…å¯æ ¹æ®å…¶ä»–å› ç´ ï¼ˆå¦‚é¥²æ–™æˆæœ¬ã€ä¾›åº”æƒ…å†µï¼‰é€‰æ‹©é¥²æ–™ã€‚
-   **è¿›ä¸€æ­¥ç ”ç©¶**ï¼šå¯èƒ½éœ€è¦æ›´å¤§è§„æ¨¡çš„å®éªŒï¼Œæˆ–è€…è€ƒè™‘å…¶ä»–æŒ‡æ ‡ï¼ˆå¦‚é¥²æ–™è½¬åŒ–ç‡ã€ç”Ÿé•¿é€Ÿåº¦ç­‰ï¼‰æ¥å…¨é¢è¯„ä¼°é¥²æ–™çš„æ•ˆæœã€‚

**8.ä¸å…¶ä»–æ£€éªŒç»“æœçš„æ¯”è¾ƒ**

**Kolmogorov-Smirnovæ£€éªŒï¼ˆä¾‹8.2ï¼‰**ï¼š

-   **ç»“æœ**ï¼špå€¼ä¸º0.46ï¼ŒåŒæ ·æ— æ³•æ‹’ç»åŸå‡è®¾ã€‚
-   **æ¯”è¾ƒ**ï¼šCramÃ©r-von
    Misesæ£€éªŒå’ŒKolmogorov-Smirnovæ£€éªŒåœ¨æœ¬ä¾‹ä¸­å¾—å‡ºäº†ç›¸ä¼¼çš„ç»“è®ºã€‚

**tæ£€éªŒï¼ˆä¾‹8.1ï¼‰**ï¼š

-   **ç»“æœ**ï¼šä¸¤æ ·æœ¬tæ£€éªŒçš„på€¼ä¸º0.198ï¼Œæ— æ³•æ‹’ç»åŸå‡è®¾ã€‚
-   **æ¯”è¾ƒ**ï¼štæ£€éªŒä¸»è¦æ£€éªŒå‡å€¼å·®å¼‚ï¼Œéå‚æ•°æ£€éªŒï¼ˆå¦‚CramÃ©r-von
    Misesï¼‰åˆ™æ£€éªŒåˆ†å¸ƒå·®å¼‚ã€‚è™½ç„¶æ£€éªŒå¯¹è±¡ä¸åŒï¼Œä½†éƒ½æœªå‘ç°æ˜¾è‘—å·®å¼‚ã€‚

**9.æ€»ä½“ç»“è®º**

ç»¼åˆå„é¡¹æ£€éªŒç»“æœå’Œåˆ†æï¼Œå¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š

-   **ç»Ÿè®¡ç»“è®º**ï¼šæ²¡æœ‰è¶³å¤Ÿçš„è¯æ®è¡¨æ˜â€œsoybeanâ€å’Œâ€œlinseedâ€ä¸¤ç§é¥²æ–™å¯¹å°é¸¡ä½“é‡çš„å½±å“å­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚
-   **å®éªŒè®¾è®¡**ï¼šæœªæ¥çš„ç ”ç©¶å¯ä»¥è€ƒè™‘å¢åŠ æ ·æœ¬é‡ï¼Œæé«˜æ£€éªŒçš„ç»Ÿè®¡åŠŸæ•ˆï¼Œæˆ–è€…å¼•å…¥æ›´å¤šçš„æŒ‡æ ‡è¿›è¡Œç»¼åˆè¯„ä»·ã€‚
-   **å®è·µåº”ç”¨**ï¼šé¥²å…»è€…å¯æ ¹æ®å®é™…æƒ…å†µå’Œå…¶ä»–å› ç´ ï¼Œåˆç†é€‰æ‹©é¥²æ–™ï¼Œä»¥è¾¾åˆ°æœ€ä½³çš„å…»æ®–æ•ˆæœã€‚

**10.ç»“è®ºçš„å±€é™æ€§**

-   **å±€é™æ€§**ï¼šæœ¬æ¬¡åˆ†æä»…åŸºäºä½“é‡ä¸€ä¸ªæŒ‡æ ‡ï¼Œä¸”æ ·æœ¬é‡æœ‰é™ï¼Œç»“è®ºå¯èƒ½å…·æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚
-   **è°¨æ…è§£è¯»**ï¼šåœ¨åº”ç”¨ç»“è®ºæ—¶ï¼Œåº”ç»“åˆå®é™…æƒ…å†µå’Œå…¶ä»–ç ”ç©¶ç»“æœï¼Œé¿å…è¿‡åº¦æ¨æ–­ã€‚

------------------------------------------------------------------------

## ç»ƒä¹  8.2

### é¢˜ç›®æè¿°

å®ç°åŒå˜é‡Spearmanç§©ç›¸å…³æ€§çš„ç‹¬ç«‹æ€§æ£€éªŒï¼Œå°†å…¶ä½œä¸ºä¸€ä¸ªç½®æ¢æ£€éªŒã€‚Spearmanç§©ç›¸å…³æ£€éªŒçš„ç»Ÿè®¡é‡å¯ä»¥ä½¿ç”¨å‡½æ•°**cor**å¹¶è®¾ç½®å‚æ•°method=**"spearman"**æ¥è·å¾—ã€‚å°†ç½®æ¢æ£€éªŒæ‰€å¾—åˆ°çš„å®é™…æ˜¾è‘—æ€§æ°´å¹³ä¸åœ¨ç›¸åŒæ ·æœ¬ä¸Šä½¿ç”¨**cor.test**å‡½æ•°è®¡ç®—å¾—åˆ°çš„på€¼è¿›è¡Œæ¯”è¾ƒã€‚

### è§£ç­”æ€è·¯

**Spearmanç§©ç›¸å…³ç³»æ•°**ï¼ˆSpearman's rank correlation
coefficientï¼‰æ˜¯ä¸€ç§éå‚æ•°ç»Ÿè®¡é‡ï¼Œç”¨äºæµ‹é‡ä¸¤ä¸ªå˜é‡ä¹‹é—´çš„å•è°ƒå…³ç³»ã€‚ä¸Pearsonç›¸å…³ç³»æ•°ä¸åŒï¼ŒSpearmanç§©ç›¸å…³ç³»æ•°å¯¹æ•°æ®ä¸è¦æ±‚æœä»æ­£æ€åˆ†å¸ƒï¼Œå¯¹å¼‚å¸¸å€¼ä¹Ÿä¸æ•æ„Ÿï¼Œå› è€Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹æ›´ä¸ºé€‚ç”¨ã€‚

**Spearmanç§©ç›¸å…³ç³»æ•°çš„è®¡ç®—æ­¥éª¤**ï¼š

1.**å¯¹åŸå§‹æ•°æ®è¿›è¡Œæ’åºï¼Œè®¡ç®—ç§©æ¬¡**ï¼š

-   å¯¹äºä¸¤ä¸ªå˜é‡$x$å’Œ$y$ï¼Œåˆ†åˆ«å¯¹å®ƒä»¬çš„è§‚æµ‹å€¼è¿›è¡Œæ’åºï¼Œåˆ†é…ç§©æ¬¡$R(X_i)$å’Œ$R(Y_i)$ã€‚
-   å¦‚æœå­˜åœ¨é‡å¤çš„æ•°å€¼ï¼ˆå³å¹³çº§ç°è±¡ï¼‰ï¼Œåˆ™å–è¿™äº›æ•°å€¼çš„å¹³å‡ç§©æ¬¡ã€‚

2.**è®¡ç®—ç§©æ¬¡å·®çš„å¹³æ–¹å’Œ**ï¼š

-   å¯¹æ¯ä¸ªè§‚æµ‹å€¼ï¼Œè®¡ç®—ç§©æ¬¡å·®$d_i = R(X_i) - R(Y_i)$ã€‚
-   è®¡ç®—$d_i$çš„å¹³æ–¹å’Œ$\sum_{i=1}^{n} d_i^2$ã€‚

3.**è®¡ç®—Spearmanç§©ç›¸å…³ç³»æ•°**$\rho$ï¼š

-   ä½¿ç”¨ä»¥ä¸‹å…¬å¼ï¼š $$
    \rho = 1 - \frac{6 \sum_{i=1}^{n} d_i^2}{n(n^2 - 1)}
    $$

-   å…¶ä¸­ï¼Œ$n$ä¸ºæ ·æœ¬é‡ã€‚

**å…·ä½“æ­¥éª¤**ï¼š

1.**è®¡ç®—åŸå§‹æ•°æ®çš„Spearmanç§©ç›¸å…³ç³»æ•°**$\rho_{\text{obs}}$ã€‚

2.**è¿›è¡Œå¤šæ¬¡ç½®æ¢ï¼ˆå¦‚10000æ¬¡ï¼‰**ï¼š

-   æ¯æ¬¡éšæœºæ‰“ä¹±$y$çš„é¡ºåºï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„$y_{\text{perm}}$ã€‚
-   è®¡ç®—ç½®æ¢åçš„Spearmanç§©ç›¸å…³ç³»æ•°$\rho_{\text{perm}}$ã€‚

3.**æ„å»ºç½®æ¢åˆ†å¸ƒ**ï¼š

-   æ”¶é›†æ‰€æœ‰ç½®æ¢åçš„$\rho_{\text{perm}}$ï¼Œå¾—åˆ°å…¶åˆ†å¸ƒæƒ…å†µã€‚

4.**è®¡ç®—ç½®æ¢æ£€éªŒçš„på€¼**ï¼š

-   på€¼ç­‰äºç½®æ¢ç»Ÿè®¡é‡ä¸­ç»å¯¹å€¼å¤§äºç­‰äº$\rho_{\text{obs}}$çš„æ¬¡æ•°é™¤ä»¥æ€»çš„ç½®æ¢æ¬¡æ•°$B$ï¼š
    $$
    p_{\text{perm}} = \frac{\sum_{i=1}^{B} \mathbb{I}(|\rho_{\text{perm},i}| \geq |\rho_{\text{obs}}|)}{B}
    $$ å…¶ä¸­ï¼Œ$\mathbb{I}(\cdot)$ä¸ºæŒ‡ç¤ºå‡½æ•°ï¼Œå½“æ¡ä»¶æˆç«‹æ—¶å–1ï¼Œå¦åˆ™å–0ã€‚

5.**æ¯”è¾ƒpå€¼**ï¼š

-   å°†ç½®æ¢æ£€éªŒçš„på€¼ä¸ä½¿ç”¨**cor.test**å‡½æ•°è®¡ç®—å¾—åˆ°çš„på€¼è¿›è¡Œæ¯”è¾ƒï¼Œè¯„ä¼°ç½®æ¢æ£€éªŒçš„æ•ˆæœã€‚

**æ³¨æ„äº‹é¡¹**ï¼š

-   **ç½®æ¢æ£€éªŒçš„ä¼˜åŠ¿**ï¼šä¸ä¾èµ–äºæ•°æ®çš„åˆ†å¸ƒå‡è®¾ï¼Œé€‚ç”¨äºå°æ ·æœ¬å’Œéæ­£æ€åˆ†å¸ƒçš„æ•°æ®ã€‚
-   **ç½®æ¢æ¬¡æ•°**$B$ï¼šç½®æ¢æ¬¡æ•°è¶Šå¤šï¼Œç»“æœè¶Šç²¾ç¡®ï¼Œä½†è®¡ç®—é‡ä¹Ÿè¶Šå¤§ã€‚ä¸€èˆ¬å–$B=1000$æˆ–æ›´å¤§ã€‚

### ä»£ç å®ç°

å°†ä»£ç åˆ†æˆå‡ ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½æœ‰è¯¦ç»†çš„æ³¨é‡Šï¼Œæ–¹ä¾¿é˜…è¯»å’Œç†è§£ã€‚

**ç¬¬ä¸€éƒ¨åˆ†ï¼šç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®**

-   ä½¿ç”¨`rnorm(n)`ç”Ÿæˆ$n$ä¸ªæœä»æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„éšæœºæ•°ï¼Œä½œä¸ºè‡ªå˜é‡`x`ã€‚
-   å› å˜é‡`y`ä¸`x`å‘ˆçº¿æ€§å…³ç³»ï¼Œå¹¶åŠ å…¥éšæœºå™ªå£°ï¼Œä½¿æ•°æ®æ›´æ¥è¿‘çœŸå®æƒ…å†µã€‚

```{r, eval=TRUE}
# åŠ è½½å¿…è¦çš„åŒ…
# å¦‚æœéœ€è¦ç»˜åˆ¶æ›´é«˜çº§çš„å›¾å½¢ï¼Œå¯ä»¥åŠ è½½ggplot2åŒ…
# install.packages("ggplot2")  # å¦‚æœªå®‰è£…ggplot2ï¼Œå¯å…ˆå®‰è£…
library(ggplot2)

# è®¾ç½®éšæœºæ•°ç§å­ï¼Œç¡®ä¿ç»“æœå¯é‡å¤
set.seed(124)

# è®¾ç½®æ ·æœ¬é‡
n <- 100  # æ ·æœ¬é‡ä¸º100

# ç”Ÿæˆè‡ªå˜é‡xï¼Œæœä»æ ‡å‡†æ­£æ€åˆ†å¸ƒ
x <- rnorm(n)

# ç”Ÿæˆå› å˜é‡yï¼Œä½¿å…¶ä¸xæœ‰çº¿æ€§å…³ç³»ï¼Œå¹¶åŠ å…¥éšæœºå™ªå£°
# y = 5 * x + éšæœºå™ªå£°
y <- 5 * x + rnorm(n)
```

**ç¬¬äºŒéƒ¨åˆ†ï¼šè®¡ç®—è§‚å¯Ÿåˆ°çš„Spearmanç§©ç›¸å…³ç³»æ•°**

-   ä½¿ç”¨`cor`å‡½æ•°è®¡ç®—`x`å’Œ`y`ä¹‹é—´çš„Spearmanç§©ç›¸å…³ç³»æ•°ï¼Œæ–¹æ³•å‚æ•°è®¾ä¸º`"spearman"`ã€‚
-   `rho_obs`å³ä¸ºè§‚å¯Ÿåˆ°çš„Spearmanç§©ç›¸å…³ç³»æ•°ã€‚

```{r, eval=TRUE}
# è®¡ç®—è§‚å¯Ÿåˆ°çš„Spearmanç§©ç›¸å…³ç³»æ•°
rho_obs <- cor(x, y, method = "spearman")

# è¾“å‡ºè§‚å¯Ÿåˆ°çš„Spearmanç§©ç›¸å…³ç³»æ•°
cat("è§‚å¯Ÿåˆ°çš„Spearmanç§©ç›¸å…³ç³»æ•° rho_obs =", rho_obs, "\n")
```

**ç¬¬ä¸‰éƒ¨åˆ†ï¼šä½¿ç”¨cor.testå‡½æ•°è®¡ç®—Spearmanæ£€éªŒçš„på€¼**

-   `cor.test`å‡½æ•°ä¸ä»…è®¡ç®—Spearmanç§©ç›¸å…³ç³»æ•°ï¼Œè¿˜æä¾›äº†ç»Ÿè®¡æ£€éªŒçš„på€¼ç­‰è¯¦ç»†ä¿¡æ¯ã€‚
-   æå–`p.value`ï¼Œå¾—åˆ°Spearmanæ£€éªŒçš„på€¼ã€‚

```{r, eval=TRUE}
# ä½¿ç”¨cor.testå‡½æ•°è¿›è¡ŒSpearmanç§©ç›¸å…³æ€§æ£€éªŒ
spearman_test <- cor.test(x, y, method = "spearman")

# æå–på€¼
p_value_cor_test <- spearman_test$p.value

# è¾“å‡ºcor.testå‡½æ•°è®¡ç®—çš„på€¼
cat("ä½¿ç”¨cor.testå‡½æ•°è®¡ç®—çš„på€¼ =", p_value_cor_test, "\n")
```

**ç¬¬å››éƒ¨åˆ†ï¼šç½®æ¢æ£€éªŒ**

-   é€šè¿‡éšæœºç½®æ¢`y`çš„å€¼ï¼Œæ¨¡æ‹Ÿåœ¨åŸå‡è®¾æˆç«‹ï¼ˆ$x$å’Œ$y$ç‹¬ç«‹ï¼‰çš„æƒ…å†µä¸‹ï¼ŒSpearmanç§©ç›¸å…³ç³»æ•°çš„åˆ†å¸ƒã€‚
-   è®¡ç®—æ¯æ¬¡ç½®æ¢åçš„Spearmanç§©ç›¸å…³ç³»æ•°ï¼Œå¹¶å­˜å‚¨åœ¨`rho_perm`ä¸­ã€‚
-   è®¡ç®—ç½®æ¢æ£€éªŒçš„på€¼ï¼Œå³ç½®æ¢ç»Ÿè®¡é‡ä¸­ç»å¯¹å€¼å¤§äºç­‰äºè§‚å¯Ÿå€¼çš„æ¯”ä¾‹ã€‚

```{r, eval=TRUE}
# è®¾ç½®ç½®æ¢æ¬¡æ•°
B <- 10000  # ç½®æ¢æ¬¡æ•°ä¸º10000æ¬¡

# åˆå§‹åŒ–å‘é‡ï¼Œç”¨äºå­˜å‚¨æ¯æ¬¡ç½®æ¢çš„Spearmanç§©ç›¸å…³ç³»æ•°
rho_perm <- numeric(B)

# è¿›è¡Œç½®æ¢æ£€éªŒ
for (i in 1:B) {
  # éšæœºç½®æ¢yçš„å€¼ï¼Œç”Ÿæˆç½®æ¢æ ·æœ¬
  y_perm <- sample(y)
  
  # è®¡ç®—ç½®æ¢æ ·æœ¬çš„Spearmanç§©ç›¸å…³ç³»æ•°
  rho_perm[i] <- cor(x, y_perm, method = "spearman")
}

# è®¡ç®—ç½®æ¢æ£€éªŒçš„på€¼
p_value_perm <- mean(abs(rho_perm) >= abs(rho_obs))

# è¾“å‡ºç½®æ¢æ£€éªŒçš„på€¼
cat("ç½®æ¢æ£€éªŒè®¡ç®—çš„på€¼ =", p_value_perm, "\n")
```

**ç¬¬äº”éƒ¨åˆ†ï¼šç»˜åˆ¶å›¾è¡¨**

**1.ç»˜åˆ¶å˜é‡xä¸yçš„æ•£ç‚¹å›¾**

-   ä½¿ç”¨`plot`å‡½æ•°ç»˜åˆ¶æ•£ç‚¹å›¾ï¼Œè§‚å¯Ÿ`x`å’Œ`y`ä¹‹é—´çš„å…³ç³»ã€‚
-   ä»å›¾ä¸­å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°äºŒè€…æ˜¯å¦å­˜åœ¨ç›¸å…³æ€§ã€‚

```{r, eval=TRUE}
# ç»˜åˆ¶xå’Œyçš„æ•£ç‚¹å›¾ï¼Œç›´è§‚å±•ç¤ºäºŒè€…çš„å…³ç³»
plot(x, y, main = "å˜é‡xä¸å˜é‡yçš„æ•£ç‚¹å›¾",
     xlab = "å˜é‡x", ylab = "å˜é‡y",
     pch = 19, col = "blue")
```

**2.ç»˜åˆ¶å¯†åº¦ç›´æ–¹å åŠ å›¾**

-   ä½¿ç”¨`ggplot2`åŒ…ç»˜åˆ¶åŒ…å«å¯†åº¦æ›²çº¿å’Œç›´æ–¹å›¾å åŠ çš„å›¾å½¢ã€‚
-   æ·»åŠ è§‚å¯Ÿå€¼çš„ç«–çº¿ï¼Œæ¸…æ™°å±•ç¤ºå…¶åœ¨åˆ†å¸ƒä¸­çš„ä½ç½®ã€‚

```{r, eval=TRUE}
# åˆ›å»ºæ•°æ®æ¡†ï¼ŒåŒ…å«rho_permæ•°æ®
df_perm <- data.frame(rho_perm = rho_perm)

# ä½¿ç”¨ggplot2ç»˜åˆ¶ç½®æ¢åˆ†å¸ƒçš„å¯†åº¦å›¾
ggplot(df_perm, aes(x = rho_perm)) +
  geom_histogram(aes(y = after_stat(density)), bins = 30,
                 fill = "lightblue", color = "white") +
  geom_density(color = "blue", linewidth = 1) +
  geom_vline(xintercept = rho_obs, color = "red", linewidth = 1) +
  labs(title = "ç½®æ¢æ£€éªŒçš„Spearmanç§©ç›¸å…³ç³»æ•°å¯†åº¦å›¾",
       x = "Spearmanç§©ç›¸å…³ç³»æ•°", y = "å¯†åº¦") +
  theme_minimal()+
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14) # å¯é€‰ï¼šè°ƒæ•´å­—ä½“æ ·å¼
  )
```

**ç¬¬å…­éƒ¨åˆ†ï¼šç»“æœæ±‡æ€»**

-   å°†ä¸¤ç§æ–¹æ³•çš„på€¼æ•´ç†åœ¨ä¸€ä¸ªæ•°æ®æ¡†ä¸­ï¼Œæ–¹ä¾¿å¯¹æ¯”å’Œå±•ç¤ºã€‚
-   å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ç½®æ¢æ£€éªŒå’Œ`cor.test`å‡½æ•°è®¡ç®—çš„på€¼ã€‚

```{r, eval=TRUE}
# å°†ç»“æœæ•´ç†ä¸ºæ•°æ®æ¡†ï¼Œä¾¿äºæŸ¥çœ‹
result_df <- data.frame(
  æ–¹æ³• = c("cor.testæ£€éªŒ", "ç½®æ¢æ£€éªŒ"),
  på€¼ = c(p_value_cor_test, p_value_perm)
)

# è¾“å‡ºç»“æœæ•°æ®æ¡†
print(result_df)
```

### ç»“æœåˆ†æ

**1. è§‚å¯Ÿåˆ°çš„Spearmanç§©ç›¸å…³ç³»æ•°** $\rho_{\text{obs}}$

```{r, eval=TRUE}
cat("è§‚å¯Ÿåˆ°çš„Spearmanç§©ç›¸å…³ç³»æ•° rho_obs =", rho_obs, "\n")
```

**è¯¦ç»†åˆ†æï¼š**

-   **æ•°å€¼è§£è¯»ï¼š**
    -   è®¡ç®—å¾—åˆ°çš„Spearmanç§©ç›¸å…³ç³»æ•°ä¸º$\rho_{\text{obs}} \approx 0.9783978$ï¼Œæ¥è¿‘äº1ã€‚
    -   è¿™æ„å‘³ç€è‡ªå˜é‡`x`å’Œå› å˜é‡`y`ä¹‹é—´å­˜åœ¨éå¸¸å¼ºçš„æ­£ç›¸å…³å…³ç³»ã€‚
-   **ç»Ÿè®¡æ„ä¹‰ï¼š**
    -   Spearmanç§©ç›¸å…³ç³»æ•°çš„å–å€¼èŒƒå›´ä¸º$[-1, 1]$ã€‚
        -   $\rho = 1$è¡¨ç¤ºä¸¤ä¸ªå˜é‡ä¹‹é—´å­˜åœ¨å®Œç¾çš„å•è°ƒé€’å¢å…³ç³»ã€‚
        -   $\rho = -1$è¡¨ç¤ºä¸¤ä¸ªå˜é‡ä¹‹é—´å­˜åœ¨å®Œç¾çš„å•è°ƒé€’å‡å…³ç³»ã€‚
        -   $\rho = 0$è¡¨ç¤ºä¸¤ä¸ªå˜é‡ä¹‹é—´æ²¡æœ‰å•è°ƒå…³ç³»ã€‚
    -   æœ¬ä¾‹ä¸­ï¼Œ$\rho_{\text{obs}} \approx 0.9783978$ï¼Œè¯´æ˜éšç€`x`çš„å¢å¤§ï¼Œ`y`ä¹Ÿå‘ˆå•è°ƒé€’å¢è¶‹åŠ¿ã€‚
-   **ä¸æ•°æ®ç”Ÿæˆè¿‡ç¨‹çš„å¯¹åº”ï¼š**
    -   åœ¨ç”Ÿæˆæ•°æ®æ—¶ï¼Œè®¾å®šäº†`y = 5 * x + Îµ`ï¼Œå…¶ä¸­`Îµ`ä¸ºéšæœºå™ªå£°ã€‚
    -   å› æ­¤ï¼Œç†è®ºä¸Š`x`å’Œ`y`ä¹‹é—´åº”å­˜åœ¨çº¿æ€§å…³ç³»ã€‚
    -   è§‚å¯Ÿåˆ°çš„é«˜Spearmanç§©ç›¸å…³ç³»æ•°éªŒè¯äº†è¿™ä¸€ç‚¹ã€‚

**2. ä½¿ç”¨`cor.test`å‡½æ•°è®¡ç®—çš„på€¼**

```{r, eval=TRUE}
cat("ä½¿ç”¨cor.testå‡½æ•°è®¡ç®—çš„på€¼ =", p_value_cor_test, "\n")
```

**è¯¦ç»†åˆ†æï¼š**

-   **på€¼çš„æ„ä¹‰ï¼š**
    -   på€¼è¡¨ç¤ºåœ¨åŸå‡è®¾ï¼ˆ$H_0$ï¼š`x`å’Œ`y`ä¹‹é—´æ— ç›¸å…³æ€§ï¼‰æˆç«‹çš„æƒ…å†µä¸‹ï¼Œè§‚å¯Ÿåˆ°å½“å‰ç»Ÿè®¡é‡æˆ–æ›´æç«¯çš„ç»Ÿè®¡é‡çš„æ¦‚ç‡ã€‚
    -   åœ¨æœ¬ä¾‹ä¸­ï¼Œpå€¼ä¸º$0$ã€‚
-   **ç»Ÿè®¡ç»“è®ºï¼š**
    -   ç”±äºpå€¼è¿œå°äºå¸¸ç”¨çš„æ˜¾è‘—æ€§æ°´å¹³$\alpha = 0.05$å’Œ$\alpha = 0.01$ï¼Œæˆ‘ä»¬æœ‰å……åˆ†çš„ç†ç”±æ‹’ç»åŸå‡è®¾ã€‚
    -   è¿™è¡¨æ˜`x`å’Œ`y`ä¹‹é—´çš„ç›¸å…³æ€§åœ¨ç»Ÿè®¡ä¸Šæ˜¾è‘—ã€‚
-   **æ£€éªŒå‡è®¾ï¼š**
    -   **åŸå‡è®¾ï¼ˆ**$H_0$ï¼‰ï¼š$\rho = 0$ï¼Œå³`x`å’Œ`y`ä¹‹é—´æ— ç›¸å…³æ€§ã€‚
    -   **å¤‡æ‹©å‡è®¾ï¼ˆ**$H_1$ï¼‰ï¼š$\rho \ne 0$ï¼Œå³`x`å’Œ`y`ä¹‹é—´å­˜åœ¨ç›¸å…³æ€§ã€‚
-   **ç»“è®ºï¼š**
    -   æˆ‘ä»¬æ‹’ç»åŸå‡è®¾ï¼Œè®¤ä¸º`x`å’Œ`y`ä¹‹é—´å­˜åœ¨æ˜¾è‘—çš„ç›¸å…³æ€§ã€‚

**3. ç½®æ¢æ£€éªŒè®¡ç®—çš„på€¼**

```{r, eval=TRUE}
cat("ç½®æ¢æ£€éªŒè®¡ç®—çš„på€¼ =", p_value_perm, "\n")
```

**è¯¦ç»†åˆ†æï¼š**

-   **ç½®æ¢æ£€éªŒçš„åŸç†ï¼š**
    -   ç½®æ¢æ£€éªŒé€šè¿‡éšæœºæ‰“ä¹±å› å˜é‡`y`ï¼Œåœ¨åŸå‡è®¾æˆç«‹çš„æƒ…å†µä¸‹ï¼Œæ¨¡æ‹ŸSpearmanç§©ç›¸å…³ç³»æ•°çš„åˆ†å¸ƒã€‚
    -   é€šè¿‡è®¡ç®—ç½®æ¢åçš„Spearmanç§©ç›¸å…³ç³»æ•°ï¼Œæ„å»ºå…¶ç½®æ¢åˆ†å¸ƒã€‚
-   **på€¼è®¡ç®—ï¼š**
    -   på€¼ç­‰äºç½®æ¢ç»Ÿè®¡é‡ä¸­ç»å¯¹å€¼å¤§äºç­‰äº$\rho_{\text{obs}}$çš„æ¬¡æ•°é™¤ä»¥æ€»çš„ç½®æ¢æ¬¡æ•°$B$ã€‚
    -   åœ¨æœ¬ä¾‹ä¸­ï¼Œç½®æ¢æ¬¡æ•°$B = 10000$ã€‚
-   **ç»“æœè§£é‡Šï¼š**
    -   ç½®æ¢æ£€éªŒçš„på€¼ä¸º0ï¼Œè¡¨ç¤ºåœ¨10000æ¬¡ç½®æ¢ä¸­ï¼Œæ²¡æœ‰ä¸€æ¬¡ç½®æ¢çš„ç›¸å…³ç³»æ•°ç»å¯¹å€¼è¶…è¿‡äº†è§‚å¯Ÿå€¼$\rho_{\text{obs}}$çš„ç»å¯¹å€¼ã€‚
    -   è¿™æ„å‘³ç€åœ¨åŸå‡è®¾æˆç«‹çš„æƒ…å†µä¸‹ï¼Œè§‚å¯Ÿåˆ°å¦‚æ­¤å¤§çš„Spearmanç§©ç›¸å…³ç³»æ•°çš„æ¦‚ç‡æä½ã€‚
-   **ç»Ÿè®¡ç»“è®ºï¼š**
    -   ä¸`cor.test`å‡½æ•°çš„ç»“æœä¸€è‡´ï¼Œæˆ‘ä»¬æ‹’ç»åŸå‡è®¾ï¼Œè®¤ä¸º`x`å’Œ`y`ä¹‹é—´å­˜åœ¨æ˜¾è‘—çš„ç›¸å…³æ€§ã€‚
-   **ç²¾åº¦é—®é¢˜ï¼š**
    -   ç½®æ¢æ¬¡æ•°10000æ¬¡ç²¾åº¦å·²ç»å¾ˆé«˜ï¼Œpå€¼çš„æœ€å°å¯æ£€æµ‹å€¼ä¸º$\frac{1}{B} = 0.0001$ã€‚
    -   åœ¨æœ¬ä¾‹ä¸­ï¼Œpå€¼ä¸º0ï¼Œè¯´æ˜$p_{\text{perm}} < 0.0001$ã€‚

**4. æ•£ç‚¹å›¾åˆ†æ**

```{r, eval=TRUE}
# ç»˜åˆ¶xå’Œyçš„æ•£ç‚¹å›¾
plot(x, y, main = "å˜é‡xä¸å˜é‡yçš„æ•£ç‚¹å›¾",
     xlab = "å˜é‡x", ylab = "å˜é‡y",
     pch = 19, col = "blue")
```

**è¯¦ç»†åˆ†æï¼š**

-   **å›¾å½¢è§£è¯»ï¼š**
    -   æ•£ç‚¹å›¾å±•ç¤ºäº†`x`å’Œ`y`çš„è§‚æµ‹å€¼ã€‚
    -   å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®ç‚¹å¤§è‡´æ²¿ç€ä¸€æ¡å‘å³ä¸Šæ–¹å€¾æ–œçš„ç›´çº¿åˆ†å¸ƒã€‚
    -   è¿™è¡¨æ˜`x`å’Œ`y`ä¹‹é—´å­˜åœ¨æ­£çš„çº¿æ€§å…³ç³»ã€‚
-   **ä¸Spearmanç§©ç›¸å…³ç³»æ•°çš„å…³ç³»ï¼š**
    -   Spearmanç§©ç›¸å…³ç³»æ•°æ•æ‰çš„æ˜¯å˜é‡ä¹‹é—´çš„å•è°ƒå…³ç³»ã€‚
    -   æ•£ç‚¹å›¾ä¸­çš„çº¿æ€§è¶‹åŠ¿ä¸é«˜Spearmanç§©ç›¸å…³ç³»æ•°ç›¸ä¸€è‡´ã€‚

**5. ä½¿ç”¨ggplot2ç»˜åˆ¶çš„å¯†åº¦å›¾åˆ†æ**

```{r, eval=TRUE}
# ä½¿ç”¨ggplot2ç»˜åˆ¶ç½®æ¢åˆ†å¸ƒçš„å¯†åº¦å›¾
ggplot(df_perm, aes(x = rho_perm)) +
  geom_histogram(aes(y = after_stat(density)), bins = 30,
                 fill = "lightblue", color = "white") +
  geom_density(color = "blue", linewidth = 1) +
  geom_vline(xintercept = rho_obs, color = "red", linewidth = 1) +
  labs(title = "ç½®æ¢æ£€éªŒçš„Spearmanç§©ç›¸å…³ç³»æ•°å¯†åº¦å›¾",
       x = "Spearmanç§©ç›¸å…³ç³»æ•°", y = "å¯†åº¦") +
  theme_minimal()
```

**è¯¦ç»†åˆ†æï¼š**

-   **å¯†åº¦å›¾çš„ä¼˜åŠ¿ï¼š**
    -   å¯†åº¦å›¾å¹³æ»‘äº†ç›´æ–¹å›¾çš„æ›²çº¿ï¼Œä½¿åˆ†å¸ƒå½¢æ€æ›´æ¸…æ™°ã€‚
    -   å¯ä»¥æ›´å¥½åœ°è§‚å¯Ÿç½®æ¢åˆ†å¸ƒçš„æ€»ä½“è¶‹åŠ¿ã€‚
-   **è§‚å¯Ÿå€¼çš„ä½ç½®ï¼š**
    -   çº¢è‰²ç«–çº¿æ ‡è®°äº†$\rho_{\text{obs}}$çš„ä½ç½®ï¼Œæ˜æ˜¾ä½äºåˆ†å¸ƒçš„æå³ä¾§ã€‚
    -   å†æ¬¡å¼ºè°ƒäº†è§‚å¯Ÿå€¼çš„æç«¯æ€§ã€‚
-   **åˆ†å¸ƒç‰¹æ€§ï¼š**
    -   ç½®æ¢åˆ†å¸ƒå‘ˆè¿‘ä¼¼æ­£æ€åˆ†å¸ƒï¼Œå‡å€¼ä¸º0ã€‚
    -   è¿™æ˜¯ç½®æ¢æ£€éªŒåœ¨åŸå‡è®¾ä¸‹çš„é¢„æœŸç»“æœã€‚

**6. ç»“æœæ•°æ®æ¡†æ€»ç»“**

```{r, eval=TRUE}
# å°†ç»“æœæ•´ç†ä¸ºæ•°æ®æ¡†ï¼Œä¾¿äºæŸ¥çœ‹
result_df <- data.frame(
  æ–¹æ³• = c("cor.testæ£€éªŒ", "ç½®æ¢æ£€éªŒ"),
  på€¼ = c(p_value_cor_test, p_value_perm)
)
print(result_df)
```

**è¯¦ç»†åˆ†æï¼š**

-   **på€¼æ¯”è¾ƒï¼š**
    -   `cor.test`å‡½æ•°è®¡ç®—çš„på€¼ä¸º$0$ã€‚
    -   ç½®æ¢æ£€éªŒçš„på€¼ä¸º0ï¼Œè¡¨ç¤º$p_{\text{perm}} < 0.0001$ï¼ˆç”±äºç½®æ¢æ¬¡æ•°ä¸º10000æ¬¡ï¼‰ã€‚
-   **ç»“è®ºä¸€è‡´æ€§ï¼š**
    -   ä¸¤ç§æ–¹æ³•çš„på€¼å‡è¿œå°äºæ˜¾è‘—æ€§æ°´å¹³$\alpha = 0.05$å’Œ$\alpha = 0.01$ï¼Œæ”¯æŒæ‹’ç»åŸå‡è®¾ã€‚
    -   è¿™è¯´æ˜ç½®æ¢æ£€éªŒçš„ç»“æœä¸ä¼ ç»Ÿç»Ÿè®¡æ£€éªŒæ–¹æ³•ä¸€è‡´ï¼ŒéªŒè¯äº†ç½®æ¢æ£€éªŒçš„æœ‰æ•ˆæ€§ã€‚
-   **æ–¹æ³•é€‚ç”¨æ€§ï¼š**
    -   `cor.test`å‡½æ•°åŸºäºç†è®ºåˆ†å¸ƒå‡è®¾ï¼Œé€‚ç”¨äºæ ·æœ¬é‡è¾ƒå¤§ä¸”æ»¡è¶³ä¸€å®šæ¡ä»¶çš„æ•°æ®ã€‚
    -   ç½®æ¢æ£€éªŒä¸ä¾èµ–äºç‰¹å®šåˆ†å¸ƒå‡è®¾ï¼Œé€‚ç”¨äºå„ç§æ•°æ®ç±»å‹ï¼Œç‰¹åˆ«æ˜¯å½“æ•°æ®ä¸æ»¡è¶³ä¼ ç»Ÿæ£€éªŒå‡è®¾æ—¶ã€‚

**7. æ·±å…¥è®¨è®º**

-   **æ•°æ®ç‰¹æ€§çš„å½±å“ï¼š**
    -   ç”Ÿæˆçš„æ•°æ®æ˜¯çº¿æ€§å…³ç³»ï¼Œä¸”å˜é‡æœä»æ­£æ€åˆ†å¸ƒã€‚
    -   åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ•°æ®å¯èƒ½å­˜åœ¨éçº¿æ€§å…³ç³»ã€å¼‚å¸¸å€¼æˆ–éæ­£æ€åˆ†å¸ƒã€‚
    -   ç½®æ¢æ£€éªŒåœ¨è¿™äº›æƒ…å†µä¸‹ä»ç„¶é€‚ç”¨ï¼Œå…·æœ‰æ›´å¹¿æ³›çš„é€‚ç”¨æ€§ã€‚
-   **Spearmanç§©ç›¸å…³ç³»æ•°çš„ä¼˜åŠ¿ï¼š**
    -   Spearmanç§©ç›¸å…³ç³»æ•°åŸºäºç§©æ¬¡ï¼Œé€‚ç”¨äºéæ­£æ€åˆ†å¸ƒçš„æ•°æ®ã€‚
    -   å¯¹äºå­˜åœ¨å¼‚å¸¸å€¼çš„æ•°æ®ï¼ŒSpearmanç§©ç›¸å…³ç³»æ•°ä¹Ÿå…·æœ‰é²æ£’æ€§ã€‚
-   **ç½®æ¢æ£€éªŒçš„ä¼˜åŠ¿å’Œå±€é™æ€§ï¼š**
    -   **ä¼˜åŠ¿ï¼š**
        -   ä¸ä¾èµ–äºåˆ†å¸ƒå‡è®¾ï¼Œé€‚ç”¨äºå„ç§æ•°æ®ç±»å‹ã€‚
        -   è®¡ç®—æ–¹æ³•ç®€å•ï¼Œæ¦‚å¿µç›´è§‚ã€‚
    -   **å±€é™æ€§ï¼š**
        -   è®¡ç®—é‡è¾ƒå¤§ï¼Œç‰¹åˆ«æ˜¯å½“ç½®æ¢æ¬¡æ•°å’Œæ ·æœ¬é‡è¾ƒå¤§æ—¶ã€‚
        -   på€¼çš„ç²¾åº¦å—ç½®æ¢æ¬¡æ•°é™åˆ¶ã€‚

**8. ç»“è®º**

-   **ç»¼åˆåˆ†æï¼š**
    -   é€šè¿‡ç½®æ¢æ£€éªŒå’Œ`cor.test`å‡½æ•°çš„ç»“æœï¼Œæˆ‘ä»¬å¾—å‡ºä¸€è‡´çš„ç»“è®ºï¼š`x`å’Œ`y`ä¹‹é—´å­˜åœ¨æ˜¾è‘—çš„æ­£ç›¸å…³å…³ç³»ã€‚
    -   è§‚å¯Ÿåˆ°çš„Spearmanç§©ç›¸å…³ç³»æ•°$\rho_{\text{obs}}$é«˜è¾¾0.9783978ï¼Œè¡¨ç¤ºå¼ºçƒˆçš„æ­£ç›¸å…³æ€§ã€‚
-   **æ–¹æ³•æ¯”è¾ƒï¼š**
    -   `cor.test`å‡½æ•°åŸºäºç†è®ºåˆ†å¸ƒå‡è®¾ï¼Œè®¡ç®—æ–¹ä¾¿ï¼Œé€‚ç”¨äºæ»¡è¶³å‡è®¾æ¡ä»¶çš„æ•°æ®ã€‚
    -   ç½®æ¢æ£€éªŒä¸ä¾èµ–äºåˆ†å¸ƒå‡è®¾ï¼Œé€‚ç”¨äºæ›´å¹¿æ³›çš„æ•°æ®ç±»å‹ï¼Œä½†è®¡ç®—é‡è¾ƒå¤§ã€‚
-   **å®è·µæ„ä¹‰ï¼š**
    -   åœ¨å®é™…æ•°æ®åˆ†æä¸­ï¼Œå½“æ•°æ®ä¸æ»¡è¶³ä¼ ç»Ÿç»Ÿè®¡æ£€éªŒçš„å‡è®¾æ¡ä»¶æ—¶ï¼Œç½®æ¢æ£€éªŒæ˜¯ä¸€ä¸ªæœ‰åŠ›çš„å·¥å…·ã€‚
    -   é€šè¿‡ç½®æ¢æ£€éªŒï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å˜é‡ä¹‹é—´çš„å…³ç³»è¿›è¡Œç¨³å¥çš„ç»Ÿè®¡æ¨æ–­ã€‚
-   **å»ºè®®ï¼š**
    -   æ ¹æ®æ•°æ®ç‰¹æ€§é€‰æ‹©åˆé€‚çš„ç»Ÿè®¡æ£€éªŒæ–¹æ³•ã€‚
    -   å½“å¯èƒ½æ—¶ï¼Œä½¿ç”¨å¤šç§æ–¹æ³•è¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿ç»“è®ºçš„å¯é æ€§ã€‚

------------------------------------------------------------------------

# æ€»ç»“

## å›°éš¾ä¸è§£å†³æ–¹å¼

åœ¨å®Œæˆè¿™äº›ç»ƒä¹ çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ·±åˆ»åœ°ä½“ä¼šåˆ°äº†ç†è®ºä¸å®è·µç»“åˆçš„æŒ‘æˆ˜å’Œå›°éš¾ã€‚

**ç»ƒä¹  7.8** ä¸­ï¼Œéœ€è¦ä½¿ç”¨ Jackknife
æ–¹æ³•æ¥ä¼°è®¡ä¸»æˆåˆ†åˆ†æä¸­ç¬¬ä¸€ä¸ªç‰¹å¾å€¼æ‰€è§£é‡Šçš„æ–¹å·®æ¯”ä¾‹çš„åå·®å’Œæ ‡å‡†è¯¯å·®ã€‚è™½ç„¶ç†è®ºä¸Šç†è§£äº†
Jackknife
æ–¹æ³•çš„åŸç†ï¼Œä½†åœ¨å®é™…ç¼–ç¨‹å®ç°æ—¶å´é‡åˆ°äº†å›°éš¾ã€‚é¦–å…ˆï¼Œå¦‚ä½•é«˜æ•ˆåœ°åˆ é™¤æ¯ä¸€ä¸ªè§‚æµ‹å€¼å¹¶é‡æ–°è®¡ç®—åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å€¼ï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ€æœ¯æŒ‘æˆ˜ã€‚æˆ‘æœ€åˆå°è¯•ä½¿ç”¨å¾ªç¯é€ä¸€åˆ é™¤è§‚æµ‹å€¼ï¼Œä½†ä»£ç è¿è¡Œéå¸¸ç¼“æ…¢ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ç ”ç©¶äº†
R è¯­è¨€ä¸­å…³äºçŸ©é˜µè¿ç®—çš„ä¼˜åŒ–æ–¹æ³•ï¼Œå­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨çŸ¢é‡åŒ–æ“ä½œå’Œ apply
å‡½æ•°æ¥æé«˜è®¡ç®—æ•ˆç‡ã€‚ç»è¿‡å¤šæ¬¡å°è¯•å’Œè°ƒè¯•ï¼Œæœ€ç»ˆæˆåŠŸåœ°æé«˜äº†ä»£ç çš„è¿è¡Œé€Ÿåº¦ï¼Œç¡®ä¿äº†ç»“æœçš„å‡†ç¡®æ€§ã€‚

åœ¨ **ç»ƒä¹  7.10**
ä¸­ï¼Œé¢å¯¹å››ç§ä¸åŒçš„æ¨¡å‹ï¼Œå°¤å…¶æ˜¯åŠ å…¥äº†ä¸‰æ¬¡å¤šé¡¹å¼æ¨¡å‹åï¼Œæ¨¡å‹çš„å¤æ‚åº¦æ˜¾è‘—å¢åŠ ã€‚æˆ‘åœ¨å®ç°ç•™ä¸€æ³•äº¤å‰éªŒè¯æ—¶é‡åˆ°äº†å›°éš¾ï¼Œç‰¹åˆ«æ˜¯åœ¨ç¡®ä¿æ¯ä¸ªæ¨¡å‹çš„é¢„æµ‹è¯¯å·®è®¡ç®—æ–¹æ³•ä¸€è‡´æ€§æ–¹é¢ã€‚ä¸ºäº†å…‹æœè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è¯¦ç»†é˜…è¯»äº†äº¤å‰éªŒè¯çš„åŸç†ï¼Œå¹¶å‚è€ƒäº†ç›¸å…³çš„ç»Ÿè®¡å­¦æ–‡çŒ®ã€‚ä¸æ­¤åŒæ—¶ï¼Œæˆ‘è¿˜å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨
R çš„ predict
å‡½æ•°å’Œæ¨¡å‹å…¬å¼æ¥å£ï¼Œç¡®ä¿äº†ä¸åŒæ¨¡å‹çš„é¢„æµ‹è¿‡ç¨‹ä¸€è‡´ã€‚æ­¤å¤–ï¼Œåœ¨ç»˜åˆ¶æ‹Ÿåˆæ›²çº¿å’Œæ®‹å·®åˆ†ææ—¶ï¼Œæˆ‘é‡åˆ°äº†å›¾å½¢ç¾è§‚æ€§å’Œä¿¡æ¯é‡ä¹‹é—´çš„å¹³è¡¡é—®é¢˜ã€‚é€šè¿‡å­¦ä¹ 
ggplot2
åŒ…çš„é«˜çº§ç»˜å›¾æŠ€å·§ï¼Œæˆ‘æˆåŠŸåœ°åˆ¶ä½œäº†æ¸…æ™°ä¸”å¯Œæœ‰ä¿¡æ¯çš„å›¾å½¢ï¼Œç›´è§‚åœ°å±•ç¤ºäº†å„ä¸ªæ¨¡å‹çš„æ€§èƒ½ã€‚

**ç»ƒä¹  8.1** è¦æ±‚å®ç°ä¸¤æ ·æœ¬ CramÃ©r-von Mises
æ£€éªŒçš„ç½®æ¢æ£€éªŒã€‚ç”±äºå¯¹è¯¥æ£€éªŒçš„ç†è§£ä¸å¤Ÿæ·±å…¥ï¼Œæˆ‘èŠ±è´¹äº†å¤§é‡æ—¶é—´ç ”è¯»æ•™æå’Œç›¸å…³è®ºæ–‡ï¼ŒåŠªåŠ›ç†è§£å…¶ç»Ÿè®¡é‡çš„è®¡ç®—æ–¹æ³•å’Œç½®æ¢æ£€éªŒçš„åŸç†ã€‚åœ¨å®é™…ç¼–ç æ—¶ï¼Œå¦‚ä½•é«˜æ•ˆåœ°è®¡ç®—ç»éªŒåˆ†å¸ƒå‡½æ•°ï¼Œä»¥åŠåœ¨ç½®æ¢è¿‡ç¨‹ä¸­ä¿æŒæ ·æœ¬çš„ä¸€è‡´æ€§ï¼Œéƒ½æ˜¯æ£˜æ‰‹çš„é—®é¢˜ã€‚ä¸ºæ­¤ï¼Œæˆ‘ç¼–å†™äº†è‡ªå®šä¹‰çš„å‡½æ•°æ¥è®¡ç®—ç»Ÿè®¡é‡ï¼Œå¹¶ä½¿ç”¨äº†
R
ä¸­çš„æ’åºå’ŒåŒ¹é…å‡½æ•°æ¥ä¼˜åŒ–è®¡ç®—è¿‡ç¨‹ã€‚ç»è¿‡å¤šæ¬¡è°ƒè¯•ï¼Œç»ˆäºæˆåŠŸåœ°å®ç°äº†è¯¥æ£€éªŒï¼Œå¹¶å°†å…¶åº”ç”¨äºå®é™…æ•°æ®ã€‚

åœ¨ **ç»ƒä¹  8.2** ä¸­ï¼Œå®ç° Spearman
ç§©ç›¸å…³æ€§çš„ç½®æ¢æ£€éªŒä¹Ÿå……æ»¡æŒ‘æˆ˜ã€‚ç‰¹åˆ«æ˜¯å¯¹äºå¤§æ ·æœ¬é‡ï¼Œç½®æ¢æ¬¡æ•°çš„é€‰æ‹©å’Œè®¡ç®—æ—¶é—´æˆä¸ºäº†ç“¶é¢ˆã€‚ä¸€å¼€å§‹ï¼Œæˆ‘ä½¿ç”¨äº†è¾ƒå°çš„ç½®æ¢æ¬¡æ•°ï¼Œç»“æœå‘ç°
p
å€¼ä¸ç¨³å®šï¼Œé‡å¤å®éªŒæ—¶ç»“æœå˜åŒ–è¾ƒå¤§ã€‚ä¸ºäº†è·å¾—ç¨³å®šçš„ç»“æœï¼Œæˆ‘ä¸å¾—ä¸å¢åŠ ç½®æ¢æ¬¡æ•°ï¼Œä½†è¿™åˆå¯¼è‡´è®¡ç®—æ—¶é—´è¿‡é•¿ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªçŸ›ç›¾ï¼Œæˆ‘å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨å¹¶è¡Œè®¡ç®—å’Œ
R ä¸­çš„ apply ç³»åˆ—å‡½æ•°ï¼Œæå¤§åœ°æé«˜äº†è®¡ç®—æ•ˆç‡ã€‚æ­¤å¤–ï¼Œåœ¨è®¡ç®— p
å€¼æ—¶ï¼Œå¦‚ä½•å¤„ç†ç²¾åº¦é—®é¢˜å’Œé¿å…æµ®ç‚¹æ•°è¯¯å·®ï¼Œä¹Ÿæ˜¯éœ€è¦æ³¨æ„çš„ç»†èŠ‚ã€‚

åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ€å¤§çš„å›°éš¾è¿˜æ˜¯å¿ƒç†ä¸Šçš„ã€‚å½“ä»£ç åå¤å‡ºç°é”™è¯¯ï¼Œæˆ–è€…ç»“æœä¸é¢„æœŸä¸ç¬¦æ—¶ï¼Œéš¾å…ä¼šæ„Ÿåˆ°æ²®ä¸§å’Œç„¦è™‘ã€‚ç„¶è€Œï¼Œæˆ‘æ„è¯†åˆ°è¿™æ˜¯å­¦ä¹ å’Œæˆé•¿çš„å¿…ç»ä¹‹è·¯ã€‚é€šè¿‡å†·é™åˆ†æé—®é¢˜ï¼ŒæŸ¥æ‰¾èµ„æ–™ï¼Œä¸åŒå­¦è®¨è®ºï¼Œæˆ‘é€æ­¥å…‹æœäº†è¿™äº›å›°éš¾ã€‚æ¯è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œéƒ½è®©æˆ‘æ„Ÿåˆ°æ— æ¯”çš„å……å®å’Œè‡ªä¿¡ã€‚

## æ€è€ƒä¸æ„Ÿæ‚Ÿ

è¿™æ¬¡å®éªŒè®©æˆ‘æ·±åˆ»åœ°è®¤è¯†åˆ°ç†è®ºçŸ¥è¯†ä¸å®è·µåº”ç”¨ä¹‹é—´çš„å·®è·ã€‚è®¸å¤šåœ¨è¯¾å ‚ä¸Šçœ‹ä¼¼ç®€å•çš„æ¦‚å¿µï¼Œåœ¨å®é™…æ“ä½œä¸­å´å¯èƒ½é‡åˆ°å„ç§å¤æ‚çš„é—®é¢˜ã€‚è¿™æé†’æˆ‘ï¼Œå­¦ä¹ ä¸èƒ½åœç•™åœ¨è¡¨é¢ï¼Œå¿…é¡»æ·±å…¥ç†è§£åŸç†ï¼Œæ‰èƒ½çµæ´»åœ°åº”ç”¨äºå®é™…ã€‚

åœ¨å¤„ç†æ•°æ®å’Œæ„å»ºæ¨¡å‹çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä½“ä¼šåˆ°äº†æ•°æ®åˆ†æçš„è‰ºæœ¯æ€§ã€‚é€‰æ‹©åˆé€‚çš„æ¨¡å‹ï¼Œä¸ä»…éœ€è¦ç»Ÿè®¡æŒ‡æ ‡çš„æ”¯æŒï¼Œæ›´éœ€è¦å¯¹æ•°æ®æœ¬èº«çš„ç†è§£å’Œå¯¹å®é™…é—®é¢˜çš„æ´å¯Ÿã€‚æ¯”å¦‚ï¼Œåœ¨
**ç»ƒä¹  7.10** ä¸­ï¼Œè™½ç„¶äºŒæ¬¡å¤šé¡¹å¼æ¨¡å‹åœ¨äº¤å‰éªŒè¯å’Œè°ƒæ•´åçš„ R
å¹³æ–¹ä¸Šè¡¨ç°æœ€ä½³ï¼Œä½†è¿™æ˜¯å¦æ„å‘³ç€å®ƒå°±æ˜¯æœ€é€‚åˆå®é™…åº”ç”¨çš„æ¨¡å‹ï¼Ÿæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘æ¨¡å‹çš„å¯è§£é‡Šæ€§ã€å¤æ‚åº¦ä»¥åŠåœ¨æ–°æ•°æ®ä¸Šçš„æ³›åŒ–èƒ½åŠ›ã€‚

ç½®æ¢æ£€éªŒçš„å­¦ä¹ å’Œå®è·µï¼Œè®©æˆ‘å¯¹éå‚æ•°ç»Ÿè®¡æ–¹æ³•æœ‰äº†æ›´æ·±çš„è®¤è¯†ã€‚åœ¨æ•°æ®ä¸æ»¡è¶³ä¼ ç»Ÿå‡è®¾çš„æƒ…å†µä¸‹ï¼Œéå‚æ•°æ–¹æ³•æä¾›äº†æœ‰åŠ›çš„å·¥å…·ã€‚ç„¶è€Œï¼Œå®ƒä»¬ä¹Ÿæœ‰è‡ªå·±çš„å±€é™æ€§ï¼Œæ¯”å¦‚è®¡ç®—é‡å¤§ã€ç²¾åº¦ä¾èµ–äºç½®æ¢æ¬¡æ•°ç­‰ã€‚è¿™æé†’æˆ‘ï¼Œä½œä¸ºæ•°æ®åˆ†æå¸ˆï¼Œéœ€è¦ç†Ÿç»ƒæŒæ¡å¤šç§æ–¹æ³•ï¼Œçµæ´»åº”å¯¹ä¸åŒçš„åˆ†æéœ€æ±‚ã€‚

æ­¤å¤–ï¼Œæˆ‘ä¹Ÿæ·±åˆ»ä½“ä¼šåˆ°ç¼–ç¨‹èƒ½åŠ›åœ¨ç»Ÿè®¡åˆ†æä¸­çš„é‡è¦æ€§ã€‚ç†Ÿç»ƒçš„ç¼–ç¨‹æŠ€èƒ½ä¸ä»…å¯ä»¥æé«˜å·¥ä½œæ•ˆç‡ï¼Œæ›´èƒ½å¸®åŠ©æˆ‘ä»¬æ¢ç´¢æ›´å¤æ‚çš„æ¨¡å‹å’Œæ–¹æ³•ã€‚åœ¨è¿™æ¬¡å®éªŒä¸­ï¼Œæˆ‘çš„
R è¯­è¨€æ°´å¹³å¾—åˆ°äº†å¾ˆå¤§çš„æå‡ï¼Œä¹Ÿæ›´åŠ ä½“ä¼šåˆ°ä»£ç è´¨é‡å’Œè§„èŒƒæ€§çš„é‡è¦æ€§ã€‚

æœ€é‡è¦çš„æ˜¯ï¼Œè¿™æ¬¡å®éªŒåŸ¹å…»äº†æˆ‘è§£å†³é—®é¢˜çš„èƒ½åŠ›å’ŒåšæŒä¸æ‡ˆçš„ç²¾ç¥ã€‚æ¯å½“é‡åˆ°å›°éš¾ï¼Œæˆ‘éƒ½å‘Šè¯«è‡ªå·±è¦å†·é™æ€è€ƒï¼Œä¸è½»è¨€æ”¾å¼ƒã€‚é€šè¿‡æŸ¥é˜…èµ„æ–™ã€å‘è€å¸ˆå’ŒåŒå­¦è¯·æ•™ï¼Œé—®é¢˜æœ€ç»ˆéƒ½ä¼šè¿åˆƒè€Œè§£ã€‚è¿™ç§æˆå°±æ„Ÿæ¿€åŠ±ç€æˆ‘ä¸æ–­å‰è¿›ã€‚


------------------------------------------------------------------------

# ç»Ÿè®¡è®¡ç®—ç¬¬7æ¬¡ä½œä¸š { .center-title }

ä»¥ä¸‹æ˜¯ç»Ÿè®¡è®¡ç®—2024-10-28è¯¾ç¨‹å¯¹åº”çš„ä½œä¸š

# Question

## Question 1

Exercies 9.3 and 9.8 (pages 277-278, Statistical Computing with R).  

-   **Exercise 9.3**  Use the Metropolis-Hastings sampler to generate random variables from a standard Cauchy distribution. Discard the first 1000 of the chain, and compare the deciles of the generated observations with the deciles of the standard Cauchy distribution (see `qcauchy` or `qt` with `df=1`). Recall that a Cauchy($\theta, \eta$) distribution has density function
$$
f(x)=\frac{1}{\theta\pi(1+[(x-\eta)/\theta]^2)},\quad-\infty<x<\infty, \theta>0.
$$
The standard Cauchy has the Cauchy($\theta = 1, \eta = 0$) density. (Note that the standard Cauchy density is equal to the Student $t$ density with one degree of freedom.)

-   **Exercise 9.8**  This example appears in [40]. Consider the bivariate density

$$
f(x, y) \propto \binom{n}{x} y^{x + a - 1} (1 - y)^{n - x + b - 1}, \quad x = 0, 1, \dots, n, \quad 0 \leq y \leq 1.
$$
It can be shown (see e.g. [23]) that for fixed $a$, $b$, $n$, the conditional distributions are $Binomial(n, y)$ and $Beta(x + a, n - x + b)$. Use the Gibbs sampler to generate a chain with target joint density $f(x, y)$.


## Question 2

Proof the Stationarity of Metropolis-Hastings sampler Algorithm in continuous situation.

- Algorithm (continuous situation)
  
  - Target pdf: $f(x)$.
  - Replace $i$ and $j$ with $s$ and $r$.
  - Proposal distribution (pdf):$g(r|s)$.
  - Acceptance probability: $\alpha(s, r) = \min \left\{ \frac{f(r) g(s|r)}{f(s) g(r|s)}, 1 \right\}$.
  - Transition kernel (mixture distribution):$K(r, s) = I(s \neq r) \alpha(r, s) g(s|r) + I(s = r) \left[ 1 - \int \alpha(r, s) g(s|r) \right]$.
  - Stationarity: $K(s, r) f(s) = K(r, s) f(r)$.


# Answer

## é—®é¢˜1 ç»ƒä¹ 9.3

### é¢˜ç›®æè¿°

æœ¬ç»ƒä¹ è¦æ±‚ä½¿ç”¨Metropolis-Hastingsé‡‡æ ·æ–¹æ³•ç”Ÿæˆæ¥è‡ªæ ‡å‡†Cauchyåˆ†å¸ƒçš„éšæœºå˜é‡ã€‚æ ‡å‡†Cauchyåˆ†å¸ƒæ˜¯ä¸€ä¸ªå…·æœ‰é‡å°¾ç‰¹å¾çš„æ¦‚ç‡åˆ†å¸ƒï¼Œå…¶æ¦‚ç‡å¯†åº¦å‡½æ•°ä¸ºï¼š

$$
f(x) = \frac{1}{\pi(1 + x^2)}, \quad -\infty < x < \infty.
$$

æˆ‘ä»¬å°†é€šè¿‡Metropolis-Hastingsç®—æ³•ç”Ÿæˆæ€»å…±10,000ä¸ªæ ·æœ¬ï¼Œä½†åœ¨æœ€ç»ˆåˆ†æä¸­ï¼Œå‰1,000ä¸ªæ ·æœ¬å°†è¢«ä¸¢å¼ƒï¼Œä»¥å‡å°‘åˆå§‹å€¼å¯¹æ ·æœ¬çš„å½±å“ã€‚æ¥ç€ï¼Œå°†è®¡ç®—ç”Ÿæˆæ ·æœ¬çš„ååˆ†ä½æ•°ï¼Œå¹¶ä¸ç†è®ºä¸Šçš„æ ‡å‡†Cauchyåˆ†å¸ƒçš„ååˆ†ä½æ•°è¿›è¡Œæ¯”è¾ƒã€‚æ­¤å¤–ï¼Œä½¿ç”¨Gelman-Rubinæ–¹æ³•ç›‘æµ‹ä¸åŒé“¾çš„æ”¶æ•›æ€§ï¼Œç›´åˆ°å¤§è‡´æ»¡è¶³æ”¶æ•›æ¡ä»¶$\hat{R} < 1.2$ã€‚æœ€åï¼Œé€šè¿‡å¯è§†åŒ–å›¾å½¢å±•ç¤ºæ ·æœ¬çš„åˆ†å¸ƒå’Œæ”¶æ•›æ€§ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£é‡‡æ ·ç»“æœã€‚

### è§£ç­”æ€è·¯

1. **Metropolis-Hastingsé‡‡æ ·åŸç†**ï¼š

   Metropolis-Hastingsç®—æ³•æ˜¯ä¸€ç§åŸºäºéšæœºæ¼«æ­¥çš„Markové“¾è’™ç‰¹å¡ç½—ï¼ˆMCMCï¼‰æ–¹æ³•ï¼Œå¹¿æ³›ç”¨äºä»éš¾ä»¥ç›´æ¥é‡‡æ ·çš„å¤æ‚æ¦‚ç‡åˆ†å¸ƒä¸­ç”Ÿæˆæ ·æœ¬ã€‚è¯¥æ–¹æ³•é€šè¿‡ä¸€ä¸ªè¿­ä»£è¿‡ç¨‹é€æ¸é€¼è¿‘ç›®æ ‡åˆ†å¸ƒï¼š

   - **åˆå§‹åŒ–**ï¼šä»ä»»æ„åˆå€¼å¼€å§‹ã€‚
   - **è¿­ä»£è¿‡ç¨‹**ï¼šå½“å‰æ ·æœ¬ä½ç½®ä¸º $X_t$ï¼Œç”Ÿæˆå€™é€‰æ ·æœ¬ $Y$ æ¥è‡ªäºä»¥ $X_t$ ä¸ºä¸­å¿ƒçš„å¯¹ç§°æ­£æ€åˆ†å¸ƒï¼ˆæè®®åˆ†å¸ƒï¼‰ã€‚
   - **æ¥å—/æ‹’ç»å‡†åˆ™**ï¼šè®¡ç®—æ¥å—ç‡ $\alpha = \min\left(1, \frac{f(Y)}{f(X_t)}\right)$ï¼Œå…¶ä¸­ $f$ æ˜¯ç›®æ ‡åˆ†å¸ƒçš„å¯†åº¦å‡½æ•°ã€‚ä½¿ç”¨ä¸€ä¸ªå‡åŒ€éšæœºæ•° $u$ ä¸ $\alpha$ æ¯”è¾ƒï¼Œè‹¥ $u \leq \alpha$ï¼Œæ¥å— $Y$ ä½œä¸ºæ–°æ ·æœ¬ï¼Œå¦åˆ™ä¿ç•™ $X_t$ã€‚

2. **æ ·æœ¬ä¸¢å¼ƒä¸çƒ­èº«æœŸ**ï¼š

   åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸ºäº†å‡å°‘åˆå§‹æ¡ä»¶å¯¹æ ·æœ¬çš„å½±å“ï¼Œé€šå¸¸ä¼šåœ¨é‡‡æ ·è¿‡ç¨‹ä¸­ä¸¢å¼ƒä¸€å®šæ•°é‡çš„â€œçƒ­èº«â€æ ·æœ¬ï¼ˆburn-in periodï¼‰ï¼Œä»¥ä¾¿ç®—æ³•è¾¾åˆ°å¹³ç¨³çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥èˆå¼ƒå‰1000ä¸ªæ ·æœ¬ï¼Œä»¥ç¡®ä¿åç»­æ ·æœ¬æ›´å¥½åœ°åæ˜ ç›®æ ‡åˆ†å¸ƒã€‚

3. **ååˆ†ä½æ•°è®¡ç®—ä¸å¯¹æ¯”åˆ†æ**ï¼š

   é€šè¿‡è®¡ç®—å’Œå¯¹æ¯”æ ·æœ¬çš„ååˆ†ä½æ•°ä¸ç†è®ºååˆ†ä½æ•°ï¼ˆä¾‹å¦‚Cauchyåˆ†å¸ƒçš„ç†è®ºååˆ†ä½æ•°ï¼‰ï¼Œå¯ä»¥è¯„ä¼°é‡‡æ ·ç®—æ³•çš„æ•ˆæœå’Œæ ·æœ¬çš„åˆ†å¸ƒç‰¹æ€§ã€‚ååˆ†ä½æ•°æä¾›äº†ä¸€ç§æ£€éªŒæ ·æœ¬æ˜¯å¦ç¬¦åˆé¢„æœŸåˆ†å¸ƒçš„æ–¹æ³•ã€‚

4. **Gelman-Rubinæ”¶æ•›æ€§ç›‘æ§**ï¼š

   Gelman-Rubinç»Ÿè®¡é‡ç”¨äºè¯„ä¼°å¤šä¸ªç‹¬ç«‹Markové“¾æ˜¯å¦æ”¶æ•›åˆ°åŒä¸€åˆ†å¸ƒã€‚è¿™é€šè¿‡æ¯”è¾ƒé“¾å†…æ–¹å·®ï¼ˆWï¼‰å’Œé“¾é—´æ–¹å·®ï¼ˆBï¼‰æ¥å®ç°ã€‚ç»Ÿè®¡é‡ $\hat{R}$ è¶Šæ¥è¿‘1ï¼ˆæœ¬ç»ƒä¹ ä¸­æ”¶æ•›æ¡ä»¶æ»¡è¶³$\hat{R} < 1.2$å³å¯ï¼‰ï¼Œè¡¨æ˜å„é“¾è¶Šè¶‹äºæ”¶æ•›ã€‚

5. **å¯è§†åŒ–åˆ†æ**ï¼š

   - **æ ·æœ¬è½¨è¿¹å›¾**ï¼šå±•ç¤ºå„é“¾æ ·æœ¬å€¼éšè¿­ä»£æ¬¡æ•°çš„å˜åŒ–ï¼Œæœ‰åŠ©äºè§‚å¯Ÿæ ·æœ¬çš„æ¼”å˜è¿‡ç¨‹å’Œæ½œåœ¨çš„æ”¶æ•›æ€§ã€‚
   - **ç›´æ–¹å›¾ä¸å¯†åº¦å›¾**ï¼šç›´æ–¹å›¾å±•ç¤ºæ ·æœ¬çš„åˆ†å¸ƒæƒ…å†µï¼Œè€Œé€šè¿‡åœ¨åŒä¸€å›¾ä¸Šå åŠ ç†è®ºå¯†åº¦æ›²çº¿ï¼ˆå¦‚Cauchyå¯†åº¦å‡½æ•°ï¼‰ï¼Œå¯ä»¥ç›´è§‚æ¯”è¾ƒæ ·æœ¬åˆ†å¸ƒä¸ç†è®ºåˆ†å¸ƒçš„å»åˆåº¦ã€‚


### ä»£ç å®ç°

**1.å¯¼å…¥å¿…è¦çš„åº“å¹¶æ¸…ç©ºå†…å­˜**

```{r, eval=TRUE}
# æ¸…ç©ºå†…å­˜
rm(list = ls())

# åŠ è½½å¿…è¦çš„åº“
library(ggplot2)  # ç”¨äºæ•°æ®å¯è§†åŒ–
library(coda)     # ç”¨äºGelman-Rubinè¯Šæ–­
library(gridExtra)  # ç”¨äºç»„åˆå¤šä¸ªå›¾å½¢
library(kableExtra) # ç”¨äºè¡¨æ ¼ç»˜åˆ¶
```

**2.å®šä¹‰Metropolis-Hastingsé‡‡æ ·å‡½æ•°**

```{r, eval=TRUE}
# Metropolis-Hastingsé‡‡æ ·å‡½æ•°
metropolis_hastings <- function(iter, initial, proposal_sd) {
  samples <- numeric(iter)  # åˆå§‹åŒ–æ ·æœ¬å‘é‡
  samples[1] <- initial  # è®¾ç½®åˆå§‹å€¼
  
  for (i in 2:iter) {
    # ä»æè®®åˆ†å¸ƒç”Ÿæˆå€™é€‰æ ·æœ¬
    candidate <- rnorm(1, mean = samples[i - 1], sd = proposal_sd)
    
    # è®¡ç®—æ¥å—ç‡
    acceptance_ratio <- dcauchy(candidate) / dcauchy(samples[i - 1])
    if (runif(1) < acceptance_ratio) {
      samples[i] <- candidate  # æ¥å—å€™é€‰æ ·æœ¬
    } else {
      samples[i] <- samples[i - 1]  # ä¿ç•™å½“å‰æ ·æœ¬
    }
  }
  
  return(samples)  # è¿”å›æ ·æœ¬
}
```

**3.è¿è¡ŒMetropolis-Hastingsé‡‡æ ·**

```{r, eval=TRUE}
# è¿è¡ŒMetropolis-Hastingsé‡‡æ ·
set.seed(123)  # è®¾ç½®éšæœºæ•°ç§å­
n_iterations <- 10000  # æ€»è¿­ä»£æ¬¡æ•°
initial_value <- 0  # åˆå§‹å€¼
proposal_sd <- 1  # æè®®åˆ†å¸ƒæ ‡å‡†å·®

# ç”Ÿæˆæ ·æœ¬
samples <- metropolis_hastings(n_iterations, initial_value, proposal_sd)

# ä¸¢å¼ƒå‰1000ä¸ªæ ·æœ¬
samples <- samples[-(1:1000)]
```

**4.è®¡ç®—ååˆ†ä½æ•°**

```{r, eval=TRUE}
# åŠ è½½å¿…è¦çš„åŒ…
library(knitr)       # ç”¨äºç¾åŒ–è¡¨æ ¼
library(magrittr)    # æä¾›ç®¡é“æ“ä½œç¬¦

# è®¡ç®—ç”Ÿæˆæ ·æœ¬çš„ååˆ†ä½æ•°
deciles_samples <- quantile(samples, probs = seq(0.1, 0.9, by = 0.1))

# è®¡ç®—ç†è®ºæ ‡å‡†Cauchyåˆ†å¸ƒçš„ååˆ†ä½æ•°
deciles_theoretical <- qcauchy(seq(0.1, 0.9, by = 0.1))

# åˆ›å»ºå¯¹æ¯”è¡¨æ ¼
decile_comparison <- data.frame(
  Decile = seq(0.1, 0.9, by = 0.1),
  Sample_Quantiles = deciles_samples,
  Theoretical_Quantiles = deciles_theoretical
)

# ç¾åŒ–è¡¨æ ¼å¹¶è¾“å‡º
kable(decile_comparison, format = "html", caption = "ååˆ†ä½æ•°å¯¹æ¯”è¡¨æ ¼") %>%
  kable_styling(full_width = F, position = "center")

```

**5.å¯è§†åŒ–ååˆ†ä½æ•°ä¸ç†è®ºååˆ†ä½æ•°çš„å¯¹æ¯”**

```{r, eval=TRUE}
library(ggplot2)

# å°†æ•°æ®è½¬æ¢ä¸ºé•¿æ ¼å¼ä»¥ä¾¿ç»˜å›¾
decile_long <- tidyr::pivot_longer(
  decile_comparison,
  cols = c(Sample_Quantiles, Theoretical_Quantiles),
  names_to = "Type",
  values_to = "Quantile"
)

# åˆ›å»ºç»˜å›¾
p <-ggplot(decile_long, aes(x = Decile, y = Quantile, color = Type)) +
  geom_point(size = 3) +  # æ·»åŠ ç‚¹
  geom_line() +  # æ·»åŠ è¿çº¿
  labs(title = "æ ·æœ¬ååˆ†ä½æ•°ä¸ç†è®ºååˆ†ä½æ•°å¯¹æ¯”",
       x = "ååˆ†ä½æ•°",
       y = "Quantile") +
  theme_minimal() +  # ä½¿ç”¨ç®€æ´ä¸»é¢˜
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14) # å¯é€‰ï¼šè°ƒæ•´å­—ä½“æ ·å¼
  )+
  scale_color_manual(values = c("Sample_Quantiles" = "blue", "Theoretical_Quantiles" = "red")) +  # è‡ªå®šä¹‰é¢œè‰²
  theme(legend.title = element_blank())  # éšè—å›¾ä¾‹æ ‡é¢˜
print(p)
```

**6.Gelman-Rubinæ”¶æ•›ç›‘æµ‹**

```{r, eval=TRUE}
# Gelman-Rubinæ”¶æ•›ç›‘æµ‹
n_chains <- 5  # è®¾ç½®é“¾çš„æ•°é‡
chains <- replicate(n_chains, metropolis_hastings(n_iterations, initial_value, proposal_sd))
chains <- chains[-(1:1000), ]  # ä¸¢å¼ƒå‰1000ä¸ªæ ·æœ¬

# è®¡ç®—å„é“¾çš„å‡å€¼å’Œæ–¹å·®
chain_means <- apply(chains, 2, mean)
chain_vars <- apply(chains, 2, var)

# è®¡ç®—æ€»å‡å€¼å’Œæ€»æ–¹å·®
overall_mean <- mean(chain_means)
overall_var <- mean(chain_vars)

# Gelman-Rubinç»Ÿè®¡é‡
B <- sum((chain_means - overall_mean)^2) * n_iterations / (n_chains - 1)
W <- mean(chain_vars)
R_hat <- sqrt((W + B / n_iterations) / W)

# è¾“å‡ºR_hatå€¼
print("Gelman-Rubinç»Ÿè®¡é‡ (R_hat):")
print(R_hat)
```

**7.æ ·æœ¬è½¨è¿¹å›¾**

```{r, eval=TRUE}
# é€‰æ‹©æ¯éš”10ä¸ªè¿­ä»£çš„æ ·æœ¬
sample_indices <- seq(1, nrow(chains), by = 10)
matplot(t(chains[sample_indices, ]), type = 'l', col = 1:n_chains, lty = 1,
        main = 'å¤šæ¡é“¾æ ·æœ¬è½¨è¿¹å›¾', xlab = 'è¿­ä»£æ¬¡æ•°', ylab = 'æ ·æœ¬å€¼')
legend("topright", legend = paste("é“¾", 1:n_chains), col = 1:n_chains, lty = 1)
```

**8.æ ·æœ¬çš„ç›´æ–¹å›¾åŠå¯†åº¦å›¾**

```{r, eval=TRUE}
# ç»˜åˆ¶æ ·æœ¬çš„ç›´æ–¹å›¾åŠå¯†åº¦å›¾
ggplot(data.frame(samples), aes(x = samples)) +
  geom_histogram(aes(y = after_stat(density)), bins = 50, fill = 'blue', alpha = 0.7) +
  stat_function(fun = dcauchy, color = 'red', linewidth = 1) +
  ggtitle('æ ·æœ¬çš„ç›´æ–¹å›¾ä¸å¯†åº¦å›¾') +
  xlab('æ ·æœ¬å€¼') + ylab('å¯†åº¦')+
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14) # å¯é€‰ï¼šè°ƒæ•´å­—ä½“æ ·å¼
  )
```

**9.æ ·æœ¬æ ·æœ¬å¯†åº¦ä¸ç†è®ºå€¼å¯¹æ¯”å›¾**

```{r, eval=TRUE}
# ç»˜åˆ¶æ ·æœ¬å¯†åº¦ä¸ç†è®ºå€¼å¯¹æ¯”å›¾
plot(density(samples), main = 'æ ·æœ¬å¯†åº¦å›¾', xlab = 'æ ·æœ¬å€¼', ylab = 'å¯†åº¦', col = 'blue')
lines(density(samples), col = 'blue', lwd = 2)
curve(dcauchy, add = TRUE, col = 'red', lwd = 2)  # åŠ å…¥ç†è®ºå¯†åº¦æ›²çº¿
legend("topright", legend = c("æ ·æœ¬å¯†åº¦", "ç†è®ºCauchyå¯†åº¦"), col = c("blue", "red"), lty = 1)
```

### ç»“æœåˆ†æ

æœ¬æ¬¡ç»ƒä¹ æ—¨åœ¨ä½¿ç”¨Metropolis-Hastingsé‡‡æ ·æ–¹æ³•ä»æ ‡å‡†Cauchyåˆ†å¸ƒä¸­ç”Ÿæˆæ ·æœ¬ï¼Œå¹¶è¿›è¡Œä¸€ç³»åˆ—ç»Ÿè®¡åˆ†æä»¥è¯„ä¼°é‡‡æ ·æ•ˆæœå’Œæ”¶æ•›æ€§ã€‚ä»¥ä¸‹æ˜¯å¯¹ç»“æœçš„è¯¦ç»†åˆ†æã€‚

1.**ååˆ†ä½æ•°æ¯”è¾ƒ**ï¼š

   è®¡ç®—äº†ç”Ÿæˆæ ·æœ¬çš„ååˆ†ä½æ•°ï¼Œå¹¶ä¸ç†è®ºæ ‡å‡†Cauchyåˆ†å¸ƒçš„ååˆ†ä½æ•°è¿›è¡Œäº†æ¯”è¾ƒã€‚å¦‚ä¸‹æ˜¯å¯¹æ¯”è¡¨æ ¼çš„æ ¸å¿ƒå†…å®¹ï¼š

   | Decile | Sample Quantiles | Theoretical Quantiles |
   | ------ | ---------------- | --------------------- |
   | 10%    | -2.8175          | -3.0777               |
   | 20%    | -1.4027          | -1.3764               |
   | 30%    | -0.7378          | -0.7265               |
   | 40%    | -0.3335          | -0.3249               |
   | 50%    | -0.0164          | 0.0000                |
   | 60%    | 0.3071           | 0.3249                |
   | 70%    | 0.7233           | 0.7265                |
   | 80%    | 1.3727           | 1.3764                |
   | 90%    | 3.0284           | 3.0777                |

   ä»è¡¨ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ ·æœ¬çš„ååˆ†ä½æ•°ä¸ç†è®ºååˆ†ä½æ•°å¤§ä½“ä¸Šå»åˆï¼Œè¡¨æ˜é‡‡æ ·ç®—æ³•æœ‰æ•ˆåœ°æ•æ‰åˆ°äº†æ ‡å‡†Cauchyåˆ†å¸ƒçš„ç‰¹å¾ã€‚è™½ç„¶å­˜åœ¨ä¸€äº›å°çš„åå·®ï¼Œä½†è¿™äº›åå·®åœ¨é‡å°¾åˆ†å¸ƒä¸­æ˜¯å¯ä»¥æ¥å—çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨æ ·æœ¬æ•°é‡è¾ƒå°çš„æƒ…å†µä¸‹ã€‚

2.**æ”¶æ•›æ€§ç›‘æµ‹**ï¼š

   æ ¹æ®Gelman-Rubinç»Ÿè®¡é‡è®¡ç®—çš„ç»“æœä¸ºï¼š

```{r, eval=TRUE}
print(R_hat)
```

   è¿™ä¸€å€¼è¿œå°äº1.2çš„æ”¶æ•›æ ‡å‡†ï¼Œè¡¨æ˜æ‰€é€‰çš„å¤šä¸ªMarkové“¾å·²ç»å¾ˆå¥½åœ°æ”¶æ•›åˆ°åŒä¸€åˆ†å¸ƒã€‚è¿™è¿›ä¸€æ­¥éªŒè¯äº†Metropolis-Hastingsé‡‡æ ·çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚è¾ƒä½çš„R_hatå€¼æ˜¾ç¤ºå‡ºå„ä¸ªé“¾ä¹‹é—´çš„æ ·æœ¬å˜å¼‚æ€§å·²ç»å¾ˆå°ï¼Œå„é“¾çš„æ ·æœ¬å‡å€¼ä¸æ€»ä½“å‡å€¼éå¸¸æ¥è¿‘ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬çš„é‡‡æ ·è¿‡ç¨‹æ˜¯æœ‰æ•ˆçš„ã€‚

3.**æ ·æœ¬è½¨è¿¹å›¾**ï¼š

   - å›¾ä¸­çš„æ³¢åŠ¨æƒ…å†µåæ˜ äº†Metropolis-Hastingsç®—æ³•çš„ç‰¹æ€§ã€‚
   - å¯ä»¥è§‚å¯Ÿåˆ°éšç€è¿­ä»£æ¬¡æ•°çš„å¢åŠ ï¼Œæ ·æœ¬å€¼é€æ¸è¶‹äºç¨³å®šï¼Œä¸”å„é“¾çš„æ ·æœ¬å€¼ç›¸äº’äº¤ç»‡ï¼Œè¿™è¡¨æ˜å¤šä¸ªé“¾ä¹‹é—´çš„æ”¶æ•›æ€§ã€‚

4.**ç›´æ–¹å›¾å’Œå¯†åº¦å›¾**ï¼š

   - ç›´æ–¹å›¾å±•ç¤ºäº†ç”Ÿæˆæ ·æœ¬çš„åˆ†å¸ƒæƒ…å†µï¼Œçº¢è‰²æ›²çº¿æ˜¯æ ‡å‡†Cauchyåˆ†å¸ƒçš„å¯†åº¦å‡½æ•°ã€‚
   - ä»ç›´æ–¹å›¾ä¸­å¯ä»¥è§‚å¯Ÿåˆ°ç”Ÿæˆçš„æ ·æœ¬åˆ†å¸ƒå¤§è‡´ä¸æ ‡å‡†Cauchyåˆ†å¸ƒç›¸ç¬¦ã€‚
   - å¯†åº¦å›¾åˆ™æ›´æ¸…æ™°åœ°å±•ç¤ºäº†æ ·æœ¬åˆ†å¸ƒå’Œç†è®ºåˆ†å¸ƒçš„é‡åˆç¨‹åº¦ã€‚

5.**æ€»ç»“**ï¼š

   - æœ¬æ¬¡å®éªŒé€šè¿‡Metropolis-Hastingsç®—æ³•æˆåŠŸç”Ÿæˆäº†æ ‡å‡†Cauchyåˆ†å¸ƒçš„æ ·æœ¬ï¼ŒéªŒè¯äº†é‡‡æ ·çš„æœ‰æ•ˆæ€§å’Œæ”¶æ•›æ€§ã€‚
   - é€šè¿‡å¤šç§å›¾è¡¨å±•ç¤ºæ ·æœ¬çš„ç‰¹æ€§ï¼Œèƒ½å¤Ÿæ›´ç›´è§‚åœ°ç†è§£é‡‡æ ·è¿‡ç¨‹åŠå…¶ç»“æœã€‚


------------------------------------------------------------------------

## é—®é¢˜1 ç»ƒä¹ 9.8

### é¢˜ç›®æè¿°

è€ƒè™‘ä¸€ä¸ªäºŒå…ƒæ¦‚ç‡åˆ†å¸ƒï¼Œå…¶å¯†åº¦å‡½æ•°å½¢å¼ä¸ºï¼š
$$ f(x, y) \propto \binom{n}{x} y^{x + a - 1} (1 - y)^{n - x + b - 1} $$

å…¶ä¸­ï¼š

- $x$ æ˜¯ç¦»æ•£å˜é‡ï¼Œå–å€¼èŒƒå›´ä¸º $x = 0, 1, ..., n$ï¼›
- $y$ æ˜¯è¿ç»­å˜é‡ï¼Œå–å€¼èŒƒå›´ä¸º $0 â‰¤ y â‰¤ 1$ï¼›
- $n$, $a$, $b$ æ˜¯å·²çŸ¥çš„æ­£æ•´æ•°å‚æ•°ï¼›
- $âˆ$ è¡¨ç¤ºæ­£æ¯”äºï¼Œæ„å‘³ç€ç­‰å·å³è¾¹ç¼ºå°‘ä¸€ä¸ªå½’ä¸€åŒ–å¸¸æ•°ã€‚

è¿™ä¸ªåˆ†å¸ƒçš„ç‰¹ç‚¹æ˜¯ï¼š

1. å®ƒæ˜¯ä¸€ä¸ªæ··åˆåˆ†å¸ƒï¼ŒåŒ…å«ç¦»æ•£å˜é‡$x$å’Œè¿ç»­å˜é‡$y$ã€‚
2. æ¡ä»¶åˆ†å¸ƒå…·æœ‰è‰¯å¥½çš„å½¢å¼ï¼š
   - $x|y$ æœä»äºŒé¡¹åˆ†å¸ƒï¼š$Binomial(n, y)$
   - $y|x$ æœä»Betaåˆ†å¸ƒï¼š$Beta(x + a, n - x + b)$
3. è¿™ç§å½¢å¼åœ¨è´å¶æ–¯åˆ†æä¸­ç»å¸¸å‡ºç°ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†äºŒé¡¹åˆ†å¸ƒçš„å…±è½­å…ˆéªŒæ—¶ã€‚

é¢˜ç›®è¦æ±‚ï¼š

1. ä½¿ç”¨GibbsæŠ½æ ·æ–¹æ³•ç”Ÿæˆæœä»è¯¥è”åˆåˆ†å¸ƒçš„é©¬å°”å¯å¤«é“¾ï¼›
2. ä½¿ç”¨Gelman-Rubinæ–¹æ³•ç›‘æ§é“¾çš„æ”¶æ•›æ€§ï¼›
3. è¿è¡Œç›´åˆ°æ½œåœ¨å°ºåº¦ç¼©å‡å› å­$\hat{R} < 1.2$ã€‚

### è§£ç­”æ€è·¯

1.**ç†è®ºåŸºç¡€**ï¼š

   - GibbsæŠ½æ ·åŸç†ï¼š
     * å½“ç›´æ¥ä»è”åˆåˆ†å¸ƒæŠ½æ ·å›°éš¾æ—¶ï¼Œå¯ä»¥é€šè¿‡æ¡ä»¶åˆ†å¸ƒäº¤æ›¿æŠ½æ ·ã€‚
     * åœ¨æ»¡è¶³ä¸€å®šæ¡ä»¶ä¸‹ï¼Œè¿™ç§æŠ½æ ·æ–¹æ³•ä¼šæ”¶æ•›åˆ°ç›®æ ‡è”åˆåˆ†å¸ƒã€‚

   - Gelman-Rubinè¯Šæ–­åŸç†ï¼š
     * é€šè¿‡æ¯”è¾ƒé“¾å†…æ–¹å·®å’Œé“¾é—´æ–¹å·®æ¥åˆ¤æ–­æ”¶æ•›æ€§ã€‚
     * $\hat{R}$æ¥è¿‘1è¡¨ç¤ºè‰¯å¥½æ”¶æ•›ã€‚

2.**å…·ä½“å®ç°æ­¥éª¤**ï¼š

   A. GibbsæŠ½æ ·æµç¨‹ï¼š
```
   åˆå§‹åŒ–ï¼š
   é€‰æ‹©yçš„åˆå§‹å€¼yâ°
   
   å¯¹t = 0,1,2,...é‡å¤ï¼š
   1. ä»p(x|y^t)ä¸­æŠ½æ ·å¾—åˆ°x^(t+1)
      x^(t+1) ~ Binomial(n, y^t)
   
   2. ä»p(y|x^(t+1))ä¸­æŠ½æ ·å¾—åˆ°y^(t+1)
      y^(t+1) ~ Beta(x^(t+1) + a, n - x^(t+1) + b)
```

   B. Gelman-Rubinè¯Šæ–­æ­¥éª¤ï¼š

1. è¿è¡ŒMæ¡é“¾ï¼ˆ$M â‰¥ 2$ï¼‰ï¼Œæ¯æ¡é“¾é•¿åº¦ä¸º$2n$ã€‚
2. ä¸¢å¼ƒæ¯æ¡é“¾çš„å‰$n$ä¸ªæ ·æœ¬ï¼ˆé¢„çƒ­æœŸï¼‰ã€‚
3. è®¡ç®—ï¼š
  - $W$: é“¾å†…æ–¹å·®ï¼ˆwithin-chain varianceï¼‰ã€‚
  - $B$: é“¾é—´æ–¹å·®ï¼ˆbetween-chain varianceï¼‰ã€‚
  - $\hat{R} = \sqrt{((n-1)/n * W + B/n)/W)}$ã€‚


3.**å®ç°æ³¨æ„äº‹é¡¹**ï¼š

   A. åˆå§‹å€¼é€‰æ‹©ï¼š

   - å¯¹æ¯æ¡é“¾é€‰æ‹©ä¸åŒçš„åˆå§‹å€¼ã€‚
   - å»ºè®®é€‰æ‹©åˆ†å¸ƒåœ¨å‚æ•°ç©ºé—´ä¸åŒåŒºåŸŸçš„åˆå§‹å€¼ã€‚
   - æœ¬é¢˜ä¸­$y$çš„åˆå§‹å€¼åº”åœ¨$(0,1)$åŒºé—´å†…ã€‚

   B. è¿­ä»£æ¬¡æ•°é€‰æ‹©ï¼š

   - é¢„çƒ­æœŸè¦è¶³å¤Ÿé•¿ä»¥æ¶ˆé™¤åˆå§‹å€¼å½±å“ã€‚
   - æ€»è¿­ä»£æ¬¡æ•°è¦è¶³å¤Ÿè·å¾—ç¨³å®šçš„ä¼°è®¡ã€‚
   - å»ºè®®é€šè¿‡è¯Šæ–­å›¾åˆ¤æ–­é¢„çƒ­æœŸé•¿åº¦ã€‚

   C. æ”¶æ•›åˆ¤æ–­ï¼š

   - ä¸»è¦ä¾æ®$\hat{R} < 1.2$çš„æ ‡å‡†ã€‚
   - åŒæ—¶è§‚å¯Ÿtrace plotçš„ç¨³å®šæ€§ã€‚
   - æ£€æŸ¥ä¸åŒé“¾çš„å¯†åº¦ä¼°è®¡æ˜¯å¦é‡åˆã€‚

4.**å¯è§†åŒ–åˆ†æè®¡åˆ’**ï¼š

   A. è¯Šæ–­å›¾ï¼š

   - Trace Plotï¼ˆè·Ÿè¸ªå›¾ï¼‰ï¼šè§‚å¯Ÿé“¾çš„æ··åˆå’Œç¨³å®šæ€§ã€‚
   - Density Plotï¼ˆå¯†åº¦å›¾ï¼‰ï¼šæ¯”è¾ƒä¸åŒé“¾çš„åˆ†å¸ƒã€‚
   - Autocorrelation Plotï¼ˆè‡ªç›¸å…³å›¾ï¼‰ï¼šæ£€æŸ¥æ ·æœ¬ç‹¬ç«‹æ€§ã€‚

   B. æ•°å€¼æ€»ç»“ï¼š

   - å„é“¾çš„æè¿°æ€§ç»Ÿè®¡é‡ã€‚
   - $\hat{R}$å€¼éšè¿­ä»£æ¬¡æ•°çš„å˜åŒ–ã€‚
   - é¢„çƒ­æœŸåˆ¤æ–­ä¾æ®ã€‚

5.**ç†è®ºéªŒè¯**ï¼š

   ä¸ºäº†éªŒè¯å®ç°çš„æ­£ç¡®æ€§ï¼Œå¯ä»¥ï¼š

   - æ£€æŸ¥è¾¹é™…åˆ†å¸ƒæ˜¯å¦ç¬¦åˆç†è®ºé¢„æœŸã€‚
   - éªŒè¯æ¡ä»¶å‡å€¼å’Œæ–¹å·®æ˜¯å¦ç¬¦åˆç†è®ºå€¼ã€‚
   - é€šè¿‡å¤šæ¬¡è¿è¡Œæ£€éªŒç»“æœçš„ç¨³å®šæ€§ã€‚

### ä»£ç å®ç°

**1.æ¸…ç©ºç¯å¢ƒå¹¶è®¾ç½®éšæœºç§å­**

```{r, eval=TRUE}
rm(list = ls())
set.seed(103)

# å‚æ•°è®¾ç½®
n <- 10          # äºŒé¡¹åˆ†å¸ƒå‚æ•°n
a <- 2           # Betaåˆ†å¸ƒå‚æ•°a
b <- 3           # Betaåˆ†å¸ƒå‚æ•°b
niter <- 5000    # è¿­ä»£æ¬¡æ•°
nchains <- 3     # é“¾çš„æ•°é‡
burnin <- 1000   # é¢„çƒ­æœŸé•¿åº¦
```

**2.å®šä¹‰Gibbsé‡‡æ ·å‡½æ•°**

```{r, eval=TRUE}
gibbs_sampler <- function(n, a, b, niter, init_y) {
  # åˆå§‹åŒ–å­˜å‚¨ç©ºé—´
  x <- numeric(niter)
  y <- numeric(niter)
  y[1] <- init_y
  
  # å­˜å‚¨æ¯æ¬¡è¿­ä»£çš„æ¥å—ç‡
  acceptance <- numeric(niter - 1)
  
  # Gibbsé‡‡æ ·è¿­ä»£
  for (i in 1:(niter - 1)) {
    # ä»æ¡ä»¶åˆ†å¸ƒp(x|y)ä¸­æŠ½æ ·
    x[i + 1] <- rbinom(1, n, y[i])
    
    # ä»æ¡ä»¶åˆ†å¸ƒp(y|x)ä¸­æŠ½æ ·
    y[i + 1] <- rbeta(1, x[i + 1] + a, n - x[i + 1] + b)
    
    # è®¡ç®—æ¥å—ç‡ï¼ˆè¿™é‡Œæ€»æ˜¯1ï¼Œå› ä¸ºGibbsé‡‡æ ·æ€»æ˜¯æ¥å—æ–°å€¼ï¼‰
    acceptance[i] <- 1
  }
  
  return(list(
    x = x, 
    y = y,
    acceptance_rate = mean(acceptance)
  ))
}
```

**3.è¿è¡Œå¤šæ¡é“¾**

```{r, eval=TRUE}
chains <- list()
init_values <- c(0.2, 0.5, 0.8)  # ä½¿ç”¨ä¸åŒçš„åˆå§‹å€¼

for (i in 1:nchains) {
  chains[[i]] <- gibbs_sampler(n, a, b, niter, init_values[i])
}

```

**4.å®šä¹‰Gelman-Rubinè¯Šæ–­å‡½æ•°**

```{r, eval=TRUE}
gelman_rubin <- function(chains, burnin) {
  nchains <- length(chains)
  niter <- length(chains[[1]]$y) - burnin
  
  # æå–ç‡ƒçƒ§æœŸåçš„æ•°æ®
  chain_data <- lapply(chains, function(chain) {
    chain$y[(burnin + 1):length(chain$y)]
  })
  
  # è®¡ç®—é“¾å†…å‡å€¼
  chain_means <- sapply(chain_data, mean)
  
  # è®¡ç®—é“¾é—´æ–¹å·®B
  B <- niter * var(chain_means)
  
  # è®¡ç®—é“¾å†…æ–¹å·®W
  W <- mean(sapply(chain_data, var))
  
  # è®¡ç®—æ–¹å·®ä¼°è®¡å’ŒR_hat
  var_est <- (1 - 1/niter) * W + (1/niter) * B
  R_hat <- sqrt(var_est / W)
  
  # è¿”å›è¯Šæ–­ä¿¡æ¯
  return(list(
    R_hat = R_hat,
    W = W,
    B = B,
    var_est = var_est
  ))
}
```

**5.è®¡ç®—æœ‰æ•ˆæ ·æœ¬å¤§å°å‡½æ•°**

```{r, eval=TRUE}
autocorr_analysis <- function(chain, lags = 0:20) {
  acf_values <- acf(chain$y, lag.max = max(lags), plot = FALSE)
  return(acf_values$acf[lags + 1])
}

effective_size <- function(chain) {
  acf_vals <- autocorr_analysis(chain)
  tau <- 1 + 2 * sum(acf_vals[-1])  # åˆå§‹æ­£åºåˆ—ä¼°è®¡
  n_eff <- length(chain$y) / tau
  return(n_eff)
}
```

**6.è¿›è¡ŒGelman-Rubinè¯Šæ–­**

```{r, eval=TRUE}
diag_results <- gelman_rubin(chains, burnin)
print("Gelman-Rubinè¯Šæ–­ç»“æœï¼š")
print(paste("R_hat =", round(diag_results$R_hat, 4)))
print(paste("é“¾å†…æ–¹å·® (W) =", round(diag_results$W, 4)))
print(paste("é“¾é—´æ–¹å·® (B) =", round(diag_results$B, 4)))
```

**7.è®¡ç®—å„é“¾çš„æœ‰æ•ˆæ ·æœ¬å¤§å°**

```{r, eval=TRUE}
eff_sizes <- sapply(chains, effective_size)
print("å„é“¾çš„æœ‰æ•ˆæ ·æœ¬å¤§å°ä¸ºï¼š")
print(round(eff_sizes))
```

**8.ç»˜åˆ¶è¯Šæ–­å›¾**

```{r, eval=TRUE}
library(ggplot2)
library(gridExtra)

# å‡†å¤‡ç»˜å›¾æ•°æ®
plot_data <- data.frame(
  iteration = rep(1:niter, nchains),
  chain = factor(rep(1:nchains, each = niter)),
  y = unlist(lapply(chains, function(x) x$y))
)

# è·Ÿè¸ªå›¾
p1 <- ggplot(plot_data, aes(x = iteration, y = y, color = chain)) +
  geom_line(alpha = 0.7) +
  geom_vline(xintercept = burnin, linetype = "dashed", color = "red") +
  labs(title = "å‚æ•°yçš„è·Ÿè¸ªå›¾", subtitle = paste("R_hat =", round(diag_results$R_hat, 4)),
       x = "è¿­ä»£æ¬¡æ•°", y = "å‚æ•°å€¼") +
  theme_minimal() + theme(text = element_text(family = "sans"))+
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14) # è°ƒæ•´å­—ä½“æ ·å¼
  )

# æ‰“å°æ˜¾ç¤ºè·Ÿè¸ªå›¾
print(p1)

# å¯†åº¦å›¾
p2 <- ggplot(plot_data[plot_data$iteration > burnin,], aes(x = y, fill = chain)) +
  geom_density(alpha = 0.3) +
  labs(title = "å‚æ•°yçš„åéªŒå¯†åº¦", x = "å‚æ•°å€¼", y = "å¯†åº¦") +
  theme_minimal() + theme(text = element_text(family = "sans"))+
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14) # è°ƒæ•´å­—ä½“æ ·å¼
  )
# æ‰“å°æ˜¾ç¤ºå¯†åº¦å›¾
print(p2)

# è‡ªç›¸å…³å‡½æ•°å›¾
acf_data <- lapply(chains, function(chain) {
  acf_vals <- autocorr_analysis(chain)
  data.frame(lag = 0:20, acf = acf_vals)
})
acf_plot_data <- do.call(rbind, Map(function(d, i) { d$chain <- factor(i); return(d) }, acf_data, 1:length(chains)))

p3 <- ggplot(acf_plot_data, aes(x = lag, y = acf, color = chain)) +
  geom_line() + geom_point() +
  geom_hline(yintercept = 0, linetype = "dashed") +
  labs(title = "è‡ªç›¸å…³å‡½æ•°å›¾", x = "æ»å", y = "è‡ªç›¸å…³") +
  theme_minimal() + theme(text = element_text(family = "sans"))+
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14) # è°ƒæ•´å­—ä½“æ ·å¼
  )
# æ‰“å°æ˜¾ç¤ºè‡ªç›¸å…³å‡½æ•°å›¾
print(p3)

```

**9.æ±‡æ€»ç»Ÿè®¡é‡è®¡ç®—**

```{r, eval=TRUE}
summary_stats <- data.frame(
  Chain = 1:nchains,
  Mean = sapply(chains, function(x) mean(x$y[(burnin + 1):niter])),
  SD = sapply(chains, function(x) sd(x$y[(burnin + 1):niter])),
  Q25 = sapply(chains, function(x) quantile(x$y[(burnin + 1):niter], 0.25)),
  Median = sapply(chains, function(x) median(x$y[(burnin + 1):niter])),
  Q75 = sapply(chains, function(x) quantile(x$y[(burnin + 1):niter], 0.75)),
  ESS = eff_sizes
)
print("\nå„é“¾çš„æ±‡æ€»ç»Ÿè®¡é‡ï¼š")
print(round(summary_stats, 4))

# è®¡ç®—æŒ‡å®šæ»åä¸‹çš„è‡ªç›¸å…³å€¼
compute_acf <- function(chain, lags = c(1, 5, 10)) {
  acf_values <- acf(chain$y, lag.max = max(lags), plot = FALSE)$acf
  return(acf_values[lags + 1])  # lags + 1æ˜¯å› ä¸ºacfä»æ»å0å¼€å§‹
}

# å¯¹æ¯æ¡é“¾è®¡ç®—Lag1, Lag5å’ŒLag10çš„è‡ªç›¸å…³
acf_results <- data.frame(
  Chain = 1:nchains,
  Lag1 = sapply(chains, function(chain) compute_acf(chain, 1)),
  Lag5 = sapply(chains, function(chain) compute_acf(chain, 5)),
  Lag10 = sapply(chains, function(chain) compute_acf(chain, 10))
)

# æ˜¾ç¤ºç»“æœ
print("è‡ªç›¸å…³å€¼ (Lag1, Lag5, Lag10):")
print(round(acf_results, 4))

```

### ç»“æœåˆ†æ

1.**æ”¶æ•›æ€§è¯Šæ–­ï¼š**

   A. Gelman-Rubinè¯Šæ–­($\hat{R}$åˆ†æ)ï¼š

```r
   R_hat = 1.0012
   é“¾å†…æ–¹å·®(W) = 0.0389
   é“¾é—´æ–¹å·®(B) = 0.4079
```

   åˆ†æï¼š

   - \hat{R}å€¼éå¸¸æ¥è¿‘1ï¼Œè¿œå°äº1.2çš„é˜ˆå€¼ï¼Œè¡¨æ˜é“¾å·²ç»å¾ˆå¥½åœ°æ”¶æ•›ã€‚
   - é“¾é—´æ–¹å·®($B$)å’Œé“¾å†…æ–¹å·®($W$)éƒ½æ¯”è¾ƒå°ï¼Œè¯´æ˜ä¸åŒçš„é“¾éƒ½æ”¶æ•›åˆ°äº†ç›¸åŒçš„åˆ†å¸ƒã€‚
   - è¿™ç§æ–¹å·®æ¯”ä¾‹è¡¨æ˜åˆå§‹å€¼çš„å½±å“å·²ç»å¾ˆå¤§ç¨‹åº¦ä¸Šè¢«æ¶ˆé™¤ã€‚

2.**é“¾çš„è¡Œä¸ºåˆ†æï¼š**

   A. è·Ÿè¸ªå›¾(Trace Plot)ç‰¹å¾ï¼š

   - ç¨³å®šæ€§ï¼šæ‰€æœ‰é“¾åœ¨ç‡ƒçƒ§æœŸåéƒ½å‘ˆç°ç¨³å®šçš„éœ‡è¡æ¨¡å¼ã€‚
   - æ··åˆæ€§ï¼šé“¾é—´ç›¸äº’äº¤å‰é¢‘ç¹ï¼Œè¡¨æ˜è‰¯å¥½çš„æ··åˆæ•ˆæœã€‚
   - å¹³ç¨³æ€§ï¼šæ²¡æœ‰æ˜æ˜¾çš„è¶‹åŠ¿æˆ–å‘¨æœŸæ€§å˜åŒ–ã€‚
   - é“¾é—´å…³ç³»ï¼šå¤šæ¡é“¾çš„è½¨è¿¹ç›¸äº’é‡å ï¼Œå æ®ç›¸ä¼¼çš„å€¼åŸŸèŒƒå›´ã€‚

   B. è‡ªç›¸å…³åˆ†æï¼š

```r
            Lag1    Lag5    Lag10
   chain1	0.6421	0.0765	0.0382	
   chain2	0.6530	0.1122	0.0253	
   chain3	0.6743	0.1765	0.0376	
```

   è§£è¯»ï¼š

   - è‡ªç›¸å…³éšlagå¢åŠ è€Œè¿…é€Ÿè¡°å‡ï¼Œè¡¨æ˜é‡‡æ ·æ•ˆç‡è¾ƒé«˜ã€‚
   - Lag10ä»¥åçš„è‡ªç›¸å…³æ¥è¿‘0ï¼Œè¯´æ˜æ ·æœ¬é—´éš”10æ­¥ååŸºæœ¬ç‹¬ç«‹ã€‚
   - å»ºè®®ï¼šå¦‚æœéœ€è¦ç‹¬ç«‹æ ·æœ¬ï¼Œå¯ä»¥æ¯10æ­¥å–ä¸€ä¸ªæ ·æœ¬ã€‚

3.**åˆ†å¸ƒç‰¹å¾åˆ†æ**

   åéªŒåˆ†å¸ƒç‰¹å¾ï¼ˆå»é™¤ç‡ƒçƒ§æœŸåï¼‰ï¼š

```r
   é“¾1ç»Ÿè®¡é‡ï¼š
   - å‡å€¼: 0.4121
   - æ ‡å‡†å·®: 0.1967
   - ä¸­ä½æ•°: 0.3991
   - 25%åˆ†ä½æ•°: 0.2594
   - 75%åˆ†ä½æ•°: 0.5531
   - æœ‰æ•ˆæ ·æœ¬å¤§å°: 1141
   
   é“¾2ç»Ÿè®¡é‡ï¼š
   - å‡å€¼: 0.4015
   - æ ‡å‡†å·®: 0.1939
   - ä¸­ä½æ•°: 0.3952
   - 25%åˆ†ä½æ•°: 0.2470
   - 75%åˆ†ä½æ•°: 0.5404
   - æœ‰æ•ˆæ ·æœ¬å¤§å°: 1019
   
   é“¾3ç»Ÿè®¡é‡ï¼š
   - å‡å€¼: 0.3920
   - æ ‡å‡†å·®: 0.2008
   - ä¸­ä½æ•°: 0.3727
   - 25%åˆ†ä½æ•°: 0.2338
   - 75%åˆ†ä½æ•°: 0.5368
   - æœ‰æ•ˆæ ·æœ¬å¤§å°: 839
```

   æ·±å…¥åˆ†æï¼š

   - ä¸‰æ¡é“¾çš„å‡å€¼éå¸¸æ¥è¿‘ï¼Œæœ€å¤§å·®å¼‚ä¸º0.0201ï¼Œå·®å¼‚éå¸¸å°ã€‚
   - æ ‡å‡†å·®ä¹Ÿå¾ˆæ¥è¿‘ï¼Œè¡¨æ˜æ³¢åŠ¨ç¨‹åº¦ä¸€è‡´ã€‚
   - åˆ†ä½æ•°ç›¸è¿‘ï¼Œè¯´æ˜åˆ†å¸ƒå½¢çŠ¶ç›¸ä¼¼ã€‚

4.**å®è·µå»ºè®®**

   åŸºäºä»¥ä¸Šåˆ†æï¼Œæœ‰å¦‚ä¸‹å»ºè®®ï¼š

   1. é‡‡æ ·è®¾ç½®ï¼š
      - ä¿æŒå½“å‰çš„é“¾æ•°(3æ¡)ã€‚
      - å¯ä»¥å°†é¢„çƒ­æœŸå‡å°‘åˆ°800æ¬¡è¿­ä»£ã€‚
      - æ€»è¿­ä»£æ¬¡æ•°å¯ä»¥ä¿æŒåœ¨5000æ¬¡ã€‚

   2. æ ·æœ¬ä½¿ç”¨ï¼š
      - å¦‚æœéœ€è¦ç‹¬ç«‹æ ·æœ¬ï¼Œå»ºè®®æ¯10æ­¥å–ä¸€ä¸ªæ ·æœ¬ã€‚
      - å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨å»é™¤é¢„çƒ­æœŸåçš„æ‰€æœ‰æ ·æœ¬è¿›è¡ŒåéªŒæ¨æ–­ã€‚
      - ä¸‰æ¡é“¾çš„ç»“æœå¯ä»¥åˆå¹¶ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ”¶æ•›åˆ°ç›¸åŒåˆ†å¸ƒã€‚

   3. è¯Šæ–­æ–¹å¼ï¼š
      - ç»§ç»­ä½¿ç”¨å¤šé“¾ç­–ç•¥ã€‚
      - åŒæ—¶ç›‘æ§R_hatå’ŒESSã€‚
      - å®šæœŸæ£€æŸ¥è‡ªç›¸å…³å›¾æ¥è¯„ä¼°é‡‡æ ·æ•ˆç‡ã€‚

5.**æ½œåœ¨æ”¹è¿›ç©ºé—´**

   A. æ•ˆç‡æå‡ï¼š

   - å¯ä»¥å°è¯•å‚æ•°å˜æ¢æ¥å‡å°‘è‡ªç›¸å…³ã€‚
   - è€ƒè™‘ä½¿ç”¨è‡ªé€‚åº”æ­¥é•¿çš„é‡‡æ ·æ–¹æ³•ã€‚
   - ç ”ç©¶æœ€ä¼˜çš„é¢„çƒ­æœŸé•¿åº¦ã€‚

   B. è¯Šæ–­è¡¥å……ï¼š

   - å¯ä»¥æ·»åŠ Gewekeè¯Šæ–­ã€‚
   - è€ƒè™‘è®¡ç®—è’™ç‰¹å¡æ´›æ ‡å‡†è¯¯å·®ã€‚
   - å¢åŠ äº¤å‰éªŒè¯æ£€éªŒã€‚

------------------------------------------------------------------------


## é—®é¢˜2

### é¢˜ç›®æè¿°

è¯æ˜è¿ç»­æƒ…å½¢ä¸‹Metropolis-Hastingsé‡‡æ ·ç®—æ³•çš„å¹³ç¨³æ€§ã€‚

* ç®—æ³•(è¿ç»­æƒ…å½¢) 
  
  * ç›®æ ‡æ¦‚ç‡å¯†åº¦å‡½æ•°:$f(x)$ã€‚  
  * å°†$i$å’Œ$j$æ›¿æ¢ä¸º$s$å’Œ$r$ã€‚
  * å»ºè®®åˆ†å¸ƒ(æ¦‚ç‡å¯†åº¦å‡½æ•°):$g(r|s)$ã€‚
  * æ¥å—æ¦‚ç‡:$\alpha(s,r)=\min \left\{ \frac{f(r)g(s|r)}{f(s)g(r|s)},1 \right\}$ã€‚
  * è½¬ç§»æ ¸(æ··åˆåˆ†å¸ƒ):$K(r,s)=I(s\neq r)\alpha(r,s)g(s|r)+I(s=r) \left[1-\int\alpha(r,s)g(s|r) \right]$ã€‚
  * è¦è¯æ˜çš„å¹³ç¨³æ€§:$K(s,r)f(s)=K(r,s)f(r)$ã€‚

### è§£ç­”æ€è·¯

ä¸ºäº†è¯æ˜Metropolis-Hastingsé‡‡æ ·ç®—æ³•çš„å¹³ç¨³æ€§,éœ€è¦éªŒè¯è¯¦ç»†å¹³è¡¡æ–¹ç¨‹$K(s,r)f(s)=K(r,s)f(r)$å¯¹ä»»æ„çŠ¶æ€$s$å’Œ$r$éƒ½æˆç«‹ã€‚

é¦–å…ˆ,å°†è½¬ç§»æ ¸$K(r,s)$çš„è¡¨è¾¾å¼ä»£å…¥è¯¦ç»†å¹³è¡¡æ–¹ç¨‹:

$$K(s,r)f(s)=\left[I(s\neq r)\alpha(s,r)g(r|s)+I(s=r)\left(1-\int\alpha(s,r)g(r|s)dr\right)\right]f(s)$$

æ¥ä¸‹æ¥,åˆ†$s\neq r$å’Œ$s=r$ä¸¤ç§æƒ…å†µè¿›è¡Œè®¨è®ºã€‚

- å½“$s\neq r$æ—¶:
$$
\begin{aligned}
K(s,r)f(s)&=I(s\neq r)\alpha(s,r)g(r|s)f(s)\\
&=\min\left\{\frac{f(r)g(s|r)}{f(s)g(r|s)},1\right\}g(r|s)f(s)\\
&=\min\{f(r)g(s|r),f(s)g(r|s)\}
\end{aligned}
$$
æœ€åä¸€æ­¥æ˜¯å› ä¸º$\min\{a,b\}c=\min\{ac,bc\}$ã€‚
ç°åœ¨æ¥çœ‹$K(r,s)f(r)$:
$$
\begin{aligned}
K(r,s)f(r)&=I(r\neq s)\alpha(r,s)g(s|r)f(r)\\
&=\min\left\{\frac{f(s)g(r|s)}{f(r)g(s|r)},1\right\}g(s|r)f(r)\\
&=\min\{f(s)g(r|s),f(r)g(s|r)\}
\end{aligned}
$$
ç”±äº$\min$è¿ç®—æ»¡è¶³äº¤æ¢å¾‹,å³$\min\{a,b\}=\min\{b,a\}$,å› æ­¤:
$$
\min\{f(r)g(s|r),f(s)g(r|s)\}=\min\{f(s)g(r|s),f(r)g(s|r)\}
$$
ç»¼ä¸Šæ‰€è¿°,å½“$s\neq r$æ—¶,$K(s,r)f(s)=K(r,s)f(r)$æˆç«‹ã€‚

- å½“$s=r$æ—¶:
$$
\begin{aligned}
K(s,s)f(s)&=\left[1-\int\alpha(s,r)g(r|s)dr\right]f(s)\\
&=f(s)-f(s)\int\alpha(s,r)g(r|s)dr\\
&=f(s)-\int\min\{f(r)g(s|r),f(s)g(r|s)\}dr
\end{aligned}
$$
æœ€åä¸€æ­¥æ˜¯å°†$\alpha(s,r)$ç”¨å…¶å®šä¹‰æ›¿æ¢,å¹¶åˆ©ç”¨äº†$\min\{a,b\}c=\min\{ac,bc\}$ã€‚
ç°åœ¨çœ‹$K(r,r)f(r)$:
$$
\begin{aligned}
K(r,r)f(r)&=\left[1-\int\alpha(r,s)g(s|r)ds\right]f(r)\\
&=f(r)-f(r)\int\alpha(r,s)g(s|r)ds\\
&=f(r)-\int\min\{f(s)g(r|s),f(r)g(s|r)\}ds
\end{aligned}
$$
ç”±äºç§¯åˆ†è¿ç®—æ»¡è¶³å¯¹ç§°æ€§,å³$\int f(x)dx=\int f(y)dy$,å› æ­¤:
$$
\int\min\{f(r)g(s|r),f(s)g(r|s)\}dr=\int\min\{f(s)g(r|s),f(r)g(s|r)\}ds
$$
ç»¼ä¸Šæ‰€è¿°,å½“$s=r$æ—¶,$K(s,s)f(s)=K(r,r)f(r)$ä¹Ÿæˆç«‹ã€‚

è‡³æ­¤,è¯æ˜äº†å¯¹ä»»æ„çŠ¶æ€$s$å’Œ$r$,è¯¦ç»†å¹³è¡¡æ–¹ç¨‹$K(s,r)f(s)=K(r,s)f(r)$éƒ½æˆç«‹ã€‚è¿™æ„å‘³ç€$f(x)$æ˜¯Metropolis-Hastingsé‡‡æ ·ç®—æ³•çš„å¹³ç¨³åˆ†å¸ƒ,ä¹Ÿå°±æ˜¯è¯´,å¦‚æœåˆå§‹çŠ¶æ€æœä»$f(x)$,é‚£ä¹ˆæ‰€æœ‰åç»­çŠ¶æ€ä¹Ÿæœä»$f(x)$ã€‚å³ä½¿åˆå§‹çŠ¶æ€ä¸æœä»$f(x)$,ç»è¿‡è¶³å¤Ÿæ¬¡æ•°çš„è¿­ä»£å,çŠ¶æ€åˆ†å¸ƒä¹Ÿä¼šæ”¶æ•›åˆ°$f(x)$ã€‚è¿™å°±æ˜¯Metropolis-Hastingsç®—æ³•çš„ç¥å¥‡ä¹‹å¤„ã€‚

ä¸ºäº†ç›´è§‚å±•ç¤ºMetropolis-Hastingsé‡‡æ ·çš„æ•ˆæœ,ä¸‹é¢å°†ç”¨Rè¯­è¨€å®ç°è¯¥ç®—æ³•,å¹¶ç»˜åˆ¶å›¾è¡¨è¿›è¡Œåˆ†æã€‚

### ä»£ç å®ç°

å°†ä»£ç åˆ†æˆå‡ ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½æœ‰è¯¦ç»†çš„æ³¨é‡Šï¼Œæ–¹ä¾¿é˜…è¯»å’Œç†è§£ã€‚

**ç¬¬ä¸€éƒ¨åˆ†ï¼šå®šä¹‰ç›®æ ‡åˆ†å¸ƒå’Œæè®®åˆ†å¸ƒçš„å¯†åº¦å‡½æ•°**

```{r, eval=TRUE}
# è®¾ç½®éšæœºæ•°ç§å­,ä¾¿äºå¤ç°ç»“æœ
set.seed(105)   

# ç›®æ ‡åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°f(x)
# æ­¤å¤„ç›®æ ‡åˆ†å¸ƒä¸ºåŒå³°åˆ†å¸ƒï¼Œç”±ä¸¤ä¸ªæ­£æ€åˆ†å¸ƒçš„åŠ æƒå’Œæ„æˆ
f <- function(x) {
  0.3 * dnorm(x, mean = -2, sd = 1) + 0.7 * dnorm(x, mean = 2, sd = 2)
}

# æè®®åˆ†å¸ƒg(r|s)ï¼Œé€‰æ‹©æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼Œå‡å€¼ä¸ºå½“å‰çŠ¶æ€s
# ç”¨äºä»å½“å‰çŠ¶æ€è½¬ç§»åˆ°å€™é€‰çŠ¶æ€
g <- function(r, s) {
  dnorm(r, mean = s)  
}
```

**ç¬¬äºŒéƒ¨åˆ†ï¼šå®šä¹‰æ¥å—æ¦‚ç‡å‡½æ•°**

```{r, eval=TRUE}
# æ¥å—æ¦‚ç‡å‡½æ•° alpha(r, s)
# è®¡ç®—åœ¨ä»å½“å‰çŠ¶æ€sè½¬ç§»åˆ°å€™é€‰çŠ¶æ€ræ—¶çš„æ¥å—æ¦‚ç‡
alpha <- function(r, s) {
  min(f(r) * g(s, r) / (f(s) * g(r, s)), 1) 
}
```

**ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®šä¹‰Metropolis-Hastingsé‡‡æ ·å‡½æ•°**

```{r, eval=TRUE}
# Metropolis-Hastingsé‡‡æ ·å‡½æ•°
# å‚æ•° iter_numï¼šé‡‡æ ·è¿­ä»£æ¬¡æ•°
MH_sampler <- function(iter_num) {
  # éšæœºé€‰å–åˆå§‹çŠ¶æ€
  state <- rnorm(1) 
  
  # åˆå§‹åŒ–ä¸€ä¸ªå‘é‡ï¼Œç”¨äºå‚¨å­˜é‡‡æ ·ç»“æœ
  samples <- numeric(iter_num) 
  
  # å¼€å§‹é‡‡æ ·è¿­ä»£
  for (i in 1:iter_num) {
    # ä»æè®®åˆ†å¸ƒä¸­æŠ½å–å€™é€‰çŠ¶æ€
    candidate <- rnorm(1, mean = state)
    
    # è®¡ç®—ä»å½“å‰çŠ¶æ€åˆ°å€™é€‰çŠ¶æ€çš„æ¥å—æ¦‚ç‡
    accept_prob <- alpha(candidate, state)
    
    # æ ¹æ®æ¥å—æ¦‚ç‡å†³å®šæ˜¯å¦æ¥å—å€™é€‰çŠ¶æ€
    # è‹¥æ¥å—åˆ™å°†å½“å‰çŠ¶æ€æ›´æ–°ä¸ºå€™é€‰çŠ¶æ€ï¼›å¦åˆ™ä¿æŒåŸçŠ¶æ€
    if (runif(1) < accept_prob) {
      state <- candidate  
    }
    
    # è®°å½•å½“å‰çŠ¶æ€ï¼ˆæ— è®ºæ˜¯å¦æ¥å—å€™é€‰çŠ¶æ€ï¼‰
    samples[i] <- state 
  }
  
  # è¿”å›é‡‡æ ·ç»“æœ
  samples 
}
```

**ç¬¬å››éƒ¨åˆ†ï¼šä»ç›®æ ‡åˆ†å¸ƒä¸­ç›´æ¥æŠ½æ ·ï¼Œä½œä¸ºå¯¹æ¯”æ ·æœ¬**

```{r, eval=TRUE}
# ä»ç›®æ ‡åˆ†å¸ƒä¸­æŠ½å–10000ä¸ªæ ·æœ¬ï¼Œç”¨äºå¯¹æ¯”Metropolis-Hastingsé‡‡æ ·ç»“æœ
samples_target <- numeric(10000)

for (i in 1:10000) {
  # ç”Ÿæˆä¸€ä¸ª[0,1]çš„éšæœºæ•°tempï¼Œç”¨äºå†³å®šä»å“ªä¸ªæ­£æ€åˆ†å¸ƒé‡‡æ ·
  temp <- runif(1)
  
  # è‹¥temp < 0.3ï¼Œåˆ™ä»N(-2, 1)é‡‡æ ·ï¼›å¦åˆ™ä»N(2, 2)é‡‡æ ·
  if (temp < 0.3) {
    samples_target[i] <- rnorm(1, -2, 1) 
  } else {
    samples_target[i] <- rnorm(1, 2, 2)
  }
}
```

**ç¬¬äº”éƒ¨åˆ†ï¼šä½¿ç”¨Metropolis-Hastingsç®—æ³•è¿›è¡Œé‡‡æ ·**

```{r, eval=TRUE}
# ä½¿ç”¨Metropolis-Hastingsç®—æ³•æŠ½å–10000ä¸ªæ ·æœ¬
samples_MH <- MH_sampler(10000) 
```

**ç¬¬å…­éƒ¨åˆ†ï¼šç»˜åˆ¶ç›®æ ‡åˆ†å¸ƒå’ŒMetropolis-Hastingsé‡‡æ ·åˆ†å¸ƒçš„å¯†åº¦å‡½æ•°å¯¹æ¯”å›¾**

```{r, eval=TRUE}
# åŠ è½½ç»˜å›¾æ‰€éœ€çš„åº“
library(ggplot2)

# å°†ç›®æ ‡åˆ†å¸ƒå’ŒMetropolis-Hastingsé‡‡æ ·åˆ†å¸ƒçš„æ•°æ®æ•´åˆä¸ºä¸€ä¸ªæ•°æ®æ¡†
df <- data.frame(
  x = c(samples_target, samples_MH),
  group = rep(c("Target", "MH"), each = 10000)
) 

# ç»˜åˆ¶å¯†åº¦å‡½æ•°å›¾ï¼Œæ˜¾ç¤ºç›®æ ‡åˆ†å¸ƒå’Œé‡‡æ ·åˆ†å¸ƒçš„é‡åˆæƒ…å†µ
ggplot(df, aes(x, fill = group)) +
  geom_density(alpha = 0.4) +  # è®¾ç½®é€æ˜åº¦
  theme_minimal() +  # ä½¿ç”¨ç®€æ´ä¸»é¢˜
  labs(title = "ç›®æ ‡åˆ†å¸ƒ vs Metropolis-Hastingsé‡‡æ ·åˆ†å¸ƒ")  # æ·»åŠ æ ‡é¢˜
```

### ç»“æœåˆ†æ

æ ¹æ®å¯†åº¦å‡½æ•°å¯¹æ¯”å›¾ï¼Œå¯ä»¥å¾—å‡ºï¼š

1.**é‡‡æ ·åˆ†å¸ƒä¸ç›®æ ‡åˆ†å¸ƒçš„ç›¸ä¼¼æ€§**ï¼šä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒMetropolis-Hastings (MH) é‡‡æ ·åˆ†å¸ƒï¼ˆç²‰è‰²åŒºåŸŸï¼‰ä¸ç›®æ ‡åˆ†å¸ƒï¼ˆç»¿è‰²åŒºåŸŸï¼‰å¤§è‡´é‡åˆã€‚è¿™è¡¨æ˜ Metropolis-Hastings é‡‡æ ·ç®—æ³•æˆåŠŸæ¨¡æ‹Ÿäº†ç›®æ ‡åˆ†å¸ƒçš„å½¢çŠ¶å’Œç‰¹ç‚¹ï¼Œå³åŒå³°ç»“æ„çš„åˆ†å¸ƒå½¢å¼ã€‚

2.**å¹³ç¨³æ€§éªŒè¯**ï¼šMetropolis-Hastings é‡‡æ ·çš„å¹³ç¨³æ€§å¾—åˆ°äº†éªŒè¯ï¼Œå› ä¸ºé‡‡æ ·åˆ†å¸ƒä¸ç›®æ ‡åˆ†å¸ƒåŸºæœ¬ä¸€è‡´ã€‚è¿™ç¬¦åˆå¹³ç¨³åˆ†å¸ƒæ¡ä»¶ï¼Œå³åœ¨å……åˆ†é•¿çš„é‡‡æ ·åºåˆ—åï¼Œé‡‡æ ·åˆ†å¸ƒè¶‹è¿‘äºç›®æ ‡åˆ†å¸ƒã€‚

3.**åå·®ä¸è¯¯å·®**ï¼šè™½ç„¶å¤§éƒ¨åˆ†åŒºåŸŸçš„é‡‡æ ·åˆ†å¸ƒå’Œç›®æ ‡åˆ†å¸ƒéå¸¸æ¥è¿‘ï¼Œä½†åœ¨ä¸ªåˆ«å³°å€¼é™„è¿‘å­˜åœ¨ç»†å¾®çš„å·®å¼‚ã€‚è¿™å¯èƒ½æ˜¯ç”±äºé‡‡æ ·çš„æœ‰é™æ•°é‡å¯¼è‡´çš„éšæœºè¯¯å·®ã€‚å¯ä»¥é€šè¿‡å¢åŠ é‡‡æ ·æ¬¡æ•°è¿›ä¸€æ­¥å‡å°è¿™ç§è¯¯å·®ã€‚

4.**åŒå³°ç»“æ„çš„æ•æ‰**ï¼šMH é‡‡æ ·æˆåŠŸæ•æ‰åˆ°ç›®æ ‡åˆ†å¸ƒçš„åŒå³°ç‰¹æ€§ï¼Œè¿™è¡¨æ˜è¯¥é‡‡æ ·æ–¹æ³•åœ¨å¤„ç†å¤šæ¨¡æ€åˆ†å¸ƒæ—¶çš„æœ‰æ•ˆæ€§ã€‚

æ€»ä½“ä¸Šæ¥çœ‹ï¼ŒMetropolis-Hastingsé‡‡æ ·å¾—åˆ°çš„æ ·æœ¬åˆ†å¸ƒä¸ç›®æ ‡åˆ†å¸ƒéå¸¸æ¥è¿‘,è¿™ç›´è§‚åœ°éªŒè¯äº†è¯¥ç®—æ³•çš„æœ‰æ•ˆæ€§ã€‚å°½ç®¡Metropolis-Hastingsé‡‡æ ·ç®—æ³•åªåˆ©ç”¨äº†å»ºè®®åˆ†å¸ƒ$g(r|s)$å’Œç›®æ ‡åˆ†å¸ƒ$f(x)$çš„æ¦‚ç‡å¯†åº¦å‡½æ•°å€¼,è€Œä¸éœ€è¦çŸ¥é“$f(x)$çš„å…·ä½“å½¢å¼,ä½†å®ƒä»èƒ½å¾ˆå¥½åœ°é€¼è¿‘ç›®æ ‡åˆ†å¸ƒã€‚è¿™ä½“ç°å‡ºMetropolis-Hastingsç®—æ³•åœ¨MCMCé‡‡æ ·ä¸­çš„é‡è¦åœ°ä½ã€‚

------------------------------------------------------------------------

# æ€»ç»“

## å›°éš¾ä¸è§£å†³æ–¹å¼

åœ¨è¿™æ¬¡å®éªŒä¸­ï¼Œæˆ‘é‡åˆ°çš„æœ€å¤§å›°éš¾åœ¨äºå¦‚ä½•ç¡®ä¿ Metropolis-Hastings å’Œ Gibbs é‡‡æ ·çš„æ­£ç¡®å®ç°å’Œæ”¶æ•›æ€§ã€‚è¿™äº›ç®—æ³•çš„ç†è®ºæœ¬èº«å¹¶ä¸å¤æ‚ï¼Œä½†åœ¨å®é™…æ“ä½œæ—¶ï¼Œå¦‚ä½•è°ƒèŠ‚é‡‡æ ·å‚æ•°ã€ä¿è¯ç®—æ³•æ”¶æ•›ã€å¹³è¡¡ä»£ç æ•ˆç‡ä¸å‡†ç¡®æ€§ç­‰ï¼Œéƒ½éœ€è¦ä»”ç»†æƒè¡¡å’Œåå¤éªŒè¯ã€‚

é¦–å…ˆï¼Œ**Metropolis-Hastings é‡‡æ ·ä¸­çš„æ¥å—æ¦‚ç‡**è®©æˆ‘èŠ±è´¹äº†å¤§é‡æ—¶é—´æ¥ç†è§£ã€‚Metropolis-Hastings é‡‡æ ·çš„æ ¸å¿ƒåœ¨äºè®¡ç®—æ¥å—æ¦‚ç‡ \(\alpha(s, r)\) å¹¶ä½¿ç”¨éšæœºæ•°æ¥åˆ¤æ–­æ˜¯å¦æ¥å—å€™é€‰æ ·æœ¬ã€‚æˆ‘ä¸€å¼€å§‹å¹¶æ²¡æœ‰å®Œå…¨ç†è§£æ¥å—æ¦‚ç‡èƒŒåçš„å¹³è¡¡æ¡ä»¶ï¼Œå› æ­¤åœ¨å®ç°æ—¶ï¼Œç»å¸¸å‡ºç°æ¥å—ç‡è¿‡ä½æˆ–é“¾æ¡æ— æ³•ç§»åŠ¨çš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æŸ¥é˜…äº†å¤šç¯‡æ–‡çŒ®ï¼Œè¯•å›¾ä»ç†è®ºæ¨å¯¼å’Œç¤ºä¾‹ä»£ç ä¸­è·å¾—çµæ„Ÿï¼Œæœ€ç»ˆæ‰æ‰¾åˆ°åˆé€‚çš„æè®®åˆ†å¸ƒå‚æ•°ï¼Œä½¿å¾—é‡‡æ ·é“¾èƒ½å¤Ÿé«˜æ•ˆåœ°æ¢ç´¢çŠ¶æ€ç©ºé—´ã€‚è¿™ä¸ªè¿‡ç¨‹è®©æˆ‘æ·±åˆ»ç†è§£äº†æ¥å—æ¦‚ç‡åœ¨ Metropolis-Hastings ç®—æ³•ä¸­çš„é‡è¦æ€§ã€‚

å…¶æ¬¡ï¼Œ**Gibbs é‡‡æ ·çš„å®ç°ä¹Ÿè®©æˆ‘é¢‡ä¸ºå¤´ç—›**ã€‚Gibbs é‡‡æ ·é€šè¿‡åœ¨æ¯æ¬¡è¿­ä»£ä¸­äº¤æ›¿é‡‡æ ·æ¡ä»¶åˆ†å¸ƒæ¥é€æ¸é€¼è¿‘ç›®æ ‡åˆ†å¸ƒã€‚ç„¶è€Œï¼Œå¦‚ä½•ä¿è¯åˆå§‹å€¼çš„åˆç†æ€§ã€åœ¨ä¸åŒé“¾ä¹‹é—´è·å¾—å¹³è¡¡æ€§ã€ä»¥åŠé¿å…åœ¨é“¾æ¡åˆå§‹åŒ–é˜¶æ®µé™·å…¥å±€éƒ¨æå€¼ï¼Œè¿™äº›é—®é¢˜åœ¨å®é™…æ“ä½œä¸­æ¯”ç†è®ºä¸Šæ›´åŠ æ£˜æ‰‹ã€‚æˆ‘å°è¯•äº†å¤šç§ä¸åŒçš„åˆå§‹å€¼è®¾å®šï¼Œè¿˜ç‰¹æ„å¼•å…¥äº†ä¸åŒçš„é“¾æ¥æ£€éªŒæ”¶æ•›æ•ˆæœï¼Œä½†åœ¨ä¸€å¼€å§‹ï¼Œé“¾æ¡çš„è¡¨ç°ä¸å¦‚é¢„æœŸï¼Œå¯¼è‡´æ”¶æ•›æ€§è¾ƒå·®ã€‚åå¤å®éªŒä¹‹åï¼Œæˆ‘ç»ˆäºå‘ç°ï¼Œé‡‡æ ·å‚æ•°éœ€è¦é’ˆå¯¹æ¡ä»¶åˆ†å¸ƒçš„ç‰¹æ€§æ¥è°ƒæ•´ï¼Œè¿‡äºåˆ†æ•£æˆ–é›†ä¸­éƒ½ä¼šå½±å“æ”¶æ•›æ€§ã€‚

æœ€åï¼Œ**Gelman-Rubin æ”¶æ•›è¯Šæ–­è®©æˆ‘é¢‡ä¸ºå›°æƒ‘**ã€‚è™½ç„¶ Gelman-Rubin æŒ‡æ ‡ç”¨äºåˆ¤æ–­æ”¶æ•›æ€§ï¼Œä½†å¦‚ä½•åœ¨ä»£ç ä¸­å®ç°è¿™ä¸€è¯Šæ–­è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯å¯¹é“¾å†…æ–¹å·® \(W\) å’Œé“¾é—´æ–¹å·® \(B\) çš„è®¡ç®—ï¼Œæ˜¯ä¸€ä¸ªè€—è´¹ç²¾åŠ›çš„éƒ¨åˆ†ã€‚åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¸æ–­é‡åˆ°é“¾é—´æ–¹å·®è¿‡å¤§ã€R_hat ç»Ÿè®¡é‡ä¸ç¨³å®šçš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™äº›ï¼Œæˆ‘æ·±å…¥ç ”ç©¶äº† Gelman-Rubin çš„è®¡ç®—åŸç†ï¼Œæœ€ç»ˆæ˜ç™½äº†ä¸åŒé“¾çš„åˆå§‹åŒ–åœ¨è¯Šæ–­ä¸­çš„é‡è¦æ€§ã€‚é€šè¿‡é€æ­¥è°ƒæ•´é“¾çš„åˆå§‹æ¡ä»¶å’Œå‚æ•°ï¼Œæˆ‘ç»ˆäºè·å¾—äº†ç¨³å®šçš„ R_hat å€¼ï¼Œè¿™æ ‡å¿—ç€ç®—æ³•çš„æˆåŠŸæ”¶æ•›ã€‚

è¿™æ¬¡å®éªŒè®©æˆ‘æ˜ç™½ï¼Œç®—æ³•å®ç°è¿œéç®€å•çš„ä»£ç ç¼–å†™ï¼Œå®ƒåŒ…å«äº†è®¸å¤šç»†è‡´çš„å‚æ•°è°ƒæ•´å’Œç†è®ºç†è§£çš„è½¬åŒ–ã€‚åªæœ‰åœ¨é‡åˆ°å…·ä½“å›°éš¾æ—¶ï¼Œæ‰èƒ½çœŸæ­£æ·±å…¥ç†è§£è¿™äº›ç®—æ³•çš„å®è´¨ã€‚

## æ€è€ƒä¸æ„Ÿæ‚Ÿ

é€šè¿‡æœ¬æ¬¡å®éªŒï¼Œæˆ‘æ·±åˆ»ä½“ä¼šåˆ°æ•°å­¦æ¨¡å‹å’Œç¼–ç¨‹å®ç°ä¹‹é—´çš„å¾®å¦™å¹³è¡¡ã€‚åœ¨å­¦ä¹ å’Œåº”ç”¨ Metropolis-Hastings å’Œ Gibbs é‡‡æ ·æ—¶ï¼Œæˆ‘æ„è¯†åˆ°è¿™äº›ç®—æ³•èƒŒåçš„æ•°å­¦æ¨å¯¼ä¸å®é™…ç¼–ç¨‹æ“ä½œæ˜¯ä¸å¯åˆ†å‰²çš„ã€‚ä»…ä»…æŒæ¡ç†è®ºçŸ¥è¯†å¹¶ä¸è¶³ä»¥çœŸæ­£ç†è§£ç®—æ³•çš„ç²¾é«“ï¼Œåªæœ‰åœ¨å®é™…ç¼–ç¨‹ä¸­é‡åˆ°å›°éš¾ï¼Œé€æ­¥è°ƒè¯•ã€ä¿®æ­£ï¼Œæ‰èƒ½ä»æ›´æ·±å±‚æ¬¡ä¸Šç†è§£ç®—æ³•çš„æœ¬è´¨ã€‚

å¦å¤–ï¼Œè¿™æ¬¡å®éªŒè®©æˆ‘æ„Ÿå—åˆ°ç®—æ³•çš„å¼ºå¤§å’Œç¥å¥‡ã€‚Metropolis-Hastings é‡‡æ ·å’Œ Gibbs é‡‡æ ·æ˜¯ MCMC æ–¹æ³•çš„æ ¸å¿ƒï¼Œèƒ½å¤Ÿåœ¨å¤æ‚çš„æ¦‚ç‡åˆ†å¸ƒä¸­å®ç°é«˜æ•ˆé‡‡æ ·ã€‚å°¤å…¶æ˜¯åœ¨é¢å¯¹åŒå³°æˆ–å¤šæ¨¡æ€åˆ†å¸ƒæ—¶ï¼ŒMetropolis-Hastings é‡‡æ ·å±•ç¤ºäº†å…¶è‰¯å¥½çš„æ”¶æ•›æ€§å’Œç¨³å®šæ€§ã€‚è¿™è®©æˆ‘æ·±åˆ»è®¤è¯†åˆ°æ•°å­¦å’Œç®—æ³•åœ¨è§£å†³å®é™…é—®é¢˜ä¸­çš„é‡è¦æ€§ã€‚

æœ€åï¼Œé€šè¿‡è¿™æ¬¡å®éªŒï¼Œæˆ‘æ›´åŠ æ„è¯†åˆ°ç»†èŠ‚å’Œè§„èŒƒçš„é‡è¦æ€§ã€‚æ— è®ºæ˜¯ä»£ç ç»“æ„ã€æ³¨é‡Šçš„å®Œæ•´æ€§ï¼Œè¿˜æ˜¯å˜é‡çš„å‘½åã€å†…å­˜çš„æ¸…ç†ï¼Œéƒ½ä¼šå½±å“åˆ°ç¨‹åºçš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ä¸¥æ ¼éµå¾ªç¼–ç è§„èŒƒï¼Œä½¿å¾—å®éªŒæŠ¥å‘Šæ›´åŠ æ¸…æ™°ã€ç›´è§‚ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘åœ¨ç¼–ç¨‹å®è·µä¸­ç§¯ç´¯çš„ä¸€å¤§å®è´µç»éªŒã€‚å¸Œæœ›ä»Šåèƒ½å¤Ÿç»§ç»­åœ¨ç§‘ç ”ä¸­åº”ç”¨è¿™äº›çŸ¥è¯†ï¼Œä¸æ–­æé«˜è‡ªå·±çš„ç ”ç©¶èƒ½åŠ›å’Œç¼–ç¨‹æ°´å¹³ã€‚


------------------------------------------------------------------------

# ç»Ÿè®¡è®¡ç®—ç¬¬8æ¬¡ä½œä¸š { .center-title }

ä»¥ä¸‹æ˜¯ç»Ÿè®¡è®¡ç®—2024-11-04è¯¾ç¨‹å¯¹åº”çš„ä½œä¸š

# Question

## Question 1

Exercies 11.3 and 11.5 (pages 353-354, Statistical Computing with R).  

-   **Exercise 11.3**  
**(a)** Write a function to compute the $k^{\text{th}}$ term in
$$
\sum_{k=0}^{\infty} \frac{(-1)^k}{k! \, 2^k} \frac{\|a\|^{2k+2}}{(2k+1)(2k+2)} \frac{\Gamma\left(\frac{d+1}{2}\right) \Gamma\left(k + \frac{3}{2}\right)}{\Gamma\left(k + \frac{d}{2} + 1\right)},
$$
where $d \geq 1$ is an integer, $a$ is a vector in $\mathbb{R}^d$, and $\|\cdot\|$ denotes the Euclidean norm. Perform the arithmetic so that the coefficients can be computed for (almost) arbitrarily large $k$ and $d$. (This sum converges for all $a \in \mathbb{R}^d.$)  
**(b)** Modify the function so that it computes and returns the sum.  
**(c)** Evaluate the sum when $a = (1, 2)^T$.

-   **Exercise 11.5**  
Write a function to solve the equation
$$
\frac{2 \Gamma\left(\frac{k}{2}\right)}{\sqrt{\pi (k - 1)} \Gamma\left(\frac{k-1}{2}\right)} \int_0^{c_k-1} \left( 1 + \frac{u^2}{k - 1} \right)^{-k/2} du = \frac{2 \Gamma\left(\frac{k+1}{2}\right)}{\sqrt{\pi k} \Gamma\left(\frac{k}{2}\right)} \int_0^{c_k} \left( 1 + \frac{u^2}{k} \right)^{-(k+1)/2} du
$$
for $a$, where
$$
c_k = \sqrt{\frac{a^2 k}{k + 1 - a^2}}.
$$
Compare the solutions with the points $A(k)$ in Exercise 11.4.<br>
**For Exercise 11.4, the specific content is as follows:**  
Find the intersection points $A(k)$ in $(0, \sqrt{k})$ of the curves
$$
S_{k-1}(a) = P \left( t(k-1) > \sqrt{\frac{a^2(k-1)}{k - a^2}} \right)
$$
and
$$
S_k(a) = P \left( t(k) > \sqrt{\frac{a^2 k}{k + 1 - a^2}} \right),
$$
for $k = 4 : 25, 100, 500, 1000$, where $t(k)$ is a Student $t$ random variable with $k$ degrees of freedom. (These intersection points determine the critical values for a $t$-test for scale-mixture errors proposed by SzÃ©kely [260].)


## Question 2

Suppose $T_1, \dots, T_n$ are i.i.d. samples drawn from the exponential distribution with expectation $\lambda$. Those values greater than $\tau$ are not observed due to right censorship, so that the observed values are $Y_i = T_i I(T_i \leq \tau) + \tau I(T_i > \tau)$, $i = 1, \dots, n$. Suppose $\tau = 1$ and the observed $Y_i$ values are as follows:
$$
0.54, 0.48, 0.33, 0.43, 1.00, 1.00, 0.91, 1.00, 0.21, 0.85
$$
Use the E-M algorithm to estimate $\lambda$, compare your result with the observed data MLE (note: $Y_i$ follows a mixture distribution).


# Answer

## é—®é¢˜1 ç»ƒä¹ 11.3

### é¢˜ç›®æè¿°

(a) ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—ä¸‹åˆ—çº§æ•°çš„ç¬¬ $k$ é¡¹ï¼š

$$
T_k = \frac{(-1)^k}{k! \cdot 2^k} \cdot \frac{\|a\|^{2k+2}}{(2k+1)(2k+2)} \cdot \frac{\Gamma\left(\frac{d+1}{2}\right) \Gamma\left(k + \frac{3}{2}\right)}{\Gamma\left(k + \frac{d}{2} + 1\right)},
$$
å…¶ä¸­ $d \geq 1$ æ˜¯æ•´æ•°ï¼Œ$a$ æ˜¯ $\mathbb{R}^d$ ä¸­çš„å‘é‡ï¼Œ$\|\cdot\|$ è¡¨ç¤ºæ¬§å‡ é‡Œå¾—èŒƒæ•°ã€‚è¦æ±‚ä»¥é€‚å½“çš„æ–¹å¼è¿›è¡Œç®—æœ¯è¿ç®—ï¼Œä½¿å¾—åœ¨ï¼ˆå‡ ä¹ï¼‰ä»»æ„å¤§çš„ $k$ å’Œ $d$ ä¸‹éƒ½èƒ½è®¡ç®—å‡ºç³»æ•°ã€‚ï¼ˆè¯¥çº§æ•°å¯¹äºæ‰€æœ‰ $a \in \mathbb{R}^d$ éƒ½æ”¶æ•›ã€‚ï¼‰

(b) ä¿®æ”¹è¯¥å‡½æ•°ï¼Œä½¿å…¶èƒ½å¤Ÿè®¡ç®—å¹¶è¿”å›çº§æ•°çš„å’Œã€‚

(c) å½“ $a = (1, 2)^T$ æ—¶ï¼Œè®¡ç®—è¯¥çº§æ•°çš„å€¼ã€‚

### è§£ç­”æ€è·¯

**1. ç†è§£çº§æ•°ç»“æ„**

ç”±äº**çº§æ•°çš„ç¬¬ $k$ é¡¹ç»“æ„å¤æ‚**ï¼ŒåŒ…å«é˜¶ä¹˜ã€æŒ‡æ•°ã€ä¼½é©¬å‡½æ•°ç­‰ï¼Œç›´æ¥è®¡ç®—å¯èƒ½ä¼šé‡åˆ°æ•°å€¼è®¡ç®—çš„å›°éš¾ã€‚å› æ­¤ï¼Œé¦–å…ˆéœ€è¦åˆ†æçº§æ•°ç¬¬ $k$ é¡¹çš„ç»“æ„ï¼Œä»¥ä¾¿æ­£ç¡®åœ°å®ç°è®¡ç®—ã€‚ç¬¬ $k$ é¡¹ $T_k$ åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

- **ç¬¦å·éƒ¨åˆ†**ï¼š$(-1)^k$
- **å› å­1**ï¼š$\frac{1}{k! \cdot 2^k}$
- **å› å­2**ï¼š$\frac{\|a\|^{2k+2}}{(2k+1)(2k+2)}$
- **å› å­3**ï¼š$\Gamma\left(\frac{d+1}{2}\right)$
- **å› å­4**ï¼š$\Gamma\left(k + \frac{3}{2}\right)$
- **å› å­5**ï¼š$\frac{1}{\Gamma\left(k + \frac{d}{2} + 1\right)}$

**2. å¤„ç†æ•°å€¼è®¡ç®—çš„ç¨³å®šæ€§**

ç”±äº $k$ å’Œ $d$ å¯ä»¥å–è¾ƒå¤§å€¼ï¼Œç›´æ¥è®¡ç®—å¯èƒ½å¯¼è‡´æ•°å€¼ä¸‹æº¢æˆ–ä¸Šæº¢ã€‚ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œé‡‡å–ä»¥ä¸‹æªæ–½ï¼š

- **å¯¹æ•°è¿ç®—**ï¼šå°†ä¹˜é™¤æ³•è½¬æ¢ä¸ºå¯¹æ•°åŠ å‡æ³•ï¼Œé¿å…å¤§æ•°æˆ–å°æ•°çš„ç›´æ¥è®¡ç®—ã€‚
- **ä½¿ç”¨ç‰¹æ®Šå‡½æ•°**ï¼šåˆ©ç”¨ R ä¸­çš„ `lgamma()` å‡½æ•°æ¥è®¡ç®— $\ln(\Gamma(z))$ï¼Œæé«˜è®¡ç®—ç²¾åº¦ã€‚

**3. ç¼–å†™è®¡ç®—ç¬¬ $k$ é¡¹çš„å‡½æ•°**

- å®šä¹‰ä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•° `compute_term(k, a_norm, d)`ï¼Œç”¨äºè®¡ç®—ç¬¬ $k$ é¡¹çš„å€¼ã€‚
- åœ¨å‡½æ•°ä¸­ï¼Œä½¿ç”¨å¯¹æ•°è¿ç®—è®¡ç®—æ¯ä¸ªéƒ¨åˆ†çš„å¯¹æ•°å€¼ï¼Œç„¶åé€šè¿‡ç´¯åŠ å¾—åˆ°æ€»çš„å¯¹æ•°å€¼ï¼Œæœ€åå–æŒ‡æ•°å¹¶ä¹˜ä»¥ç¬¦å·éƒ¨åˆ†ã€‚

**4. ç¼–å†™ç‹¬ç«‹çš„å‡½æ•°**

- **`compute_series_sum()` å‡½æ•°**ï¼šå®šä¹‰ä¸€ä¸ªå‡½æ•° `compute_series_sum(a, d, tol, max_iter)`ï¼Œç”¨äºè®¡ç®—çº§æ•°çš„å’Œã€‚ä½¿ç”¨å¾ªç¯ç´¯åŠ æ¯ä¸€é¡¹çš„å€¼ï¼Œç›´åˆ°å½“å‰é¡¹çš„ç»å¯¹å€¼å°äºè®¾å®šçš„å®¹å·® `tol`ï¼Œæˆ–è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•° `max_iter`ã€‚
- **`plot_convergence()` å‡½æ•°**ï¼šç»˜åˆ¶çº§æ•°é¡¹çš„æ”¶æ•›æƒ…å†µã€‚
- **`compute_term()` å‡½æ•°**ï¼šè®¡ç®—ç¬¬ $k$ é¡¹çš„å€¼ã€‚

**5. å½“ $a = (1, 2)^T$ æ—¶ï¼Œè®¡ç®—çº§æ•°çš„å€¼**

- è®¡ç®—å‘é‡ $a$ çš„æ¬§å‡ é‡Œå¾—èŒƒæ•° $\|a\|$ã€‚
- è°ƒç”¨ `compute_series_sum()` å‡½æ•°ï¼Œè®¡ç®—çº§æ•°çš„å’Œã€‚

**6. å¯è§†åŒ–ç»“æœ**

- **å›¾1**ï¼šç»˜åˆ¶æ¯ä¸€é¡¹çš„ç»å¯¹å€¼éš $k$ å˜åŒ–çš„å›¾ï¼Œå±•ç¤ºæ”¶æ•›é€Ÿåº¦ã€‚
- **å›¾2**ï¼šç»˜åˆ¶çº§æ•°å’Œéš $k$ å¢åŠ çš„å˜åŒ–ï¼Œå±•ç¤ºçº§æ•°å’Œçš„æ”¶æ•›è¿‡ç¨‹ã€‚

**7. å†…å­˜ç®¡ç†**

- åœ¨ç¨‹åºå¼€å§‹å’Œç»“æŸæ—¶ï¼Œä½¿ç”¨ `rm(list = ls())` æ¸…ç©ºå·¥ä½œç©ºé—´ã€‚
- ä½¿ç”¨ `gc()` è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œé‡Šæ”¾å†…å­˜ã€‚


### ä»£ç å®ç°

**1.æ¸…ç©ºå·¥ä½œç©ºé—´ï¼Œé‡Šæ”¾å†…å­˜**

```{r, eval=TRUE}
# æ¸…ç©ºå·¥ä½œç©ºé—´ï¼Œé‡Šæ”¾å†…å­˜
rm(list = ls())
```

**2.å®šä¹‰è®¡ç®—ç¬¬ $k$ é¡¹çš„å‡½æ•°**

```{r, eval=TRUE}
# è®¡ç®—ç¬¬ k é¡¹çš„å‡½æ•°
compute_term <- function(k, a_norm, d) {
  # ç¬¦å·éƒ¨åˆ†ï¼š(-1)^k
  sign_part <- (-1)^k
  
  # å¯¹æ•°è¿ç®—åˆå§‹åŒ–
  ln_Tk <- 0
  
  # éƒ¨åˆ†1ï¼šln(1 / (k! * 2^k))
  ln_part1 <- -lgamma(k + 1) - k * log(2)
  
  # éƒ¨åˆ†2ï¼šln(||a||^(2k+2) / ((2k+1)(2k+2)))
  ln_part2 <- (2 * k + 2) * log(a_norm) - log(2 * k + 1) - log(2 * k + 2)
  
  # éƒ¨åˆ†3ï¼šln(Î“((d+1)/2))
  ln_part3 <- lgamma((d + 1) / 2)
  
  # éƒ¨åˆ†4ï¼šln(Î“(k + 3/2))
  ln_part4 <- lgamma(k + 1.5)
  
  # éƒ¨åˆ†5ï¼š-ln(Î“(k + d/2 + 1))
  ln_part5 <- -lgamma(k + d / 2 + 1)
  
  # æ€»çš„å¯¹æ•°å€¼
  ln_Tk <- ln_part1 + ln_part2 + ln_part3 + ln_part4 + ln_part5
  
  # è®¡ç®—ç¬¬ k é¡¹çš„å€¼
  Tk <- sign_part * exp(ln_Tk)
  
  return(Tk)
}
```

**3.å®šä¹‰è®¡ç®—çº§æ•°å’Œçš„å‡½æ•°**

```{r, eval=TRUE}
library(knitr)
library(kableExtra)

# è®¡ç®—çº§æ•°å’Œçš„å‡½æ•°ï¼Œä¿®æ”¹åèƒ½å±•ç¤ºè¡¨æ ¼ç»“æœ
compute_series_sum <- function(a, d, tol = 1e-10, max_iter = 1000) { 
  # è®¡ç®—å‘é‡ a çš„æ¬§å‡ é‡Œå¾—èŒƒæ•°
  a_norm <- sqrt(sum(a^2)) 
   
  # åˆå§‹åŒ–å‚æ•°
  sum_series <- 0       # ç´¯åŠ çš„çº§æ•°å’Œ
  k <- 0                # è¿­ä»£è®¡æ•°å™¨
  term_values <- c()    # å­˜å‚¨æ¯ä¸€é¡¹çš„å€¼
  sum_values <- c()     # å­˜å‚¨çº§æ•°å’Œçš„å˜åŒ–
  k_values <- c()       # å­˜å‚¨é¡¹æ•° k
 
  repeat { 
    # è®¡ç®—ç¬¬ k é¡¹
    Tk <- compute_term(k, a_norm, d)
     
    # å­˜å‚¨å½“å‰é¡¹çš„å€¼
    term_values <- c(term_values, Tk)
    sum_series <- sum_series + Tk
    sum_values <- c(sum_values, sum_series)
    k_values <- c(k_values, k)
     
    # åˆ¤æ–­æ”¶æ•›æ¡ä»¶
    if (abs(Tk) < tol) { 
      break 
    } 
     
    # æ›´æ–°è¿­ä»£è®¡æ•°å™¨
    k <- k + 1 
     
    # é˜²æ­¢è¶…è¿‡æœ€å¤§è¿­ä»£æ¬¡æ•°
    if (k > max_iter) { 
      warning("è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œçº§æ•°å¯èƒ½æœªå®Œå…¨æ”¶æ•›") 
      break 
    } 
  }
   
  # åˆ›å»ºä¸€ä¸ªåŒ…å«è®¡ç®—è¿‡ç¨‹çš„è¡¨æ ¼æ•°æ®æ¡†
  result_table <- data.frame(
    k = k_values,
    Term = term_values,
    CumulativeSum = sum_values,
    AbsTerm = abs(term_values)
  )
   
  # è¿”å›ç»“æœ
  return(list(
    sum = sum_series, 
    iterations = k, 
    terms_table = result_table
  )) 
}

# å®šä¹‰å‘é‡ a å’Œç»´åº¦ d
a_vector <- c(1, 2)
d_value <- length(a_vector)

# è°ƒç”¨å‡½æ•°è®¡ç®—çº§æ•°å’Œ
result <- compute_series_sum(a_vector, d_value)

# æ˜¾ç¤ºç»“æœè¡¨æ ¼
kable(result$terms_table, caption = "çº§æ•°é¡¹çš„è®¡ç®—è¿‡ç¨‹")


```

**4.å½“ $a = (1, 2)^T$ æ—¶ï¼Œè®¡ç®—çº§æ•°çš„å€¼**

```{r, eval=TRUE}
# å®šä¹‰å‘é‡ a å’Œç»´åº¦ d
a_vector <- c(1, 2)
d_value <- length(a_vector)

# è°ƒç”¨å‡½æ•°è®¡ç®—çº§æ•°å’Œ
result <- compute_series_sum(a_vector, d_value)

# è¾“å‡ºç»“æœ
cat("å½“ a = (1, 2)^T æ—¶ï¼Œçº§æ•°çš„å’Œä¸ºï¼š", result$sum, "\n")
cat("è®¡ç®—è¿­ä»£æ¬¡æ•°ä¸ºï¼š", result$iterations, "\n")
```

**5.ç»˜åˆ¶çº§æ•°é¡¹çš„æ”¶æ•›æƒ…å†µ**

```{r, eval=TRUE}
# å¯¼å…¥ ggplot2
library(ggplot2)

# å‡†å¤‡ç»˜å›¾æ•°æ®
term_df <- result$terms_table

# ç»˜åˆ¶çº§æ•°é¡¹çš„ç»å¯¹å€¼
plot_terms <- ggplot(term_df, aes(x = k, y = AbsTerm)) +
  geom_line(color = "#1f77b4", linewidth = 1.2, linetype = "solid") +  # ä½¿ç”¨æŸ”å’Œçš„è“è‰²å’Œè¾ƒç²—çš„çº¿æ¡
  geom_point(color = "#ff7f0e", size = 3, alpha = 0.8) +  # ä½¿ç”¨æ©™è‰²ç‚¹å¹¶è°ƒæ•´é€æ˜åº¦
  scale_y_log10(labels = scales::label_math(format = scales::scientific_format(digits = 2))) +  # å¯¹æ•°åˆ»åº¦ä¼˜åŒ–æ˜¾ç¤º
  labs(
    title = "çº§æ•°é¡¹çš„æ”¶æ•›æƒ…å†µï¼ˆå¯¹æ•°åˆ»åº¦ï¼‰",
    subtitle = "å±•ç¤ºå„é¡¹ç»å¯¹å€¼çš„æ”¶æ•›è¶‹åŠ¿",
    x = "é¡¹æ•° k",
    y = expression(paste("ç»å¯¹å€¼ ", "|T[k]|"))
  ) +
  theme_minimal(base_size = 15) +  # ä½¿ç”¨æ›´å¤§çš„åŸºç¡€å­—ä½“å¤§å°
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),  # æ ‡é¢˜åŠ ç²—å¹¶å±…ä¸­
    plot.subtitle = element_text(hjust = 0.5),  # å‰¯æ ‡é¢˜å±…ä¸­
    axis.text = element_text(size = 12),  # åæ ‡è½´æ–‡æœ¬å¤§å°è°ƒæ•´
    axis.title = element_text(face = "bold"),  # åæ ‡è½´æ ‡é¢˜åŠ ç²—
    panel.grid.major = element_line(color = "grey80", linetype = "dashed"),  # å¢åŠ ä¸»è¦ç½‘æ ¼çº¿
    panel.grid.minor = element_line(color = "grey90", linetype = "dotted")   # å¢åŠ æ¬¡è¦ç½‘æ ¼çº¿
  ) +
  annotate("text", x = max(term_df$k) * 0.8, y = min(term_df$AbsTerm) * 10,
           label = "æ”¶æ•›è¶‹åŠ¿æ˜æ˜¾", color = "darkred", size = 5, fontface = "italic")  # æ·»åŠ æ–‡æœ¬æ ‡æ³¨

# æ˜¾ç¤ºå›¾å½¢
print(plot_terms)

```

**6.ç»˜åˆ¶çº§æ•°å’Œçš„æ”¶æ•›æƒ…å†µ**

```{r, eval=TRUE}
library(ggplot2)

# æ£€æŸ¥ result$terms_table æ˜¯å¦ä¸ºç©º
if (!is.null(result$terms_table) && nrow(result$terms_table) > 0) {
  # å‡†å¤‡ç»˜å›¾æ•°æ®
  sum_df <- data.frame(
    k = result$terms_table$k,
    Sum = result$terms_table$CumulativeSum
  )

  # ä½¿ç”¨ ggplot2 ç»˜åˆ¶çº§æ•°å’Œçš„å˜åŒ–ï¼Œå¹¶è¿›è¡Œç¾åŒ–
  plot_sums <- ggplot(sum_df, aes(x = k, y = Sum)) +
    geom_line(color = "#2ca02c", linewidth = 1.2, linetype = "solid") +  # ä½¿ç”¨æŸ”å’Œçš„ç»¿è‰²ï¼Œçº¿æ¡è¾ƒç²—
    geom_point(color = "#d62728", size = 3, alpha = 0.8) +  # ä½¿ç”¨çº¢è‰²ç‚¹å¹¶è°ƒæ•´é€æ˜åº¦
    labs(
      title = "çº§æ•°å’Œçš„æ”¶æ•›æƒ…å†µ",
      subtitle = "å±•ç¤ºå„é¡¹ç´¯ç§¯å’Œçš„æ”¶æ•›è¶‹åŠ¿",
      x = "é¡¹æ•° k",
      y = expression(paste("çº§æ•°å’Œ ", S[k]))
    ) +
    theme_minimal(base_size = 15) +  # ä½¿ç”¨è¾ƒå¤§çš„åŸºç¡€å­—ä½“å¤§å°
    theme(
      plot.title = element_text(face = "bold", hjust = 0.5),  # æ ‡é¢˜åŠ ç²—å¹¶å±…ä¸­
      plot.subtitle = element_text(hjust = 0.5),  # å‰¯æ ‡é¢˜å±…ä¸­
      axis.text = element_text(size = 12),  # åæ ‡è½´æ–‡æœ¬å¤§å°è°ƒæ•´
      axis.title = element_text(face = "bold"),  # åæ ‡è½´æ ‡é¢˜åŠ ç²—
      panel.grid.major = element_line(color = "grey80", linetype = "dashed"),  # å¢åŠ ä¸»è¦ç½‘æ ¼çº¿
      panel.grid.minor = element_line(color = "grey90", linetype = "dotted")   # å¢åŠ æ¬¡è¦ç½‘æ ¼çº¿
    ) +
    annotate("text", x = max(sum_df$k) * 0.8, y = max(sum_df$Sum) * 0.9,
             label = "æ”¶æ•›è¶‹åŠ¿æ˜æ˜¾", color = "blue", size = 5, fontface = "italic")  # æ·»åŠ æ–‡æœ¬æ ‡æ³¨

  # æ˜¾ç¤ºå›¾å½¢
  print(plot_sums)
} else {
  print("result$terms_table ä¸ºç©ºï¼Œæ— æ³•ç»˜åˆ¶å›¾å½¢")
}


```

### ç»“æœåˆ†æ

**1. è®¡ç®—ç»“æœ**

- **çº§æ•°å’Œ**ï¼šå½“ $a = (1, 2)^T$ æ—¶ï¼Œè®¡ç®—å¾—åˆ°çº§æ•°çš„å’Œä¸ºï¼š

  ```
  å½“ a = (1, 2)^T æ—¶ï¼Œçº§æ•°çš„å’Œä¸ºï¼š 1.532164 
  è®¡ç®—è¿­ä»£æ¬¡æ•°ä¸ºï¼š 17 
  ```

- **è¿­ä»£æ¬¡æ•°**ï¼šå…±è¿›è¡Œäº† 17 æ¬¡è¿­ä»£ï¼Œè¡¨æ˜çº§æ•°æ”¶æ•›è¾ƒå¿«ã€‚

**2. æ”¶æ•›æ€§åˆ†æ**

- **çº§æ•°é¡¹çš„ç»å¯¹å€¼**ï¼š

```{r, eval=TRUE}
# æ˜¾ç¤ºç»“æœè¡¨æ ¼ï¼ˆäº¤äº’å¼ï¼‰
# å¿½ç•¥DTåŒ…ç‰ˆæœ¬è­¦å‘Š
suppressWarnings(library(DT))
library(DT)
datatable(result$terms_table, options = list(pageLength = 10), caption = "çº§æ•°é¡¹çš„è®¡ç®—è¿‡ç¨‹")

```

- **æ”¶æ•›é€Ÿåº¦**ï¼šä»è¡¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œçº§æ•°é¡¹çš„ç»å¯¹å€¼è¿…é€Ÿå‡å°ï¼Œå‘ˆæŒ‡æ•°çº§ä¸‹é™ï¼Œè¯´æ˜çº§æ•°æ”¶æ•›é€Ÿåº¦å¿«ã€‚

**3. å›¾å½¢åˆ†æ**

- **å›¾1ï¼šçº§æ•°é¡¹çš„æ”¶æ•›æƒ…å†µ**
```{r, eval=TRUE}
# æ˜¾ç¤ºå›¾å½¢
print(plot_terms)
```
  **å›¾åƒè§£è¯»**ï¼š

  - æ¨ªè½´ä¸ºé¡¹æ•° $k$ï¼Œçºµè½´ä¸º $|T_k|$ çš„å¯¹æ•°å€¼ã€‚
  - å›¾åƒæ˜¾ç¤º $|T_k|$ éš $k$ å¢å¤§å‘ˆæŒ‡æ•°çº§ä¸‹é™ã€‚

- **å›¾2ï¼šçº§æ•°å’Œçš„æ”¶æ•›æƒ…å†µ**
```{r, eval=TRUE}
# æ˜¾ç¤ºå›¾å½¢
print(plot_sums)
```

  **å›¾åƒè§£è¯»**ï¼š

  - æ¨ªè½´ä¸ºé¡¹æ•° $k$ï¼Œçºµè½´ä¸ºçº§æ•°å’Œ $S_k$ã€‚
  - çº§æ•°å’Œåœ¨ $k = 6$ åè¶‹äºç¨³å®šï¼Œè¯´æ˜çº§æ•°æ”¶æ•›ã€‚

**4. ç»“è®º**

- **çº§æ•°æ”¶æ•›æ€§**ï¼šçº§æ•°å¯¹äºä»»æ„ $a \in \mathbb{R}^d$ éƒ½æ”¶æ•›ï¼Œå®é™…è®¡ç®—ä¸­ä¹ŸéªŒè¯äº†è¿™ä¸€ç‚¹ã€‚
- **è®¡ç®—ç²¾åº¦**ï¼šé€šè¿‡å¯¹æ•°è¿ç®—å’Œé€‚å½“çš„æ•°å€¼æ–¹æ³•ï¼ŒæˆåŠŸé¿å…äº†æ•°å€¼ä¸‹æº¢æˆ–ä¸Šæº¢ï¼Œä¿è¯äº†è®¡ç®—ç²¾åº¦ã€‚
- **ç¼–ç¨‹è§„èŒƒ**ï¼šä»£ç ä¸­ç¼–å†™äº†ç‹¬ç«‹çš„å‡½æ•°ï¼Œä¾¿äºç»´æŠ¤å’Œå¤ç”¨ï¼›å¹¶åœ¨å¼€å§‹å’Œç»“æŸæ—¶æ¸…ç†äº†å†…å­˜ã€‚
- **ç»“æœå¯ä¿¡æ€§**ï¼šé€šè¿‡æ•°å€¼è®¡ç®—å’Œå›¾å½¢åˆ†æï¼ŒéªŒè¯äº†è®¡ç®—ç»“æœçš„å¯ä¿¡æ€§ã€‚

**5. æ³¨æ„äº‹é¡¹**

- **å‚æ•°é€‰æ‹©**ï¼šåœ¨è®¡ç®—çº§æ•°å’Œæ—¶ï¼Œè®¾ç½®äº†å®¹å·® `tol = 1e-10`ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ç²¾åº¦ã€‚
- **æœ€å¤§è¿­ä»£æ¬¡æ•°**ï¼šè®¾ç½®äº† `max_iter = 1000`ï¼Œé˜²æ­¢æ— é™å¾ªç¯ã€‚
- **å‡½æ•°å¤ç”¨æ€§**ï¼šç¼–å†™çš„å‡½æ•°å…·æœ‰é€šç”¨æ€§ï¼Œå¯ä»¥ç”¨äºè®¡ç®—ä¸åŒçš„ $a$ å’Œ $d$ ä¸‹çš„çº§æ•°ã€‚


------------------------------------------------------------------------

## é—®é¢˜1 ç»ƒä¹ 11.5

### é¢˜ç›®æè¿°

ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æ±‚è§£å…³äº $a$ çš„æ–¹ç¨‹ï¼š

$$
\frac{2 \Gamma\left(\frac{k}{2}\right)}{\sqrt{\pi (k - 1)} \Gamma\left(\frac{k - 1}{2}\right)} \int_0^{c_{k-1}} \left(1 + \frac{u^2}{k - 1}\right)^{-\frac{k}{2}} du = \frac{2 \Gamma\left(\frac{k + 1}{2}\right)}{\sqrt{\pi k} \Gamma\left(\frac{k}{2}\right)} \int_0^{c_k} \left(1 + \frac{u^2}{k}\right)^{-\frac{k + 1}{2}} du
$$

å…¶ä¸­ï¼Œ

$$
c_k = \sqrt{\frac{a^2 k}{k + 1 - a^2}}.
$$

æ¯”è¾ƒæ±‚è§£å¾—åˆ°çš„ $a$ ä¸ç»ƒä¹ 11.4ä¸­çš„ç‚¹ $A(k)$ã€‚

**ç»ƒä¹ 11.4å…·ä½“å†…å®¹ä¸ºï¼š**

æ‰¾åˆ°æ›²çº¿åœ¨åŒºé—´ $(0, \sqrt{k})$ ä¸Šçš„äº¤ç‚¹ $A(k)$ï¼š

$$
S_{k - 1}(a) = P\left( t_{k - 1} > \sqrt{\frac{a^2 (k - 1)}{k - a^2}} \right)
$$

å’Œ

$$
S_k(a) = P\left( t_k > \sqrt{\frac{a^2 k}{k + 1 - a^2}} \right),
$$

å…¶ä¸­ $k = 4:25, 100, 500, 1000$ï¼Œ$t_k$ æ˜¯è‡ªç”±åº¦ä¸º $k$ çš„ Student $t$ åˆ†å¸ƒéšæœºå˜é‡ã€‚

ï¼ˆè¿™äº›äº¤ç‚¹ç¡®å®šäº† SzÃ©kely æå‡ºçš„ç”¨äºå°ºåº¦æ··åˆè¯¯å·®çš„ $t$ æ£€éªŒçš„ä¸´ç•Œå€¼ã€‚ï¼‰

### è§£ç­”æ€è·¯

**1. é—®é¢˜ç†è§£**

æœ¬é¢˜çš„ç›®æ ‡æ˜¯æ±‚è§£å…³äº $a$ çš„æ–¹ç¨‹ï¼Œä½¿å¾—å·¦ä¾§å’Œå³ä¾§çš„ç§¯åˆ†è¡¨è¾¾å¼ç›¸ç­‰ã€‚éœ€è¦ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå¯¹äºç»™å®šçš„è‡ªç”±åº¦ $k$ï¼Œæ±‚è§£å¯¹åº”çš„ $a$ å€¼ã€‚ç„¶åï¼Œå°†æ±‚å¾—çš„ $a$ ä¸ç»ƒä¹  11.4 ä¸­çš„ç‚¹ $A(k)$ è¿›è¡Œæ¯”è¾ƒã€‚

**2. æ•°å­¦æ¨å¯¼**

ä¸ºäº†é¿å…ç›´æ¥è®¡ç®—ç§¯åˆ†å¯¼è‡´çš„æ•°å€¼ä¸‹æº¢æˆ–ä¸Šæº¢é—®é¢˜ï¼Œéœ€è¦å°†ç§¯åˆ†è¡¨è¾¾å¼è½¬æ¢ä¸ºå·²çŸ¥çš„æ¦‚ç‡åˆ†å¸ƒå‡½æ•°å½¢å¼ï¼Œåˆ©ç”¨ R ä¸­çš„å†…ç½®å‡½æ•°æ¥è®¡ç®—ï¼Œä»¥æé«˜æ•°å€¼è®¡ç®—çš„ç¨³å®šæ€§ã€‚

**2.1. è§‚å¯Ÿç§¯åˆ†è¡¨è¾¾å¼**

é¦–å…ˆï¼Œæ³¨æ„åˆ°ç§¯åˆ†çš„è¢«ç§¯å‡½æ•°å½¢å¼ä¸ºï¼š

- å·¦ä¾§ç§¯åˆ†ï¼š

  $$
  I_1 = \int_0^{c_{k-1}} \left( 1 + \dfrac{u^2}{k - 1} \right)^{-\dfrac{k}{2}} du
  $$

- å³ä¾§ç§¯åˆ†ï¼š

  $$
  I_2 = \int_0^{c_k} \left( 1 + \dfrac{u^2}{k} \right)^{-\dfrac{k+1}{2}} du
  $$

è¿™äº›å½¢å¼ä¸ t åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆPDFï¼‰å¯†åˆ‡ç›¸å…³ã€‚

**2.2. t åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°**

è‡ªç”±åº¦ä¸º $\nu$ çš„ $t$ åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°ä¸ºï¼š

$$
f_{\nu}(u) = \frac{\Gamma\left(\dfrac{\nu + 1}{2}\right)}{\sqrt{\pi \nu}\ \Gamma\left(\dfrac{\nu}{2}\right)} \left(1 + \dfrac{u^2}{\nu}\right)^{-\dfrac{\nu + 1}{2}}
$$

**2.3. å°†ç§¯åˆ†è½¬æ¢ä¸ºç´¯ç§¯åˆ†å¸ƒå‡½æ•°**

è€ƒè™‘åˆ° t åˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼ˆCDFï¼‰ä¸å…¶æ¦‚ç‡å¯†åº¦å‡½æ•°çš„ç§¯åˆ†æœ‰å…³ï¼Œå³ï¼š

$$
P(T_{\nu} > x) = \int_x^{\infty} f_{\nu}(u) du
$$

ä½†æ˜¯ï¼Œç§¯åˆ†ä¸Šé™æ˜¯ $c_{k-1}$ å’Œ $c_k$ï¼Œç§¯åˆ†ä¸‹é™æ˜¯ 0ã€‚å› æ­¤ï¼Œå¯ä»¥è€ƒè™‘å°†ç§¯åˆ†ä» 0 åˆ° \( c \) çš„å½¢å¼ä¸ t åˆ†å¸ƒçš„ CDF å…³è”ã€‚

ç”±äº $t$ åˆ†å¸ƒæ˜¯å¯¹ç§°çš„ï¼Œåˆ™æœ‰ï¼š

$$
P(T_{\nu} > x) = P(T_{\nu} < -x)
$$

ä½†ç”±äºç§¯åˆ†èŒƒå›´ä¸º $[0, c]$ï¼Œå¯ä»¥è¡¨ç¤ºä¸ºï¼š

$$
\int_0^{c} f_{\nu}(u) du = F_{\nu}(c) - F_{\nu}(0)
$$

å…¶ä¸­ $F_{\nu}(c)$ æ˜¯ $t$ åˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ã€‚

**2.4. ç®€åŒ–ç§¯åˆ†è¡¨è¾¾å¼**

ç„¶è€Œï¼Œä¸ºäº†é¿å…å¤æ‚çš„è®¡ç®—ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ç§¯åˆ†è¡¨è¾¾å¼ä¸ç”Ÿå­˜å‡½æ•°ï¼ˆSurvival Functionï¼‰æœ‰å…³ã€‚å¯¹äºæ­£å€¼ $c$ï¼Œç”Ÿå­˜å‡½æ•°ä¸ºï¼š

$$
S_{\nu}(c) = P(T_{\nu} > c)
$$

ä½†æ˜¯ç›´æ¥å°†ç§¯åˆ†è½¬æ¢ä¸ºç”Ÿå­˜å‡½æ•°å¯èƒ½å¹¶ä¸ç›´è§‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è€ƒè™‘ä½¿ç”¨ $t$ åˆ†å¸ƒçš„ç‰¹æ€§ï¼Œå°†åŸæ–¹ç¨‹è½¬æ¢ä¸ºç”Ÿå­˜å‡½æ•°çš„ç­‰å¼ã€‚

**2.5. å»ºç«‹ç­‰å¼**

é€šè¿‡å¯¹æ¯”ç§¯åˆ†è¡¨è¾¾å¼å’Œ $t$ åˆ†å¸ƒçš„ PDFï¼Œå¯ä»¥å‘ç°ï¼š

- å·¦ä¾§çš„ç§¯åˆ†å¯ä»¥ä¸è‡ªç”±åº¦ä¸º $k - 1$ çš„ $t$ åˆ†å¸ƒçš„ç”Ÿå­˜å‡½æ•°ç›¸å…³ã€‚
- å³ä¾§çš„ç§¯åˆ†å¯ä»¥ä¸è‡ªç”±åº¦ä¸º $k$ çš„ $t$ åˆ†å¸ƒçš„ç”Ÿå­˜å‡½æ•°ç›¸å…³ã€‚

å…·ä½“æ¥è¯´ï¼ŒåŸæ–¹ç¨‹å¯ä»¥è¿‘ä¼¼è¡¨ç¤ºä¸ºï¼š

$$
P\left( T_{k-1} > c_{k-1} \right) = P\left( T_k > c_k \right)
$$

å…¶ä¸­ï¼š

- $c_{k-1} = \sqrt{\dfrac{a^2 (k - 1)}{k - a^2}}$
- $c_k = \sqrt{\dfrac{a^2 k}{k + 1 - a^2}}$

**2.6. å®šä¹‰ç›®æ ‡å‡½æ•°**

ä¸ºäº†æ±‚è§£ $a$ï¼Œå®šä¹‰ç›®æ ‡å‡½æ•°ä¸ºï¼š

$$
f(a) = \ln P\left( T_{k-1} > c_{k-1} \right) - \ln P\left( T_k > c_k \right)
$$

è¿™é‡Œå–å¯¹æ•°æ˜¯ä¸ºäº†é¿å…ç›´æ¥è®¡ç®—æå°çš„æ¦‚ç‡å€¼å¯¼è‡´çš„æ•°å€¼ä¸‹æº¢é—®é¢˜ã€‚

å› æ­¤ï¼Œæœ¬é¢˜çš„ç›®æ ‡æ˜¯æ‰¾åˆ°ä½¿ $f(a) = 0$ çš„ $a$ å€¼ã€‚

**2.7. æ•°å€¼æ±‚è§£**

ç”±äºæ— æ³•è§£ææ±‚è§£ $a$ï¼Œåªèƒ½é‡‡ç”¨æ•°å€¼æ–¹æ³•ã€‚

- **å–å€¼èŒƒå›´**ï¼š$a \in (0, \sqrt{k})$
- **æ•°å€¼æ–¹æ³•**ï¼šä½¿ç”¨ R è¯­è¨€çš„ `uniroot()` å‡½æ•°åœ¨æŒ‡å®šåŒºé—´å†…æ±‚è§£ã€‚
- **é¿å…æ•°å€¼ä¸‹æº¢/ä¸Šæº¢**ï¼šåœ¨è®¡ç®—æ¦‚ç‡æ—¶ï¼Œä½¿ç”¨å¯¹æ•°æ¦‚ç‡ã€‚

**3. ç¼–ç¨‹å®ç°**

**3.1. ç¼–å†™è®¡ç®— $c_{k-1}$ å’Œ $c_k$ çš„å‡½æ•°**

- å‡½æ•° `calc_c_k_minus1(a, k)`ï¼šè®¡ç®— $c_{k-1}$ã€‚
- å‡½æ•° `calc_c_k(a, k)`ï¼šè®¡ç®— $c_k$ã€‚

**3.2. ç¼–å†™è®¡ç®—å¯¹æ•°ç”Ÿå­˜å‡½æ•°çš„å‡½æ•°**

- å‡½æ•° `log_survival_t(x, df)`ï¼šè®¡ç®— t åˆ†å¸ƒçš„å¯¹æ•°ç”Ÿå­˜å‡½æ•°ï¼Œä½¿ç”¨ R çš„ `pt()` å‡½æ•°ï¼Œè®¾ç½® `log.p = TRUE`ã€‚

**3.3. å®šä¹‰ç›®æ ‡å‡½æ•°**

- å‡½æ•° `f_a(a, k)`ï¼šè®¡ç®—ç›®æ ‡å‡½æ•°å€¼ã€‚

**3.4. ç¼–å†™æ±‚è§£ $a$ çš„å‡½æ•°**

- å‡½æ•° `solve_a(k)`ï¼šä½¿ç”¨ `uniroot()` å‡½æ•°æ±‚è§£ $f(a) = 0$ï¼Œå¹¶åŒ…å«é”™è¯¯å¤„ç†å’ŒåŒºé—´è°ƒæ•´ã€‚

**3.5. å¾ªç¯è®¡ç®—ä¸åŒ $k$ å€¼ä¸‹çš„ $a$**

- éå†æŒ‡å®šçš„ $k$ å€¼ï¼Œè°ƒç”¨ `solve_a(k)`ï¼Œä¿å­˜ç»“æœã€‚

**3.6. ç»˜åˆ¶ç»“æœ**

- ä½¿ç”¨ `ggplot2` ç»˜åˆ¶ $a$ ä¸ $k$ çš„å…³ç³»å›¾ã€‚
- ç»˜åˆ¶ç›®æ ‡å‡½æ•° $f(a)$ éš $a$ çš„å˜åŒ–æ›²çº¿ï¼ŒéªŒè¯æ±‚è§£çš„æ­£ç¡®æ€§ã€‚

### ä»£ç å®ç°

**1.åˆå§‹åŒ–ç¯å¢ƒ**

```{r, eval=TRUE}
# æ¸…ç©ºå·¥ä½œç©ºé—´ï¼Œé‡Šæ”¾å†…å­˜
rm(list = ls())

# åŠ è½½å¿…è¦çš„åº“
library(ggplot2)
```

åœ¨å¼€å§‹æ—¶ï¼Œæ¸…é™¤æ‰€æœ‰å˜é‡å¹¶åŠ è½½ç»˜å›¾æ‰€éœ€çš„ `ggplot2` åŒ…ã€‚

**2.å®šä¹‰è®¡ç®— $c_{k-1}(a)$ å’Œ $c_k(a)$ çš„å‡½æ•°**

```{r, eval=TRUE}
# è®¡ç®— c_{k-1}(a)
calc_c_k_minus1 <- function(a, k) {
  numerator <- a^2 * (k - 1)
  denominator <- k - a^2
  if (denominator <= 0) {
    return(NA)  # é¿å…è´Ÿæ•°å¼€æ–¹
  }
  c_k_minus1 <- sqrt(numerator / denominator)
  return(c_k_minus1)
}

# è®¡ç®— c_k(a)
calc_c_k <- function(a, k) {
  numerator <- a^2 * k
  denominator <- k + 1 - a^2
  if (denominator <= 0) {
    return(NA)
  }
  c_k <- sqrt(numerator / denominator)
  return(c_k)
}
```

è¿™ä¸¤ä¸ªå‡½æ•°ç”¨äºè®¡ç®— $c_{k-1}$ å’Œ $c_k$ï¼Œå¹¶æ£€æŸ¥é¿å…æ— æ•ˆçš„æ•°å­¦æ“ä½œï¼ˆå¦‚è´Ÿæ•°å¼€æ–¹ï¼‰ã€‚

**3.å®šä¹‰è®¡ç®—å¯¹æ•°ç”Ÿå­˜å‡½æ•° $S_{\nu}(x)$ çš„å‡½æ•°**

```{r, eval=TRUE}
# è®¡ç®—å¯¹æ•°ç”Ÿå­˜å‡½æ•°ï¼Œé¿å…æ•°å€¼ä¸‹æº¢
log_survival_t <- function(x, df) {
  if (is.na(x)) {
    return(NA)
  }
  # ä½¿ç”¨ pt() å‡½æ•°çš„ log.p = TRUE å‚æ•°è®¡ç®—å¯¹æ•°ç”Ÿå­˜å‡½æ•°
  log_S <- pt(q = x, df = df, lower.tail = FALSE, log.p = TRUE)
  return(log_S)
}
```

è¿™ä¸ªå‡½æ•°è®¡ç®— $t$ åˆ†å¸ƒçš„å¯¹æ•°ç”Ÿå­˜å‡½æ•°ï¼Œä»¥é¿å…ç›´æ¥è®¡ç®—å°æ¦‚ç‡å¯¼è‡´çš„æ•°å€¼ä¸‹æº¢é—®é¢˜ã€‚

**4.å®šä¹‰ç›®æ ‡å‡½æ•° $f(a)$**

```{r, eval=TRUE}
# å®šä¹‰ç›®æ ‡å‡½æ•° f(a)
f_a <- function(a, k) {
  # æ£€æŸ¥ a çš„å–å€¼èŒƒå›´
  if (a <= 0 || a >= sqrt(k)) {
    return(NA)
  }
  
  # è®¡ç®— c_{k-1} å’Œ c_k
  c_k_minus1 <- calc_c_k_minus1(a, k)
  c_k <- calc_c_k(a, k)
  
  # å¦‚æœè®¡ç®—å¤±è´¥ï¼Œè¿”å› NA
  if (is.na(c_k_minus1) || is.na(c_k)) {
    return(NA)
  }
  
  # è®¡ç®—å¯¹æ•°ç”Ÿå­˜å‡½æ•°å€¼
  log_S_k_minus1 <- log_survival_t(c_k_minus1, df = k - 1)
  log_S_k <- log_survival_t(c_k, df = k)
  
  # æ£€æŸ¥ç”Ÿå­˜å‡½æ•°å€¼æ˜¯å¦ä¸º NA
  if (is.na(log_S_k_minus1) || is.na(log_S_k)) {
    return(NA)
  }
  
  # è¿”å›å¯¹æ•°æ¦‚ç‡å·®
  f_value <- log_S_k_minus1 - log_S_k
  return(f_value)
}
```

ç›®æ ‡å‡½æ•°è®¡ç®—ä¸¤ä¸ªå¯¹æ•°ç”Ÿå­˜å‡½æ•°çš„å·®å€¼ï¼Œå¯»æ‰¾ä½¿ $f(a) = 0$ çš„ $a$ å€¼ã€‚

**5.å®šä¹‰æ±‚è§£ $a$ çš„å‡½æ•°**

```{r, eval=TRUE}
# å®šä¹‰æ±‚è§£ a çš„å‡½æ•°
solve_a <- function(k, lower = 0.01, upper = NULL, tol = 1e-8) {
  # è®¾ç½® upper ä¸º sqrt(k) çš„ç•¥å°å€¼ï¼Œé¿å…åˆ†æ¯ä¸ºé›¶
  if (is.null(upper)) {
    upper <- sqrt(k) - 0.01
  }
  
  # æ£€æŸ¥å‡½æ•°åœ¨åŒºé—´ç«¯ç‚¹çš„å€¼ï¼Œä»¥ç¡®ä¿å¯ä»¥ä½¿ç”¨ uniroot
  f_lower <- f_a(lower, k)
  f_upper <- f_a(upper, k)
  
  # å¦‚æœå‡½æ•°å€¼ä¸º NA æˆ–è€…åŒå·ï¼Œè°ƒæ•´åŒºé—´
  if (is.na(f_lower) || is.na(f_upper) || f_lower * f_upper > 0) {
    warning("æ— æ³•åœ¨æŒ‡å®šåŒºé—´å†…æ‰¾åˆ°é›¶ç‚¹ï¼Œè°ƒæ•´åŒºé—´")
    # å°è¯•æ‰©å¤§åŒºé—´
    lower_new <- 0.0001
    upper_new <- sqrt(k) - 0.0001
    f_lower_new <- f_a(lower_new, k)
    f_upper_new <- f_a(upper_new, k)
    if (!is.na(f_lower_new) && !is.na(f_upper_new) && f_lower_new * f_upper_new < 0) {
      lower <- lower_new
      upper <- upper_new
    } else {
      return(NA)
    }
  }
  
  # ä½¿ç”¨ uniroot() æ±‚è§£æ–¹ç¨‹ f(a) = 0
  result <- tryCatch({
    uniroot(f = f_a, interval = c(lower, upper), k = k, tol = tol)$root
  }, error = function(e) {
    NA  # å¦‚æœæ— è§£ï¼Œè¿”å› NA
  })
  
  # è¿”å›æ±‚è§£å¾—åˆ°çš„ a
  return(result)
}
```

è¿™ä¸ªå‡½æ•°ä½¿ç”¨æ•°å€¼æ–¹æ³•æ±‚è§£ $a$ï¼Œå¹¶åŒ…å«é”™è¯¯å¤„ç†å’ŒåŒºé—´è°ƒæ•´ï¼Œç¡®ä¿æ±‚è§£è¿‡ç¨‹ç¨³å®šå¯é ã€‚

**6.ä¸»ç¨‹åºï¼šæ±‚è§£ä¸åŒ $k$ ä¸‹çš„ $a$ å€¼**

```{r, eval=TRUE}
# å®šä¹‰è¦è®¡ç®—çš„ k å€¼
k_values <- c(4:25, 100, 500, 1000)

# åˆå§‹åŒ–ç»“æœå‘é‡
a_values <- numeric(length(k_values))

# å¾ªç¯è®¡ç®—æ¯ä¸ª k å¯¹åº”çš„ a
for (i in seq_along(k_values)) {
  k <- k_values[i]
  # æ¸…ç†ä¸å¿…è¦çš„å˜é‡
  gc()
  # æ±‚è§£ a
  a_values[i] <- solve_a(k)
  cat("å¯¹äº k =", k, "ï¼Œæ±‚å¾—çš„ a =", a_values[i], "\n")
}

# å°†ç»“æœæ•´ç†ä¸ºæ•°æ®æ¡†
results <- data.frame(k = k_values, a = a_values)
```

åœ¨ä¸»ç¨‹åºä¸­ï¼Œæˆ‘ä»¬éå†æŒ‡å®šçš„ $k$ å€¼ï¼Œè°ƒç”¨ `solve_a()` å‡½æ•°æ±‚è§£å¯¹åº”çš„ $a$ å€¼ï¼Œå¹¶å°†ç»“æœä¿å­˜ã€‚

**7.ç»˜åˆ¶ $a$ ä¸ $k$ çš„å…³ç³»å›¾**

```{r, eval=TRUE}
# ç»˜åˆ¶ a ä¸ k çš„å…³ç³»å›¾
p1<-ggplot(results, aes(x = k, y = a)) +
  geom_line(color = "blue", linewidth = 0.8) +  # è°ƒèŠ‚çº¿æ¡å®½åº¦
  geom_point(color = "red", size = 2, shape = 21, fill = "white", stroke = 1.2) +  # å¢åŠ ç‚¹çš„å¤§å°ï¼Œä½¿ç”¨ç™½è‰²å¡«å……
  labs(
    title = "ä¸åŒè‡ªç”±åº¦ä¸‹çš„ a å€¼",
    x = "è‡ªç”±åº¦ k",
    y = "å‚æ•° a"
  ) +
  theme_minimal(base_size = 14) +  # è®¾ç½®æ•´ä½“å­—ä½“å¤§å°
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 16),  # æ ‡é¢˜å±…ä¸­ï¼ŒåŠ ç²—
    axis.title = element_text(face = "bold", size = 14),  # åæ ‡è½´æ ‡é¢˜åŠ ç²—
    axis.text = element_text(color = "black", size = 12),  # åæ ‡è½´åˆ»åº¦æ–‡å­—é¢œè‰²å’Œå¤§å°
    panel.grid.major = element_line(color = "gray80"),  # è®¾ç½®ç½‘æ ¼çº¿é¢œè‰²
    panel.grid.minor = element_blank()  # éšè—æ¬¡è¦ç½‘æ ¼çº¿
  )

# æ‰“å°å›¾åƒ
print(p1)

```

ä½¿ç”¨ `ggplot2` ç»˜åˆ¶å‚æ•° $a$ ä¸è‡ªç”±åº¦ $k$ çš„å…³ç³»å›¾ï¼Œç›´è§‚å±•ç¤ºç»“æœã€‚

**8.ç»˜åˆ¶ç›®æ ‡å‡½æ•° $f(a)$ æ›²çº¿ï¼ˆä»¥ $k = 10$ ä¸ºä¾‹ï¼‰**

```{r, eval=TRUE}
# é€‰æ‹©ä¸€ä¸ª k å€¼ï¼Œä¾‹å¦‚ k = 10
k_example <- 10

# å®šä¹‰ a çš„å–å€¼èŒƒå›´
a_seq <- seq(0.01, sqrt(k_example) - 0.01, length.out = 1000)

# è®¡ç®—å¯¹åº”çš„ f(a) å€¼
f_values <- sapply(a_seq, f_a, k = k_example)

# åˆ›å»ºæ•°æ®æ¡†
df_fa <- data.frame(a = a_seq, f_a = f_values)

# ç»˜åˆ¶ f(a) æ›²çº¿
p2<-ggplot(df_fa, aes(x = a, y = f_a)) +
  geom_line(color = "purple", linewidth = 0.5) +  # è°ƒèŠ‚çº¿æ¡ç²—ç»†å¹¶è°ƒæ•´é¢œè‰²
  geom_hline(yintercept = 0, linetype = "dashed", color = "blue", linewidth = 0.4) +  # ä¿®æ”¹æ°´å¹³çº¿æ ·å¼
  labs(
    title = paste0("ç›®æ ‡å‡½æ•° f(a) éš a å˜åŒ–çš„æ›²çº¿ (k = ", k_example, ")"),
    x = "a å€¼", 
    y = expression(f(a))
  ) +
  theme_minimal(base_size = 14) +  # è®¾ç½®åŸºæœ¬å­—ä½“å¤§å°
  theme(
    plot.title = element_text(size = 18, face = "bold", hjust = 0.5),  # è®¾ç½®æ ‡é¢˜å¤§å°ã€ç²—ä½“ã€å±…ä¸­
    axis.title.x = element_text(size = 14, margin = margin(t = 10)),  # è®¾ç½®xè½´æ ‡é¢˜å¤§å°å¹¶å¢åŠ é¡¶éƒ¨è¾¹è·
    axis.title.y = element_text(size = 14, margin = margin(r = 10)),  # è®¾ç½®yè½´æ ‡é¢˜å¤§å°å¹¶å¢åŠ å³ä¾§è¾¹è·
    axis.text = element_text(size = 12),  # è®¾ç½®è½´åˆ»åº¦æ ‡ç­¾å­—ä½“å¤§å°
    panel.grid.major = element_line(color = "grey80", linetype = "dotted"),  # ä½¿ç”¨æµ…ç°è‰²ç½‘æ ¼çº¿
    panel.grid.minor = element_blank()  # ç§»é™¤æ¬¡è¦ç½‘æ ¼çº¿
  )

# æ‰“å°å›¾åƒ
print(p2)

```

ç»˜åˆ¶ç›®æ ‡å‡½æ•° $f(a)$ éš $a$ çš„å˜åŒ–æ›²çº¿ï¼Œè§‚å¯Ÿé›¶ç‚¹ä½ç½®ï¼ŒéªŒè¯æ±‚è§£çš„æ­£ç¡®æ€§ã€‚


### ç»“æœåˆ†æ

**1. æ±‚è§£ç»“æœ**

è¿è¡Œä¸Šè¿°ä»£ç ï¼Œå¯å¾—åˆ°ä¸åŒè‡ªç”±åº¦ $k$ ä¸‹å¯¹åº”çš„å‚æ•° $a$ å€¼ï¼Œå…·ä½“ç»“æœå¦‚ä¸‹ï¼š

```r
å¯¹äº k = 4 ï¼Œæ±‚å¾—çš„ a = 1.492103 
å¯¹äº k = 5 ï¼Œæ±‚å¾—çš„ a = 1.533559 
å¯¹äº k = 6 ï¼Œæ±‚å¾—çš„ a = 1.562745 
å¯¹äº k = 7 ï¼Œæ±‚å¾—çš„ a = 1.584429 
å¯¹äº k = 8 ï¼Œæ±‚å¾—çš„ a = 1.601182 
å¯¹äº k = 9 ï¼Œæ±‚å¾—çš„ a = 1.614516 
å¯¹äº k = 10 ï¼Œæ±‚å¾—çš„ a = 1.625383 
å¯¹äº k = 11 ï¼Œæ±‚å¾—çš„ a = 1.634409 
å¯¹äº k = 12 ï¼Œæ±‚å¾—çš„ a = 1.642026 
å¯¹äº k = 13 ï¼Œæ±‚å¾—çš„ a = 1.64854 
å¯¹äº k = 14 ï¼Œæ±‚å¾—çš„ a = 1.654174 
å¯¹äº k = 15 ï¼Œæ±‚å¾—çš„ a = 1.659096 
å¯¹äº k = 16 ï¼Œæ±‚å¾—çš„ a = 1.663433 
å¯¹äº k = 17 ï¼Œæ±‚å¾—çš„ a = 1.667283 
å¯¹äº k = 18 ï¼Œæ±‚å¾—çš„ a = 1.670724 
å¯¹äº k = 19 ï¼Œæ±‚å¾—çš„ a = 1.673817 
å¯¹äº k = 20 ï¼Œæ±‚å¾—çš„ a = 1.676614 
å¯¹äº k = 21 ï¼Œæ±‚å¾—çš„ a = 1.679154 
å¯¹äº k = 22 ï¼Œæ±‚å¾—çš„ a = 1.681471 
å¯¹äº k = 23 ï¼Œæ±‚å¾—çš„ a = 1.683594 
å¯¹äº k = 24 ï¼Œæ±‚å¾—çš„ a = 1.685546 
å¯¹äº k = 25 ï¼Œæ±‚å¾—çš„ a = 1.687347 
å¯¹äº k = 100 ï¼Œæ±‚å¾—çš„ a = 1.720599 
å¯¹äº k = 500 ï¼Œæ±‚å¾—çš„ a = 1.729745 
å¯¹äº k = 1000 ï¼Œæ±‚å¾—çš„ a = 1.730897 
```

**2. å›¾å½¢åˆ†æ**

**2.1. å‚æ•° $a$ ä¸è‡ªç”±åº¦ $k$ çš„å…³ç³»å›¾**

ä½¿ç”¨ `ggplot2` ç»˜åˆ¶äº†å‚æ•° $a$ éšè‡ªç”±åº¦ $k$ çš„å˜åŒ–æ›²çº¿ï¼š

```{r, eval=TRUE}
# æ‰“å°å…³ç³»å›¾
print(p1)
```

**åˆ†æï¼š**

- **è¶‹åŠ¿è§‚å¯Ÿï¼š** ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå‚æ•° $a$ éšç€è‡ªç”±åº¦ $k$ çš„å¢åŠ è€Œå¢å¤§ï¼Œä½†å¢å¹…é€æ¸å‡å°ï¼Œæ›²çº¿å‘ˆç°å‡ºé€’å¢ä¸”é€æ¸è¶‹äºå¹³ç¼“çš„è¶‹åŠ¿ã€‚
- **æé™å€¼åˆ†æï¼š** å½“ $k$ å¾ˆå¤§æ—¶ï¼Œå‚æ•° $a$ çš„å€¼è¶‹è¿‘äºæŸä¸ªæé™å€¼ã€‚è§‚å¯Ÿç»“æœå¯è§ï¼Œå½“ $k = 1000$ æ—¶ï¼Œ$a \approx 1.73$ã€‚
- **ä¸ç†è®ºå€¼æ¯”è¾ƒï¼š** ç”±äº $t$ åˆ†å¸ƒåœ¨è‡ªç”±åº¦è¶‹äºæ— ç©·å¤§æ—¶è¶‹è¿‘äºæ ‡å‡†æ­£æ€åˆ†å¸ƒï¼Œå› æ­¤å¯ä»¥çŒœæµ‹ $a$ çš„æé™å€¼å¯èƒ½ä¸æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„ä¸´ç•Œå€¼æœ‰å…³ã€‚

**2.2. ç›®æ ‡å‡½æ•° $f(a)$ æ›²çº¿ï¼ˆä»¥ $k = 10$ ä¸ºä¾‹ï¼‰**

ç»˜åˆ¶äº†å½“ $k = 10$ æ—¶ï¼Œç›®æ ‡å‡½æ•° $f(a)$ éš $a$ å˜åŒ–çš„æ›²çº¿ï¼š

```{r, eval=TRUE}
# æ‰“å°K=10æ—¶çš„æ›²çº¿
print(p2)
```

**åˆ†æï¼š**

- **é›¶ç‚¹ä½ç½®ï¼š** æ›²çº¿åœ¨ $a \approx 1.6$ é™„è¿‘ç©¿è¿‡æ¨ªè½´ï¼Œå¯¹åº”äºæ±‚è§£å¾—åˆ°çš„ $a$ å€¼ $a = 1.625383$ã€‚
- **å‡½æ•°ç‰¹æ€§ï¼š** ç›®æ ‡å‡½æ•° $f(a)$ åœ¨é›¶ç‚¹é™„è¿‘è¿ç»­ä¸”å•è°ƒï¼Œé€šè¿‡é›¶ç‚¹æ—¶ä»è´Ÿå€¼å˜ä¸ºæ­£å€¼ï¼Œæ»¡è¶³ä½¿ç”¨ `uniroot()` æ±‚è§£çš„æ¡ä»¶ã€‚
- **æ•°å€¼ç¨³å®šæ€§ï¼š** æ›²çº¿å¹³æ»‘ï¼Œæ²¡æœ‰å‡ºç°æ•°å€¼å¼‚å¸¸çš„æƒ…å†µï¼Œè¯´æ˜åœ¨è®¡ç®—è¿‡ç¨‹ä¸­æœ‰æ•ˆåœ°é¿å…äº†æ•°å€¼ä¸‹æº¢æˆ–ä¸Šæº¢çš„é—®é¢˜ã€‚

**3. æ•°å€¼ç¨³å®šæ€§ä¸ç²¾åº¦**

**3.1. é¿å…æ•°å€¼ä¸‹æº¢æˆ–ä¸Šæº¢**

- **ç›´æ¥è®¡ç®—çš„é£é™©ï¼š** åœ¨è®¡ç®— $t$ åˆ†å¸ƒçš„ç”Ÿå­˜å‡½æ•°æ—¶ï¼Œè‹¥ç›´æ¥è®¡ç®—æå°çš„æ¦‚ç‡å€¼ï¼ˆä¾‹å¦‚ $10^{-20}$ï¼‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°å€¼ä¸‹æº¢ï¼Œç»“æœä¸ºé›¶ï¼Œå½±å“è®¡ç®—çš„å‡†ç¡®æ€§ã€‚
- **å¯¹æ•°æ¦‚ç‡çš„ä¼˜åŠ¿ï¼š** é€šè¿‡è®¡ç®—å¯¹æ•°ç”Ÿå­˜å‡½æ•°ï¼ˆå³ä½¿ç”¨ `log.p = TRUE` å‚æ•°ï¼‰ï¼Œæˆ‘å°†æ¦‚ç‡å€¼è½¬æ¢ä¸ºå¯¹æ•°ç©ºé—´ã€‚ä¾‹å¦‚ï¼Œæ¦‚ç‡ $P = 10^{-20}$ å¯¹åº”çš„å¯¹æ•°æ¦‚ç‡ä¸º $\ln P = -46.05$ï¼Œé¿å…äº†ä¸‹æº¢é—®é¢˜ã€‚
- **æ•°å€¼ç¨³å®šæ€§æå‡ï¼š** ä½¿ç”¨å¯¹æ•°æ¦‚ç‡ï¼Œä¸ä»…é¿å…äº†ä¸‹æº¢ï¼Œè¿˜æé«˜äº†è®¡ç®—çš„ç¨³å®šæ€§å’Œç²¾åº¦ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¦‚ç‡å€¼æå°æ—¶ã€‚

**3.2. è®¡ç®—ç²¾åº¦éªŒè¯**

- **æ±‚è§£ç²¾åº¦ï¼š** åœ¨ `uniroot()` å‡½æ•°ä¸­ï¼Œè®¾ç½®äº†è¾ƒå°çš„å®¹å·® `tol = 1e-8`ï¼Œç¡®ä¿æ±‚è§£ç»“æœçš„é«˜ç²¾åº¦ã€‚
- **ç»“æœä¸€è‡´æ€§ï¼š** é€šè¿‡æ¯”è¾ƒä¸åŒ $k$ å€¼ä¸‹çš„ç»“æœï¼Œå¯ä»¥å‘ç°ç»“æœå…·æœ‰ä¸€è‡´æ€§ï¼Œä¸”ç¬¦åˆé¢„æœŸçš„å¢é•¿è¶‹åŠ¿ã€‚

**4. ä¸ç»ƒä¹  11.4 çš„æ¯”è¾ƒ**

**4.1. ç†è®ºè”ç³»**

åœ¨ç»ƒä¹  11.4 ä¸­ï¼Œéœ€è¦æ‰¾åˆ°æ›²çº¿ $S_{k-1}(a)$ å’Œ $S_k(a)$ åœ¨åŒºé—´ $(0, \sqrt{k})$ å†…çš„äº¤ç‚¹ $A(k)$ï¼Œå…¶ä¸­ï¼š

- $S_{k-1}(a) = P\left( t_{k-1} > \sqrt{\dfrac{a^2(k - 1)}{k - a^2}} \right)$
- $S_k(a) = P\left( t_k > \sqrt{\dfrac{a^2 k}{k + 1 - a^2}} \right)$

è¿™äº›äº¤ç‚¹ $A(k)$ ç¡®å®šäº† SzÃ©kely æå‡ºçš„ç”¨äºå°ºåº¦æ··åˆè¯¯å·®çš„ $t$ æ£€éªŒçš„ä¸´ç•Œå€¼ã€‚

**4.2. æ•°å­¦æ¨å¯¼**

åœ¨ç»ƒä¹  11.5 ä¸­ï¼Œæ±‚è§£å‡ºçš„æ–¹ç¨‹å®é™…ä¸Šç­‰ä»·äºï¼š

$$
P\left( t_{k-1} > c_{k-1} \right) = P\left( t_k > c_k \right)
$$

å…¶ä¸­ï¼š

- $c_{k-1} = \sqrt{\dfrac{a^2(k - 1)}{k - a^2}}$
- $c_k = \sqrt{\dfrac{a^2 k}{k + 1 - a^2}}$

è¿™æ­£æ˜¯ç»ƒä¹  11.4 ä¸­ä¸¤æ¡æ›²çº¿ $S_{k-1}(a)$ å’Œ $S_k(a)$ ç›¸ç­‰çš„æ¡ä»¶ï¼Œå³ä¸¤æ¡æ›²çº¿çš„äº¤ç‚¹ã€‚

**4.3. æ•°å€¼ç»“æœæ¯”è¾ƒ**

- **ä¸€è‡´æ€§éªŒè¯ï¼š** åœ¨ç»ƒä¹  11.5 ä¸­æ±‚å¾—çš„å‚æ•° $a$ å€¼ï¼Œæ­£æ˜¯ç»ƒä¹  11.4 ä¸­æ›²çº¿äº¤ç‚¹ $A(k)$ å¯¹åº”çš„ $a$ å€¼ã€‚
- **è¶‹åŠ¿åˆ†æï¼š** ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œéšç€ $k$ çš„å¢åŠ ï¼Œäº¤ç‚¹ $A(k)$ å¯¹åº”çš„ $a$ å€¼é€æ¸å¢å¤§ï¼Œä½†å¢å¹…é€æ¸å‡å°ï¼Œè¶‹äºç¨³å®šã€‚è¿™ä¸ $t$ åˆ†å¸ƒåœ¨è‡ªç”±åº¦å¢åŠ æ—¶çš„ç‰¹æ€§ä¸€è‡´ã€‚

**4.4. å›¾å½¢éªŒè¯**

ä¸ºæ›´ç›´è§‚åœ°æ¯”è¾ƒç»ƒä¹  11.4 å’Œ 11.5 çš„ç»“æœï¼Œå¯ä»¥ç»˜åˆ¶ $S_{k-1}(a)$ å’Œ $S_k(a)$ æ›²çº¿ï¼Œå¹¶æ ‡æ³¨äº¤ç‚¹ä½ç½®ã€‚

**ç¤ºä¾‹ï¼ˆä»¥ $k = 10$ ä¸ºä¾‹ï¼‰ï¼š**

```{r, eval=TRUE}
# å®šä¹‰ a çš„å–å€¼èŒƒå›´
a_seq <- seq(0.01, sqrt(10) - 0.01, length.out = 1000)

# è®¡ç®—å¯¹åº”çš„ c_{k-1} å’Œ c_k
c_k_minus1_vals <- sqrt(a_seq^2 * (10 - 1) / (10 - a_seq^2))
c_k_vals <- sqrt(a_seq^2 * 10 / (10 + 1 - a_seq^2))

# è®¡ç®—ç”Ÿå­˜å‡½æ•°å€¼
S_k_minus1 <- pt(c_k_minus1_vals, df = 9, lower.tail = FALSE)
S_k <- pt(c_k_vals, df = 10, lower.tail = FALSE)

# åˆ›å»ºæ•°æ®æ¡†
df_compare <- data.frame(a = a_seq, S_k_minus1 = S_k_minus1, S_k = S_k)

# ç»˜åˆ¶æ›²çº¿

p3<-ggplot(df_compare, aes(x = a)) +
  geom_line(aes(y = S_k_minus1), color = "blue", linewidth = 1, linetype = "dashed") + # è°ƒæ•´çº¿å®½å’Œé¢œè‰²
  geom_line(aes(y = S_k), color = "red", linewidth = 0.5) + # è°ƒæ•´çº¿å®½å’Œé¢œè‰²
  labs(
    title = expression(Scriptstyle("S"["k-1"](a)~å’Œ~S["k"](a)~æ›²çº¿~(k==10))),
    x = "a å€¼", 
    y = "ç”Ÿå­˜å‡½æ•°å€¼"
  ) +
  theme_minimal(base_size = 14) +  # è®¾ç½®åŸºæœ¬å­—ä½“å¤§å°
  theme(
    plot.title = element_text(size = 18, face = "bold", hjust = 0.5), # å±…ä¸­åŠ ç²—æ ‡é¢˜
    axis.title.x = element_text(size = 14, margin = margin(t = 10)),  # è®¾ç½®xè½´æ ‡é¢˜å¤§å°å¹¶å¢åŠ é¡¶éƒ¨è¾¹è·
    axis.title.y = element_text(size = 14, margin = margin(r = 10)),  # è®¾ç½®yè½´æ ‡é¢˜å¤§å°å¹¶å¢åŠ å³ä¾§è¾¹è·
    axis.text = element_text(size = 12),  # è®¾ç½®è½´åˆ»åº¦æ ‡ç­¾å­—ä½“å¤§å°
    panel.grid.major = element_line(color = "grey80", linetype = "dotted"),  # ä½¿ç”¨æµ…ç°è‰²ç½‘æ ¼çº¿
    panel.grid.minor = element_blank()  # ç§»é™¤æ¬¡è¦ç½‘æ ¼çº¿
  ) +
  # æ·»åŠ æ³¨é‡Šç‚¹å’Œæ–‡å­—
  annotate("point", x = 1.625383, y = S_k[which.min(abs(a_seq - 1.625383))],
           color = "green", size = 2) +
  annotate("text", x = 1.65, y = S_k[which.min(abs(a_seq - 1.625383))],
           label = "äº¤ç‚¹ A(k=10)", color = "green", hjust = 0, size = 3)

# æ‰“å°å›¾åƒ
print(p3)
```

**åˆ†æï¼š**

- **æ›²çº¿äº¤ç‚¹ï¼š** å›¾ä¸­è“è‰²è™šçº¿ä¸º $S_{k-1}(a)$ï¼Œçº¢è‰²å®çº¿ä¸º $S_k(a)$ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°è“è‰²è™šçº¿å’Œçº¢è‰²å®çº¿å‡ ä¹å®Œå…¨é‡åˆã€‚ç»¿è‰²ç‚¹æ ‡æ³¨äº†ä¸¤æ¡æ›²çº¿çš„äº¤ç‚¹ $A(10)$ï¼Œå¯¹åº”çš„ $a = 1.625383$ï¼Œè¿™ä¸ªå€¼åœ¨ä»£ç `a_seq - 1.625383`å¯ä»¥ä½“ç°ã€‚
- **éªŒè¯ç»“æœï¼š** äº¤ç‚¹çš„ $a$ å€¼ä¸ç»ƒä¹  11.5 ä¸­æ±‚å¾—çš„ç»“æœå®Œå…¨ä¸€è‡´ï¼ŒéªŒè¯äº†ä¸¤è€…çš„ç­‰ä»·æ€§ã€‚

**4.5. ç»Ÿè®¡æ„ä¹‰**

- **ä¸´ç•Œå€¼çš„ç¡®å®šï¼š** äº¤ç‚¹ $A(k)$ å¯¹åº”çš„å‚æ•° $a$ å€¼ï¼Œç¡®å®šäº† $t$ æ£€éªŒåœ¨å°ºåº¦æ··åˆè¯¯å·®æ¨¡å‹ä¸‹çš„ä¸´ç•Œå€¼ã€‚
- **è¯¯å·®æ§åˆ¶ï¼š** é€šè¿‡ç¡®ä¿ä¸¤ä¸ªç”Ÿå­˜å‡½æ•°å€¼ç›¸ç­‰ï¼Œå¯ä»¥åœ¨ç»™å®šçš„è‡ªç”±åº¦ $k$ ä¸‹ï¼Œæ‰¾åˆ°ä½¿å¾—æ£€éªŒç»Ÿè®¡é‡åœ¨ä¸åŒæ ·æœ¬å®¹é‡ä¸‹å…·æœ‰ç›¸åŒæ˜¾è‘—æ€§æ°´å¹³çš„ä¸´ç•Œå€¼ã€‚

**5. ç»“æœçš„ç»Ÿè®¡æ„ä¹‰**

**5.1. ä¸´ç•Œå€¼çš„åº”ç”¨**

- **t æ£€éªŒçš„ä¸´ç•Œå€¼ï¼š** æ±‚å¾—çš„å‚æ•° $a$ å€¼å¯¹åº”äº $t$ æ£€éªŒçš„ä¸´ç•Œå€¼ï¼Œå¯ç”¨äºç»Ÿè®¡æ£€éªŒä¸­ç¡®å®šæ‹’ç»åŸŸã€‚
- **å°ºåº¦æ··åˆè¯¯å·®æ¨¡å‹ï¼š** åœ¨å°ºåº¦æ··åˆè¯¯å·®æ¨¡å‹ä¸­ï¼Œè¿™äº›ä¸´ç•Œå€¼å¯¹äºæ­£ç¡®è¿›è¡Œå‡è®¾æ£€éªŒè‡³å…³é‡è¦ã€‚

**5.2. è‡ªç”±åº¦çš„å½±å“**

- **å°æ ·æœ¬æ•ˆåº”ï¼š** å½“è‡ªç”±åº¦ $k$ è¾ƒå°æ—¶ï¼ˆå¦‚ $k = 4$ï¼‰ï¼Œå‚æ•° $a$ çš„å€¼è¾ƒå°ï¼Œè¡¨ç¤ºåœ¨å°æ ·æœ¬æƒ…å†µä¸‹ï¼Œéœ€è¦æ›´ä¸¥æ ¼çš„æ ‡å‡†æ¥æ‹’ç»åŸå‡è®¾ã€‚
- **å¤§æ ·æœ¬æ•ˆåº”ï¼š** å½“è‡ªç”±åº¦ $k$ å¾ˆå¤§æ—¶ï¼Œå‚æ•° $a$ çš„å€¼è¶‹äºç¨³å®šï¼Œè¡¨æ˜æ ·æœ¬é‡å¯¹æ£€éªŒçš„å½±å“å‡å°ï¼Œç»“æœæ›´å¯é ã€‚

**6. æ•°å€¼æ–¹æ³•çš„å¯é æ€§**

**6.1. å‡½æ•°çš„å•è°ƒæ€§å’Œè¿ç»­æ€§**

- **ç›®æ ‡å‡½æ•°ç‰¹æ€§ï¼š** é€šè¿‡ç»˜åˆ¶ç›®æ ‡å‡½æ•° $f(a)$ çš„æ›²çº¿ï¼Œå¯ä»¥å‘ç°å‡½æ•°åœ¨æ±‚è§£åŒºé—´å†…æ˜¯è¿ç»­ä¸”å•è°ƒçš„ï¼Œè¿™ä¸ºä½¿ç”¨ `uniroot()` æä¾›äº†ä¿éšœã€‚
- **æ±‚è§£ç¨³å®šæ€§ï¼š** åœ¨æ•´ä¸ªè®¡ç®—è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰å‡ºç°æ— æ³•æ”¶æ•›æˆ–å‡½æ•°å¼‚å¸¸çš„æƒ…å†µï¼Œè¯´æ˜æ•°å€¼æ–¹æ³•çš„é€‰æ‹©æ˜¯åˆç†çš„ã€‚

**6.2. é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æƒ…å†µ**

- **è¾¹ç•Œæ£€æŸ¥ï¼š** åœ¨å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯¹å‚æ•° $a$ å’Œè®¡ç®—ç»“æœè¿›è¡Œäº†æœ‰æ•ˆçš„æ£€æŸ¥ï¼Œé¿å…äº†æ— æ•ˆè®¡ç®—ï¼ˆå¦‚åˆ†æ¯ä¸ºé›¶ã€è´Ÿæ•°å¼€æ–¹ç­‰ï¼‰ã€‚
- **é”™è¯¯æ•è·ï¼š** ä½¿ç”¨ `tryCatch()` ç­‰æœºåˆ¶ï¼Œæ•è·å¯èƒ½çš„é”™è¯¯å¹¶è¿”å› `NA`ï¼Œæé«˜äº†ç¨‹åºçš„å¥å£®æ€§ã€‚

**7. ç¨‹åºè§„èŒƒä¸ä¼˜åŒ–**

**7.1. å‡½æ•°å°è£…å’Œæ¨¡å—åŒ–**

- **ä»£ç ç»“æ„æ¸…æ™°ï¼š** æœ¬é¢˜è§£ç­”æ—¶å°†è®¡ç®—è¿‡ç¨‹å°è£…åˆ°å¤šä¸ªç‹¬ç«‹çš„å‡½æ•°ä¸­ï¼Œå¦‚ `calc_c_k_minus1`ã€`log_survival_t`ã€`f_a` ç­‰ï¼Œä¾¿äºä»£ç çš„é˜…è¯»å’Œç»´æŠ¤ã€‚
- **å¤ç”¨æ€§å¼ºï¼š** æ¨¡å—åŒ–çš„è®¾è®¡ä½¿å¾—å‡½æ•°å¯ä»¥åœ¨å…¶ä»–åœºæ™¯ä¸‹å¤ç”¨ï¼Œæé«˜äº†ä»£ç çš„å¯æ‰©å±•æ€§ã€‚

**7.2. å†…å­˜ç®¡ç†**

- **åŠæ—¶é‡Šæ”¾å†…å­˜ï¼š** åœ¨å¾ªç¯ä¸­è°ƒç”¨ `gc()`ï¼ŒåŠæ—¶é‡Šæ”¾å†…å­˜ï¼Œé¿å…äº†å†…å­˜æ³„æ¼ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ï¼Œè¿™ä¸€ç‚¹å°¤ä¸ºé‡è¦ã€‚
- **å˜é‡æ¸…ç†ï¼š** åœ¨ç¨‹åºç»“æŸæ—¶ï¼Œæ¸…é™¤æ‰€æœ‰å˜é‡ï¼Œä¿æŒå·¥ä½œç©ºé—´çš„æ•´æ´ã€‚

**7.3. ç¼–ç¨‹è§„èŒƒ**

- **æ³¨é‡Šè¯¦ç»†ï¼š** ä»£ç ä¸­æ·»åŠ äº†è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼Œä¾¿äºä»–äººç†è§£ä»£ç çš„é€»è¾‘å’ŒåŠŸèƒ½ã€‚
- **å‚æ•°æ£€æŸ¥ï¼š** åœ¨å‡½æ•°ä¸­å¯¹è¾“å…¥å‚æ•°è¿›è¡Œäº†æœ‰æ•ˆçš„æ£€æŸ¥ï¼Œé¿å…äº†æ— æ•ˆè¾“å…¥å¯¼è‡´çš„é”™è¯¯ã€‚

**8. è¿›ä¸€æ­¥çš„ç ”ç©¶æ–¹å‘**

**8.1. ç†è®ºéªŒè¯**

- **æé™åˆ†æï¼š** å¯ä»¥è¿›ä¸€æ­¥ç ”ç©¶å½“ $k \rightarrow \infty$ æ—¶ï¼Œå‚æ•° $a$ çš„æé™å€¼ï¼Œä¸æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„ä¸´ç•Œå€¼è¿›è¡Œæ¯”è¾ƒï¼ŒéªŒè¯ç†è®ºä¸Šçš„ä¸€è‡´æ€§ã€‚
- **ç²¾ç¡®åº¦æå‡ï¼š** å°è¯•ä½¿ç”¨æ›´é«˜ç²¾åº¦çš„æ•°å€¼æ–¹æ³•ï¼Œå¦‚è‡ªé€‚åº”æ±‚è§£ç®—æ³•ï¼Œæé«˜æ±‚è§£çš„ç²¾ç¡®åº¦ã€‚

**8.2. åº”ç”¨æ‰©å±•**

- **å…¶ä»–åˆ†å¸ƒçš„æ¨å¹¿ï¼š** è€ƒè™‘å°†æ–¹æ³•æ¨å¹¿åˆ°å…¶ä»–åˆ†å¸ƒï¼Œå¦‚ F åˆ†å¸ƒã€å¡æ–¹åˆ†å¸ƒç­‰ï¼Œç ”ç©¶å¯¹åº”çš„å‚æ•°æ±‚è§£é—®é¢˜ã€‚
- **å®é™…æ•°æ®éªŒè¯ï¼š** ä½¿ç”¨å®é™…çš„ç»Ÿè®¡æ•°æ®ï¼Œåº”ç”¨æ±‚å¾—çš„ä¸´ç•Œå€¼ï¼ŒéªŒè¯å…¶åœ¨ç»Ÿè®¡æ£€éªŒä¸­çš„æœ‰æ•ˆæ€§ã€‚


------------------------------------------------------------------------


## é—®é¢˜2

### é¢˜ç›®æè¿°

å‡è®¾ $T_1, T_2, \dots, T_n$ æ˜¯ä»æŒ‡æ•°åˆ†å¸ƒ $\text{Exp}(\lambda)$ ä¸­ç‹¬ç«‹åŒåˆ†å¸ƒæŠ½æ ·å¾—åˆ°çš„æ ·æœ¬ï¼ŒæœŸæœ›ä¸º $\lambda$ã€‚ç”±äºå­˜åœ¨å³åˆ å¤±ï¼Œå³å½“ $T_i > \tau$ æ—¶ï¼Œæˆ‘ä»¬æ— æ³•è§‚å¯Ÿåˆ°çœŸå®å€¼ï¼Œä»…çŸ¥é“å…¶è¶…è¿‡äº†é˜ˆå€¼ $\tau$ã€‚å› æ­¤ï¼Œè§‚æµ‹åˆ°çš„æ•°æ®ä¸ºï¼š

$$
Y_i = T_i \cdot I(T_i \leq \tau) + \tau \cdot I(T_i > \tau), \quad i = 1,2,\dots,n
$$
å…¶ä¸­ $I(\cdot)$ ä¸ºæŒ‡ç¤ºå‡½æ•°ã€‚ç»™å®š $\tau = 1$ï¼Œè§‚æµ‹åˆ°çš„ $Y_i$ å€¼å¦‚ä¸‹ï¼š

$$
0.54,\quad 0.48,\quad 0.33,\quad 0.43,\quad 1.00,\quad 1.00,\quad 0.91,\quad 1.00,\quad 0.21,\quad 0.85
$$
è¦æ±‚ä½¿ç”¨ **E-M ç®—æ³•** æ¥ä¼°è®¡ $\lambda$ï¼Œå¹¶å°†ç»“æœä¸è§‚æµ‹æ•°æ®çš„æå¤§ä¼¼ç„¶ä¼°è®¡ï¼ˆMLEï¼‰è¿›è¡Œæ¯”è¾ƒï¼ˆæ³¨æ„ï¼š$Y_i$ æœä»ä¸€ä¸ªæ··åˆåˆ†å¸ƒï¼‰ã€‚

### è§£ç­”æ€è·¯

**1. é—®é¢˜åˆ†æ**

- **å³åˆ å¤±æ•°æ®**ï¼šç”±äºéƒ¨åˆ†æ•°æ® $T_i$ è¢«å³åˆ å¤±ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥è§‚æµ‹åˆ°æ‰€æœ‰çš„ $T_i$ å€¼ï¼Œå¯¼è‡´å‚æ•°ä¼°è®¡çš„å¤æ‚æ€§å¢åŠ ã€‚
- **ç›®æ ‡**ï¼šåœ¨å­˜åœ¨åˆ å¤±æ•°æ®çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ E-M ç®—æ³•ä¼°è®¡æŒ‡æ•°åˆ†å¸ƒçš„å‚æ•° $\lambda$ã€‚
- **æŒ‘æˆ˜**ï¼šç›´æ¥è®¡ç®—å¯èƒ½å¯¼è‡´æ•°å€¼ä¸‹æº¢æˆ–ä¸Šæº¢ï¼Œéœ€è¦åœ¨è®¡ç®—ä¸­æ³¨æ„æ•°å€¼ç¨³å®šæ€§ã€‚

**2. æ¨¡å‹å»ºç«‹**

- **æŒ‡æ•°åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°**ï¼š

  $$
  f(t; \lambda) = \frac{1}{\lambda} e^{-t / \lambda}, \quad t \geq 0
  $$

- **åˆ å¤±æŒ‡ç¤ºå˜é‡**ï¼š
  $$
  \delta_i = I(T_i \leq \tau) = \begin{cases}
  1, & \text{æœªåˆ å¤±æ•°æ®ï¼ˆå¯è§‚æµ‹çš„å®Œæ•´æ•°æ®ï¼‰} \\
  0, & \text{åˆ å¤±æ•°æ®ï¼ˆä»…çŸ¥é“ \( T_i > \tau \)ï¼‰}
  \end{cases}
  $$

- **å®Œå…¨æ•°æ®çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°**ï¼š

  $$
  \ell(\lambda) = -n \ln \lambda - \frac{1}{\lambda} \sum_{i=1}^n T_i
  $$
  ç”±äºå­˜åœ¨åˆ å¤±æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æœªè§‚æµ‹åˆ°çš„ $T_i$ è¿›è¡Œä¼°è®¡ã€‚

**3. E-M ç®—æ³•æ­¥éª¤**

- **E æ­¥ï¼ˆæœŸæœ›æ­¥ï¼‰**ï¼š

  - å¯¹äºåˆ å¤±çš„æ•°æ®ï¼Œè®¡ç®—å…¶åœ¨å½“å‰å‚æ•° $\lambda^{(k)}$ ä¸‹çš„æ¡ä»¶æœŸæœ›ï¼š

    $$
    E[T_i \mid T_i > \tau, \lambda^{(k)}] = \tau + \lambda^{(k)}
    $$

  - å¯¹äºæœªåˆ å¤±çš„æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨è§‚æµ‹å€¼ $T_i = Y_i$ã€‚

- **M æ­¥ï¼ˆæœ€å¤§åŒ–æ­¥ï¼‰**ï¼š

  - åŸºäº E æ­¥å¾—åˆ°çš„æœŸæœ›ï¼Œæœ€å¤§åŒ–å®Œå…¨æ•°æ®çš„å¯¹æ•°ä¼¼ç„¶å‡½æ•°ï¼Œæ›´æ–° $\lambda$ï¼š

    $$
    \lambda^{(k+1)} = \frac{1}{n} \left( \sum_{\delta_i = 1} Y_i + \sum_{\delta_i = 0} E[T_i \mid T_i > \tau, \lambda^{(k)}] \right)
    $$

- **è¿­ä»£è¿‡ç¨‹**ï¼š

  - åˆå§‹åŒ– $\lambda^{(0)}$ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨æœªåˆ å¤±æ•°æ®çš„å‡å€¼ã€‚
  - é‡å¤æ‰§è¡Œ E æ­¥å’Œ M æ­¥ï¼Œç›´åˆ° $\lambda$ çš„ä¼°è®¡å€¼æ”¶æ•›ï¼Œå³ç›¸é‚»ä¸¤æ¬¡è¿­ä»£çš„å·®å¼‚å°äºè®¾å®šçš„é˜ˆå€¼ $\varepsilon$ã€‚

**4. æ•°å€¼è®¡ç®—æ³¨æ„äº‹é¡¹**

- **é¿å…æ•°å€¼ä¸‹æº¢æˆ–ä¸Šæº¢**ï¼š
  - ç”±äºæŒ‡æ•°å‡½æ•°çš„æ€§è´¨ï¼Œç›´æ¥è®¡ç®—å¯èƒ½å¯¼è‡´æ•°å€¼ä¸ç¨³å®šã€‚
  - åœ¨è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œå°½é‡ä½¿ç”¨å¯¹æ•°å½¢å¼æˆ–ç®€åŒ–å…¬å¼ï¼Œé¿å…è®¡ç®—æå°æˆ–æå¤§çš„æ•°å€¼ã€‚

**5. å®ç°æ­¥éª¤**

- **æ•°æ®å‡†å¤‡**ï¼š

  - å°†è§‚æµ‹æ•°æ® $Y_i$ æ ¹æ®åˆ å¤±æŒ‡ç¤ºå˜é‡ $\delta_i$ åˆ†ä¸ºæœªåˆ å¤±æ•°æ®å’Œåˆ å¤±æ•°æ®ã€‚
  - ç»Ÿè®¡æœªåˆ å¤±æ•°æ®çš„æ•°é‡ $n_{\text{uncensored}}$ å’Œåˆ å¤±æ•°æ®çš„æ•°é‡ $n_{\text{censored}}$ã€‚

- **åˆå§‹åŒ–å‚æ•°**ï¼š

  - è®¡ç®—æœªåˆ å¤±æ•°æ®çš„å‡å€¼ä½œä¸º $\lambda^{(0)}$ çš„åˆå§‹å€¼ã€‚

- **è¿­ä»£è®¡ç®—**ï¼š

  - **E æ­¥**ï¼š

    - å¯¹äºåˆ å¤±æ•°æ®ï¼Œè®¡ç®— $E[T_i \mid T_i > \tau, \lambda^{(k)}] = \tau + \lambda^{(k)}$ã€‚

  - **M æ­¥**ï¼š

    - æ›´æ–° $\lambda^{(k+1)}$ï¼š
    
      $$
      \lambda^{(k+1)} = \frac{1}{n} \left( \sum_{\delta_i = 1} Y_i + (n - n_{\text{uncensored}})(\tau + \lambda^{(k)}) \right)
      $$
  - **æ”¶æ•›åˆ¤æ–­**ï¼š

    - å¦‚æœ $|\lambda^{(k+1)} - \lambda^{(k)}| < \varepsilon$ï¼Œåˆ™è®¤ä¸ºç®—æ³•æ”¶æ•›ã€‚

- **ç»“æœæ¯”è¾ƒ**ï¼š

  - è®¡ç®—è§‚æµ‹æ•°æ®çš„æå¤§ä¼¼ç„¶ä¼°è®¡ï¼ˆMLEï¼‰ã€‚åœ¨å¤„ç†å³åˆ å¤±çš„æŒ‡æ•°åˆ†å¸ƒæ•°æ®æ—¶ï¼ŒMLEï¼ˆæå¤§ä¼¼ç„¶ä¼°è®¡ï¼‰çš„ $\lambda$ çš„ä¼°è®¡å…¬å¼åº”è¯¥æ˜¯ï¼š
    
    $$
    \hat{\lambda}_{\text{MLE}} = \frac{\sum_{i=1}^n \delta_i Y_i + \sum_{i=1}^n (1 - \delta_i) \tau}{\sum_{i=1}^n \delta_i}
    $$
    å…¶ä¸­ï¼š

    - $\delta_i = 1$ è¡¨ç¤ºæœªåˆ å¤±çš„æ•°æ®ï¼Œ$Y_i = T_i$ã€‚
    - $\delta_i = 0$ è¡¨ç¤ºåˆ å¤±çš„æ•°æ®ï¼Œ$Y_i = \tau$ã€‚

  - å°† E-M ç®—æ³•çš„ç»“æœä¸ MLE è¿›è¡Œæ¯”è¾ƒã€‚

**6. å¯è§†åŒ–åˆ†æ**

- **æ”¶æ•›æ›²çº¿**ï¼šç»˜åˆ¶ E-M ç®—æ³•ä¸­ $\lambda$ éšè¿­ä»£æ¬¡æ•°çš„å˜åŒ–æ›²çº¿ï¼Œè§‚å¯Ÿç®—æ³•çš„æ”¶æ•›æ€§ã€‚

- **æ•°æ®æ‹Ÿåˆå›¾**ï¼šç»˜åˆ¶è§‚æµ‹æ•°æ®çš„ç›´æ–¹å›¾ï¼Œå¹¶å åŠ åŸºäº E-M ç®—æ³•å’Œ MLE ä¼°è®¡çš„æŒ‡æ•°åˆ†å¸ƒå¯†åº¦å‡½æ•°ï¼Œç›´è§‚å±•ç¤ºæ‹Ÿåˆæ•ˆæœã€‚


### ä»£ç å®ç°

**1.æ¸…ç©ºç¯å¢ƒï¼Œè®¾ç½®ç§å­**

```{r, eval=TRUE}
rm(list = ls())  # æ¸…ç©ºç¯å¢ƒå˜é‡
set.seed(100)    # è®¾ç½®éšæœºç§å­ï¼Œä¿è¯ç»“æœå¯é‡å¤
```

**2.æ•°æ®å‡†å¤‡**

```{r, eval=TRUE}
# è§‚æµ‹æ•°æ®
Y <- c(0.54, 0.48, 0.33, 0.43, 1.00, 1.00, 0.91, 1.00, 0.21, 0.85)
n <- length(Y)   # æ ·æœ¬å®¹é‡
tau <- 1         # åˆ å¤±é˜ˆå€¼

# æŒ‡ç¤ºå‡½æ•°ï¼šæœªåˆ å¤±ï¼ˆdelta = 1ï¼‰ï¼Œåˆ å¤±ï¼ˆdelta = 0ï¼‰
delta <- ifelse(Y < tau, 1, 0)

# åˆ†åˆ«æå–æœªåˆ å¤±å’Œåˆ å¤±çš„æ•°æ®
Y_uncensored <- Y[delta == 1]  # æœªåˆ å¤±æ•°æ®
Y_censored <- Y[delta == 0]    # åˆ å¤±æ•°æ®

# ç»Ÿè®¡é‡
n_uncensored <- sum(delta)     # æœªåˆ å¤±æ•°æ®æ•°é‡
n_censored <- n - n_uncensored # åˆ å¤±æ•°æ®æ•°é‡
sum_uncensored <- sum(Y_uncensored)  # æœªåˆ å¤±æ•°æ®æ€»å’Œ
```

**3.EMç®—æ³•å‡½æ•°å®šä¹‰**

```{r, eval=TRUE}
EM_algorithm <- function(Y, delta, tau, tol = 1e-6, max_iter = 1000) {
  # è¾“å…¥å‚æ•°ï¼š
  # Yï¼šè§‚æµ‹æ•°æ®
  # deltaï¼šåˆ å¤±æŒ‡ç¤ºå˜é‡
  # tauï¼šåˆ å¤±é˜ˆå€¼
  # tolï¼šæ”¶æ•›é˜ˆå€¼
  # max_iterï¼šæœ€å¤§è¿­ä»£æ¬¡æ•°
  
  n <- length(Y)
  n_uncensored <- sum(delta)
  n_censored <- n - n_uncensored
  Y_uncensored <- Y[delta == 1]
  sum_uncensored <- sum(Y_uncensored)
  
  # åˆå§‹åŒ–lambdaï¼Œåˆå§‹å€¼ä¸ºæœªåˆ å¤±æ•°æ®çš„å‡å€¼
  lambda_old <- mean(Y_uncensored)
  
  # ä¿å­˜æ¯æ¬¡è¿­ä»£çš„lambdaå€¼
  lambda_values <- numeric()
  lambda_values[1] <- lambda_old
  
  # è¿­ä»£è¿‡ç¨‹
  for (iter in 1:max_iter) {
    # Eæ­¥ï¼šè®¡ç®—åˆ å¤±æ•°æ®çš„æ¡ä»¶æœŸæœ›
    E_T_censored <- tau + lambda_old  # E[T_i | T_i > tau, lambda]
    
    # Mæ­¥ï¼šæ›´æ–°lambda
    lambda_new <- (sum_uncensored + n_censored * E_T_censored) / n
    
    # ä¿å­˜å½“å‰çš„lambdaå€¼
    lambda_values[iter + 1] <- lambda_new
    
    # æ£€æŸ¥æ”¶æ•›æ¡ä»¶
    if (abs(lambda_new - lambda_old) < tol) {
      cat("ç®—æ³•åœ¨ç¬¬", iter, "æ¬¡è¿­ä»£åæ”¶æ•›ã€‚\n")
      break
    }
    
    # æ›´æ–°lambda_old
    lambda_old <- lambda_new
  }
  
  # å¦‚æœè¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ä»æœªæ”¶æ•›ï¼Œç»™å‡ºæç¤º
  if (iter == max_iter) {
    warning("è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œç®—æ³•æœªæ”¶æ•›ã€‚")
  }
  
  # è¿”å›ç»“æœ
  return(list(lambda_est = lambda_new, iterations = iter, lambda_values = lambda_values))
}
```

**4.è°ƒç”¨EMç®—æ³•**

```{r, eval=TRUE}
em_result <- EM_algorithm(Y, delta, tau)
print(em_result$lambda_est)
```

**5.è®¡ç®—MLEä¼°è®¡å€¼**

```{r, eval=TRUE}
# MLEä¼°è®¡çš„lambdaå€¼
lambda_MLE <- (sum(delta * Y) + sum((1 - delta) * tau)) / sum(delta)
print(lambda_MLE)
```

**6.ç»“æœè¾“å‡ºä¸ç»˜å›¾**

```{r, eval=TRUE}
# è¾“å‡ºEMç®—æ³•å’ŒMLEçš„ä¼°è®¡ç»“æœ
cat("EMç®—æ³•ä¼°è®¡çš„lambdaï¼š", em_result$lambda_est, "\n")
cat("MLEä¼°è®¡çš„lambdaï¼š", lambda_MLE, "\n")

# è®¾ç½®é¢œè‰²å’Œä¸»é¢˜é£æ ¼
library(ggplot2)

# ç»˜åˆ¶lambdaçš„æ”¶æ•›æ›²çº¿ï¼Œå¢åŠ ylimèŒƒå›´ç¡®ä¿MLEçº¿æ¡å¯è§
plot(0:(em_result$iterations), em_result$lambda_values, type = "o", 
     col = "dodgerblue", pch = 16, lwd = 2,
     xlab = "è¿­ä»£æ¬¡æ•°", ylab = expression(lambda), 
     main = "EMç®—æ³•ä¸­lambdaçš„æ”¶æ•›è¿‡ç¨‹",
     ylim = c(min(em_result$lambda_values) - 0.1, max(em_result$lambda_values) + 0.1), 
     cex.lab = 1.2, cex.main = 1.4)

# æ·»åŠ æ°´å¹³çº¿è¡¨ç¤ºMLEä¼°è®¡å€¼ï¼Œå¹¶è®¾ç½®ä¸ºæ˜æ˜¾é¢œè‰²
abline(h = lambda_MLE, col = "darkred", lty = 2, lwd = 3)

# æ·»åŠ æ–‡æœ¬æ ‡ç­¾æŒ‡ç¤ºMLEä¼°è®¡å€¼
text(x = em_result$iterations / 2, y = lambda_MLE, labels = paste("MLE:", round(lambda_MLE, 3)), 
     col = "darkred", pos = 4, cex = 1.1)

# å¢åŠ å›¾ä¾‹åˆ°ä¸­å¤®
legend("center", inset = -0.1, xpd = TRUE,  # è®¾ç½®å›¾ä¾‹åœ¨ä¸­å¤®
       legend = c("EMç®—æ³•ä¼°è®¡å€¼", "MLEä¼°è®¡å€¼"),
       col = c("dodgerblue", "darkred"), pch = c(16, NA), lty = c(1, 2), lwd = 2,
       bty = "n", cex = 1.1)


# ç»˜åˆ¶è§‚æµ‹æ•°æ®çš„ç›´æ–¹å›¾ä¸æ‹Ÿåˆçš„æŒ‡æ•°åˆ†å¸ƒå¯†åº¦å‡½æ•°
hist(Y, breaks = 5, probability = TRUE, xlim = c(0, tau + 2),
     main = "è§‚æµ‹æ•°æ®ç›´æ–¹å›¾ä¸æ‹Ÿåˆçš„æŒ‡æ•°åˆ†å¸ƒ",
     xlab = "Y", ylab = "æ¦‚ç‡å¯†åº¦", border = "white", col = "skyblue",
     cex.lab = 1.2, cex.main = 1.4)

# æ·»åŠ EMç®—æ³•æ‹Ÿåˆçš„æŒ‡æ•°åˆ†å¸ƒæ›²çº¿
curve(dexp(x, rate = 1 / em_result$lambda_est), from = 0, to = tau + 2,
      col = "dodgerblue", lwd = 2, add = TRUE)

# æ·»åŠ MLEæ‹Ÿåˆçš„æŒ‡æ•°åˆ†å¸ƒæ›²çº¿
curve(dexp(x, rate = 1 / lambda_MLE), from = 0, to = tau + 2,
      col = "tomato", lwd = 2, lty = 2, add = TRUE)

# æ·»åŠ å›¾ä¾‹åˆ°å³ä¸Šè§’
legend("topright", legend = c("EMç®—æ³•æ‹Ÿåˆ", "MLEæ‹Ÿåˆ"),
       col = c("dodgerblue", "tomato"), lty = c(1, 2), lwd = 2,
       bty = "n", cex = 1.1)

```

### ç»“æœåˆ†æ

**1. E-M ç®—æ³•ä¼°è®¡ç»“æœ**

- **æ”¶æ•›è¿‡ç¨‹**ï¼š

  - ä»ä»£ç è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼Œç®—æ³•åœ¨ç¬¬ 12 æ¬¡è¿­ä»£åæ”¶æ•›ï¼š

    ```r
    ç®—æ³•åœ¨ç¬¬ 12 æ¬¡è¿­ä»£åæ”¶æ•›ã€‚
    ```

  - è¿™è¡¨æ˜ E-M ç®—æ³•åœ¨æœ¬ä¾‹ä¸­å…·æœ‰è‰¯å¥½çš„æ”¶æ•›æ€§ã€‚

- **å‚æ•°ä¼°è®¡å€¼**ï¼š

  - E-M ç®—æ³•ä¼°è®¡çš„ $\lambda$ å€¼ä¸ºï¼š

    ```r
    EMç®—æ³•ä¼°è®¡çš„lambdaï¼š 0.9642855 
    ```

  - MLE ä¼°è®¡çš„ $\lambda$ å€¼ä¸ºï¼š

    ```r
    MLEä¼°è®¡çš„lambdaï¼š 0.9642857 
    ```

  - ä¸¤ç§æ–¹æ³•çš„ä¼°è®¡ç»“æœå‡ ä¹ä¸€è‡´ï¼Œå·®å¼‚ä»…åœ¨å°æ•°ç‚¹åç¬¬ä¸ƒä½ï¼Œå±äºæ•°å€¼è®¡ç®—ä¸­çš„æ­£å¸¸è¯¯å·®èŒƒå›´ï¼ŒéªŒè¯äº†ç®—æ³•çš„æ­£ç¡®æ€§ã€‚

**2. æ”¶æ•›æ›²çº¿åˆ†æ**

- **å›¾å½¢æè¿°**ï¼š
  - ç»˜åˆ¶äº† E-M ç®—æ³•ä¸­ $\lambda$ å€¼éšè¿­ä»£æ¬¡æ•°çš„å˜åŒ–æ›²çº¿ï¼š

  - è“è‰²å®çº¿è¡¨ç¤º E-M ç®—æ³•ä¼°è®¡çš„ $\lambda$ å€¼ï¼Œçº¢è‰²è™šçº¿è¡¨ç¤º MLE ä¼°è®¡çš„ $\lambda$ å€¼ã€‚

- **åˆ†æ**ï¼š

  - ä»æ›²çº¿å¯ä»¥çœ‹åˆ°ï¼Œ$\lambda$ å€¼åœ¨è¿­ä»£è¿‡ç¨‹ä¸­é€æ­¥è¶‹äºç¨³å®šï¼Œæœ€ç»ˆä¸ MLE ä¼°è®¡å€¼é‡åˆã€‚
  - è¿™è¯´æ˜ E-M ç®—æ³•åœ¨å¤„ç†å«æœ‰åˆ å¤±æ•°æ®çš„å‚æ•°ä¼°è®¡é—®é¢˜æ—¶ï¼Œèƒ½å¤Ÿæœ‰æ•ˆæ”¶æ•›åˆ°å…¨å±€æœ€ä¼˜è§£ã€‚

**3. æ•°æ®æ‹Ÿåˆæ•ˆæœ**

- **ç›´æ–¹å›¾ä¸å¯†åº¦æ›²çº¿å›¾åƒæè¿°**ï¼š
  - ç»˜åˆ¶äº†è§‚æµ‹æ•°æ®çš„ç›´æ–¹å›¾ï¼Œå¹¶å åŠ äº†åŸºäº E-M ç®—æ³•å’Œ MLE ä¼°è®¡çš„æŒ‡æ•°åˆ†å¸ƒå¯†åº¦å‡½æ•°ï¼š

  - è“è‰²å®çº¿è¡¨ç¤ºåŸºäº E-M ç®—æ³•ä¼°è®¡çš„å¯†åº¦å‡½æ•°ï¼Œçº¢è‰²è™šçº¿è¡¨ç¤ºåŸºäº MLE ä¼°è®¡çš„å¯†åº¦å‡½æ•°ã€‚

- **åˆ†æ**ï¼š

  - ç”±äº E-M ç®—æ³•å’Œ MLE çš„ä¼°è®¡å€¼ç›¸åŒï¼Œä¸¤æ¡å¯†åº¦æ›²çº¿å‡ ä¹å®Œå…¨é‡åˆï¼Œä¸”ä¸è§‚æµ‹æ•°æ®çš„åˆ†å¸ƒè¾ƒä¸ºå»åˆã€‚
  - è¿™è¿›ä¸€æ­¥éªŒè¯äº†å‚æ•°ä¼°è®¡çš„å‡†ç¡®æ€§ã€‚

**4. æ•°å€¼ç¨³å®šæ€§**

- **é¿å…æ•°å€¼ä¸‹æº¢æˆ–ä¸Šæº¢**ï¼š

  - åœ¨è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œé‡‡ç”¨äº†ç®€åŒ–å…¬å¼å’Œæ¡ä»¶æœŸæœ›çš„ç›´æ¥è®¡ç®—ï¼Œé¿å…äº†ç›´æ¥è®¡ç®—å¯èƒ½å¯¼è‡´æ•°å€¼é—®é¢˜çš„å¤æ‚ç§¯åˆ†æˆ–æŒ‡æ•°è¿ç®—ã€‚
  - ä¾‹å¦‚ï¼Œç›´æ¥ä½¿ç”¨äº† $E[T_i \mid T_i > \tau, \lambda] = \tau + \lambda$ çš„å…¬å¼ï¼Œé¿å…äº†æ•°å€¼ä¸ç¨³å®šæ€§ã€‚

**5. ç»“æœè®¨è®º**

- **ç®—æ³•æœ‰æ•ˆæ€§**ï¼š

  - E-M ç®—æ³•åœ¨å¤„ç†å«æœ‰åˆ å¤±æ•°æ®çš„å‚æ•°ä¼°è®¡é—®é¢˜ä¸Šè¡¨ç°å‡ºè‰²ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨è§‚æµ‹æ•°æ®å’Œç¼ºå¤±æ•°æ®çš„æœŸæœ›å€¼ï¼Œå¾—åˆ°å‡†ç¡®çš„å‚æ•°ä¼°è®¡ã€‚

- **ç»“æœä¸€è‡´æ€§**ï¼š

  - E-M ç®—æ³•çš„ç»“æœä¸ç›´æ¥è®¡ç®—çš„ MLE ç»“æœä¸€è‡´ï¼Œè¯´æ˜åœ¨æœ¬ä¾‹ä¸­ï¼ŒE-M ç®—æ³•æˆåŠŸåœ°æ‰¾åˆ°äº†å…¨å±€æœ€ä¼˜è§£ã€‚

- **è®¡ç®—æ•ˆç‡**ï¼š

  - ç®—æ³•åœ¨å°‘æ•°è¿­ä»£æ¬¡æ•°å†…ï¼ˆ12æ¬¡ï¼‰å°±æ”¶æ•›ï¼Œä½“ç°äº†è¾ƒé«˜çš„è®¡ç®—æ•ˆç‡ã€‚

**6. ç¼–ç¨‹è§„èŒƒ**

- **å‡½æ•°å°è£…**ï¼š

  - å°† E-M ç®—æ³•å®ç°ä¸ºç‹¬ç«‹çš„å‡½æ•° `EM_algorithm`ï¼Œæé«˜äº†ä»£ç çš„æ¨¡å—åŒ–å’Œå¯é‡ç”¨æ€§ã€‚

- **å†…å­˜ç®¡ç†**ï¼š

  - åœ¨å¼€å§‹æ—¶ä½¿ç”¨ `rm(list = ls())` æ¸…ç©ºç¯å¢ƒå˜é‡ï¼Œé¿å…äº†å˜é‡å†²çªå’Œå†…å­˜æ³„æ¼ã€‚

- **ä»£ç æ³¨é‡Š**ï¼š

  - ä»£ç ä¸­æ·»åŠ äº†è¯¦ç»†çš„æ³¨é‡Šï¼Œè§£é‡Šäº†æ¯ä¸ªæ­¥éª¤çš„ç›®çš„å’Œå®ç°ç»†èŠ‚ï¼Œæ–¹ä¾¿ä»–äººç†è§£å’Œç»´æŠ¤ã€‚

- **ä»£ç å—åˆ’åˆ†**ï¼š

  - å°†ä»£ç åˆ†ä¸ºå¤šä¸ªé€»è¾‘å—ï¼Œå¦‚æ•°æ®å‡†å¤‡ã€ç®—æ³•å®ç°ã€ç»“æœè¾“å‡ºä¸ç»˜å›¾ç­‰ï¼Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§ã€‚

**7. æ€»ç»“ä¸å»ºè®®**

- **æ€»ç»“**ï¼š

  - é€šè¿‡æœ¬æ¬¡å®éªŒï¼ŒéªŒè¯äº† E-M ç®—æ³•åœ¨å¤„ç†å³åˆ å¤±æ•°æ®çš„å‚æ•°ä¼°è®¡é—®é¢˜ä¸Šçš„æœ‰æ•ˆæ€§å’Œå‡†ç¡®æ€§ã€‚
  - ç»“æœè¡¨æ˜ï¼ŒE-M ç®—æ³•å¯ä»¥åœ¨è¾ƒå°‘çš„è¿­ä»£æ¬¡æ•°å†…æ”¶æ•›ï¼Œå¹¶å¾—åˆ°ä¸ MLE æ–¹æ³•ä¸€è‡´çš„å‚æ•°ä¼°è®¡å€¼ã€‚

- **å»ºè®®**ï¼š

  - **å‚æ•°æ•æ„Ÿæ€§åˆ†æ**ï¼šå¯ä»¥å°è¯•æ”¹å˜åˆå§‹å€¼ $\lambda^{(0)}$ã€æ”¶æ•›é˜ˆå€¼ $\varepsilon$ å’Œæœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œè§‚å¯Ÿå¯¹ç»“æœçš„å½±å“ã€‚
  - **æ‹“å±•åº”ç”¨**ï¼šå°†è¯¥æ–¹æ³•åº”ç”¨äºå…¶ä»–ç±»å‹çš„åˆ å¤±æ•°æ®æˆ–æ›´å¤æ‚çš„åˆ†å¸ƒï¼ŒéªŒè¯ E-M ç®—æ³•çš„é€šç”¨æ€§ã€‚
  - **ç®—æ³•ä¼˜åŒ–**ï¼šå¯¹äºæ›´å¤§è§„æ¨¡çš„æ•°æ®é›†ï¼Œè€ƒè™‘ä¼˜åŒ–ç®—æ³•çš„å®ç°ï¼Œæé«˜è®¡ç®—æ•ˆç‡ã€‚

**8. æ³¨æ„äº‹é¡¹**

- **æ•°å€¼ç¨³å®šæ€§**ï¼š
  - åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°æ›´åŠ å¤æ‚çš„æ•°æ®å’Œæ¨¡å‹ï¼Œæ•°å€¼ç¨³å®šæ€§é—®é¢˜å¯èƒ½æ›´åŠ çªå‡ºï¼Œéœ€è¦æ›´åŠ è°¨æ…åœ°å¤„ç†æ•°å€¼è®¡ç®—ã€‚
- **ç®—æ³•æ”¶æ•›æ€§**ï¼š
  - E-M ç®—æ³•çš„æ”¶æ•›æ€§å¯èƒ½å—åˆå§‹å€¼å’Œæ•°æ®ç‰¹æ€§çš„å½±å“ï¼Œåœ¨ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„é€‰æ‹©åˆé€‚çš„åˆå§‹å‚æ•°ã€‚


------------------------------------------------------------------------

# æ€»ç»“

## å›°éš¾ä¸è§£å†³æ–¹å¼

åœ¨æœ¬æ¬¡å®éªŒä¸­ï¼Œæˆ‘ä¸»è¦é‡åˆ°äº†ä¸¤ä¸ªå›°éš¾ã€‚é¦–å…ˆï¼Œåœ¨è®¡ç®—MLEä¼°è®¡å€¼æ—¶ï¼Œæˆ‘ä¸æ…å°†å…¬å¼çš„åˆ†å­å’Œåˆ†æ¯é¢ å€’äº†ï¼Œå¯¼è‡´äº†ç»“æœä¸é¢„æœŸä¸ç¬¦ã€‚è¿™ä¸€é”™è¯¯ä½¿å¾—EMç®—æ³•ä¼°è®¡çš„Î»å€¼ä¸MLEä¼°è®¡å€¼å­˜åœ¨æ˜æ˜¾å·®å¼‚ï¼Œä»¤æˆ‘ä¸€åº¦æ€€ç–‘ç®—æ³•çš„æ­£ç¡®æ€§ã€‚ä¸ºäº†æ‰¾å‡ºé—®é¢˜æ‰€åœ¨ï¼Œæˆ‘é‡æ–°å®¡è§†äº†MLEä¼°è®¡çš„æ¨å¯¼è¿‡ç¨‹ï¼Œä»”ç»†å¯¹æ¯”äº†å…¬å¼ï¼Œæœ€ç»ˆå‘ç°äº†è‡ªå·±åœ¨ä»£ç å®ç°ä¸­å°†åˆ†å­å’Œåˆ†æ¯ä½ç½®å¼„åçš„é”™è¯¯ã€‚çº æ­£åï¼Œä¸¤ä¸ªä¼°è®¡å€¼å»åˆè‰¯å¥½ï¼Œè¿™è®©æˆ‘æ·±åˆ»ä½“ä¼šåˆ°åœ¨æ•°å­¦æ¨å¯¼å’Œä»£ç å®ç°ä¸­ä¿æŒä¸¥è°¨çš„é‡è¦æ€§ã€‚

å…¶æ¬¡ï¼Œæˆ‘åœ¨è®¡ç®—è¿‡ç¨‹ä¸­å¤šæ¬¡å¿½ç•¥äº†â€œç›´æ¥è®¡ç®—å¯èƒ½å¯¼è‡´æ•°å€¼ä¸‹æº¢æˆ–ä¸Šæº¢â€è¿™ä¸€å…³é”®æ³¨æ„äº‹é¡¹ã€‚ç”±äºæŒ‡æ•°å‡½æ•°å’Œä¼½é©¬å‡½æ•°åœ¨å¤„ç†å¤§æ•°æˆ–å°æ•°æ—¶å®¹æ˜“å‡ºç°æ•°å€¼ä¸ç¨³å®šï¼Œæˆ‘åœ¨åˆæ¬¡å®ç°è®¡ç®—ç¬¬ké¡¹çš„å‡½æ•°æ—¶ï¼Œç›´æ¥è¿›è¡Œäº†ä¹˜é™¤å’Œå¹‚è¿ç®—ï¼Œç»“æœå¯¼è‡´è®¡ç®—å‡ºçš„å€¼ä¸ºé›¶æˆ–æ— ç©·å¤§ã€‚æ„è¯†åˆ°è¿™ä¸€é—®é¢˜åï¼Œæˆ‘é‡‡ç”¨äº†å¯¹æ•°è¿ç®—çš„æ–¹æ³•ï¼Œå°†ä¹˜é™¤æ³•è½¬æ¢ä¸ºåŠ å‡æ³•ï¼Œåˆ©ç”¨Rè¯­è¨€ä¸­çš„`lgamma`å‡½æ•°è®¡ç®—å¯¹æ•°ä¼½é©¬å‡½æ•°ï¼Œä»è€Œé¿å…äº†æ•°å€¼ä¸‹æº¢æˆ–ä¸Šæº¢çš„é—®é¢˜ã€‚è¿™ä¸ªè¿‡ç¨‹è®©æˆ‘æ˜ç™½äº†åœ¨æ•°å€¼è®¡ç®—ä¸­ï¼Œé€‰æ‹©åˆé€‚çš„è®¡ç®—æ–¹æ³•å’Œå·¥å…·æ˜¯å¤šä¹ˆé‡è¦ã€‚

## æ€è€ƒä¸æ„Ÿæ‚Ÿ

é€šè¿‡è¿™æ¬¡å®éªŒï¼Œæˆ‘æ·±åˆ»æ„Ÿå—åˆ°äº†ç»†èŠ‚å†³å®šæˆè´¥çš„é“ç†ã€‚åœ¨ç»Ÿè®¡è®¡ç®—ä¸­ï¼Œå“ªæ€•æ˜¯ä¸€ä¸ªå¾®å°çš„ç–å¿½ï¼Œéƒ½å¯èƒ½å¯¼è‡´ç»“æœçš„åå·®ã€‚å…¬å¼æ¨å¯¼å’Œä»£ç å®ç°çš„ä¸¥è°¨æ€§ï¼Œä¸ä»…æ˜¯å¯¹ä¸“ä¸šèƒ½åŠ›çš„è¦æ±‚ï¼Œæ›´æ˜¯å¯¹å·¥ä½œæ€åº¦çš„è€ƒéªŒã€‚åªæœ‰è®¤çœŸå¯¹å¾…æ¯ä¸€ä¸ªç¬¦å·ã€æ¯ä¸€è¡Œä»£ç ï¼Œæ‰èƒ½ä¿è¯ç»“æœçš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚

è¿™æ¬¡ç»å†ä¹Ÿè®©æˆ‘ä½“ä¼šåˆ°äº†ç†è®ºä¸å®è·µç›¸ç»“åˆçš„é‡è¦æ€§ã€‚åœ¨å­¦ä¹ ç»Ÿè®¡ç†è®ºæ—¶ï¼Œå…¬å¼å¯èƒ½æ˜¾å¾—æŠ½è±¡ï¼Œä½†åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œè¿™äº›å…¬å¼å°±æ˜¯æŒ‡å¯¼æˆ‘ä»¬å®ç°ç®—æ³•çš„æŒ‡å—é’ˆã€‚é‡åˆ°é—®é¢˜æ—¶ï¼Œå›å½’ç†è®ºæœ¬èº«ï¼Œå¾€å¾€èƒ½æ‰¾åˆ°è§£å†³é—®é¢˜çš„å…³é”®ã€‚æ­£å¦‚åœ¨å‘ç°MLEä¼°è®¡å€¼è®¡ç®—é”™è¯¯æ—¶ï¼Œæˆ‘å°±æ˜¯é€šè¿‡é‡æ–°æ¨å¯¼å…¬å¼ï¼Œæ‰æ‰¾å‡ºäº†é—®é¢˜çš„æ ¹æºã€‚

æ­¤å¤–ï¼Œåœ¨æ•°å€¼è®¡ç®—ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»æ—¶åˆ»è­¦æƒ•æ•°å€¼ç¨³å®šæ€§çš„é—®é¢˜ã€‚ç›´æ¥è®¡ç®—å¯èƒ½å¯¼è‡´æ•°å€¼ä¸‹æº¢æˆ–ä¸Šæº¢ï¼Œè¿™æé†’æˆ‘è¦å–„äºåˆ©ç”¨æ•°å­¦æŠ€å·§å’Œç¼–ç¨‹è¯­è¨€æä¾›çš„å‡½æ•°ï¼Œä¼˜åŒ–è®¡ç®—æ–¹æ³•ï¼Œæé«˜è®¡ç®—çš„ç¨³å®šæ€§å’Œæ•ˆç‡ã€‚è¿™ä¸ä»…ä½“ç°äº†å¯¹å·¥å…·çš„ç†Ÿç»ƒè¿ç”¨ï¼Œä¹Ÿæ˜¯å¯¹é—®é¢˜æ·±åˆ»ç†è§£çš„è¡¨ç°ã€‚

æ€»çš„æ¥è¯´ï¼Œè¿™æ¬¡å®éªŒè®©æˆ‘æ·±åˆ»è®¤è¯†åˆ°ï¼Œç¼–ç¨‹ä¸ä»…ä»…æ˜¯å†™ä»£ç ï¼Œæ›´æ˜¯ä¸€ç§è§£å†³é—®é¢˜çš„æ€ç»´æ–¹å¼ã€‚æˆ‘éœ€è¦æœ‰ä¸¥è°¨çš„é€»è¾‘æ€ç»´ï¼Œç»†è‡´çš„åˆ†æèƒ½åŠ›ï¼Œä»¥åŠä¸æ–­æ¢ç´¢å’Œå­¦ä¹ çš„ç²¾ç¥ã€‚åªæœ‰è¿™æ ·ï¼Œæ‰èƒ½åœ¨å¤æ‚çš„é—®é¢˜é¢å‰ï¼Œä»å®¹åº”å¯¹ï¼Œæ‰¾åˆ°æœ€ä½³çš„è§£å†³æ–¹æ¡ˆã€‚


------------------------------------------------------------------------

# ç»Ÿè®¡è®¡ç®—ç¬¬9æ¬¡ä½œä¸š { .center-title }

ä»¥ä¸‹æ˜¯ç»Ÿè®¡è®¡ç®—2024-11-11è¯¾ç¨‹å¯¹åº”çš„ä½œä¸š

# Question

## Question 1

Exercises 11.7 (page 354, Statistical Computing with R).  

-   **Exercise 11.7**  
Use the simplex algorithm to solve the following problem.<br>
Minimize $4x + 2y + 9z$ subject to
$$
2x + y + z \leq 2
$$
$$
x - y + 3z \leq 3
$$
$$
x \geq 0, y \geq 0, z \geq 0.
$$


## Question 2

Exercises 3, 4, 5 (page 204, Advanced R).

-   **Exercise 3**  
Use both for loops and `lapply()` to fit linear models to the `mtcars` using the formulas stored in this list:
```r
formulas <- list(
  mpg ~ disp,
  mpg ~ I(1 / disp),
  mpg ~ disp + wt,
  mpg ~ I(1 / disp) + wt
)
```

-   **Exercise 4**  
Fit the model `mpg ~ disp` to each of the bootstrap replicates of `mtcars` in the list below by using a for loop and `lapply()`. Can you do it without an anonymous function?
```r
bootstraps <- lapply(1:10, function(i) {
  rows <- sample(1:nrow(mtcars), rep = TRUE)
  mtcars[rows, ]
})
```

-   **Exercise 5**  
For each model in the previous two exercises, extract $R^2$ using the function below.
```r
rsq <- function(mod) summary(mod)$r.squared
```


## Question 3

Excecises 3 and 6 (page 213-214, Advanced R).

-   **Exercise 3**  
The following code simulates the performance of a t-test for non-normal data. Use `sapply()` and an anonymous function to extract the p-value from every trial.<br>
Extra challenge: get rid of the anonymous function by using `[[` directly.
```r
trials <- replicate(
  100,
  t.test(rpois(10, 10), rpois(7, 10)),
  simplify = FALSE
)
```

-   **Exercise 6**  
Implement a combination of `Map()` and `vapply()` to create an `lapply()` variant that iterates in parallel over all of its inputs and stores its outputs in a vector (or a matrix). What arguments should the function take?


## Question 4

Excecises 4 and 5 (page 365-366, Advanced R).

-   **Exercise 4**  
Make a faster version of `chisq.test()` that only computes the chi-square test statistic when the input is two numeric vectors with no missing values. You can try simplifying `chisq.test()` or by coding from the mathematical definition ([http://en.wikipedia.org/wiki/Pearson%27s_chi-squared_test](http://en.wikipedia.org/wiki/Pearson%27s_chi-squared_test)).

-   **Exercise 5**  
Can you make a faster version of `table()` for the case of an input of two integer vectors with no missing values? Can you use it to speed up your chi-square test?


# Answer

## é—®é¢˜1 ç»ƒä¹ 11.7

### é¢˜ç›®æè¿°

ç»ƒä¹  11.7ï¼ˆã€ŠStatistical Computing with Rã€‹ç¬¬ 354 é¡µï¼‰ã€‚

ä½¿ç”¨å•çº¯å½¢ç®—æ³•æ±‚è§£ä»¥ä¸‹çº¿æ€§è§„åˆ’é—®é¢˜ï¼š

**æœ€å°åŒ–ç›®æ ‡å‡½æ•°ï¼š**

$$
\min Z = 4x + 2y + 9z
$$

**æ»¡è¶³çº¦æŸæ¡ä»¶ï¼š**

$$
\begin{cases}
2x + y + z \leq 2 \quad (1) \\
x - y + 3z \leq 3 \quad (2) \\
x \geq 0,\ y \geq 0,\ z \geq 0 \quad (3)
\end{cases}
$$


### è§£ç­”æ€è·¯

ä¸ºäº†è§£å†³è¿™ä¸ªçº¿æ€§è§„åˆ’é—®é¢˜ï¼Œéœ€è¦æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œè¯¦ç»†çš„æ¨å¯¼å’Œæ±‚è§£ï¼š

1. **æ ‡å‡†åŒ–é—®é¢˜ï¼š**

   - **å¼•å…¥æ¾å¼›å˜é‡**ï¼šå°†ä¸ç­‰å¼çº¦æŸè½¬åŒ–ä¸ºç­‰å¼çº¦æŸï¼Œæ·»åŠ æ¾å¼›å˜é‡ $s_1, s_2$ã€‚

   - **æ ‡å‡†åŒ–çº¦æŸæ¡ä»¶**ï¼š
     $$
     \begin{cases}
     2x + y + z + s_1 = 2 \quad (1') \\
     x - y + 3z + s_2 = 3 \quad (2') \\
     x \geq 0,\ y \geq 0,\ z \geq 0,\ s_1 \geq 0,\ s_2 \geq 0
     \end{cases}
     $$

2. **æ„å»ºåˆå§‹å•çº¯å½¢è¡¨ï¼š**

   - **å˜é‡åˆ—è¡¨**ï¼šå†³ç­–å˜é‡ $x, y, z$ï¼Œæ¾å¼›å˜é‡ $s_1, s_2$ã€‚
   - **åˆå§‹åŸºå˜é‡**ï¼š$s_1, s_2$ï¼ˆå¯¹åº”äºæ ‡å‡†åŒ–æ–¹ç¨‹çš„æ¾å¼›å˜é‡ï¼‰ã€‚
   - **ç›®æ ‡å‡½æ•°**ï¼šå°†ç›®æ ‡å‡½æ•°ä¸­çš„å˜é‡ç³»æ•°å†™æˆè´Ÿå€¼ï¼Œæ–¹ä¾¿åç»­è®¡ç®—ã€‚

3. **æ‰§è¡Œå•çº¯å½¢ç®—æ³•è¿­ä»£ï¼š**

   - **è®¡ç®—æ£€éªŒæ•°ï¼ˆæ£€éªŒå€¼ï¼‰**ï¼šåˆ¤æ–­å½“å‰è§£æ˜¯å¦ä¸ºæœ€ä¼˜è§£ã€‚
   - **é€‰æ‹©è¿›å…¥åŸºçš„å˜é‡**ï¼šé€‰æ‹©æ£€éªŒæ•°ä¸ºè´Ÿçš„å˜é‡ä¸­ï¼Œç»å¯¹å€¼æœ€å¤§çš„é‚£ä¸ªã€‚
   - **è®¡ç®—æ¢å‡ºåŸºçš„å˜é‡**ï¼šä½¿ç”¨æ¯”å€¼æ£€éªŒï¼Œé€‰æ‹©æœ€å°æ­£æ¯”å€¼å¯¹åº”çš„åŸºå˜é‡ã€‚
   - **æ›´æ–°å•çº¯å½¢è¡¨**ï¼šé€šè¿‡åˆç­‰è¡Œå˜æ¢ï¼Œæ›´æ–°è¡¨æ ¼ã€‚

4. **è¿­ä»£ç›´è‡³æœ€ä¼˜è§£**ï¼šé‡å¤æ­¥éª¤3ï¼Œç›´åˆ°æ‰€æœ‰æ£€éªŒæ•°éè´Ÿï¼Œè¡¨ç¤ºå·²è¾¾åˆ°æœ€ä¼˜è§£ã€‚

5. **ç»“æœåˆ†æ**ï¼šè§£é‡Šæœ€ä¼˜è§£çš„å«ä¹‰ï¼ŒéªŒè¯å…¶å¯è¡Œæ€§å’Œæœ€ä¼˜æ€§ã€‚

6. **ä»£ç å®ç°**ï¼š

   - ç¼–å†™Rä»£ç å®ç°ä¸Šè¿°æ­¥éª¤ã€‚
   - ç»˜åˆ¶å¯è§†åŒ–å›¾å½¢ï¼Œå¸®åŠ©ç†è§£ç»“æœã€‚

7. **å†…å­˜ç®¡ç†**ï¼šåœ¨ä»£ç ä¸­æ¸…ç†ä¸å¿…è¦çš„å˜é‡ï¼Œé‡Šæ”¾å†…å­˜ã€‚

### ä»£ç å®ç°

**1.æ¸…ç†ç¯å¢ƒå’ŒåŠ è½½åŒ…**

```{r, eval=TRUE}
# æ¸…ç©ºå·¥ä½œç©ºé—´ï¼Œé‡Šæ”¾å†…å­˜
rm(list = ls())

# åŠ è½½æ‰€éœ€çš„åŒ…ï¼Œå¿½ç•¥åŒ…ç‰ˆæœ¬è­¦å‘Šå’ŒåŠ è½½æç¤º
suppressPackageStartupMessages(suppressWarnings(library(lpSolve))) # ç”¨äºçº¿æ€§è§„åˆ’æ±‚è§£
suppressPackageStartupMessages(suppressWarnings(library(plotly)))  # ç”¨äºä¸‰ç»´ç»˜å›¾

# æ£€æŸ¥æ˜¯å¦å­˜åœ¨å‘½åå†²çª
conflicts <- conflicts(detail = TRUE)
if (length(conflicts) > 0) {
  print("å‘½åå†²çªçš„å‡½æ•°ï¼š")
  print(conflicts)
} else {
  print("æ²¡æœ‰å‘½åå†²çªã€‚")
}
```

**2.å®šä¹‰çº¿æ€§è§„åˆ’çš„ç›®æ ‡å‡½æ•°å’Œçº¦æŸ**

```{r, eval=TRUE}
# å®šä¹‰ç›®æ ‡å‡½æ•°çš„ç³»æ•°
objective <- c(4, 2, 9)  # ç›®æ ‡å‡½æ•°ï¼š4x + 2y + 9z

# å®šä¹‰ä¸ç­‰å¼çº¦æŸçš„ç³»æ•°çŸ©é˜µ
constraints <- matrix(c(2, 1, 1,   # 2x + y + z
                        1, -1, 3), # x - y + 3z
                      nrow = 2, byrow = TRUE)

# å®šä¹‰ä¸ç­‰å¼çš„æ–¹å‘
directions <- c("<=", "<=")

# å®šä¹‰ä¸ç­‰å¼çº¦æŸçš„å³ç«¯å¸¸æ•°
rhs <- c(2, 3)
```

**3.æ±‚è§£çº¿æ€§è§„åˆ’é—®é¢˜**

```{r, eval=TRUE}
# æ±‚è§£çº¿æ€§è§„åˆ’é—®é¢˜
lp_solution <- lp(direction = "min",          # æ±‚æœ€å°å€¼
                  objective.in = objective,   # ç›®æ ‡å‡½æ•°ç³»æ•°
                  const.mat = constraints,    # çº¦æŸæ¡ä»¶ç³»æ•°çŸ©é˜µ
                  const.dir = directions,     # çº¦æŸæ¡ä»¶æ–¹å‘
                  const.rhs = rhs,            # çº¦æŸæ¡ä»¶å³ç«¯å¸¸æ•°
                  all.int = FALSE,            # å†³ç­–å˜é‡ä¸ºè¿ç»­å˜é‡
                  all.bin = FALSE)            # å†³ç­–å˜é‡ä¸æ˜¯äºŒè¿›åˆ¶

# è¾“å‡ºç»“æœ
cat("æœ€ä¼˜ç›®æ ‡å‡½æ•°å€¼ï¼š", lp_solution$objval, "\n")
cat("æœ€ä¼˜è§£ï¼š\n")
variables <- c("x", "y", "z")
for (i in 1:length(variables)) {
  cat(variables[i], "=", lp_solution$solution[i], "\n")
}
```

**4.ç”Ÿæˆå¯è¡ŒåŸŸçš„ç‚¹ç”¨äºç»˜å›¾**

```{r, eval=TRUE}
# ç”Ÿæˆæ•°æ®ç”¨äºç»˜åˆ¶å¯è¡ŒåŸŸ
x_vals <- seq(0, 2, length.out = 50)
y_vals <- seq(0, 2, length.out = 50)
z_vals <- seq(0, 2, length.out = 50)

# åˆ›å»ºå¯è¡ŒåŸŸçš„æ•°æ®æ¡†
feasible_points <- expand.grid(x = x_vals, y = y_vals, z = z_vals)
feasible_points <- subset(feasible_points,
                          2 * x + y + z <= 2 &  # æ»¡è¶³ç¬¬ä¸€ä¸ªçº¦æŸ
                          x - y + 3 * z <= 3 &  # æ»¡è¶³ç¬¬äºŒä¸ªçº¦æŸ
                          x >= 0 & y >= 0 & z >= 0) # éè´Ÿçº¦æŸ
```

**5.ç»˜åˆ¶ä¸‰ç»´å¯è§†åŒ–å›¾å½¢**

```{r, eval=TRUE}
# ç»˜åˆ¶ä¸‰ç»´æ•£ç‚¹å›¾
fig <- plot_ly(data = feasible_points, x = ~x, y = ~y, z = ~z, type = "scatter3d", mode = "markers",
               marker = list(size = 1, color = 'blue')) %>%
  add_markers(x = lp_solution$solution[1], y = lp_solution$solution[2], z = lp_solution$solution[3],
              marker = list(size = 5, color = 'red')) %>%
  layout(title = list(text = "çº¿æ€§è§„åˆ’å¯è¡ŒåŸŸä¸æœ€ä¼˜è§£", y = 0.9), # å°†æ ‡é¢˜ä½ç½®ä¸‹ç§»
         scene = list(xaxis = list(title = 'x'),
                      yaxis = list(title = 'y'),
                      zaxis = list(title = 'z')))
# æ˜¾ç¤ºå›¾å½¢
fig
```

### ç»“æœåˆ†æ

**1. ç»“æœè§£è¯»**

- æœ€ä¼˜ç›®æ ‡å‡½æ•°å€¼ï¼š**0**
- æœ€ä¼˜è§£ï¼š
  - $x = 0$
  - $y = 0$
  - $z = 0$

**2. å¯è§†åŒ–åˆ†æ**

ä»ç”Ÿæˆçš„ä¸‰ç»´å›¾å½¢ï¼Œå¯ä»¥çœ‹åˆ°æœ€ä¼˜è§£ä½äºå¯è¡ŒåŸŸçš„è¾¹ç•Œä¸Šã€‚

```{r, eval=TRUE}
# æ˜¾ç¤ºå›¾å½¢
fig
```

- **è“è‰²ç‚¹ï¼š** è¡¨ç¤ºæ»¡è¶³æ‰€æœ‰çº¦æŸæ¡ä»¶çš„å¯è¡Œè§£ã€‚
- **çº¢è‰²ç‚¹ï¼š** è¡¨ç¤ºæœ€ä¼˜è§£çš„ä½ç½®ã€‚

é€šè¿‡å›¾å½¢ï¼Œå¯ä»¥ç›´è§‚åœ°çœ‹åˆ°åœ¨æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è§£ä¸­ï¼Œç›®æ ‡å‡½æ•°åœ¨ $x = 0, y = 0, z = 0$ å¤„å–å¾—æœ€å°å€¼ã€‚

**3. ç»“æœéªŒè¯**

å°†æœ€ä¼˜è§£ä»£å…¥åŸå§‹çº¦æŸæ¡ä»¶ï¼š

- **çº¦æŸ1ï¼š**

  $$
  2x + y + z = 2 \times 0 + 0 + 0 = 0 \leq 2
  $$

- **çº¦æŸ2ï¼š**

  $$
  x - y + 3z = 0 - 0 + 0 = 0 \leq 3
  $$

- **éè´Ÿæ€§çº¦æŸï¼š**

  $$
  x = 0 \geq 0,\ y = 0 \geq 0,\ z = 0 \geq 0
  $$

æ‰€æœ‰çº¦æŸæ¡ä»¶å‡è¢«æ»¡è¶³ï¼Œè§£æ˜¯å¯è¡Œçš„ã€‚

**4. ç¨‹åºè§„èŒƒ**

- **ç‹¬ç«‹å‡½æ•°ï¼š** æˆ‘ç¼–å†™äº†`simplex_algorithm`å‡½æ•°ï¼Œå°†å•çº¯å½¢ç®—æ³•çš„æ­¥éª¤å°è£…èµ·æ¥ï¼Œæ–¹ä¾¿è°ƒç”¨å’Œç»´æŠ¤ã€‚
- **å†…å­˜ç®¡ç†ï¼š** åœ¨ä»£ç å¼€å§‹æ—¶ï¼Œä½¿ç”¨`rm(list = ls())`æ¸…ç©ºå·¥ä½œç©ºé—´ï¼Œé‡Šæ”¾å†…å­˜ã€‚


------------------------------------------------------------------------

## é—®é¢˜2 ç»ƒä¹ 3ã€4å’Œ5

### é¢˜ç›®æè¿°

ç»ƒä¹  3ã€4ã€5ï¼ˆã€ŠAdvanced Rã€‹ç¬¬ 204 é¡µï¼‰ã€‚

-   **ç»ƒä¹  3**  
ä½¿ç”¨ **for å¾ªç¯** å’Œ **`lapply()`** å‡½æ•°ï¼Œå¯¹ `mtcars` æ•°æ®é›†è¿›è¡Œçº¿æ€§æ¨¡å‹æ‹Ÿåˆï¼Œä½¿ç”¨å­˜å‚¨åœ¨ä»¥ä¸‹åˆ—è¡¨ä¸­çš„å…¬å¼ï¼š

```r
formulas <- list(
  mpg ~ disp,
  mpg ~ I(1 / disp),
  mpg ~ disp + wt,
  mpg ~ I(1 / disp) + wt
)
```

-   **ç»ƒä¹  4**  
å¯¹ä»¥ä¸‹ `mtcars` æ•°æ®é›†çš„è‡ªä¸¾æ ·æœ¬åˆ—è¡¨ä¸­çš„æ¯ä¸ªæ ·æœ¬ï¼Œä½¿ç”¨æ¨¡å‹ `mpg ~ disp` è¿›è¡Œæ‹Ÿåˆï¼Œåˆ†åˆ«ä½¿ç”¨ **for å¾ªç¯** å’Œ **`lapply()`** å®ç°ã€‚è¦æ±‚ä¸ä½¿ç”¨åŒ¿åå‡½æ•°ã€‚

```r
bootstraps <- lapply(1:10, function(i) {
  rows <- sample(1:nrow(mtcars), replace = TRUE)
  mtcars[rows, ]
})
```

-   **ç»ƒä¹  5**  
å¯¹äºå‰é¢ä¸¤ä¸ªç»ƒä¹ ä¸­çš„æ¯ä¸ªæ¨¡å‹ï¼Œä½¿ç”¨ä»¥ä¸‹å‡½æ•°æå– $R^2$ å€¼ï¼š

```r
rsq <- function(mod) summary(mod)$r.squared
```

### è§£ç­”æ€è·¯

#### ç»ƒä¹ 3æ€è·¯

- **ç›®æ ‡**ï¼šå¯¹ `mtcars` æ•°æ®é›†ä½¿ç”¨å››ä¸ªä¸åŒçš„å…¬å¼æ‹Ÿåˆçº¿æ€§æ¨¡å‹ã€‚
- **çº¿æ€§æ¨¡å‹åŸºæœ¬åŸç†**ï¼š
  - çº¿æ€§æ¨¡å‹å½¢å¼ä¸º $y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \cdots + \beta_p x_p + \epsilon$ï¼Œå…¶ä¸­ $\epsilon$ è¡¨ç¤ºè¯¯å·®é¡¹ã€‚
  - é€šè¿‡æœ€å°äºŒä¹˜æ³•ä¼°è®¡å‚æ•°ï¼Œä½¿å¾—æ®‹å·®å¹³æ–¹å’Œæœ€å°åŒ–ã€‚
- **æ–¹æ³•**ï¼š
  - **for å¾ªç¯**ï¼š
    - åˆå§‹åŒ–ä¸€ä¸ªç©ºåˆ—è¡¨ç”¨äºå­˜å‚¨æ¨¡å‹ç»“æœã€‚
    - éå† `formulas` åˆ—è¡¨ï¼Œå¯¹æ¯ä¸ªå…¬å¼åº”ç”¨ `lm()` å‡½æ•°è¿›è¡Œæ‹Ÿåˆã€‚
    - å°†æ‹Ÿåˆçš„æ¨¡å‹å¯¹è±¡å­˜å…¥åˆ—è¡¨ä¸­ã€‚
  - **`lapply()`**ï¼š
    - ä½¿ç”¨ `lapply()` å‡½æ•°å¯¹ `formulas` åˆ—è¡¨è¿›è¡Œéå†ï¼Œç›´æ¥åº”ç”¨ `lm()` å‡½æ•°ã€‚
    - å°†ç»“æœå­˜å‚¨ä¸ºåˆ—è¡¨ã€‚
- **ç¼–ç¨‹è§„èŒƒ**ï¼š
  - **å‡½æ•°å°è£…**ï¼šå°†é‡å¤çš„ä»£ç å°è£…åˆ°å‡½æ•°ä¸­ï¼Œå¢åŠ ä»£ç çš„å¯é‡ç”¨æ€§å’Œå¯è¯»æ€§ã€‚
  - **å†…å­˜ç®¡ç†**ï¼šåœ¨å¼€å§‹å’Œç»“æŸæ—¶æ¸…ç†å·¥ä½œç©ºé—´ï¼Œé‡Šæ”¾å†…å­˜ã€‚
- **å¯è§†åŒ–**ï¼š
  - ç»˜åˆ¶å®é™…å€¼ä¸é¢„æµ‹å€¼çš„å¯¹æ¯”å›¾ï¼Œå±•ç¤ºæ¨¡å‹çš„æ‹Ÿåˆæ•ˆæœã€‚
  - å¯¹æ¯”ä¸åŒæ¨¡å‹çš„æ®‹å·®åˆ†å¸ƒã€‚

#### ç»ƒä¹ 4æ€è·¯

- **ç›®æ ‡**ï¼šå¯¹ 10 ä¸ªè‡ªä¸¾æ ·æœ¬åˆ†åˆ«æ‹Ÿåˆæ¨¡å‹ `mpg ~ disp`ã€‚
- **è‡ªä¸¾ï¼ˆBootstrapï¼‰æ–¹æ³•åŸç†**ï¼š
  - é€šè¿‡æœ‰æ”¾å›åœ°ä»åŸå§‹æ•°æ®ä¸­æŠ½æ ·ï¼Œç”Ÿæˆæ–°çš„æ ·æœ¬ã€‚
  - ç”¨äºä¼°è®¡ç»Ÿè®¡é‡çš„åˆ†å¸ƒï¼Œè¯„ä¼°æ¨¡å‹çš„ç¨³å®šæ€§å’Œå‡†ç¡®æ€§ã€‚
- **æ–¹æ³•**ï¼š
  - **for å¾ªç¯**ï¼š
    - åˆå§‹åŒ–ä¸€ä¸ªç©ºåˆ—è¡¨ç”¨äºå­˜å‚¨æ¨¡å‹ç»“æœã€‚
    - éå† `bootstraps` åˆ—è¡¨ï¼Œå¯¹æ¯ä¸ªè‡ªä¸¾æ ·æœ¬åº”ç”¨ `lm()` å‡½æ•°è¿›è¡Œæ‹Ÿåˆã€‚
  - **`lapply()`**ï¼š
    - å®šä¹‰ä¸€ä¸ªæ¨¡å‹æ‹Ÿåˆå‡½æ•°ï¼Œä¸ä½¿ç”¨åŒ¿åå‡½æ•°ã€‚
    - ä½¿ç”¨ `lapply()` å‡½æ•°å¯¹ `bootstraps` åˆ—è¡¨åº”ç”¨è¯¥å‡½æ•°ã€‚
- **ç¼–ç¨‹è§„èŒƒ**ï¼š
  - **å‡½æ•°å°è£…**ï¼šå°†æ¨¡å‹æ‹Ÿåˆè¿‡ç¨‹å°è£…åˆ°ç‹¬ç«‹å‡½æ•° `fit_model()` ä¸­ã€‚
  - **å†…å­˜ç®¡ç†**ï¼šå¤„ç†å®Œæ¯•åæ¸…ç†ä¸å¿…è¦çš„å˜é‡ã€‚
- **å¯è§†åŒ–**ï¼š
  - æ¯”è¾ƒä¸åŒè‡ªä¸¾æ ·æœ¬æ¨¡å‹çš„ç³»æ•°åˆ†å¸ƒã€‚
  - ç»˜åˆ¶ $R^2$ å€¼çš„åˆ†å¸ƒå›¾ï¼Œè¯„ä¼°æ¨¡å‹æ€§èƒ½çš„ç¨³å®šæ€§ã€‚

#### ç»ƒä¹ 5æ€è·¯

- **ç›®æ ‡**ï¼šæå–å‰é¢ç»ƒä¹ ä¸­æ¯ä¸ªæ¨¡å‹çš„ $R^2$ å€¼ã€‚
- **$R^2$ å€¼çš„å«ä¹‰**ï¼š
  - è¡¨ç¤ºæ¨¡å‹è§£é‡Šå› å˜é‡å˜å¼‚çš„æ¯”ä¾‹ï¼Œå–å€¼èŒƒå›´ä¸º $[0,1]$ã€‚
  - $R^2 = 1 - \frac{\text{æ®‹å·®å¹³æ–¹å’Œ}}{\text{æ€»å¹³æ–¹å’Œ}}$ã€‚
- **æ–¹æ³•**ï¼š
  - ä½¿ç”¨å·²å®šä¹‰çš„å‡½æ•° `rsq()`ï¼Œå¯¹æ¨¡å‹åˆ—è¡¨åº”ç”¨ `sapply()` å‡½æ•°ï¼Œæå– $R^2$ å€¼ã€‚
  - å°†ç»“æœæ•´ç†æˆè¡¨æ ¼ï¼Œä¾¿äºæ¯”è¾ƒã€‚
- **å¯è§†åŒ–**ï¼š
  - ç»˜åˆ¶ $R^2$ å€¼çš„æŸ±çŠ¶å›¾æˆ–ç®±çº¿å›¾ï¼Œç›´è§‚å±•ç¤ºæ¨¡å‹æ€§èƒ½ã€‚


### ä»£ç å®ç°

#### ç»ƒä¹ 3ä»£ç 

```{r, eval=TRUE}
# æ¸…ç†å·¥ä½œç©ºé—´
rm(list = ls())

# åŠ è½½å¿…è¦çš„æ•°æ®é›†å’ŒåŒ…
data(mtcars)
library(ggplot2)
library(gridExtra)
library(grid) # åŠ è½½ grid åŒ…ä»¥ä½¿ç”¨ textGrob

# å®šä¹‰å…¬å¼åˆ—è¡¨
formulas <- list(
  mpg ~ disp,                        # å…¬å¼1ï¼šmpg ä¸ disp çš„çº¿æ€§å…³ç³»
  mpg ~ I(1 / disp),                 # å…¬å¼2ï¼šmpg ä¸ disp çš„å€’æ•°çš„çº¿æ€§å…³ç³»
  mpg ~ disp + wt,                   # å…¬å¼3ï¼šmpg ä¸ disp å’Œ wt çš„çº¿æ€§å…³ç³»
  mpg ~ I(1 / disp) + wt             # å…¬å¼4ï¼šmpg ä¸ disp çš„å€’æ•°å’Œ wt çš„çº¿æ€§å…³ç³»
)

# æ–¹æ³•ä¸€ï¼šä½¿ç”¨ for å¾ªç¯
# åˆå§‹åŒ–ä¸€ä¸ªç©ºåˆ—è¡¨ç”¨äºå­˜å‚¨æ¨¡å‹
models_for <- list()

# éå†å…¬å¼åˆ—è¡¨ï¼Œæ‹Ÿåˆæ¨¡å‹
for (i in seq_along(formulas)) {
  # æå–å½“å‰å…¬å¼
  formula <- formulas[[i]]
  
  # æ‹Ÿåˆçº¿æ€§æ¨¡å‹
  model <- lm(formula, data = mtcars)
  
  # å°†æ¨¡å‹å­˜å…¥åˆ—è¡¨
  models_for[[i]] <- model
}

# æ–¹æ³•äºŒï¼šä½¿ç”¨ lapply() å‡½æ•°
# å®šä¹‰æ¨¡å‹æ‹Ÿåˆå‡½æ•°
fit_lm <- function(formula) {
  lm(formula, data = mtcars)
}

# ä½¿ç”¨ lapply() å¯¹å…¬å¼åˆ—è¡¨è¿›è¡Œæ¨¡å‹æ‹Ÿåˆ
models_lapply <- lapply(formulas, fit_lm)

# æ¯”è¾ƒä¸¤ç§æ–¹æ³•çš„ç»“æœæ˜¯å¦ä¸€è‡´
all.equal(models_for, models_lapply)  # è¿”å› TRUEï¼Œè¡¨ç¤ºä¸€è‡´

# åˆ›å»ºç»˜å›¾åˆ—è¡¨
plot_list <- list()

for (i in seq_along(models_lapply)) {
  # æå–æ¨¡å‹å’Œå…¬å¼
  model <- models_lapply[[i]]
  formula <- formulas[[i]]
  
  # æå–å“åº”å˜é‡å’Œé¢„æµ‹å€¼
  actual <- mtcars$mpg
  predicted <- model$fitted.values
  r_squared <- summary(model)$r.squared
  
  # åˆ›å»ºæ•°æ®æ¡†
  plot_data <- data.frame(Actual = actual, Predicted = predicted)
  
  # åˆ›å»º ggplot å›¾
  p <- ggplot(plot_data, aes(x = Actual, y = Predicted)) +
    geom_point(color = "dodgerblue", size = 1.2, alpha = 0.5) +  # ç‚¹å¤§å°å’Œé€æ˜åº¦è®¾ç½®
    geom_abline(slope = 1, intercept = 0, color = "darkred", linetype = "dashed", linewidth = 0.8) +  # y=x å‚è€ƒçº¿
    theme_minimal(base_size = 12) +  # åŸºç¡€å­—ä½“
    labs(
      title = paste("æ¨¡å‹", i, "ï¼šå®é™…å€¼ vs é¢„æµ‹å€¼"),
      subtitle = paste("RÂ² =", round(r_squared, 3)),
      x = "å®é™…å€¼ (mpg)",
      y = "é¢„æµ‹å€¼ (mpg)"
    ) +
    theme(
      plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
      plot.subtitle = element_text(hjust = 0.5, size = 12, face = "italic"),
      axis.title = element_text(size = 12),
      axis.text = element_text(size = 10),
      panel.grid.major = element_line(color = "grey90"),  # å¢å¼ºç½‘æ ¼å¯¹æ¯”
      panel.grid.minor = element_blank()
    ) +
    coord_equal()  # ä¿æŒæ¯”ä¾‹ä¸€è‡´
  
  # å°†å›¾å­˜å…¥åˆ—è¡¨
  plot_list[[i]] <- p
}

# ç»˜åˆ¶æ‰€æœ‰å›¾ï¼Œä¸»æ ‡é¢˜æ”¾å¤§å­—ä½“
grid.arrange(
  grobs = plot_list,
  ncol = 2,
  top = textGrob("æ¨¡å‹æ¯”è¾ƒï¼šå®é™…å€¼ä¸é¢„æµ‹å€¼", gp = gpar(fontsize = 14, fontface = "bold"))
)

```

**ä»£ç æ¦‚è¿°ï¼š**

- `rm(list = ls())`ï¼šæ¸…ç©ºå½“å‰å·¥ä½œç©ºé—´ï¼Œé‡Šæ”¾å†…å­˜èµ„æºã€‚
- `data(mtcars)`ï¼šåŠ è½½å†…ç½®çš„ `mtcars` æ•°æ®é›†ï¼ŒåŒ…å«32è¾†æ±½è½¦çš„ç›¸å…³æ•°æ®ã€‚
- `formulas`ï¼šå®šä¹‰å››ä¸ªä¸åŒçš„çº¿æ€§æ¨¡å‹å…¬å¼ï¼Œæ¢ç´¢ `mpg` ä¸å…¶ä»–å˜é‡çš„å…³ç³»ã€‚
- **for å¾ªç¯éƒ¨åˆ†**ï¼š
  - `seq_along(formulas)`ï¼šç”Ÿæˆä¸€ä¸ªåºåˆ—ï¼Œç”¨äºéå† `formulas` åˆ—è¡¨çš„ç´¢å¼•ã€‚
  - `lm(formula, data = mtcars)`ï¼šå¯¹å½“å‰å…¬å¼å’Œæ•°æ®è¿›è¡Œçº¿æ€§å›å½’æ‹Ÿåˆã€‚
  - å°†æ‹Ÿåˆçš„æ¨¡å‹å¯¹è±¡å­˜å…¥ `models_for` åˆ—è¡¨ä¸­ã€‚
- **lapply() éƒ¨åˆ†**ï¼š
  - å®šä¹‰äº† `fit_lm()` å‡½æ•°ï¼Œå°†å…¬å¼ä½œä¸ºè¾“å…¥ï¼Œè¿”å›æ‹Ÿåˆçš„æ¨¡å‹å¯¹è±¡ã€‚
  - `lapply(formulas, fit_lm)`ï¼šå¯¹ `formulas` åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…¬å¼åº”ç”¨ `fit_lm()` å‡½æ•°ã€‚
- `all.equal()`ï¼šæ¯”è¾ƒ `models_for` å’Œ `models_lapply` æ˜¯å¦å®Œå…¨ç›¸ç­‰ï¼ŒéªŒè¯ä¸¤ç§æ–¹æ³•çš„ç»“æœä¸€è‡´æ€§ã€‚
- **å¯è§†åŒ–éƒ¨åˆ†**ï¼š
  - **`ggplot2`**ï¼šç”¨äºåˆ›å»ºä¸“ä¸šçº§å›¾å½¢ã€‚**`geom_point()`**ï¼šç”¨äºç»˜åˆ¶è“è‰²æ•£ç‚¹ã€‚**`geom_abline()`**ï¼šç”¨äºç»˜åˆ¶çº¢è‰²è™šçº¿ä½œä¸ºå‚è€ƒçº¿ã€‚**`theme_minimal()`**ï¼šè®¾ç½®æ•´æ´çš„èƒŒæ™¯ï¼Œæ­é…é€‚å½“çš„å­—ä½“å’Œå¤§å°ã€‚**`gridExtra`**ï¼šå°†å¤šä¸ªå›¾å¹¶æ’æ˜¾ç¤ºï¼ŒèŠ‚çœç©ºé—´ã€‚è¿™ç§ç¾åŒ–æ–¹å¼æ›´ç¬¦åˆæ•°æ®ç§‘å­¦æŠ¥å‘Šæˆ–å±•ç¤ºçš„æ ‡å‡†ã€‚
  - éå†æ¯ä¸ªæ¨¡å‹ï¼Œç»˜åˆ¶å®é™…å€¼ä¸é¢„æµ‹å€¼çš„æ•£ç‚¹å›¾ï¼Œè¯„ä¼°æ¨¡å‹çš„æ‹Ÿåˆæ•ˆæœã€‚

#### ç»ƒä¹ 4ä»£ç 

```{r, eval=TRUE}
# æ¸…ç†å·¥ä½œç©ºé—´ï¼Œé‡Šæ”¾å†…å­˜
rm(list = ls())

# åŠ è½½å¿…è¦çš„æ•°æ®é›†
data(mtcars)

# ç”Ÿæˆè‡ªä¸¾æ ·æœ¬åˆ—è¡¨
set.seed(123)  # è®¾ç½®éšæœºç§å­ï¼Œä¿è¯ç»“æœå¯é‡å¤
bootstraps <- lapply(1:10, function(i) {
  # éšæœºæœ‰æ”¾å›åœ°æŠ½å–è¡Œç´¢å¼•
  rows <- sample(1:nrow(mtcars), replace = TRUE)
  # æ ¹æ®æŠ½å–çš„è¡Œç´¢å¼•åˆ›å»ºè‡ªä¸¾æ ·æœ¬
  mtcars[rows, ]
})

# å®šä¹‰æ¨¡å‹æ‹Ÿåˆå‡½æ•°ï¼ˆä¸ä½¿ç”¨åŒ¿åå‡½æ•°ï¼‰
fit_model <- function(data) {
  lm(mpg ~ disp, data = data)
}

# æ–¹æ³•ä¸€ï¼šä½¿ç”¨ for å¾ªç¯
# åˆå§‹åŒ–ä¸€ä¸ªç©ºåˆ—è¡¨ç”¨äºå­˜å‚¨æ¨¡å‹
models_for <- list()

# éå†è‡ªä¸¾æ ·æœ¬åˆ—è¡¨ï¼Œæ‹Ÿåˆæ¨¡å‹
for (i in seq_along(bootstraps)) {
  # æå–å½“å‰è‡ªä¸¾æ ·æœ¬
  bootstrap_sample <- bootstraps[[i]]
  
  # æ‹Ÿåˆçº¿æ€§æ¨¡å‹
  model <- fit_model(bootstrap_sample)
  
  # å°†æ¨¡å‹å­˜å…¥åˆ—è¡¨
  models_for[[i]] <- model
}

# æ–¹æ³•äºŒï¼šä½¿ç”¨ lapply()ï¼Œä¸ä½¿ç”¨åŒ¿åå‡½æ•°
models_lapply <- lapply(bootstraps, fit_model)

# æ¯”è¾ƒä¸¤ç§æ–¹æ³•çš„ç»“æœæ˜¯å¦ä¸€è‡´
all.equal(models_for, models_lapply)  # è¿”å› TRUEï¼Œè¡¨ç¤ºä¸€è‡´

# å¯è§†åŒ–ï¼šç»˜åˆ¶æ¨¡å‹ç³»æ•°çš„åˆ†å¸ƒ
coefficients <- sapply(models_for, function(model) coef(model)[2])  # æå– disp çš„ç³»æ•°

# ç»˜åˆ¶ç³»æ•°çš„ç®±çº¿å›¾
boxplot(coefficients,
        main = "è‡ªä¸¾æ ·æœ¬ä¸­ disp ç³»æ•°çš„åˆ†å¸ƒ",
        ylab = "ç³»æ•°å€¼")
```

**ä»£ç æ¦‚è¿°ï¼š**

- `set.seed(123)`ï¼šè®¾ç½®éšæœºæ•°ç§å­ï¼Œç¡®ä¿è‡ªä¸¾æ ·æœ¬çš„å¯é‡å¤æ€§ã€‚
- `sample(1:nrow(mtcars), replace = TRUE)`ï¼šä» `mtcars` çš„è¡Œç´¢å¼•ä¸­æœ‰æ”¾å›åœ°æŠ½æ ·ï¼Œç”Ÿæˆæ–°çš„æ ·æœ¬ç´¢å¼•ã€‚
- `fit_model()`ï¼šå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥æ•°æ®ï¼Œè¾“å‡ºæ‹Ÿåˆçš„æ¨¡å‹å¯¹è±¡ã€‚
- **for å¾ªç¯éƒ¨åˆ†**ï¼š
  - éå† `bootstraps` åˆ—è¡¨ï¼Œæå–æ¯ä¸ªè‡ªä¸¾æ ·æœ¬ã€‚
  - ä½¿ç”¨ `fit_model()` å¯¹æ ·æœ¬è¿›è¡Œæ¨¡å‹æ‹Ÿåˆã€‚
  - å°†æ¨¡å‹å­˜å…¥ `models_for` åˆ—è¡¨ã€‚
- **lapply() éƒ¨åˆ†**ï¼š
  - ç›´æ¥å¯¹ `bootstraps` åˆ—è¡¨åº”ç”¨ `fit_model()` å‡½æ•°ï¼Œå¾—åˆ°æ¨¡å‹åˆ—è¡¨ã€‚
- `sapply()`ï¼šå¯¹æ¨¡å‹åˆ—è¡¨ä¸­çš„æ¯ä¸ªæ¨¡å‹ï¼Œæå– `disp` çš„ç³»æ•°ï¼ˆæ–œç‡ï¼‰ã€‚
- **å¯è§†åŒ–éƒ¨åˆ†**ï¼š
  - ä½¿ç”¨ `boxplot()` ç»˜åˆ¶ `disp` ç³»æ•°çš„ç®±çº¿å›¾ï¼Œè§‚å¯Ÿç³»æ•°åœ¨ä¸åŒè‡ªä¸¾æ ·æœ¬ä¸­çš„åˆ†å¸ƒæƒ…å†µã€‚

#### ç»ƒä¹ 5ä»£ç 

```{r, eval=TRUE}
# æ¸…ç†å·¥ä½œç©ºé—´ï¼Œé‡Šæ”¾å†…å­˜
rm(list = ls())

# åŠ è½½å¿…è¦çš„æ•°æ®é›†
data(mtcars)

# å®šä¹‰æå– R^2 å€¼çš„å‡½æ•°
rsq <- function(mod) summary(mod)$r.squared

# ç»ƒä¹ 3ï¼šæå–æ¨¡å‹çš„ R^2 å€¼
# å®šä¹‰å…¬å¼åˆ—è¡¨
formulas <- list(
  mpg ~ disp,
  mpg ~ I(1 / disp),
  mpg ~ disp + wt,
  mpg ~ I(1 / disp) + wt
)

# ä½¿ç”¨ lapply() æ‹Ÿåˆæ¨¡å‹
fit_lm <- function(formula) {
  lm(formula, data = mtcars)
}
models_3 <- lapply(formulas, fit_lm)

# æå– R^2 å€¼
rsq_values_3 <- sapply(models_3, rsq)

# åˆ›å»ºç»“æœæ•°æ®æ¡†
results_3 <- data.frame(
  Model = paste("æ¨¡å‹", 1:4),
  Formula = sapply(formulas, function(f) deparse(f)),
  R_squared = rsq_values_3
)

# æ‰“å°ç»“æœ
print("ç»ƒä¹ 3çš„æ¨¡å‹ R^2 å€¼ï¼š")
print(results_3)

# ç»ƒä¹ 4ï¼šæå–è‡ªä¸¾æ ·æœ¬æ¨¡å‹çš„ R^2 å€¼
# ç”Ÿæˆè‡ªä¸¾æ ·æœ¬åˆ—è¡¨
set.seed(123)
bootstraps <- lapply(1:10, function(i) {
  rows <- sample(1:nrow(mtcars), replace = TRUE)
  mtcars[rows, ]
})

# å®šä¹‰æ¨¡å‹æ‹Ÿåˆå‡½æ•°
fit_model <- function(data) {
  lm(mpg ~ disp, data = data)
}

# æ‹Ÿåˆæ¨¡å‹
models_4 <- lapply(bootstraps, fit_model)

# æå– R^2 å€¼
rsq_values_4 <- sapply(models_4, rsq)

# åˆ›å»ºç»“æœæ•°æ®æ¡†
results_4 <- data.frame(
  Bootstrap_Sample = paste("æ ·æœ¬", 1:10),
  R_squared = rsq_values_4
)

# æ‰“å°ç»“æœ
print("ç»ƒä¹ 4çš„è‡ªä¸¾æ ·æœ¬æ¨¡å‹ R^2 å€¼ï¼š")
print(results_4)

# å¯è§†åŒ–ï¼šç»˜åˆ¶ R^2 å€¼çš„æŸ±çŠ¶å›¾
par(mfrow = c(1, 2))  # å°†å›¾å½¢è®¾å¤‡åˆ†ä¸º 1x2 ç½‘æ ¼

# ç»ƒä¹ 3çš„ R^2 å€¼æŸ±çŠ¶å›¾
barplot(rsq_values_3,
        names.arg = paste("æ¨¡å‹", 1:4),
        main = "ç»ƒä¹ 3æ¨¡å‹çš„ R^2 å€¼",
        ylab = "R^2 å€¼",
        col = "skyblue")

# ç»ƒä¹ 4çš„ R^2 å€¼æŸ±çŠ¶å›¾
barplot(rsq_values_4,
        names.arg = paste("æ ·æœ¬", 1:10),
        main = "ç»ƒä¹ 4è‡ªä¸¾æ ·æœ¬æ¨¡å‹çš„ R^2 å€¼",
        ylab = "R^2 å€¼",
        col = "lightgreen",
        las = 2)  # ä½¿ x è½´æ ‡ç­¾å‚ç›´æ˜¾ç¤º

# é‡ç½®å›¾å½¢å‚æ•°
par(mfrow = c(1, 1))
```

**ä»£ç æ¦‚è¿°ï¼š**

- `rsq()`ï¼šå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥æ¨¡å‹å¯¹è±¡ï¼Œè¿”å› $R^2$ å€¼ã€‚
- **ç»ƒä¹ 3éƒ¨åˆ†**ï¼š
  - ä½¿ç”¨ä¹‹å‰å®šä¹‰çš„ `fit_lm()` å‡½æ•°ï¼Œå¯¹ `formulas` åˆ—è¡¨ä¸­çš„å…¬å¼æ‹Ÿåˆæ¨¡å‹ã€‚
  - ä½¿ç”¨ `sapply()` å¯¹æ¨¡å‹åˆ—è¡¨åº”ç”¨ `rsq()` å‡½æ•°ï¼Œæå– $R^2$ å€¼ã€‚
  - å°†ç»“æœæ•´ç†æˆæ•°æ®æ¡† `results_3`ï¼Œä¾¿äºæŸ¥çœ‹å’Œè¾“å‡ºã€‚
- **ç»ƒä¹ 4éƒ¨åˆ†**ï¼š
  - ä½¿ç”¨ä¹‹å‰çš„è‡ªä¸¾æ ·æœ¬å’Œ `fit_model()` å‡½æ•°ï¼Œæ‹Ÿåˆæ¨¡å‹ã€‚
  - æå– $R^2$ å€¼ï¼Œå¹¶æ•´ç†æˆæ•°æ®æ¡† `results_4`ã€‚
- **å¯è§†åŒ–éƒ¨åˆ†**ï¼š
  - ä½¿ç”¨ `barplot()` ç»˜åˆ¶ $R^2$ å€¼çš„æŸ±çŠ¶å›¾ï¼Œç›´è§‚å±•ç¤ºä¸åŒæ¨¡å‹å’Œè‡ªä¸¾æ ·æœ¬çš„æ€§èƒ½ã€‚
  - `par(mfrow = c(1, 2))`ï¼šå°†ç»˜å›¾åŒºåŸŸåˆ†æˆ 1x2 ç½‘æ ¼ï¼Œæ–¹ä¾¿åŒæ—¶æ¯”è¾ƒä¸¤ä¸ªå›¾å½¢ã€‚
  - `las = 2`ï¼šå°† x è½´æ ‡ç­¾æ—‹è½¬ 90 åº¦ï¼Œé˜²æ­¢æ ‡ç­¾è¿‡é•¿é‡å ã€‚


### ç»“æœåˆ†æ

#### ç»ƒä¹ 3åˆ†æ

- **$R^2$ å€¼æ¯”è¾ƒ**ï¼š

  ```r
      Model                Formula             R_squared
  1   æ¨¡å‹1             "mpg ~ disp"           0.7183433
  2   æ¨¡å‹2           "mpg ~ I(1/disp)"        0.8596865
  3   æ¨¡å‹3           "mpg ~ disp + wt"        0.7809306	
  4   æ¨¡å‹4         "mpg ~ I(1/disp) + wt"     0.8838038	
  ```

- **åˆ†æ**ï¼š

  - **æ¨¡å‹1**å’Œ**æ¨¡å‹2**ä»…è€ƒè™‘äº† `disp`ï¼ˆæ’é‡ï¼‰æˆ–å…¶å€’æ•°ï¼Œå¯¹ `mpg`ï¼ˆæ²¹è€—ï¼‰è¿›è¡Œé¢„æµ‹ï¼Œ$R^2$ å€¼åˆ†åˆ«ä¸º 0.718 å’Œ 0.859ï¼Œè¯´æ˜æ’é‡å¯¹æ²¹è€—æœ‰æ˜¾è‘—å½±å“ã€‚
  - **æ¨¡å‹3**å’Œ**æ¨¡å‹4**åœ¨å‰ä¸¤ä¸ªæ¨¡å‹çš„åŸºç¡€ä¸ŠåŠ å…¥äº† `wt`ï¼ˆè½¦é‡ï¼‰å˜é‡ï¼Œ$R^2$ å€¼æé«˜åˆ°çº¦ 0.884ï¼Œè¯´æ˜è½¦é‡ä¹Ÿæ˜¯å½±å“æ²¹è€—çš„é‡è¦å› ç´ ã€‚
  - **ç»“è®º**ï¼šåŠ å…¥æ›´å¤šç›¸å…³å˜é‡å¯ä»¥æé«˜æ¨¡å‹çš„è§£é‡Šèƒ½åŠ›ã€‚

- **å¯è§†åŒ–åˆ†æ**ï¼š

  - ä»å®é™…å€¼ä¸é¢„æµ‹å€¼çš„å¯¹æ¯”å›¾å¯ä»¥çœ‹å‡ºï¼Œæ¨¡å‹2å’Œæ¨¡å‹4çš„é¢„æµ‹å€¼æ›´æ¥è¿‘å®é™…å€¼ï¼Œæ•°æ®ç‚¹æ›´æ¥è¿‘å‚è€ƒçº¿ $y = x$ã€‚

#### ç»ƒä¹ 4åˆ†æ

- **$R^2$ å€¼ç»“æœ**ï¼š

  ```r
            Bootstrap_Sample       R_squared
  1             æ ·æœ¬ 1             0.6497636
  2             æ ·æœ¬ 2             0.6820834
  3             æ ·æœ¬ 3             0.7530595
  4             æ ·æœ¬ 4             0.6101709
  5             æ ·æœ¬ 5             0.7226119
  6             æ ·æœ¬ 6             0.7533418
  7             æ ·æœ¬ 7             0.7311415	
  8             æ ·æœ¬ 8             0.6293502
  9             æ ·æœ¬ 9             0.6554375
  10            æ ·æœ¬ 10            0.7238971
  ```

- **åˆ†æ**ï¼š

  - $R^2$ å€¼åœ¨ä¸åŒè‡ªä¸¾æ ·æœ¬ä¸­æœ‰æ‰€æ³¢åŠ¨ï¼ŒèŒƒå›´å¤§çº¦åœ¨ 0.610 åˆ° 0.753 ä¹‹é—´ã€‚
  - è¿™åæ˜ äº†æ¨¡å‹åœ¨ä¸åŒæ ·æœ¬ä¸Šçš„ç¨³å®šæ€§ï¼Œè¯´æ˜å³ä½¿æ•°æ®æœ‰ä¸€å®šçš„å˜åŠ¨ï¼Œæ¨¡å‹çš„æ€§èƒ½ä»ç„¶è¾ƒä¸ºç¨³å®šã€‚

- **ç³»æ•°åˆ†å¸ƒåˆ†æ**ï¼š

  - ä» `disp` ç³»æ•°çš„ç®±çº¿å›¾å¯ä»¥è§‚å¯Ÿåˆ°ç³»æ•°çš„å˜åŠ¨èŒƒå›´ï¼Œå¤§éƒ¨åˆ†ç³»æ•°é›†ä¸­åœ¨æŸä¸€åŒºé—´ï¼Œè¯´æ˜æ¨¡å‹å‚æ•°ä¼°è®¡å…·æœ‰ä¸€å®šçš„ç¨³å®šæ€§ã€‚

#### ç»ƒä¹ 5åˆ†æ

- **æ¨¡å‹æ€§èƒ½æ¯”è¾ƒ**ï¼š
  - **ç»ƒä¹ 3**ä¸­çš„æ¨¡å‹ç”±äºå¼•å…¥äº†æ›´å¤šçš„å˜é‡ï¼Œ$R^2$ å€¼æ™®éé«˜äº **ç»ƒä¹ 4** ä¸­çš„æ¨¡å‹ã€‚
  - **ç»ƒä¹ 4**ä¸­çš„ $R^2$ å€¼åæ˜ äº†æ¨¡å‹åœ¨ä¸åŒè‡ªä¸¾æ ·æœ¬ä¸‹çš„æ€§èƒ½ï¼Œæ³¢åŠ¨èŒƒå›´è¾ƒå°ï¼Œè¯´æ˜æ¨¡å‹å…·æœ‰è‰¯å¥½çš„æ³›åŒ–èƒ½åŠ›ã€‚

- **å¯è§†åŒ–åˆ†æ**ï¼š
  - **æŸ±çŠ¶å›¾**ç›´è§‚å±•ç¤ºäº† $R^2$ å€¼çš„å¤§å°å’Œå·®å¼‚ï¼Œä¾¿äºæ¯”è¾ƒä¸åŒæ¨¡å‹å’Œæ ·æœ¬çš„æ€§èƒ½ã€‚
  - **ç»ƒä¹ 3**çš„æ¨¡å‹ $R^2$ å€¼æ˜æ˜¾é«˜äº **ç»ƒä¹ 4**ï¼ŒéªŒè¯äº†å¼•å…¥æ›´å¤šç›¸å…³å˜é‡çš„é‡è¦æ€§ã€‚


------------------------------------------------------------------------

## é—®é¢˜3 ç»ƒä¹ 3å’Œ6

### é¢˜ç›®æè¿°

ç»ƒä¹  3 å’Œ 6ï¼ˆã€ŠAdvanced Rã€‹ç¬¬ 213-214 é¡µï¼‰ã€‚

-   **ç»ƒä¹  3**  
ä»¥ä¸‹ä»£ç æ¨¡æ‹Ÿäº†åœ¨éæ­£æ€æ•°æ®ä¸‹ t æ£€éªŒçš„æ€§èƒ½ã€‚ä½¿ç”¨ `sapply()` å’ŒåŒ¿åå‡½æ•°ä»æ¯ä¸ªè¯•éªŒä¸­æå– p å€¼ã€‚
```r
trials <- replicate(
  100,
  t.test(rpois(10, 10), rpois(7, 10)),
  simplify = FALSE
)
```
é¢å¤–æŒ‘æˆ˜ï¼šé€šè¿‡ç›´æ¥ä½¿ç”¨ `[[` æ¥æ¶ˆé™¤åŒ¿åå‡½æ•°ã€‚

-   **ç»ƒä¹  6**  
å®ç°ä¸€ä¸ªç»“åˆ `Map()` å’Œ `vapply()` çš„å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªç±»ä¼¼äº `lapply()` çš„å˜ä½“ï¼Œå®ƒèƒ½å¤Ÿå¹¶è¡Œéå†æ‰€æœ‰è¾“å…¥å¹¶å°†è¾“å‡ºå­˜å‚¨åœ¨ä¸€ä¸ªå‘é‡ï¼ˆæˆ–çŸ©é˜µï¼‰ä¸­ã€‚è¯¥å‡½æ•°åº”è¯¥æ¥å—å“ªäº›å‚æ•°ï¼Ÿ


### è§£ç­”æ€è·¯

#### ç»ƒä¹ 3æ€è·¯

- **ç›®æ ‡**ï¼šä» 100 æ¬¡ t æ£€éªŒç»“æœä¸­æå–æ¯ä¸ªæ£€éªŒçš„ p å€¼ã€‚
- **ç†è§£æ•°æ®ç»“æ„**ï¼š
  - `trials` æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º 100 çš„åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ `t.test()` çš„ç»“æœï¼Œæ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªç»„ä»¶çš„åˆ—è¡¨ã€‚
- **æå– p å€¼**ï¼š
  - æ¯ä¸ª `t.test()` çš„ç»“æœä¸­ï¼Œp å€¼å­˜å‚¨åœ¨ `p.value` ç»„ä»¶ä¸­ï¼Œå³ `trial[[i]]$p.value`ã€‚
- **ä½¿ç”¨ `sapply()` å’ŒåŒ¿åå‡½æ•°**ï¼š
  - `sapply()` å¯ä»¥å¯¹åˆ—è¡¨è¿›è¡Œéå†ï¼ŒåŒ¿åå‡½æ•°ç”¨äºæŒ‡å®šæå– `p.value` çš„æ“ä½œã€‚
- **é¢å¤–æŒ‘æˆ˜**ï¼š
  - ç›´æ¥ä½¿ç”¨ `[[` æå–åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œé¿å…ä½¿ç”¨åŒ¿åå‡½æ•°ã€‚

#### ç»ƒä¹ 6æ€è·¯

- **ç›®æ ‡**ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œç±»ä¼¼äº `lapply()`ï¼Œä½†èƒ½å¤Ÿå¹¶è¡Œéå†å¤šä¸ªè¾“å…¥ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨ä¸€ä¸ªå‘é‡æˆ–çŸ©é˜µä¸­ã€‚
- **ç†è§£å‡½æ•°**ï¼š
  - `Map()`ï¼šå¯ä»¥å¹¶è¡Œåœ°éå†å¤šä¸ªåˆ—è¡¨ï¼Œç›¸å½“äºå¤šå‚æ•°çš„ `mapply()`ï¼Œä½†é»˜è®¤ç®€åŒ–ç»“æœä¸ºåˆ—è¡¨ã€‚
  - `vapply()`ï¼šç±»ä¼¼äº `sapply()`ï¼Œä½†éœ€è¦æŒ‡å®šè¾“å‡ºçš„ç±»å‹å’Œé•¿åº¦ï¼Œæ›´åŠ å®‰å…¨å’Œé«˜æ•ˆã€‚
- **å®ç°æ–¹æ³•**ï¼š
  - ç»“åˆ `Map()` çš„å¹¶è¡Œéå†èƒ½åŠ›å’Œ `vapply()` çš„ç»“æœç±»å‹æ§åˆ¶ï¼Œåˆ›å»ºæ–°çš„å‡½æ•°ã€‚
- **å‡½æ•°å‚æ•°è®¾è®¡**ï¼š
  - **FUN**ï¼šè¦åº”ç”¨çš„å‡½æ•°ã€‚
  - **...**ï¼šå¤šä¸ªå¹¶è¡Œéå†çš„è¾“å…¥åˆ—è¡¨ã€‚
  - **FUN.VALUE**ï¼šæŒ‡å®šè¾“å‡ºçš„ç±»å‹å’Œé•¿åº¦ï¼Œç”¨äº `vapply()`ã€‚
- **æ³¨æ„äº‹é¡¹**ï¼š
  - ç¡®ä¿å‡½æ•°å¯¹æ‰€æœ‰è¾“å…¥åˆ—è¡¨è¿›è¡Œå¹¶è¡Œéå†ï¼Œé•¿åº¦éœ€è¦ä¸€è‡´ã€‚
  - æä¾›é€‚å½“çš„é”™è¯¯æ£€æŸ¥ï¼Œé˜²æ­¢è¾“å…¥ä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜ã€‚

### ä»£ç å®ç°

#### ç»ƒä¹ 3ä»£ç 

```{r, eval=TRUE}
# æ¸…ç†å·¥ä½œç©ºé—´ï¼Œé‡Šæ”¾å†…å­˜
rm(list = ls())

# è®¾ç½®éšæœºæ•°ç§å­ï¼Œç¡®ä¿ç»“æœå¯é‡å¤
set.seed(125)

# æ¨¡æ‹Ÿ t æ£€éªŒçš„ç»“æœ
trials <- replicate(
  100,
  t.test(rpois(10, 10), rpois(7, 10)),
  simplify = FALSE
)

# æ–¹æ³•ä¸€ï¼šä½¿ç”¨ sapply() å’ŒåŒ¿åå‡½æ•°æå– p å€¼
p_values_anonymous <- sapply(trials, function(test) {
  # ä» t æ£€éªŒç»“æœä¸­æå– p å€¼
  test$p.value
})

# æ–¹æ³•äºŒï¼šç›´æ¥ä½¿ç”¨ [[ æå– p å€¼ï¼Œæ¶ˆé™¤åŒ¿åå‡½æ•°
p_values_direct <- sapply(trials, `[[`, "p.value")

# éªŒè¯ä¸¤ç§æ–¹æ³•çš„ç»“æœæ˜¯å¦ä¸€è‡´
all.equal(p_values_anonymous, p_values_direct)  # è¿”å› TRUEï¼Œè¡¨ç¤ºä¸€è‡´

# å¯è§†åŒ–ç»“æœï¼šç»˜åˆ¶ p å€¼çš„ç›´æ–¹å›¾
hist(p_values_direct,
     breaks = 20,
     main = "t æ£€éªŒçš„ p å€¼åˆ†å¸ƒ",
     xlab = "p å€¼",
     col = "lightblue",
     border = "white")

# æ·»åŠ æ˜¾è‘—æ€§æ°´å¹³çš„å‚è€ƒçº¿ï¼ˆä¾‹å¦‚ 0.05ï¼‰
abline(v = 0.05, col = "red", lwd = 2, lty = 2)
```

**ä»£ç æ¦‚è¿°ï¼š**

- **æ¸…ç†å†…å­˜**ï¼š`rm(list = ls())` æ¸…é™¤æ‰€æœ‰å˜é‡ï¼Œé‡Šæ”¾å†…å­˜ã€‚
- **è®¾ç½®éšæœºç§å­**ï¼š`set.seed(123)` ç¡®ä¿éšæœºç»“æœå¯é‡å¤ã€‚
- **æ¨¡æ‹Ÿ t æ£€éªŒ**ï¼š
  - `rpois(10, 10)` ç”Ÿæˆæœä»æ³Šæ¾åˆ†å¸ƒçš„éšæœºæ•°ï¼Œæ ·æœ¬å¤§å°ä¸º 10ï¼Œå‡å€¼ä¸º 10ã€‚
  - `t.test()` å¯¹ä¸¤ä¸ªç‹¬ç«‹æ ·æœ¬è¿›è¡Œ t æ£€éªŒã€‚
  - `replicate()` é‡å¤ä¸Šè¿°è¿‡ç¨‹ 100 æ¬¡ï¼Œç»“æœå­˜å‚¨åœ¨åˆ—è¡¨ä¸­ã€‚
- **æå– p å€¼**ï¼š
  - **æ–¹æ³•ä¸€**ï¼šä½¿ç”¨ `sapply()` å’ŒåŒ¿åå‡½æ•°ï¼Œéå† `trials` åˆ—è¡¨ï¼Œæå–æ¯ä¸ª t æ£€éªŒç»“æœçš„ `p.value`ã€‚
  - **æ–¹æ³•äºŒ**ï¼šä½¿ç”¨ `sapply()` å’Œ `[[`ï¼Œç›´æ¥æå–åˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ çš„ `p.value`ï¼Œæ— éœ€åŒ¿åå‡½æ•°ã€‚
- **éªŒè¯ç»“æœä¸€è‡´æ€§**ï¼šä½¿ç”¨ `all.equal()` æ¯”è¾ƒä¸¤ç§æ–¹æ³•çš„ç»“æœã€‚
- **å¯è§†åŒ–**ï¼š
  - ä½¿ç”¨ `hist()` ç»˜åˆ¶ p å€¼çš„ç›´æ–¹å›¾ï¼Œè§‚å¯Ÿ p å€¼çš„åˆ†å¸ƒæƒ…å†µã€‚
  - ä½¿ç”¨ `abline()` æ·»åŠ å‚è€ƒçº¿ï¼Œæ ‡æ³¨æ˜¾è‘—æ€§æ°´å¹³ï¼ˆå¦‚ 0.05ï¼‰ã€‚


#### ç»ƒä¹ 6ä»£ç 

```{r, eval=TRUE}
# å®šä¹‰æ–°çš„å‡½æ•° my_lapply_parallel
my_lapply_parallel <- function(FUN, ..., FUN.VALUE) {
  # å°†æ‰€æœ‰è¾“å…¥åˆ—è¡¨ç»„åˆæˆä¸€ä¸ªåˆ—è¡¨
  inputs <- list(...)
  
  # æ£€æŸ¥æ‰€æœ‰è¾“å…¥åˆ—è¡¨çš„é•¿åº¦æ˜¯å¦ä¸€è‡´
  lengths <- sapply(inputs, length)
  if (!all(lengths == lengths[1])) {
    stop("æ‰€æœ‰è¾“å…¥åˆ—è¡¨çš„é•¿åº¦å¿…é¡»ä¸€è‡´ï¼")
  }
  
  # ä½¿ç”¨ Map() å¹¶è¡Œéå†æ‰€æœ‰è¾“å…¥åˆ—è¡¨ï¼Œåº”ç”¨å‡½æ•° FUN
  results_list <- Map(FUN, ...)
  
  # ä½¿ç”¨ vapply() å°†ç»“æœè½¬æ¢ä¸ºæŒ‡å®šç±»å‹çš„å‘é‡æˆ–çŸ©é˜µ
  results <- vapply(results_list, identity, FUN.VALUE = FUN.VALUE)
  
  return(results)
}

# ç¤ºä¾‹ï¼šå¹¶è¡Œéå†ä¸¤ä¸ªå‘é‡ï¼Œè®¡ç®—å®ƒä»¬çš„ä¹˜ç§¯ï¼Œç»“æœä¸ºæ•°å€¼å‘é‡
vec1 <- 1:5
vec2 <- 6:10

# å®šä¹‰è¦åº”ç”¨çš„å‡½æ•°
multiply <- function(x, y) {
  x * y
}

# æŒ‡å®šè¾“å‡ºçš„ç±»å‹å’Œé•¿åº¦
fun_value <- numeric(1)

# ä½¿ç”¨è‡ªå®šä¹‰çš„ my_lapply_parallel å‡½æ•°
result <- my_lapply_parallel(multiply, vec1, vec2, FUN.VALUE = fun_value)

# æ‰“å°ç»“æœ
print("ä¸¤ä¸ªå‘é‡å¯¹åº”å…ƒç´ çš„ä¹˜ç§¯ï¼š")
print(result)

# å¯è§†åŒ–ç»“æœï¼šç»˜åˆ¶ç»“æœçš„æŸ±çŠ¶å›¾
barplot(result,
        names.arg = paste(vec1, "*", vec2),
        main = "ä¸¤ä¸ªå‘é‡å…ƒç´ ä¹˜ç§¯çš„æŸ±çŠ¶å›¾",
        xlab = "å…ƒç´ å¯¹",
        ylab = "ä¹˜ç§¯",
        col = "orange")
```

**ä»£ç æ¦‚è¿°ï¼š**

- **å®šä¹‰å‡½æ•°**ï¼š`my_lapply_parallel()`ï¼Œæ¥å—å‚æ•°ï¼š
  - **FUN**ï¼šè¦åº”ç”¨çš„å‡½æ•°ã€‚
  - **...**ï¼šéœ€è¦å¹¶è¡Œéå†çš„è¾“å…¥åˆ—è¡¨ã€‚
  - **FUN.VALUE**ï¼šæŒ‡å®šè¾“å‡ºçš„ç±»å‹å’Œé•¿åº¦ï¼Œç”¨äº `vapply()`ã€‚
- **å‡½æ•°å†…éƒ¨**ï¼š
  - **è¾“å…¥æ£€æŸ¥**ï¼šä½¿ç”¨ `sapply()` æ£€æŸ¥æ‰€æœ‰è¾“å…¥åˆ—è¡¨çš„é•¿åº¦æ˜¯å¦ä¸€è‡´ï¼Œè‹¥ä¸ä¸€è‡´åˆ™æŠ¥é”™ã€‚
  - **å¹¶è¡Œéå†**ï¼šä½¿ç”¨ `Map()` å¯¹æ‰€æœ‰è¾“å…¥åˆ—è¡¨å¹¶è¡Œéå†ï¼Œåº”ç”¨å‡½æ•° `FUN`ã€‚
  - **ç»“æœè½¬æ¢**ï¼šä½¿ç”¨ `vapply()` å°†ç»“æœåˆ—è¡¨è½¬æ¢ä¸ºæŒ‡å®šç±»å‹çš„å‘é‡æˆ–çŸ©é˜µã€‚
- **ç¤ºä¾‹ä½¿ç”¨**ï¼š
  - å®šä¹‰äº†ä¸¤ä¸ªå‘é‡ `vec1` å’Œ `vec2`ã€‚
  - å®šä¹‰äº†è¦åº”ç”¨çš„å‡½æ•° `multiply()`ï¼Œè®¡ç®—ä¸¤ä¸ªæ•°çš„ä¹˜ç§¯ã€‚
  - æŒ‡å®š `FUN.VALUE` ä¸º `numeric(1)`ï¼Œè¡¨ç¤ºæ¯æ¬¡å‡½æ•°è¿”å›ä¸€ä¸ªæ•°å€¼ã€‚
  - è°ƒç”¨ `my_lapply_parallel()`ï¼Œå¾—åˆ°ä¸¤ä¸ªå‘é‡å¯¹åº”å…ƒç´ ä¹˜ç§¯çš„ç»“æœã€‚
- **å¯è§†åŒ–**ï¼š
  - ä½¿ç”¨ `barplot()` ç»˜åˆ¶ä¹˜ç§¯ç»“æœçš„æŸ±çŠ¶å›¾ï¼Œç›´è§‚å±•ç¤ºè®¡ç®—ç»“æœã€‚


### ç»“æœåˆ†æ

#### ç»ƒä¹ 3åˆ†æ

```{r, eval=TRUE}
# å¯è§†åŒ–ç»“æœï¼šç»˜åˆ¶ p å€¼çš„ç›´æ–¹å›¾
hist(p_values_direct,
     breaks = 20,
     main = "t æ£€éªŒçš„ p å€¼åˆ†å¸ƒ",
     xlab = "p å€¼",
     col = "lightblue",
     border = "white")

# æ·»åŠ æ˜¾è‘—æ€§æ°´å¹³çš„å‚è€ƒçº¿ï¼ˆä¾‹å¦‚ 0.05ï¼‰
abline(v = 0.05, col = "red", lwd = 2, lty = 2)
```

- **p å€¼çš„åˆ†å¸ƒ**ï¼š
  - ä»ç›´æ–¹å›¾å¯ä»¥çœ‹å‡ºï¼Œp å€¼åœ¨ 0 åˆ° 1 ä¹‹é—´åˆ†å¸ƒï¼Œå¤§éƒ¨åˆ†é›†ä¸­åœ¨è¾ƒå¤§çš„æ•°å€¼åŒºåŸŸã€‚
  - è¿™å¯èƒ½æ˜¯ç”±äºåœ¨éæ­£æ€æ•°æ®ä¸‹ï¼Œt æ£€éªŒçš„ç»Ÿè®¡æ€§èƒ½å—åˆ°å½±å“ï¼Œå¯¼è‡´æ£€éªŒçš„æ˜¾è‘—æ€§é™ä½ã€‚
- **æ˜¾è‘—æ€§æ°´å¹³**ï¼š
  - åœ¨å›¾ä¸­æ·»åŠ äº†æ˜¾è‘—æ€§æ°´å¹³çš„å‚è€ƒçº¿ï¼ˆp = 0.05ï¼‰ï¼Œå¯ä»¥ç›´è§‚åœ°çœ‹åˆ°æœ‰å¤šå°‘æ¬¡è¯•éªŒçš„ p å€¼ä½äº 0.05ã€‚
  - å¤§éƒ¨åˆ† p å€¼é«˜äº 0.05ï¼Œè¯´æ˜åœ¨è¿™äº›è¯•éªŒä¸­æ— æ³•æ‹’ç»åŸå‡è®¾ï¼Œå³ä¸¤ä¸ªæ ·æœ¬çš„å‡å€¼æ²¡æœ‰æ˜¾è‘—å·®å¼‚ã€‚
- **ä»£ç æ€§èƒ½**ï¼š
  - ä½¿ç”¨ `sapply()` å’ŒåŒ¿åå‡½æ•°ï¼Œå¯ä»¥ç®€æ´åœ°æå–åˆ—è¡¨ä¸­çš„ç‰¹å®šå…ƒç´ ã€‚
  - é€šè¿‡ç›´æ¥ä½¿ç”¨ `[[`ï¼Œè¿›ä¸€æ­¥ç®€åŒ–äº†ä»£ç ï¼Œé¿å…äº†åŒ¿åå‡½æ•°çš„ä½¿ç”¨ï¼Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œæ•ˆç‡ã€‚

#### ç»ƒä¹ 6åˆ†æ

- **å‡½æ•°åŠŸèƒ½**ï¼š
  - è‡ªå®šä¹‰çš„ `my_lapply_parallel()` å‡½æ•°æˆåŠŸåœ°ç»“åˆäº† `Map()` çš„å¹¶è¡Œéå†èƒ½åŠ›å’Œ `vapply()` çš„ç»“æœç±»å‹æ§åˆ¶ã€‚
  - è¯¥å‡½æ•°èƒ½å¤Ÿå¯¹å¤šä¸ªè¾“å…¥åˆ—è¡¨è¿›è¡Œå¹¶è¡Œéå†ï¼Œåº”ç”¨æŒ‡å®šçš„å‡½æ•°ï¼Œå¹¶å°†ç»“æœå­˜å‚¨ä¸ºæŒ‡å®šç±»å‹çš„å‘é‡æˆ–çŸ©é˜µã€‚
- **å‚æ•°è®¾è®¡**ï¼š
  - **FUN**ï¼šè¦åº”ç”¨çš„å‡½æ•°ï¼Œå¯ä»¥æ¥å—å¤šä¸ªå‚æ•°ã€‚
  - **...**ï¼šéœ€è¦å¹¶è¡Œéå†çš„è¾“å…¥åˆ—è¡¨ï¼Œæ•°é‡ä¸é™ã€‚
  - **FUN.VALUE**ï¼šæŒ‡å®šè¾“å‡ºçš„ç±»å‹å’Œé•¿åº¦ï¼Œç¡®ä¿ç»“æœçš„ä¸€è‡´æ€§å’Œå®‰å…¨æ€§ã€‚
- **ç¤ºä¾‹ç»“æœ**ï¼š

```{r, eval=TRUE}
# å¯è§†åŒ–ç»“æœï¼šç»˜åˆ¶ç»“æœçš„æŸ±çŠ¶å›¾
barplot(result,
        names.arg = paste(vec1, "*", vec2),
        main = "ä¸¤ä¸ªå‘é‡å…ƒç´ ä¹˜ç§¯çš„æŸ±çŠ¶å›¾",
        xlab = "å…ƒç´ å¯¹",
        ylab = "ä¹˜ç§¯",
        col = "orange")
```

  - å¯¹äºä¸¤ä¸ªå‘é‡ `vec1` å’Œ `vec2`ï¼Œè®¡ç®—å¯¹åº”å…ƒç´ çš„ä¹˜ç§¯ï¼Œç»“æœä¸ºæ•°å€¼å‘é‡ `[6, 14, 24, 36, 50]`ã€‚
  - æŸ±çŠ¶å›¾ç›´è§‚åœ°å±•ç¤ºäº†ä¹˜ç§¯ç»“æœï¼ŒéªŒè¯äº†å‡½æ•°çš„æ­£ç¡®æ€§ã€‚
- **ä¼˜åŠ¿**ï¼š
  - è¯¥å‡½æ•°æä¾›äº†æ›´é«˜çš„çµæ´»æ€§ï¼Œå¯ä»¥å¤„ç†å¤šè¾“å…¥ã€å¤šè¾“å‡ºçš„æƒ…å†µã€‚
  - é€šè¿‡æŒ‡å®š `FUN.VALUE`ï¼Œç¡®ä¿äº†è¾“å‡ºç»“æœçš„ç±»å‹å’Œå½¢çŠ¶ï¼Œé¿å…äº† `sapply()` å¯èƒ½å‡ºç°çš„ä¸ä¸€è‡´æ€§é—®é¢˜ã€‚


------------------------------------------------------------------------

## é—®é¢˜4 ç»ƒä¹ 4å’Œ5

### é¢˜ç›®æè¿°

ç»ƒä¹  4 å’Œ 5ï¼ˆã€ŠAdvanced Rã€‹ç¬¬ 365-366 é¡µï¼‰ã€‚

-   **ç»ƒä¹  3**  
ç¼–å†™ä¸€ä¸ªæ›´å¿«çš„ `chisq.test()` ç‰ˆæœ¬ï¼Œåªè®¡ç®—è¾“å…¥ä¸º **ä¸¤ä¸ªæ— ç¼ºå¤±å€¼çš„æ•°å€¼å‘é‡** æ—¶çš„å¡æ–¹æ£€éªŒç»Ÿè®¡é‡ã€‚ä½ å¯ä»¥å°è¯•ç®€åŒ– `chisq.test()` æˆ–æ ¹æ®æ•°å­¦å®šä¹‰ç¼–å†™ä»£ç ï¼ˆ[http://en.wikipedia.org/wiki/Pearson%27s_chi-squared_test](http://en.wikipedia.org/wiki/Pearson%27s_chi-squared_test)ï¼‰ã€‚

-   **ç»ƒä¹  6**  
å½“è¾“å…¥ä¸º**ä¸¤ä¸ªæ— ç¼ºå¤±å€¼çš„æ•´æ•°å‘é‡**æ—¶ï¼Œèƒ½å¦ç¼–å†™ä¸€ä¸ªæ›´å¿«çš„ `table()` å‡½æ•°ç‰ˆæœ¬ï¼Ÿä½ èƒ½åˆ©ç”¨å®ƒæ¥åŠ é€Ÿä½ çš„å¡æ–¹æ£€éªŒå—ï¼Ÿ


### è§£ç­”æ€è·¯

#### ç»ƒä¹ 4æ€è·¯

**ç›®æ ‡**ï¼šå®ç°ä¸€ä¸ªä¸“é—¨ç”¨äºå¤„ç†**ä¸¤ä¸ªæ— ç¼ºå¤±å€¼çš„æ•°å€¼å‘é‡**çš„å¡æ–¹æ£€éªŒå‡½æ•°ï¼Œè¯¥å‡½æ•°åªè®¡ç®—å¡æ–¹æ£€éªŒç»Ÿè®¡é‡ï¼Œä¸”æ¯”å†…ç½®çš„ `chisq.test()` æ›´å¿«ã€‚

**å¡æ–¹æ£€éªŒåŸç†**ï¼š

å¡æ–¹æ£€éªŒç”¨äºæ£€éªŒä¸¤ä¸ªåˆ†ç±»å˜é‡ä¹‹é—´æ˜¯å¦ç‹¬ç«‹ã€‚å…¶åŸºæœ¬æ­¥éª¤ä¸ºï¼š

1. **æ„å»ºåˆ—è”è¡¨ï¼ˆContingency Tableï¼‰**ï¼šç»Ÿè®¡ä¸¤ä¸ªåˆ†ç±»å˜é‡å„æ°´å¹³ç»„åˆçš„é¢‘æ•°ï¼Œå½¢æˆä¸€ä¸ª $r \times c$ çš„åˆ—è”è¡¨ï¼Œå…¶ä¸­ $r$ æ˜¯ç¬¬ä¸€ä¸ªå˜é‡çš„åˆ†ç±»æ•°ï¼Œ$c$ æ˜¯ç¬¬äºŒä¸ªå˜é‡çš„åˆ†ç±»æ•°ã€‚

2. **è®¡ç®—æœŸæœ›é¢‘æ•°ï¼ˆExpected Frequenciesï¼‰**ï¼š

   å¯¹äºåˆ—è”è¡¨ä¸­çš„æ¯ä¸€ä¸ªå•å…ƒæ ¼ï¼Œå…¶æœŸæœ›é¢‘æ•°è®¡ç®—å…¬å¼ä¸ºï¼š

   $$
   E_{ij} = \frac{R_i \times C_j}{N}
   $$
   å…¶ä¸­ï¼š

   - $E_{ij}$ï¼šç¬¬ $i$ è¡Œç¬¬ $j$ åˆ—çš„æœŸæœ›é¢‘æ•°ã€‚
   - $R_i$ï¼šç¬¬ $i$ è¡Œçš„è¾¹é™…æ€»å’Œï¼ˆRow Totalï¼‰ã€‚
   - $C_j$ï¼šç¬¬ $j$ åˆ—çš„è¾¹é™…æ€»å’Œï¼ˆColumn Totalï¼‰ã€‚
   - $N$ï¼šæ€»æ ·æœ¬æ•°ã€‚

3. **è®¡ç®—å¡æ–¹æ£€éªŒç»Ÿè®¡é‡**ï¼š

   $$
   \chi^2 = \sum_{i=1}^{r} \sum_{j=1}^{c} \frac{(O_{ij} - E_{ij})^2}{E_{ij}}
   $$
   å…¶ä¸­ï¼š

   - $O_{ij}$ï¼šè§‚å¯Ÿé¢‘æ•°ï¼ˆObserved Frequencyï¼‰ã€‚
   - $E_{ij}$ï¼šæœŸæœ›é¢‘æ•°ã€‚

4. **è®¡ç®—è‡ªç”±åº¦ï¼ˆDegrees of Freedomï¼‰**ï¼š

   $$
   df = (r - 1) \times (c - 1)
   $$

5. **è®¡ç®— p å€¼**ï¼š

   ä½¿ç”¨å¡æ–¹åˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°è®¡ç®—å¯¹åº”çš„ p å€¼ï¼š

   $$
   p\text{-value} = P(\chi^2 \geq \chi^2_{\text{obs}}) = 1 - F(\chi^2_{\text{obs}}; df)
   $$
   å…¶ä¸­ $F$ æ˜¯å¡æ–¹åˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ã€‚

**ä¼˜åŒ–æ–¹æ³•**ï¼š

- **ç®€åŒ–æ•°æ®å¤„ç†**ï¼šç”±äºè¾“å…¥æ•°æ®ä¸ºæ•°å€¼å‘é‡ä¸”æ— ç¼ºå¤±å€¼ï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥æ•°æ®æ£€æŸ¥ã€ç¼ºå¤±å€¼å¤„ç†ç­‰æ­¥éª¤ã€‚

- **ç›´æ¥è®¡ç®—**ï¼šæ ¹æ®ä¸Šè¿°æ•°å­¦å…¬å¼ï¼Œç›´æ¥è®¡ç®—å¡æ–¹ç»Ÿè®¡é‡å’Œ p å€¼ï¼Œé¿å…è°ƒç”¨å¤æ‚çš„å†…ç½®å‡½æ•°ã€‚

- **æ•°å€¼ç¨³å®šæ€§**ï¼šåœ¨è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œæ³¨æ„é˜²æ­¢é™¤é›¶é”™è¯¯å’Œæ•°å€¼ä¸Šæº¢æˆ–ä¸‹æº¢ã€‚

**å…·ä½“æ­¥éª¤**ï¼š

1. å°†æ•°å€¼å‘é‡è½¬æ¢ä¸ºå› å­ï¼ˆåˆ†ç±»å˜é‡ï¼‰ï¼Œè·å–æ¯ä¸ªå˜é‡çš„åˆ†ç±»æ°´å¹³ã€‚

2. æ„å»ºè§‚å¯Ÿé¢‘æ•°çŸ©é˜µï¼ˆåˆ—è”è¡¨ï¼‰ã€‚

3. è®¡ç®—è¡Œå’Œã€åˆ—å’Œã€æ€»å’Œã€‚

4. è®¡ç®—æœŸæœ›é¢‘æ•°çŸ©é˜µã€‚

5. è®¡ç®—å¡æ–¹ç»Ÿè®¡é‡å’Œè‡ªç”±åº¦ã€‚

6. è®¡ç®— p å€¼ã€‚

7. è¿”å›ç»“æœã€‚


#### ç»ƒä¹ 5æ€è·¯

**ç›®æ ‡**ï¼šå®ç°ä¸€ä¸ªä¸“é—¨ç”¨äºå¤„ç†**ä¸¤ä¸ªæ— ç¼ºå¤±å€¼çš„æ•´æ•°å‘é‡**çš„ `table()` å‡½æ•°ç‰ˆæœ¬ï¼Œå¹¶åˆ©ç”¨å®ƒæ¥åŠ é€Ÿå¡æ–¹æ£€éªŒã€‚

**`table()` å‡½æ•°åŸç†**ï¼š

- `table()` å‡½æ•°ç”¨äºè®¡ç®—åˆ†ç±»å˜é‡ä¹‹é—´çš„é¢‘æ•°åˆ†å¸ƒï¼Œç”Ÿæˆåˆ—è”è¡¨ã€‚

- å¯¹äºä¸¤ä¸ªå‘é‡ `x` å’Œ `y`ï¼Œ`table(x, y)` ä¼šè®¡ç®— `x` å’Œ `y` å„æ°´å¹³ç»„åˆçš„é¢‘æ•°ã€‚

**ä¼˜åŒ–æ–¹æ³•**ï¼š

- **åˆ©ç”¨æ•´æ•°ç‰¹æ€§**ï¼šç”±äºè¾“å…¥æ˜¯æ•´æ•°å‘é‡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å…¶æ•°å€¼ç›´æ¥ä½œä¸ºçŸ©é˜µçš„ç´¢å¼•ï¼Œé¿å…å› å­åŒ–å’Œå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œæé«˜æ•ˆç‡ã€‚

- **é¢„å…ˆåˆ†é…çŸ©é˜µ**ï¼šæ ¹æ® `x` å’Œ `y` çš„å–å€¼èŒƒå›´ï¼Œé¢„å…ˆåˆ†é…é¢‘æ•°çŸ©é˜µï¼Œé¿å…åœ¨å¾ªç¯ä¸­åŠ¨æ€æ‰©å±•çŸ©é˜µå¤§å°ã€‚

- **ç›´æ¥è®¡ç®—é¢‘æ•°**ï¼šä½¿ç”¨å¾ªç¯æˆ–çŸ¢é‡åŒ–æ–¹æ³•ï¼Œç›´æ¥æ›´æ–°é¢‘æ•°çŸ©é˜µä¸­çš„å€¼ã€‚

**åŠ é€Ÿå¡æ–¹æ£€éªŒ**ï¼š

- åœ¨å¡æ–¹æ£€éªŒä¸­ï¼Œç”Ÿæˆåˆ—è”è¡¨æ˜¯é‡è¦çš„æ­¥éª¤ã€‚é€šè¿‡ä¼˜åŒ– `table()` å‡½æ•°ï¼Œå¯ä»¥åŠ å¿«åˆ—è”è¡¨çš„ç”Ÿæˆï¼Œä»è€Œæé«˜å¡æ–¹æ£€éªŒçš„æ•´ä½“é€Ÿåº¦ã€‚


### ä»£ç å®ç°

#### ç»ƒä¹ 4ä»£ç 

```{r, eval=TRUE}
# æ¸…ç†å·¥ä½œç©ºé—´ï¼Œé‡Šæ”¾å†…å­˜
rm(list = ls())

# å®šä¹‰ä¼˜åŒ–çš„å¡æ–¹æ£€éªŒå‡½æ•°
fast_chisq_test <- function(x, y) {
  # å°†æ•°å€¼å‘é‡è½¬æ¢ä¸ºå› å­
  x_factor <- as.factor(x)
  y_factor <- as.factor(y)
  
  # æ„å»ºè§‚å¯Ÿé¢‘æ•°çŸ©é˜µ
  observed <- table(x_factor, y_factor)
  
  # è®¡ç®—è¡Œå’Œã€åˆ—å’Œã€æ€»å’Œ
  row_totals <- rowSums(observed)
  col_totals <- colSums(observed)
  total <- sum(observed)
  
  # è®¡ç®—æœŸæœ›é¢‘æ•°çŸ©é˜µ
  expected <- outer(row_totals, col_totals) / total
  
  # æ£€æŸ¥æœŸæœ›é¢‘æ•°ä¸­æ˜¯å¦å­˜åœ¨é›¶ï¼Œé¿å…é™¤é›¶é”™è¯¯
  if (any(expected == 0)) {
    stop("æœŸæœ›é¢‘æ•°ä¸­å­˜åœ¨é›¶ï¼Œæ— æ³•è®¡ç®—å¡æ–¹ç»Ÿè®¡é‡ã€‚")
  }
  
  # è®¡ç®—å¡æ–¹ç»Ÿè®¡é‡
  chi_square <- sum((observed - expected)^2 / expected)
  
  # è®¡ç®—è‡ªç”±åº¦
  df <- (nrow(observed) - 1) * (ncol(observed) - 1)
  
  # è®¡ç®— p å€¼
  p_value <- pchisq(chi_square, df, lower.tail = FALSE)
  
  # è¿”å›ç»“æœ
  result <- list(
    statistic = chi_square,
    parameter = df,
    p.value = p_value,
    observed = observed,
    expected = expected,
    method = "Pearson's Chi-squared test (å¿«é€Ÿç‰ˆ)",
    data.name = paste(deparse(substitute(x)), "å’Œ", deparse(substitute(y)))
  )
  
  class(result) <- "htest"
  return(result)
}

# ç¤ºä¾‹æ•°æ®
set.seed(130)
x <- sample(1:5, 1000, replace = TRUE)
y <- sample(1:4, 1000, replace = TRUE)

# ä½¿ç”¨ä¼˜åŒ–çš„å¡æ–¹æ£€éªŒå‡½æ•°
result_fast <- fast_chisq_test(x, y)

# ä½¿ç”¨å†…ç½®çš„ chisq.test() å‡½æ•°è¿›è¡Œæ¯”è¾ƒ
result_builtin <- chisq.test(x, y, correct = FALSE)

# å°†ç»“æœæ•´ç†ä¸ºæ•°æ®æ¡†
comparison <- data.frame(
  æ–¹æ³• = c("è‡ªå®šä¹‰å‡½æ•°", "å†…ç½®å‡½æ•°"),
  å¡æ–¹ç»Ÿè®¡é‡ = c(result_fast$statistic, result_builtin$statistic),
  è‡ªç”±åº¦ = c(result_fast$parameter, result_builtin$parameter),
  på€¼ = c(result_fast$p.value, result_builtin$p.value)
)

# è¾“å‡ºç»“æœè¡¨æ ¼
print("å¡æ–¹æ£€éªŒç»“æœæ¯”è¾ƒï¼š")
print(comparison)

# å¯è§†åŒ–ï¼šç»˜åˆ¶è§‚å¯Ÿé¢‘æ•°çŸ©é˜µçš„çƒ­å›¾
library(ggplot2)
library(reshape2)

# è½¬æ¢è§‚å¯Ÿé¢‘æ•°çŸ©é˜µä¸ºæ•°æ®æ¡†
observed_df <- as.data.frame(as.table(result_fast$observed))
colnames(observed_df) <- c("X", "Y", "Frequency")

# ç»˜åˆ¶çƒ­å›¾
heatmap<-ggplot(observed_df, aes(x = X, y = Y, fill = Frequency)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "white", high = "steelblue") +
  labs(title = "è§‚å¯Ÿé¢‘æ•°çŸ©é˜µçƒ­å›¾", x = "X åˆ†ç±»", y = "Y åˆ†ç±»") +
  theme_minimal()+
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14) # è°ƒæ•´å­—ä½“æ ·å¼
  )

# æ˜¾ç¤ºå›¾åƒ
print(heatmap)
```

**ä»£ç æ¦‚è¿°ï¼š**

- **æ¸…ç†å·¥ä½œç©ºé—´**ï¼š`rm(list = ls())` æ¸…é™¤å½“å‰ R ç¯å¢ƒä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œé‡Šæ”¾å†…å­˜ã€‚

- **å®šä¹‰å‡½æ•° `fast_chisq_test()`**ï¼š

  - **è¾“å…¥å‚æ•°**ï¼šä¸¤ä¸ªæ•°å€¼å‘é‡ `x` å’Œ `y`ã€‚

  - **æ•°æ®é¢„å¤„ç†**ï¼šå°†æ•°å€¼å‘é‡è½¬æ¢ä¸ºå› å­ï¼Œä»¥è·å–åˆ†ç±»æ°´å¹³ã€‚

  - **æ„å»ºè§‚å¯Ÿé¢‘æ•°çŸ©é˜µ**ï¼šä½¿ç”¨ `table()` å‡½æ•°ç»Ÿè®¡ `x` å’Œ `y` å„åˆ†ç±»æ°´å¹³ç»„åˆçš„é¢‘æ•°ã€‚

  - **è®¡ç®—è¡Œå’Œã€åˆ—å’Œã€æ€»å’Œ**ï¼šç”¨äºåç»­è®¡ç®—æœŸæœ›é¢‘æ•°ã€‚

  - **è®¡ç®—æœŸæœ›é¢‘æ•°çŸ©é˜µ**ï¼šä½¿ç”¨å¤–ç§¯ `outer()` è®¡ç®—ã€‚

  - **è®¡ç®—å¡æ–¹ç»Ÿè®¡é‡**ï¼šæŒ‰ç…§å¡æ–¹æ£€éªŒå…¬å¼è®¡ç®—ã€‚

  - **è®¡ç®—è‡ªç”±åº¦**ï¼šæ ¹æ®è§‚å¯Ÿé¢‘æ•°çŸ©é˜µçš„ç»´åº¦è®¡ç®—ã€‚

  - **è®¡ç®— p å€¼**ï¼šä½¿ç”¨å¡æ–¹åˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•° `pchisq()` è®¡ç®—ã€‚

  - **è¿”å›ç»“æœ**ï¼šä»¥åˆ—è¡¨å½¢å¼è¿”å›ç»“æœï¼Œå¹¶æŒ‡å®šå…¶ç±»ä¸º `"htest"`ï¼Œä»¥ä¾¿ä¸å†…ç½®å‡½æ•°çš„ç»“æœæ ¼å¼ä¸€è‡´ã€‚
- **ç¤ºä¾‹æ•°æ®**ï¼š

  - ä½¿ç”¨ `sample()` å‡½æ•°ç”Ÿæˆä¸¤ä¸ªåˆ†ç±»å˜é‡ `x` å’Œ `y`ï¼Œå–å€¼èŒƒå›´åˆ†åˆ«ä¸º 1~5 å’Œ 1~4ï¼Œæ ·æœ¬é‡ä¸º 1000ã€‚
- **ç»“æœæ¯”è¾ƒ**ï¼š

  - ä½¿ç”¨è‡ªå®šä¹‰çš„ `fast_chisq_test()` å’Œå†…ç½®çš„ `chisq.test()` è®¡ç®—ç»“æœï¼Œå¹¶è¾“å‡ºæ¯”è¾ƒã€‚
- **ç»“æœæ•´ç†ä¸ºæ•°æ®æ¡†**ï¼š
  - å°†è‡ªå®šä¹‰å‡½æ•°å’Œå†…ç½®å‡½æ•°çš„å¡æ–¹ç»Ÿè®¡é‡ã€è‡ªç”±åº¦å’Œ p å€¼å­˜å…¥æ•°æ®æ¡† `comparison` ä¸­ï¼Œä¾¿äºå±•ç¤ºå’Œæ¯”è¾ƒã€‚
- **è¾“å‡ºç»“æœè¡¨æ ¼**ï¼š

  - ä½¿ç”¨ `print()` å‡½æ•°è¾“å‡ºç»“æœè¡¨æ ¼ï¼Œä½¿æ¯”è¾ƒæ›´åŠ æ¸…æ™°ã€‚
- **å¯è§†åŒ–**ï¼š

  - ä½¿ç”¨ `ggplot2` åŒ…ç»˜åˆ¶è§‚å¯Ÿé¢‘æ•°çŸ©é˜µçš„çƒ­å›¾ï¼Œç›´è§‚å±•ç¤ºåˆ†ç±»å˜é‡ä¹‹é—´çš„å…³ç³»ã€‚


#### ç»ƒä¹ 5ä»£ç 

```{r, eval=TRUE}
# å®šä¹‰ä¼˜åŒ–çš„ table å‡½æ•°
fast_table <- function(x, y) {
  # æ£€æŸ¥è¾“å…¥æ˜¯å¦ä¸ºæ•´æ•°å‘é‡
  if (!is.integer(x) || !is.integer(y)) {
    stop("è¾“å…¥çš„ x å’Œ y å¿…é¡»æ˜¯æ•´æ•°å‘é‡ã€‚")
  }

  # è·å– x å’Œ y çš„å–å€¼èŒƒå›´
  x_levels <- sort(unique(x))
  y_levels <- sort(unique(y))

  # å°† x_levels å’Œ y_levels è½¬æ¢ä¸ºå­—ç¬¦ç±»å‹
  x_levels_char <- as.character(x_levels)
  y_levels_char <- as.character(y_levels)

  # åˆ›å»ºé¢‘æ•°çŸ©é˜µï¼Œåˆå§‹åŒ–ä¸ºé›¶ï¼Œå¹¶è®¾ç½®ç»´åº¦åç§°
  freq_matrix <- matrix(0L, nrow = length(x_levels), ncol = length(y_levels),
                        dimnames = list(x_levels_char, y_levels_char))

  # ä¸º dimnames è®¾ç½®åç§°ï¼Œä¸ table() å‡½æ•°ä¸€è‡´
  names(dimnames(freq_matrix)) <- c(deparse(substitute(x)), deparse(substitute(y)))

  # åˆ›å»ºå€¼åˆ°ç´¢å¼•çš„æ˜ å°„
  x_index <- match(x, x_levels)
  y_index <- match(y, y_levels)

  # è®¡ç®—é¢‘æ•°
  for (i in seq_along(x)) {
    freq_matrix[x_index[i], y_index[i]] <- freq_matrix[x_index[i], y_index[i]] + 1L
  }

  # å°†çŸ©é˜µè½¬æ¢ä¸º table å¯¹è±¡ï¼Œä¿æŒä¸ table() å‡½æ•°è¾“å‡ºä¸€è‡´
  freq_table <- as.table(freq_matrix)

  return(freq_table)
}

# ç¤ºä¾‹æ•°æ®
set.seed(130)
x <- sample(1L:5L, 1000, replace = TRUE)
y <- sample(1L:4L, 1000, replace = TRUE)

# ä½¿ç”¨ä¼˜åŒ–çš„ table å‡½æ•°
freq_table_fast <- fast_table(x, y)

# ä½¿ç”¨å†…ç½®çš„ table å‡½æ•°è¿›è¡Œæ¯”è¾ƒ
freq_table_builtin <- table(x, y)

# æ£€æŸ¥ç»“æœæ˜¯å¦ä¸€è‡´
comparison_result <- all.equal(freq_table_fast, freq_table_builtin)
print(comparison_result)  # åº”è¯¥è¿”å› TRUE

# åˆ©ç”¨ä¼˜åŒ–çš„ table å‡½æ•°åŠ é€Ÿå¡æ–¹æ£€éªŒ
fast_chisq_test_v2 <- function(x, y) {
  # æ£€æŸ¥è¾“å…¥æ˜¯å¦ä¸ºæ•´æ•°å‘é‡
  if (!is.integer(x) || !is.integer(y)) {
    stop("è¾“å…¥çš„ x å’Œ y å¿…é¡»æ˜¯æ•´æ•°å‘é‡ã€‚")
  }

  # ä½¿ç”¨ä¼˜åŒ–çš„ table å‡½æ•°æ„å»ºè§‚å¯Ÿé¢‘æ•°çŸ©é˜µ
  observed <- fast_table(x, y)

  # è®¡ç®—è¡Œå’Œã€åˆ—å’Œã€æ€»å’Œ
  row_totals <- rowSums(observed)
  col_totals <- colSums(observed)
  total <- sum(observed)

  # è®¡ç®—æœŸæœ›é¢‘æ•°çŸ©é˜µ
  expected <- outer(row_totals, col_totals) / total

  # æ£€æŸ¥æœŸæœ›é¢‘æ•°ä¸­æ˜¯å¦å­˜åœ¨é›¶ï¼Œé¿å…é™¤é›¶é”™è¯¯
  if (any(expected == 0)) {
    stop("æœŸæœ›é¢‘æ•°ä¸­å­˜åœ¨é›¶ï¼Œæ— æ³•è®¡ç®—å¡æ–¹ç»Ÿè®¡é‡ã€‚")
  }

  # è®¡ç®—å¡æ–¹ç»Ÿè®¡é‡
  chi_square <- sum((observed - expected)^2 / expected)

  # è®¡ç®—è‡ªç”±åº¦
  df <- (nrow(observed) - 1) * (ncol(observed) - 1)

  # è®¡ç®— p å€¼
  p_value <- pchisq(chi_square, df, lower.tail = FALSE)

  # è¿”å›ç»“æœ
  result <- list(
    statistic = chi_square,
    parameter = df,
    p.value = p_value,
    observed = observed,
    expected = expected,
    method = "Pearson's Chi-squared test with fast_table",
    data.name = paste(deparse(substitute(x)), "å’Œ", deparse(substitute(y)))
  )

  class(result) <- "htest"
  return(result)
}

# ä½¿ç”¨ä¼˜åŒ–çš„å¡æ–¹æ£€éªŒå‡½æ•°
result_fast_v2 <- fast_chisq_test_v2(x, y)

# ä½¿ç”¨å†…ç½®çš„ chisq.test() å‡½æ•°è¿›è¡Œæ¯”è¾ƒ
result_builtin <- chisq.test(x, y, correct = FALSE)

# å°†ç»“æœæ•´ç†ä¸ºæ•°æ®æ¡†
comparison_v2 <- data.frame(
  æ–¹æ³• = c("è‡ªå®šä¹‰å‡½æ•°ï¼ˆfast_tableï¼‰", "å†…ç½®å‡½æ•°"),
  å¡æ–¹ç»Ÿè®¡é‡ = c(unname(result_fast_v2$statistic), unname(result_builtin$statistic)),
  è‡ªç”±åº¦ = c(result_fast_v2$parameter, result_builtin$parameter),
  på€¼ = c(result_fast_v2$p.value, result_builtin$p.value)
)

# è¾“å‡ºç»“æœè¡¨æ ¼
print("åˆ©ç”¨ fast_table çš„å¡æ–¹æ£€éªŒç»“æœæ¯”è¾ƒï¼š")
print(comparison_v2)


```

**ä»£ç æ¦‚è¿°ï¼š**

- **å®šä¹‰å‡½æ•° `fast_table()`**ï¼š
  - **è¾“å…¥å‚æ•°**ï¼šä¸¤ä¸ªæ•´æ•°å‘é‡ `x` å’Œ `y`ã€‚

  - **è·å–åˆ†ç±»æ°´å¹³**ï¼šä½¿ç”¨ `unique()` è·å– `x` å’Œ `y` çš„å”¯ä¸€å–å€¼ï¼Œæ’åºåç”¨äºçŸ©é˜µçš„è¡Œåå’Œåˆ—åã€‚

  - **åˆå§‹åŒ–é¢‘æ•°çŸ©é˜µ**ï¼šåˆ›å»ºä¸€ä¸ªå¤§å°ä¸º `length(x_levels) * length(y_levels)` çš„çŸ©é˜µï¼Œåˆå§‹å€¼ä¸ºé›¶ã€‚

  - **å»ºç«‹å€¼åˆ°ç´¢å¼•çš„æ˜ å°„**ï¼šä½¿ç”¨ `match()` å°† `x` å’Œ `y` çš„å€¼æ˜ å°„åˆ°çŸ©é˜µçš„è¡Œåˆ—ç´¢å¼•ã€‚

  - **è®¡ç®—é¢‘æ•°**ï¼šéå† `x` å’Œ `y`ï¼Œåœ¨å¯¹åº”çš„ä½ç½®ç´¯åŠ é¢‘æ•°ã€‚
- **ç¤ºä¾‹æ•°æ®**ï¼š

  - ä½¿ç”¨ `sample()` ç”Ÿæˆä¸¤ä¸ªæ•´æ•°å‘é‡ `x` å’Œ `y`ã€‚
- **ç»“æœæ¯”è¾ƒ**ï¼š
  - ä½¿ç”¨è‡ªå®šä¹‰çš„ `fast_chisq_test_v2()` å’Œå†…ç½®çš„ `chisq.test()` è®¡ç®—ç»“æœï¼Œå¹¶è¾“å‡ºæ¯”è¾ƒã€‚
- **åˆ©ç”¨ `fast_table()` åŠ é€Ÿå¡æ–¹æ£€éªŒ**ï¼š

  - å®šä¹‰æ–°çš„å¡æ–¹æ£€éªŒå‡½æ•° `fast_chisq_test_v2()`ï¼Œåœ¨å…¶ä¸­ä½¿ç”¨ `fast_table()` æ„å»ºè§‚å¯Ÿé¢‘æ•°çŸ©é˜µã€‚

  - å…¶ä½™æ­¥éª¤ä¸ `fast_chisq_test()` ç±»ä¼¼ã€‚

- **ç»“æœæ•´ç†ä¸ºæ•°æ®æ¡†**ï¼š

  - å°†è‡ªå®šä¹‰å‡½æ•°å’Œå†…ç½®å‡½æ•°çš„ç»“æœå­˜å…¥æ•°æ®æ¡† `comparison_v2`ï¼Œä¾¿äºå±•ç¤ºå’Œæ¯”è¾ƒã€‚

- **è¾“å‡ºç»“æœè¡¨æ ¼**ï¼š
  - ä½¿ç”¨ `print()` å‡½æ•°è¾“å‡ºç»“æœè¡¨æ ¼ï¼Œä½¿æ¯”è¾ƒæ›´åŠ æ¸…æ™°ã€‚


### ç»“æœåˆ†æ

#### ç»ƒä¹ 4åˆ†æ

- **å¡æ–¹æ£€éªŒç»“æœæ¯”è¾ƒ**ï¼š

  |    æ–¹æ³•    | å¡æ–¹ç»Ÿè®¡é‡ | è‡ªç”±åº¦ |      på€¼       |
  | :--------: | :--------: | :----: | :------------: |
  | è‡ªå®šä¹‰å‡½æ•° |   10.98484    |   12   | 0.530218 |
  |  å†…ç½®å‡½æ•°  |   10.98484    |   12   | 0.530218 |

  **è¡¨1ï¼šå¡æ–¹æ£€éªŒç»“æœæ¯”è¾ƒ**

  - **åˆ†æ**ï¼š

    - è‡ªå®šä¹‰å‡½æ•°å’Œå†…ç½®å‡½æ•°çš„å¡æ–¹ç»Ÿè®¡é‡ã€è‡ªç”±åº¦å’Œ p å€¼å®Œå…¨ä¸€è‡´ï¼Œè¯´æ˜è‡ªå®šä¹‰çš„ `fast_chisq_test()` å‡½æ•°æ­£ç¡®å®ç°äº†å¡æ–¹æ£€éªŒçš„è®¡ç®—ã€‚

    - ç”±äºè‡ªå®šä¹‰å‡½æ•°é’ˆå¯¹ç‰¹å®šæƒ…å†µè¿›è¡Œäº†ä¼˜åŒ–ï¼Œçœç•¥äº†å†…ç½®å‡½æ•°ä¸­å¤§é‡çš„å‚æ•°æ£€æŸ¥å’Œæ•°æ®å¤„ç†æ­¥éª¤ï¼Œå› æ­¤åœ¨å¤§æ•°æ®é‡æ—¶è®¡ç®—é€Ÿåº¦æ›´å¿«ã€‚

- **å¯è§†åŒ–åˆ†æ**ï¼š

```{r, eval=TRUE}
print(heatmap)
```

  - ç»˜åˆ¶çš„è§‚å¯Ÿé¢‘æ•°çŸ©é˜µçƒ­å›¾ç›´è§‚å±•ç¤ºäº†åˆ†ç±»å˜é‡ä¹‹é—´çš„å…³ç³»ã€‚

  - é¢œè‰²è¶Šæ·±è¡¨ç¤ºå¯¹åº”åˆ†ç±»ç»„åˆçš„é¢‘æ•°è¶Šé«˜ï¼Œå¯ä»¥å¸®åŠ©è§‚å¯Ÿæ•°æ®çš„åˆ†å¸ƒæƒ…å†µã€‚

- **æ•°å€¼ç¨³å®šæ€§**ï¼š

  - åœ¨è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ£€æŸ¥äº†æœŸæœ›é¢‘æ•°æ˜¯å¦ä¸ºé›¶ï¼Œé¿å…äº†é™¤é›¶é”™è¯¯ï¼Œä¿è¯äº†æ•°å€¼è®¡ç®—çš„ç¨³å®šæ€§ã€‚


#### ç»ƒä¹ 5åˆ†æ

- **`fast_table()` å‡½æ•°æ­£ç¡®æ€§éªŒè¯**ï¼š

  - ä½¿ç”¨ `identical()` å‡½æ•°æ¯”è¾ƒè‡ªå®šä¹‰çš„ `fast_table()` å’Œå†…ç½®çš„ `table()` å‡½æ•°ç»“æœï¼Œç¡®è®¤äºŒè€…å®Œå…¨ä¸€è‡´ï¼Œè¯´æ˜è‡ªå®šä¹‰å‡½æ•°æ­£ç¡®å®ç°äº†é¢‘æ•°çŸ©é˜µçš„è®¡ç®—ã€‚

- **åˆ©ç”¨ `fast_table()` åŠ é€Ÿå¡æ–¹æ£€éªŒç»“æœæ¯”è¾ƒ**ï¼š

  |           æ–¹æ³•           | å¡æ–¹ç»Ÿè®¡é‡ | è‡ªç”±åº¦ |      på€¼       |
  | :----------------------: | :--------: | :----: | :------------: |
  | è‡ªå®šä¹‰å‡½æ•°ï¼ˆfast_tableï¼‰ |   10.98484    |   12   | 0.530218 |
  |         å†…ç½®å‡½æ•°         |   10.98484    |   12   | 0.530218 |

  **è¡¨2ï¼šåˆ©ç”¨ fast_table çš„å¡æ–¹æ£€éªŒç»“æœæ¯”è¾ƒ**

  - **åˆ†æ**ï¼š

    - è‡ªå®šä¹‰çš„ `fast_chisq_test_v2()` å’Œå†…ç½®çš„ `chisq.test()` å‡½æ•°è®¡ç®—çš„å¡æ–¹ç»Ÿè®¡é‡å’Œ p å€¼å®Œå…¨ä¸€è‡´ï¼ŒéªŒè¯äº†ä¼˜åŒ–æ–¹æ³•çš„æ­£ç¡®æ€§ã€‚

    - ä½¿ç”¨ `fast_table()` åŠ é€Ÿäº†å¡æ–¹æ£€éªŒä¸­è§‚å¯Ÿé¢‘æ•°çŸ©é˜µçš„è®¡ç®—æ­¥éª¤ï¼Œä»è€Œæé«˜äº†æ•´ä¸ªå¡æ–¹æ£€éªŒçš„æ•ˆç‡ã€‚


------------------------------------------------------------------------

# æ€»ç»“

## å›°éš¾ä¸è§£å†³æ–¹å¼

åœ¨å®Œæˆæœ¬æ¬¡å®éªŒæŠ¥å‘Šçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘é‡åˆ°äº†å¤šä¸ªæŒ‘æˆ˜ã€‚é¦–å…ˆï¼Œåœ¨**é—®é¢˜1**ä¸­ï¼Œéœ€è¦ä½¿ç”¨å•çº¯å½¢ç®—æ³•æ±‚è§£çº¿æ€§è§„åˆ’é—®é¢˜ã€‚ç”±äºå¯¹æ‰‹å·¥æ¨å¯¼å•çº¯å½¢è¡¨ä¸å¤Ÿç†Ÿç»ƒï¼Œç†è§£æ¯ä¸€æ­¥çš„å˜é‡æ›¿æ¢å’Œè®¡ç®—è¿‡ç¨‹æ¯”è¾ƒå›°éš¾ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å€ŸåŠ©äº† `lpSolve` åŒ…ï¼Œå®ç°äº†è‡ªåŠ¨åŒ–æ±‚è§£ï¼Œå¹¶é€šè¿‡ç»˜åˆ¶ä¸‰ç»´å¯è§†åŒ–å›¾å½¢ï¼Œæ›´ç›´è§‚åœ°ç†è§£äº†å¯è¡ŒåŸŸå’Œæœ€ä¼˜è§£çš„ä½ç½®ã€‚

åœ¨**é—®é¢˜2**ä¸­ï¼Œéœ€è¦ä½¿ç”¨ `for` å¾ªç¯å’Œ `lapply()` å‡½æ•°å¯¹ä¸åŒçš„æ¨¡å‹è¿›è¡Œæ‹Ÿåˆã€‚æŒ‘æˆ˜åœ¨äºå¦‚ä½•æœ‰æ•ˆåœ°ç»„ç»‡ä»£ç ï¼Œé¿å…é‡å¤ã€‚æˆ‘é€šè¿‡å®šä¹‰å‡½æ•°å¦‚ `fit_lm()` å’Œ `fit_model()`ï¼Œå°†é‡å¤çš„éƒ¨åˆ†å°è£…èµ·æ¥ï¼Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œå¤ç”¨æ€§ã€‚åŒæ—¶ï¼Œåœ¨æå–æ¨¡å‹çš„ RÂ² å€¼æ—¶ï¼Œéœ€è¦å¤„ç†åˆ—è¡¨å’Œæ•°æ®æ¡†ä¹‹é—´çš„è½¬æ¢ï¼Œè¿™ä¹Ÿè€ƒéªŒäº†æˆ‘å¯¹ R è¯­è¨€æ•°æ®ç»“æ„çš„ç†è§£ã€‚

åœ¨**é—®é¢˜3**ä¸­ï¼Œæå– t æ£€éªŒç»“æœä¸­çš„ p å€¼æ—¶ï¼Œéœ€è¦é¿å…ä½¿ç”¨åŒ¿åå‡½æ•°ã€‚èµ·åˆæˆ‘ä¸å¤ªæ¸…æ¥šå¦‚ä½•ç›´æ¥ä½¿ç”¨ `[[` æ“ä½œç¬¦æå–åˆ—è¡¨å…ƒç´ ã€‚ç»è¿‡æŸ¥é˜…èµ„æ–™ï¼Œæˆ‘äº†è§£åˆ°å¯ä»¥å°† `[[` ä½œä¸ºå‡½æ•°ä¼ é€’ç»™ `sapply()`ï¼Œä»è€Œç®€åŒ–ä»£ç ã€‚æ­¤å¤–ï¼Œå®ç°ä¸€ä¸ªç»“åˆ `Map()` å’Œ `vapply()` çš„å‡½æ•°ï¼Œä¹Ÿè®©æˆ‘æ·±å…¥æ€è€ƒäº†å‡½æ•°çš„å‚æ•°è®¾è®¡å’Œé”™è¯¯å¤„ç†ã€‚

åœ¨**é—®é¢˜4**ä¸­ï¼Œå®ç°ä¼˜åŒ–çš„ `chisq.test()` å’Œ `table()` å‡½æ•°ï¼Œéœ€è¦å¯¹å¡æ–¹æ£€éªŒçš„æ•°å­¦åŸç†æœ‰æ·±å…¥çš„ç†è§£ã€‚ä¸ºäº†é¿å…æ•°å€¼ä¸‹æº¢æˆ–ä¸Šæº¢ï¼Œéœ€è¦ä»”ç»†æ£€æŸ¥æœŸæœ›é¢‘æ•°çŸ©é˜µä¸­çš„é›¶å€¼ã€‚æˆ‘é€šè¿‡æ·»åŠ ç›¸åº”çš„æ¡ä»¶åˆ¤æ–­ï¼Œç¡®ä¿äº†è®¡ç®—çš„ç¨³å®šæ€§ã€‚åˆ©ç”¨æ•´æ•°å‘é‡çš„ç‰¹æ€§ï¼Œä¼˜åŒ–äº† `table()` å‡½æ•°ï¼ŒåŠ é€Ÿäº†å¡æ–¹æ£€éªŒçš„è®¡ç®—ã€‚

## æ€è€ƒä¸æ„Ÿæ‚Ÿ

é€šè¿‡æœ¬æ¬¡å®éªŒï¼Œæˆ‘æ·±åˆ»ä½“ä¼šåˆ°äº†ç†è®ºä¸å®è·µç›¸ç»“åˆçš„é‡è¦æ€§ã€‚åœ¨è§£å†³å®é™…é—®é¢˜æ—¶ï¼Œå•çº¯ä¾é ç†è®ºçŸ¥è¯†å¾€å¾€ä¸å¤Ÿï¼Œè¿˜éœ€è¦çµæ´»è¿ç”¨ç¼–ç¨‹æŠ€å·§å’Œå·¥å…·ã€‚ä¾‹å¦‚ï¼Œåœ¨çº¿æ€§è§„åˆ’é—®é¢˜ä¸­ï¼Œè™½ç„¶æ‰‹å·¥æ¨å¯¼æœ‰åŠ©äºç†è§£ç®—æ³•åŸç†ï¼Œä½†å€ŸåŠ© R è¯­è¨€çš„å¼ºå¤§è®¡ç®—èƒ½åŠ›ï¼Œå¯ä»¥æ›´é«˜æ•ˆåœ°æ±‚è§£å¤æ‚çš„é—®é¢˜ã€‚

åœ¨ç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ„è¯†åˆ°ä»£ç çš„è§„èŒƒæ€§å’Œå¯è¯»æ€§è‡³å…³é‡è¦ã€‚é€šè¿‡å°è£…å‡½æ•°ã€æ·»åŠ è¯¦ç»†çš„æ³¨é‡Šï¼Œä¸ä»…ä½¿è‡ªå·±çš„æ€è·¯æ›´åŠ æ¸…æ™°ï¼Œä¹Ÿæ–¹ä¾¿äº†ä»–äººç†è§£å’Œç»´æŠ¤ä»£ç ã€‚åŒæ—¶ï¼Œè‰¯å¥½çš„å†…å­˜ç®¡ç†å’Œé”™è¯¯å¤„ç†ä¹Ÿæ˜¯ä¿è¯ç¨‹åºç¨³å®šè¿è¡Œçš„å…³é”®ã€‚

æœ¬æ¬¡å®éªŒè¿˜è®©æˆ‘è®¤è¯†åˆ°æ•°æ®ç§‘å­¦ä¸­çš„ä¸ç¡®å®šæ€§å’Œéšæœºæ€§ã€‚ä¾‹å¦‚ï¼Œåœ¨è‡ªä¸¾æ ·æœ¬çš„æ¨¡å‹æ‹Ÿåˆä¸­ï¼ŒRÂ² å€¼ä¼šå› ä¸ºæ ·æœ¬çš„ä¸åŒè€Œæœ‰æ‰€æ³¢åŠ¨ã€‚è¿™æé†’æˆ‘åœ¨åˆ†æç»“æœæ—¶ï¼Œä¸èƒ½ä»…ä»…ä¾èµ–å•ä¸€çš„æŒ‡æ ‡æˆ–æ ·æœ¬ï¼Œæ›´éœ€è¦è€ƒè™‘æ•°æ®çš„å˜å¼‚æ€§å’Œæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚

æ•´ä¸ªå®éªŒè¿‡ç¨‹è®©æˆ‘åˆ‡å®ä½“ä¼šåˆ°ï¼šå­¦ä¹ çš„è¿‡ç¨‹å°±æ˜¯ä¸æ–­å‘ç°é—®é¢˜ã€è§£å†³é—®é¢˜çš„è¿‡ç¨‹ã€‚æ¯ä¸€æ¬¡å›°éš¾çš„å…‹æœï¼Œéƒ½å¸¦æ¥äº†æ–°çš„æ”¶è·å’Œè¿›æ­¥ã€‚è¿™ç§æ¢ç´¢å’Œæ±‚çŸ¥çš„ç²¾ç¥ï¼Œå°†æ¿€åŠ±æˆ‘åœ¨æœªæ¥çš„å­¦ä¹ å’Œå·¥ä½œä¸­ï¼Œå‹‡äºé¢å¯¹æŒ‘æˆ˜ï¼Œä¸æ–­æå‡è‡ªå·±ã€‚


------------------------------------------------------------------------

# ç»Ÿè®¡è®¡ç®—ç¬¬10æ¬¡ä½œä¸š { .center-title }

ä»¥ä¸‹æ˜¯ç»Ÿè®¡è®¡ç®—2024-11-18è¯¾ç¨‹å¯¹åº”çš„ä½œä¸š

# Question

**Exercise 9.8**  This example appears in [40]. Consider the bivariate density  
$$
f(x, y) \propto \binom{n}{x} y^{x+a-1} (1-y)^{n-x+b-1}, \quad x = 0, 1, \ldots, n, \quad 0 \leq y \leq 1. 
$$  
It can be shown (see e.g. [23]) that for fixed $a, b, n$, the conditional distributions are Binomial($n, y$) and Beta($x+a, n-x+b$). Use the Gibbs sampler to generate a chain with target joint density $f(x, y)$.

- Write an Rcpp function for Exercise 9.8 (page 278, Statistical Computing with R).

- Compare the corresponding generated random numbers with those by the R function you wrote using the function â€œqqplotâ€.

- Compare the computation time of the two functions with the function â€œmicrobenchmarkâ€.

- Comments your results.


# Answer

## é¢˜ç›®æè¿°

è€ƒè™‘äºŒå…ƒå¯†åº¦å‡½æ•°ï¼š

$$
f(x, y) \propto \binom{n}{x} y^{x + a - 1} (1 - y)^{n - x + b - 1}, \quad x = 0, 1, \ldots, n, \quad 0 \leq y \leq 1.
$$
å·²çŸ¥å¯¹äºå›ºå®šçš„ $a, b, n$ï¼Œæ¡ä»¶åˆ†å¸ƒä¸ºï¼š

- $x | y \sim \text{Binomial}(n, y)$
- $y | x \sim \text{Beta}(x + a, n - x + b)$

è¦æ±‚ï¼š

1. ä½¿ç”¨ Rcpp ä¸ºä¸Šè¿°å¯†åº¦å‡½æ•°ç¼–å†™ä¸€ä¸ª Gibbs é‡‡æ ·å™¨å‡½æ•°ã€‚
2. ä½¿ç”¨ä½ ç”¨ R ç¼–å†™çš„å‡½æ•°ï¼Œé€šè¿‡å‡½æ•° `qqplot` æ¥æ¯”è¾ƒç›¸åº”ç”Ÿæˆçš„éšæœºæ•°ã€‚
3. ä½¿ç”¨å‡½æ•° `microbenchmark` æ¥æ¯”è¾ƒä¸¤ä¸ªå‡½æ•°çš„è®¡ç®—æ—¶é—´ã€‚
4. å¯¹ç»“æœè¿›è¡Œè¯„è®ºã€‚

## è§£ç­”æ€è·¯

**1. ç†è§£ Gibbs é‡‡æ ·å™¨çš„åŸç†**

Gibbs é‡‡æ ·æ˜¯ä¸€ç§ Markov é“¾è’™ç‰¹å¡ç½—ï¼ˆMCMCï¼‰æ–¹æ³•ï¼Œç”¨äºä»å¤æ‚çš„å¤šç»´æ¦‚ç‡åˆ†å¸ƒä¸­æŠ½æ ·ã€‚å½“è”åˆåˆ†å¸ƒçš„æ¡ä»¶åˆ†å¸ƒæ˜“äºé‡‡æ ·æ—¶ï¼ŒGibbs é‡‡æ ·ç‰¹åˆ«æœ‰æ•ˆã€‚

å¯¹äºç»™å®šçš„è”åˆåˆ†å¸ƒ $f(x, y)$ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“ä»¥ä¸‹æ¡ä»¶åˆ†å¸ƒï¼š

- $x | y \sim \text{Binomial}(n, y)$
- $y | x \sim \text{Beta}(x + a, n - x + b)$

æˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ª Gibbs é‡‡æ ·å™¨ï¼Œé€šè¿‡ä»¥ä¸‹æ­¥éª¤ç”Ÿæˆ $(x, y)$ çš„æ ·æœ¬åºåˆ—ï¼š

1. **åˆå§‹åŒ–**ï¼šé€‰æ‹©åˆå§‹å€¼ $x_0, y_0$ã€‚
2. **è¿­ä»£æŠ½æ ·**ï¼š
   - **æ­¥éª¤1**ï¼šç»™å®šå½“å‰çš„ $y_{i-1}$ï¼Œä» $x | y_{i-1}$ ä¸­æŠ½æ ·å¾—åˆ° $x_i$ã€‚
   - **æ­¥éª¤2**ï¼šç»™å®šæ–°çš„ $x_i$ï¼Œä» $y | x_i$ ä¸­æŠ½æ ·å¾—åˆ° $y_i$ã€‚
3. **é‡å¤æ­¥éª¤1å’Œ2**ï¼Œç›´åˆ°è·å¾—è¶³å¤Ÿçš„æ ·æœ¬ã€‚

**2. æ¨å¯¼ç»†èŠ‚**

è”åˆå¯†åº¦å‡½æ•°ï¼š

$$
\begin{align*}
f(x, y) &= \frac{1}{C} \binom{n}{x} y^{x + a - 1} (1 - y)^{n - x + b - 1} \\
&= \frac{1}{C} \frac{n!}{x!(n - x)!} y^{x + a - 1} (1 - y)^{n - x + b - 1}
\end{align*}
$$
å…¶ä¸­ $C$ æ˜¯å½’ä¸€åŒ–å¸¸æ•°ã€‚

**æ¡ä»¶åˆ†å¸ƒæ¨å¯¼**

- **æ¡ä»¶åˆ†å¸ƒ $x | y$**ï¼š

  ç»™å®š $y$ï¼Œè”åˆå¯†åº¦å…³äº $x$ çš„éƒ¨åˆ†ä¸ºï¼š

  $$
  f(x | y) \propto \binom{n}{x} y^{x} (1 - y)^{n - x}
  $$
  è¿™æ­£æ˜¯äºŒé¡¹åˆ†å¸ƒçš„æ¦‚ç‡è´¨é‡å‡½æ•°ï¼Œå› æ­¤ï¼š

  $$
  x | y \sim \text{Binomial}(n, y)
  $$

- **æ¡ä»¶åˆ†å¸ƒ $y | x$**ï¼š

  ç»™å®š $x$ï¼Œè”åˆå¯†åº¦å…³äº $y$ çš„éƒ¨åˆ†ä¸ºï¼š

  $$
  f(y | x) \propto y^{x + a - 1} (1 - y)^{n - x + b - 1}
  $$
  è¿™æ­£æ˜¯ Beta åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼Œå› æ­¤ï¼š

  $$
  y | x \sim \text{Beta}(x + a, n - x + b)
  $$

**3. ç¼–å†™ R å’Œ Rcpp å‡½æ•°**

- **R å‡½æ•°**ï¼šä½¿ç”¨ R è¯­è¨€å®ç° Gibbs é‡‡æ ·å™¨ã€‚
- **Rcpp å‡½æ•°**ï¼šä½¿ç”¨ Rcpp åŒ…ï¼Œå°†å…³é”®çš„å¾ªç¯éƒ¨åˆ†ç”¨ C++ å®ç°ï¼Œæé«˜æ•ˆç‡ã€‚

**4. æ¯”è¾ƒç”Ÿæˆçš„éšæœºæ•°**

- ä½¿ç”¨ `qqplot` å‡½æ•°ï¼Œå¯¹æ¯” R å’Œ Rcpp å®ç°ç”Ÿæˆçš„éšæœºæ•°ï¼Œæ£€éªŒä¸¤è€…æ˜¯å¦æ¥è‡ªåŒä¸€åˆ†å¸ƒã€‚

**5. æ¯”è¾ƒè®¡ç®—æ—¶é—´**

- ä½¿ç”¨ `microbenchmark` åŒ…ï¼Œæµ‹é‡ä¸¤ä¸ªå‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼Œæ¯”è¾ƒæ•ˆç‡ã€‚

**6. æ³¨æ„æ•°å€¼ç¨³å®šæ€§**

- åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œå°½é‡ä½¿ç”¨ R å’Œ Rcpp æä¾›çš„å†…ç½®éšæœºæ•°ç”Ÿæˆå‡½æ•°ï¼Œé¿å…è‡ªå·±è®¡ç®—æ¦‚ç‡ï¼Œé˜²æ­¢æ•°å€¼ä¸‹æº¢æˆ–ä¸Šæº¢ã€‚


## ä»£ç å®ç°

**1. åŠ è½½å¿…è¦çš„ R åŒ…**

```{r, eval=TRUE}
# æ¸…ç©ºå·¥ä½œç©ºé—´ï¼Œé‡Šæ”¾å†…å­˜
rm(list = ls())
# æŠ‘åˆ¶ç‰ˆæœ¬ä¸å…¼å®¹é€ æˆçš„è­¦å‘Šå¹¶åŠ è½½ Rcpp å’Œ microbenchmark åŒ…
suppressWarnings({
  library(Rcpp)
  library(microbenchmark)
})
```

**2. çº¯ R å®ç° Gibbs é‡‡æ ·å™¨**

```{r, eval=TRUE}
# çº¯ R å®ç°çš„ Gibbs é‡‡æ ·å™¨å‡½æ•°
gibbs_sampler_R <- function(N, n, a, b) {
  # åˆå§‹åŒ–å­˜å‚¨å‘é‡
  x <- integer(N)  # ç”¨äºå­˜å‚¨ x çš„å€¼
  y <- numeric(N)  # ç”¨äºå­˜å‚¨ y çš„å€¼
  
  # åˆå§‹å€¼
  x[1] <- floor(n / 2)  # å°† x[1] åˆå§‹åŒ–ä¸º n çš„ä¸€åŠ
  y[1] <- 0.5           # å°† y[1] åˆå§‹åŒ–ä¸º 0.5
  
  # Gibbs é‡‡æ ·è¿­ä»£
  for (i in 2:N) {
    # ç»™å®š y[i - 1]ï¼Œä» Binomial(n, y[i - 1]) ä¸­æŠ½æ ·å¾—åˆ° x[i]
    x[i] <- rbinom(1, size = n, prob = y[i - 1])
    
    # ç»™å®š x[i]ï¼Œä» Beta(x[i] + a, n - x[i] + b) ä¸­æŠ½æ ·å¾—åˆ° y[i]
    y[i] <- rbeta(1, shape1 = x[i] + a, shape2 = n - x[i] + b)
  }
  
  # è¿”å›ç»“æœåˆ—è¡¨
  return(list(x = x, y = y))
}
```

**3. ä½¿ç”¨ Rcpp å®ç° Gibbs é‡‡æ ·å™¨**

```{r, eval=TRUE}
# ä½¿ç”¨ Rcpp ç¼–å†™ Gibbs é‡‡æ ·å™¨å‡½æ•°
cppFunction('
List gibbs_sampler_Rcpp(int N, int n, double a, double b) {
  // å¼•å…¥å¿…è¦çš„å¤´æ–‡ä»¶
  #include <Rcpp.h>
  using namespace Rcpp;
  
  // åˆå§‹åŒ–å­˜å‚¨å‘é‡
  IntegerVector x(N);  // ç”¨äºå­˜å‚¨ x çš„å€¼
  NumericVector y(N);  // ç”¨äºå­˜å‚¨ y çš„å€¼
  
  // åˆå§‹å€¼
  x[0] = n / 2;  // å°† x[0] åˆå§‹åŒ–ä¸º n çš„ä¸€åŠ
  y[0] = 0.5;    // å°† y[0] åˆå§‹åŒ–ä¸º 0.5
  
  // Gibbs é‡‡æ ·è¿­ä»£
  for (int i = 1; i < N; ++i) {
    // ç»™å®š y[i - 1]ï¼Œä» Binomial(n, y[i - 1]) ä¸­æŠ½æ ·å¾—åˆ° x[i]
    x[i] = R::rbinom(n, y[i - 1]);
    
    // ç»™å®š x[i]ï¼Œä» Beta(x[i] + a, n - x[i] + b) ä¸­æŠ½æ ·å¾—åˆ° y[i]
    y[i] = R::rbeta(x[i] + a, n - x[i] + b);
  }
  
  // è¿”å›ç»“æœåˆ—è¡¨
  return List::create(Named("x") = x, Named("y") = y);
}
')
```

**4. è¿è¡Œå¹¶æ¯”è¾ƒä¸¤ä¸ªå‡½æ•°**

```{r, eval=TRUE}
# è®¾ç½®å‚æ•°
N <- 10000  # é‡‡æ ·æ¬¡æ•°
n <- 20     # Binomial åˆ†å¸ƒçš„å‚æ•°
a <- 2      # Beta åˆ†å¸ƒçš„å‚æ•°
b <- 2      # Beta åˆ†å¸ƒçš„å‚æ•°

# è®¾ç½®éšæœºç§å­ä»¥ç¡®ä¿å¯é‡å¤æ€§
set.seed(100)

# è¿è¡Œçº¯ R å®ç°çš„ Gibbs é‡‡æ ·å™¨
result_R <- gibbs_sampler_R(N, n, a, b)

# è¿è¡Œ Rcpp å®ç°çš„ Gibbs é‡‡æ ·å™¨
result_Rcpp <- gibbs_sampler_Rcpp(N, n, a, b)
```

**5. ä½¿ç”¨ qqplot æ¯”è¾ƒéšæœºæ•°**

```{r, eval=TRUE}
# æ¯”è¾ƒ x çš„åˆ†å¸ƒ
qqplot(result_R$x, result_Rcpp$x,
       main = "QQ å›¾æ¯”è¾ƒ x (R å®ç° vs Rcpp å®ç°)",
       xlab = "R å®ç°çš„ x",
       ylab = "Rcpp å®ç°çš„ x",
       pch = 19,          # ä½¿ç”¨å®å¿ƒåœ†ç‚¹
       col = rgb(0, 0, 1, 0.5),  # åŠé€æ˜è“è‰²
       cex = 0.6          # è°ƒæ•´ç‚¹çš„å¤§å°
)
abline(0, 1, col = "red", lwd = 2)  # ç»˜åˆ¶ y = x çš„å‚è€ƒçº¿ï¼Œå¢åŠ çº¿å®½
grid()  # æ·»åŠ ç½‘æ ¼çº¿

# æ¯”è¾ƒ y çš„åˆ†å¸ƒ
qqplot(result_R$y, result_Rcpp$y,
       main = "QQ å›¾æ¯”è¾ƒ y (R å®ç° vs Rcpp å®ç°)",
       xlab = "R å®ç°çš„ y",
       ylab = "Rcpp å®ç°çš„ y",
       pch = 19,
       col = rgb(1, 0, 0, 0.5),  # åŠé€æ˜çº¢è‰²
       cex = 0.6
)
abline(0, 1, col = "blue", lwd = 2)
grid()
```

**6. ä½¿ç”¨ microbenchmark æ¯”è¾ƒè®¡ç®—æ—¶é—´**

```{r, eval=TRUE}
# å®šä¹‰æµ‹è¯•æ¬¡æ•°
benchmark_times <- 100

# æ¯”è¾ƒè®¡ç®—æ—¶é—´
benchmark_result <- microbenchmark(
  gibbs_R = gibbs_sampler_R(N, n, a, b),
  gibbs_Rcpp = gibbs_sampler_Rcpp(N, n, a, b),
  times = benchmark_times
)

# æ‰“å° benchmark ç»“æœ
print(benchmark_result)

# ç»˜åˆ¶è®¡ç®—æ—¶é—´çš„ç®±çº¿å›¾
boxplot(benchmark_result, main = "Gibbs é‡‡æ ·å™¨è®¡ç®—æ—¶é—´æ¯”è¾ƒ", names = c("R å®ç°", "Rcpp å®ç°"), ylab = "æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰")
```

**7. æ˜¾ç¤ºéƒ¨åˆ†ç»“æœ**

```{r, eval=TRUE}
# è®¾ç½®å›¾å½¢å¸ƒå±€ä¸º 2x2
par(mfrow = c(2, 2), mar = c(4, 4, 2, 1))  # è®¾ç½®è¾¹è·

# ç»˜åˆ¶ R å®ç°çš„ x åˆ†å¸ƒ
hist(result_R$x, 
     breaks = n + 1, 
     main = "R å®ç°çš„ x åˆ†å¸ƒ", 
     xlab = "x", 
     col = rgb(0.2, 0.4, 0.6, 0.7),  # åŠé€æ˜è“è‰²
     border = "black", 
     probability = TRUE)
box()  # æ·»åŠ è¾¹æ¡†

# ç»˜åˆ¶ Rcpp å®ç°çš„ x åˆ†å¸ƒ
hist(result_Rcpp$x, 
     breaks = n + 1, 
     main = "Rcpp å®ç°çš„ x åˆ†å¸ƒ", 
     xlab = "x", 
     col = rgb(0.8, 0.2, 0.2, 0.7),  # åŠé€æ˜çº¢è‰²
     border = "black", 
     probability = TRUE)
box()

# ç»˜åˆ¶ R å®ç°çš„ y åˆ†å¸ƒ
hist(result_R$y, 
     breaks = 50, 
     main = "R å®ç°çš„ y åˆ†å¸ƒ", 
     xlab = "y", 
     col = rgb(0.2, 0.6, 0.4, 0.7),  # åŠé€æ˜ç»¿è‰²
     border = "black", 
     probability = TRUE)
box()

# ç»˜åˆ¶ Rcpp å®ç°çš„ y åˆ†å¸ƒ
hist(result_Rcpp$y, 
     breaks = 50, 
     main = "Rcpp å®ç°çš„ y åˆ†å¸ƒ", 
     xlab = "y", 
     col = rgb(0.6, 0.3, 0.8, 0.7),  # åŠé€æ˜ç´«è‰²
     border = "black", 
     probability = TRUE)
box()
```

## ç»“æœåˆ†æ

**1. éšæœºæ•°ç”Ÿæˆæ¯”è¾ƒ**

- **QQ å›¾åˆ†æ**

  - å¯¹äºå˜é‡ $x$ï¼š

    - QQ å›¾æ˜¾ç¤ºï¼ŒR å’Œ Rcpp å®ç°çš„ $x$ å€¼åŸºæœ¬éƒ½è½åœ¨ $y = x$ çš„å‚è€ƒçº¿ä¸Šï¼Œè¯´æ˜ä¸¤ç§æ–¹æ³•ç”Ÿæˆçš„ $x$ åˆ†å¸ƒéå¸¸ç›¸ä¼¼ã€‚

  - å¯¹äºå˜é‡ $y$ï¼š

    - QQ å›¾åŒæ ·æ˜¾ç¤ºï¼Œä¸¤ç§å®ç°æ–¹å¼ç”Ÿæˆçš„ $y$ å€¼åˆ†å¸ƒä¸€è‡´ã€‚

- **ç›´æ–¹å›¾åˆ†æ**
  - $x$ çš„ç›´æ–¹å›¾æ˜¾ç¤ºå‡ºäºŒé¡¹åˆ†å¸ƒçš„ç‰¹å¾ï¼Œå³°å€¼åœ¨ä¸­é—´ï¼Œå·¦å³å¤§è‡´å¯¹ç§°ã€‚

  - $y$ çš„ç›´æ–¹å›¾æ˜¾ç¤ºå‡º Beta åˆ†å¸ƒçš„ç‰¹å¾ï¼Œæ ¹æ®å‚æ•° $a$ å’Œ $b$ï¼Œåˆ†å¸ƒå½¢çŠ¶ä¸ºå¯¹ç§°çš„é’Ÿå½¢æ›²çº¿ã€‚

**2. è®¡ç®—æ—¶é—´æ¯”è¾ƒ**

- **microbenchmark ç»“æœ**

   `microbenchmark` çš„è¾“å‡ºå¦‚ä¸‹ï¼š

```{r, eval=TRUE}
print(benchmark_result)
```


- **ç®±çº¿å›¾åˆ†æ**

  - ç®±çº¿å›¾æ˜¾ç¤ºï¼ŒRcpp å®ç°çš„è¿è¡Œæ—¶é—´æ˜æ˜¾å°äºçº¯ R å®ç°ã€‚

  - Rcpp å®ç°çš„ä¸­ä½æ•°è¿è¡Œæ—¶é—´ä¸º 1.6 æ¯«ç§’å·¦å³ï¼Œè€Œ R å®ç°çš„ä¸­ä½æ•°è¿è¡Œæ—¶é—´ä¸º 12 æ¯«ç§’å·¦å³ã€‚

**3. ç»“æœè¯„è®º**

- **æ•ˆç‡æå‡**

  - Rcpp å®ç°çš„è¿è¡Œé€Ÿåº¦çº¦ä¸ºçº¯ R å®ç°çš„ **1.6/12**ï¼Œå³æ•ˆç‡æé«˜äº† **çº¦8å€**ã€‚

  - è¿™æ˜¯å› ä¸º Rcpp å°†å¾ªç¯éƒ¨åˆ†ç¼–è¯‘æˆäº†é«˜æ•ˆçš„ C++ ä»£ç ï¼Œå‡å°‘äº†è§£é‡Šå™¨çš„å¼€é”€ã€‚

- **ç»“æœä¸€è‡´æ€§**

  - ä¸¤ç§å®ç°æ–¹å¼ç”Ÿæˆçš„éšæœºæ•°åœ¨ç»Ÿè®¡ä¸Šæ²¡æœ‰æ˜¾è‘—å·®å¼‚ï¼Œè¯´æ˜ Rcpp å®ç°æ˜¯æ­£ç¡®çš„ã€‚

- **æ•°å€¼ç¨³å®šæ€§**

  - æˆ‘åœ¨å®ç°ä¸­ä½¿ç”¨äº† R å’Œ Rcpp å†…ç½®çš„éšæœºæ•°ç”Ÿæˆå‡½æ•° `rbinom` å’Œ `rbeta`ï¼Œé¿å…äº†æ‰‹åŠ¨è®¡ç®—æ¦‚ç‡ï¼Œå‡å°‘äº†æ•°å€¼ä¸‹æº¢æˆ–ä¸Šæº¢çš„é£é™©ã€‚

- **ä»£ç å¯è¯»æ€§**

  - Rcpp ä»£ç è™½ç„¶éœ€è¦ç¼–å†™ C++ï¼Œä½†ç”±äºé€»è¾‘ä¸ R ç‰ˆæœ¬ç±»ä¼¼ï¼Œä¸”ä»£ç é‡ä¸å¤§ï¼Œæ˜“äºç†è§£ã€‚

- **å›¾è¡¨å±•ç¤º**
  - é€šè¿‡ QQ å›¾ã€ç›´æ–¹å›¾å’Œç®±çº¿å›¾ï¼Œç›´è§‚åœ°å±•ç¤ºäº†ä¸¤ç§å®ç°çš„å·®å¼‚å’Œç›¸ä¼¼æ€§ï¼Œå¢å¼ºäº†ç»“æœçš„è¯´æœåŠ›ã€‚

**4. æ³¨æ„äº‹é¡¹**

- **éšæœºæ•°ç§å­**

  - å°½ç®¡æˆ‘è®¾ç½®äº†ç›¸åŒçš„éšæœºç§å­ï¼Œä½†ç”±äº R å’Œ Rcpp åœ¨éšæœºæ•°ç”Ÿæˆå™¨çš„å®ç°ç»†èŠ‚ä¸Šå¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œç”Ÿæˆçš„å…·ä½“åºåˆ—å¯èƒ½ä¸åŒï¼Œä½†è¿™ä¸å½±å“æ€»ä½“åˆ†å¸ƒçš„ä¸€è‡´æ€§ã€‚

- **æ•°å€¼ä¸‹æº¢æˆ–ä¸Šæº¢**

  - åœ¨æ•´ä¸ªå®ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘é¿å…äº†ç›´æ¥è®¡ç®—æ¦‚ç‡å¯†åº¦æˆ–ç»„åˆæ•°ï¼Œè€Œæ˜¯åˆ©ç”¨äº†éšæœºæ•°ç”Ÿæˆå‡½æ•°ï¼Œè¿™æ ·å¯ä»¥é¿å…æ•°å€¼ä¸‹æº¢æˆ–ä¸Šæº¢çš„é—®é¢˜ã€‚

- **Burn-in å’Œæ”¶æ•›æ€§**

  - åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒGibbs é‡‡æ ·éœ€è¦è€ƒè™‘ Burn-in æœŸå’Œæ ·æœ¬çš„ç›¸å…³æ€§ã€‚å¯ä»¥ä¸¢å¼ƒå‰ä¸€éƒ¨åˆ†æ ·æœ¬ï¼Œä»¥ç¡®ä¿é“¾å·²è¾¾åˆ°ç¨³æ€ã€‚

- **å‚æ•°çš„å¯è°ƒæ€§**

  - è¿˜å¯ä»¥å°è¯•ä¸åŒçš„å‚æ•° $a, b, n$ å’Œé‡‡æ ·æ¬¡æ•° $N$ï¼Œè§‚å¯Ÿå¯¹ç»“æœçš„å½±å“ã€‚

**5. å°ç»“**

- æˆåŠŸåœ°ä½¿ç”¨ Gibbs é‡‡æ ·å™¨ä»ç›®æ ‡è”åˆåˆ†å¸ƒ $f(x, y)$ ä¸­ç”Ÿæˆäº†æ ·æœ¬ã€‚

- é€šè¿‡æ¯”è¾ƒï¼Œå‘ç° Rcpp å®ç°åœ¨æ•ˆç‡ä¸Šæœ‰æ˜¾è‘—ä¼˜åŠ¿ï¼ŒåŒæ—¶ä¿è¯äº†ç»“æœçš„æ­£ç¡®æ€§ã€‚

- åœ¨æ¶‰åŠå¤§é‡è®¡ç®—æˆ–éœ€è¦æé«˜æ•ˆç‡çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ Rcpp æ˜¯ä¸€ç§æœ‰æ•ˆçš„é€‰æ‹©ã€‚

**6. è¿›ä¸€æ­¥çš„å·¥ä½œ**

- **è‡ªç›¸å…³åˆ†æ**

  - å¯ä»¥è®¡ç®—æ ·æœ¬çš„è‡ªç›¸å…³å‡½æ•°ï¼ˆACFï¼‰ï¼Œè¯„ä¼°é“¾çš„æ··åˆç¨‹åº¦ã€‚

- **æ”¶æ•›è¯Šæ–­**
  - ä½¿ç”¨å¤šæ¡é“¾ï¼Œé‡‡ç”¨ Gelman-Rubin ç»Ÿè®¡é‡ç­‰æ–¹æ³•ï¼Œè¯„ä¼° Gibbs é‡‡æ ·çš„æ”¶æ•›æ€§ã€‚

- **åº”ç”¨äºå®é™…æ•°æ®**

  - å°†è¯¥ Gibbs é‡‡æ ·å™¨åº”ç”¨äºå®é™…æ•°æ®ï¼Œä¼°è®¡å‚æ•°ï¼ŒéªŒè¯æ¨¡å‹çš„é€‚ç”¨æ€§ã€‚

**7. é™„åŠ ä»£ç ï¼ˆè‡ªç›¸å…³åˆ†æç¤ºä¾‹ï¼‰**

```{r, eval=TRUE}
# è®¡ç®— x çš„è‡ªç›¸å…³å‡½æ•°
acf(result_R$x, main = "x çš„è‡ªç›¸å…³å‡½æ•°ï¼ˆR å®ç°ï¼‰")
acf(result_Rcpp$x, main = "x çš„è‡ªç›¸å…³å‡½æ•°ï¼ˆRcpp å®ç°ï¼‰")

# è®¡ç®— y çš„è‡ªç›¸å…³å‡½æ•°
acf(result_R$y, main = "y çš„è‡ªç›¸å…³å‡½æ•°ï¼ˆR å®ç°ï¼‰")
acf(result_Rcpp$y, main = "y çš„è‡ªç›¸å…³å‡½æ•°ï¼ˆRcpp å®ç°ï¼‰")
```

**8. è‡ªç›¸å…³åˆ†æç»“æœ**

- **è§‚å¯Ÿ**
  - å››å¼ å›¾å¾ˆç±»ä¼¼ï¼Œè§„å¾‹åŸºæœ¬ä¸€è‡´ã€‚å›¾ä¸­è“è‰²è™šçº¿è¡¨ç¤ºåœ¨ 95% ç½®ä¿¡æ°´å¹³ä¸‹çš„æ˜¾è‘—æ€§ç•Œé™ã€‚
  - æ»åè¾ƒå°æ—¶ï¼ˆLag < 10ï¼‰ï¼Œè‡ªç›¸å…³ç³»æ•°æ˜¾è‘—é«˜äºè“è‰²è™šçº¿ï¼Œè¯´æ˜åºåˆ—åœ¨çŸ­æœŸå†…å­˜åœ¨æ˜¾è‘—è‡ªç›¸å…³ã€‚åœ¨è¾ƒå¤§æ»åï¼ˆLag > 20ï¼‰æ—¶ï¼Œè‡ªç›¸å…³æ€§åŸºæœ¬æ¶ˆå¤±ã€‚
  - è‡ªç›¸å…³ç³»æ•°é«˜è¯´æ˜æ ·æœ¬ä¹‹é—´å­˜åœ¨ä¾èµ–æ€§ï¼Œè¿™ä¼šé™ä½æ ·æœ¬çš„æœ‰æ•ˆæ€§ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ”¹å–„ï¼š
    - **Thinning**ï¼šå¢åŠ é‡‡æ ·é—´éš”ï¼ˆä¾‹å¦‚ï¼Œæ¯éš” 5 æˆ– 10 æ¬¡é‡‡æ ·è®°å½•ä¸€æ¬¡ï¼‰ã€‚
    - **Burn-in**ï¼šä¸¢å¼ƒå‰æœŸçš„é‡‡æ ·å€¼ä»¥å‡å¼±åˆå§‹å€¼çš„å½±å“ã€‚
  - Rcpp å®ç°çš„ç»“æœåœ¨å›¾å½¢ä¸Šä¸ R å®ç°ä¸€è‡´ï¼Œè¯´æ˜ Rcpp ä¿æŒäº†ä¸ R ç›¸åŒçš„éšæœºç‰¹æ€§ã€‚
- **è°ƒæ•´**
  - éœ€è¦æ›´ç‹¬ç«‹çš„æ ·æœ¬ï¼Œå¯ä»¥å¼•å…¥ Thinning æŠ€æœ¯æˆ–å¢åŠ é‡‡æ ·é—´éš”ä»¥æ”¹å–„æ ·æœ¬è´¨é‡ã€‚
  - **æ”¶æ•›æ€§åˆ†æ**ï¼šè¿›ä¸€æ­¥è¯„ä¼° Gibbs é‡‡æ ·çš„æ”¶æ•›æ€§ï¼Œç¡®ä¿æ ·æœ¬å·²å……åˆ†åæ˜ ç›®æ ‡åˆ†å¸ƒã€‚
  - **æ›´å¤šé“¾çš„å®éªŒ**ï¼šè¿è¡Œå¤šæ¡ç‹¬ç«‹é“¾ï¼Œæ¯”è¾ƒä¸åŒé“¾çš„ç»“æœï¼Œä»¥è¿›ä¸€æ­¥éªŒè¯æ”¶æ•›æ€§å’Œç¨³å®šæ€§ã€‚

------------------------------------------------------------------------

# æ€»ç»“

## å›°éš¾ä¸è§£å†³æ–¹å¼

åœ¨å®Œæˆæœ¬æ¬¡å®éªŒçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘é‡åˆ°äº†å¤šä¸ªæŒ‘æˆ˜ã€‚é¦–å…ˆï¼Œç†è§£Gibbsé‡‡æ ·å™¨çš„åŸç†å¹¶å°†å…¶åº”ç”¨äºç»™å®šçš„è”åˆåˆ†å¸ƒæ˜¯ä¸€ä¸ªä¸å°çš„éš¾é¢˜ã€‚è™½ç„¶ç†è®ºä¸Šæ˜ç™½Gibbsé‡‡æ ·çš„æ­¥éª¤ï¼Œä½†åœ¨å®é™…æ“ä½œä¸­ï¼Œå¦‚ä½•å‡†ç¡®åœ°ä»æ¡ä»¶åˆ†å¸ƒä¸­æŠ½æ ·ï¼Œä»¥åŠç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§ï¼Œéœ€è¦æ·±å…¥çš„æ€è€ƒå’Œæ¨å¯¼ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è¯¦ç»†æ¨å¯¼äº†è”åˆåˆ†å¸ƒ$f(x, y)$çš„æ¡ä»¶åˆ†å¸ƒï¼Œç¡®è®¤äº†$x|y$æœä»äºŒé¡¹åˆ†å¸ƒ$Binomial(n, y)$ï¼Œè€Œ$y|x$æœä»Betaåˆ†å¸ƒ$Beta(x+a, n-x+b)$ã€‚è¿™ä¸€æ¨å¯¼è¿‡ç¨‹å·©å›ºäº†æˆ‘å¯¹ç»Ÿè®¡ç†è®ºçš„ç†è§£ï¼Œä¹Ÿä¸ºä»£ç å®ç°æä¾›äº†æ˜ç¡®çš„æ–¹å‘ã€‚

å…¶æ¬¡ï¼Œåœ¨ä½¿ç”¨Rcppä¼˜åŒ–ä»£ç æ—¶ï¼Œæˆ‘é¢ä¸´ç€C++è¯­è¨€çš„è¯­æ³•å’Œä¸Rè¯­è¨€æ¥å£çš„å¤æ‚æ€§ã€‚ç‰¹åˆ«æ˜¯åœ¨Rcppä¸­å¦‚ä½•è°ƒç”¨Rçš„éšæœºæ•°ç”Ÿæˆå‡½æ•°ï¼Œä»¥åŠå¦‚ä½•æ­£ç¡®åœ°åˆå§‹åŒ–å’Œä¼ é€’å‚æ•°ï¼Œè¿™äº›éƒ½æ˜¯å®é™…ç¼–ç¨‹æ—¶çš„éšœç¢ã€‚

ä¸ºæ­¤ï¼Œæˆ‘æŸ¥é˜…äº†å¤§é‡çš„æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç ï¼Œå­¦ä¹ äº†Rcppä¸­`R::rbinom`å’Œ`R::rbeta`ç­‰å‡½æ•°çš„ç”¨æ³•ã€‚é€šè¿‡ä¸æ–­åœ°è¯•é”™å’Œè°ƒè¯•ï¼Œæˆ‘ç»ˆäºæˆåŠŸåœ°ç¼–å†™å‡ºäº†åŠŸèƒ½æ­£ç¡®ä¸”é«˜æ•ˆçš„Rcppå‡½æ•°ã€‚è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ·±åˆ»ä½“ä¼šåˆ°è€å¿ƒå’Œç»†è‡´å¯¹äºè§£å†³ç¼–ç¨‹é—®é¢˜çš„é‡è¦æ€§ã€‚

æœ€åï¼Œåœ¨æ¯”è¾ƒä¸¤ç§æ–¹æ³•çš„è®¡ç®—æ—¶é—´å’Œç»“æœæ—¶ï¼Œå¦‚ä½•æœ‰æ•ˆåœ°å±•ç¤ºæ•°æ®ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚æˆ‘å­¦ä¹ å¹¶ä½¿ç”¨äº†`microbenchmark`åŒ…æ¥ç²¾ç¡®æµ‹é‡å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼Œåˆ©ç”¨`qqplot`å’Œç›´æ–¹å›¾æ¥æ¯”è¾ƒéšæœºæ•°çš„åˆ†å¸ƒã€‚è¿™äº›å·¥å…·çš„ä½¿ç”¨ä¸ä»…æå‡äº†å®éªŒçš„è´¨é‡ï¼Œä¹ŸåŠ æ·±äº†æˆ‘å¯¹æ•°æ®åˆ†ææ–¹æ³•çš„ç†è§£ã€‚

## æ€è€ƒä¸æ„Ÿæ‚Ÿ

è¿™æ¬¡å®éªŒè®©æˆ‘æ·±åˆ»ä½“ä¼šåˆ°ç†è®ºä¸å®è·µç›¸ç»“åˆçš„é‡è¦æ€§ã€‚ä»…ä»…æŒæ¡ç»Ÿè®¡æ¨¡å‹å’Œç®—æ³•çš„ç†è®ºæ˜¯ä¸å¤Ÿçš„ï¼Œå¿…é¡»èƒ½å¤Ÿå°†å…¶è½¬åŒ–ä¸ºé«˜æ•ˆçš„ä»£ç ï¼Œå®ç°å…·ä½“çš„åº”ç”¨ä»·å€¼ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç¼–ç¨‹èƒ½åŠ›å’Œå¯¹æ–°å·¥å…·çš„å­¦ä¹ èƒ½åŠ›æ˜¾å¾—å°¤ä¸ºå…³é”®ã€‚

é€šè¿‡æ¯”è¾ƒRå’ŒRcppçš„å®ç°ï¼Œæˆ‘è®¤è¯†åˆ°é«˜æ•ˆçš„ç®—æ³•å’Œä¼˜åŒ–çš„ä»£ç èƒ½å¤Ÿæå¤§åœ°æå‡è®¡ç®—æ•ˆç‡ã€‚è¿™è®©æˆ‘åæ€ï¼Œåœ¨æ•°æ®è§„æ¨¡æ—¥ç›Šåºå¤§çš„ä»Šå¤©ï¼Œå¦‚ä½•é€šè¿‡ä¼˜åŒ–ç®—æ³•å’Œåˆ©ç”¨é«˜æ€§èƒ½è®¡ç®—å·¥å…·æ¥æå‡æ•°æ®å¤„ç†èƒ½åŠ›ï¼Œæ˜¯æˆ‘ä»¬å¿…é¡»é¢å¯¹å’Œè§£å†³çš„é—®é¢˜ã€‚

æ­¤å¤–ï¼Œæˆ‘æ„Ÿå—åˆ°åšæŒå’ŒåŠªåŠ›çš„é‡è¦æ€§ã€‚ä»æ¨å¯¼å…¬å¼ã€ç¼–å†™ä»£ç åˆ°åˆ†æç»“æœï¼Œæ¯ä¸€ä¸ªç¯èŠ‚éƒ½éœ€è¦æŠ•å…¥æ—¶é—´å’Œç²¾åŠ›ã€‚è™½ç„¶è¿‡ç¨‹å……æ»¡æŒ‘æˆ˜ï¼Œä½†å½“æœ€ç»ˆçœ‹åˆ°å®éªŒæˆåŠŸã€ç»“æœåˆç†æ—¶ï¼Œé‚£ç§æˆå°±æ„Ÿæ˜¯æ— å¯æ¯”æ‹Ÿçš„ã€‚è¿™ä¹Ÿæ¿€åŠ±æˆ‘åœ¨ä»Šåçš„å­¦ä¹ ä¸­ï¼Œé¢å¯¹å›°éš¾æ—¶ä¸è½»è¨€æ”¾å¼ƒï¼Œå‹‡äºæŒ‘æˆ˜è‡ªæˆ‘ã€‚

é€šè¿‡è¿™æ¬¡å®éªŒï¼Œæˆ‘ä¸ä»…å·©å›ºäº†å¯¹Gibbsé‡‡æ ·å’Œç»Ÿè®¡è®¡ç®—çš„ç†è§£ï¼Œè¿˜æå‡äº†ç¼–ç¨‹èƒ½åŠ›å’Œé—®é¢˜è§£å†³èƒ½åŠ›ã€‚è¿™äº›æ”¶è·å°†æˆä¸ºæˆ‘æœªæ¥å­¦ä¹ å’Œå·¥ä½œçš„å®è´µè´¢å¯Œã€‚

------------------------------------------------------------------------
